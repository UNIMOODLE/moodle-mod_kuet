{"version":3,"file":"teachercontrolpanel.min.js","sources":["../src/teachercontrolpanel.js"],"sourcesContent":["\"use strict\";\r\n/* eslint-disable no-unused-vars */\r\n\r\nimport jQuery from 'jquery';\r\nimport {get_strings as getStrings} from 'core/str';\r\nimport Notification from 'core/notification';\r\nimport ModalFactory from 'core/modal_factory';\r\nimport ModalEvents from 'core/modal_events';\r\n\r\nlet REGION = {\r\n    CONTROLPANEL: '[data-region=\"teacher_control_panel\"]', // This root.\r\n    JUMPTOINPUT: '[data-input=\"jumpto\"]',\r\n    SWITCHS: '.showhide-action',\r\n};\r\n\r\nlet ACTION = {\r\n    NEXT: '[data-action=\"next\"]',\r\n    PAUSE: '[data-action=\"pause\"]',\r\n    PLAY: '[data-action=\"play\"]',\r\n    RESEND: '[data-action=\"resend\"]',\r\n    JUMP: '[data-action=\"jump\"]',\r\n    FINISHQUESTION: '[data-action=\"finishquestion\"]',\r\n    SHOWHIDE_RESPONSES: '[data-action=\"showhide_responses\"]',\r\n    SHOWHIDE_STATISTICS: '[data-action=\"showhide_statistics\"]',\r\n    SHOWHIDE_FEEDBACK: '[data-action=\"showhide_feedback\"]',\r\n    IMPROVISE: '[data-action=\"improvise\"]',\r\n    VOTE: '[data-action=\"vote\"]',\r\n    ENDSESSION: '[data-action=\"endsession\"]'\r\n};\r\n\r\nTeacherControlPanel.prototype.root = null;\r\nTeacherControlPanel.prototype.jqid = null;\r\n\r\n/**\r\n * @constructor\r\n * @param {String} region\r\n * @param {int} jqid\r\n */\r\nfunction TeacherControlPanel(region, jqid) {\r\n    this.root = jQuery(region);\r\n    this.jqid = jqid;\r\n    this.initControlPanel();\r\n    finishquestionEvent = new Event('teacherQuestionEnd_' + this.jqid);\r\n}\r\n\r\nconst nextEvent = new Event('nextQuestion');\r\nconst pauseEvent = new Event('pauseQuestionSelf');\r\nconst playEvent = new Event('playQuestionSelf');\r\nconst resendEvent = new Event('resendSelf');\r\nconst finishquestionEventSelf = new Event('teacherQuestionEndSelf');\r\nconst endSession = new Event('endSession');\r\nconst showAnswers = new Event('showAnswersSelf');\r\nconst hideAnswers = new Event('hideAnswersSelf');\r\nconst showStatistics = new Event('showStatisticsSelf');\r\nconst hideStatistics = new Event('hideStatisticsSelf');\r\nconst showFeedback = new Event('showFeedbackSelf');\r\nconst hideFeedback = new Event('hideFeedbackSelf');\r\nlet finishquestionEvent = null;\r\nlet questionEnd = false;\r\n\r\nTeacherControlPanel.prototype.initControlPanel = function() {\r\n    this.root.find(ACTION.NEXT).on('click', this.next);\r\n    this.root.find(ACTION.PAUSE).on('click', this.pause);\r\n    this.root.find(ACTION.PLAY).on('click', this.play);\r\n    this.root.find(ACTION.RESEND).on('click', this.resend);\r\n    this.root.find(ACTION.JUMP).on('click', this.jump);\r\n    this.root.find(REGION.JUMPTOINPUT).on('keyup', (e) => {\r\n        if (e.key === 'Enter' || e.keyCode === 13) {\r\n            TeacherControlPanel.prototype.jump();\r\n        }\r\n    });\r\n    this.root.find(ACTION.FINISHQUESTION).on('click', this.finishquestion);\r\n    this.root.find(ACTION.ENDSESSION).on('click', this.endsession);\r\n    this.root.find(ACTION.SHOWHIDE_RESPONSES).on('click', function(e) {\r\n        if (jQuery(ACTION.SHOWHIDE_RESPONSES).is(':checked')) {\r\n            TeacherControlPanel.prototype.showAnswers();\r\n        } else {\r\n            TeacherControlPanel.prototype.hideAnswers();\r\n        }\r\n    });\r\n    this.root.find(ACTION.SHOWHIDE_STATISTICS).on('click', function() {\r\n        if (jQuery(ACTION.SHOWHIDE_STATISTICS).is(':checked')) {\r\n            TeacherControlPanel.prototype.showStatistics();\r\n        } else {\r\n            TeacherControlPanel.prototype.hideStatistics();\r\n        }\r\n    });\r\n    this.root.find(ACTION.SHOWHIDE_FEEDBACK).on('click', function() {\r\n        if (jQuery(ACTION.SHOWHIDE_FEEDBACK).is(':checked')) {\r\n            TeacherControlPanel.prototype.showFeedback();\r\n        } else {\r\n            TeacherControlPanel.prototype.hideFeedback();\r\n        }\r\n    });\r\n};\r\n\r\n// TODO prevent default and stop propagations.\r\n// TODO disable show/hide until the question is finalised.\r\n\r\nTeacherControlPanel.prototype.next = function() {\r\n    dispatchEvent(nextEvent);\r\n};\r\n\r\nTeacherControlPanel.prototype.pause = function() {\r\n    dispatchEvent(pauseEvent);\r\n    jQuery(ACTION.PAUSE).addClass('d-none');\r\n    jQuery(ACTION.PLAY).removeClass('d-none');\r\n};\r\n\r\nTeacherControlPanel.prototype.play = function(e) {\r\n    dispatchEvent(playEvent);\r\n    jQuery(ACTION.PAUSE).removeClass('d-none');\r\n    jQuery(ACTION.PLAY).addClass('d-none');\r\n};\r\n\r\nTeacherControlPanel.prototype.resend = function() {\r\n    dispatchEvent(resendEvent);\r\n};\r\n\r\nTeacherControlPanel.prototype.jump = function() {\r\n    let numquestion = jQuery(REGION.JUMPTOINPUT).data('numquestions');\r\n    let value = jQuery(REGION.JUMPTOINPUT).val();\r\n    if (value > numquestion || value < 1) {\r\n        const stringkeys = [\r\n            {key: 'jump', component: 'mod_jqshow'},\r\n            {key: 'jumpto_error', component: 'mod_jqshow', param: numquestion},\r\n            {key: 'confirm', component: 'mod_jqshow'}\r\n        ];\r\n        getStrings(stringkeys).then((langStrings) => {\r\n            return ModalFactory.create({\r\n                title: langStrings[0],\r\n                body: langStrings[1],\r\n                type: ModalFactory.types.CANCEL\r\n            }).then(modal => {\r\n                modal.getRoot().on(ModalEvents.hidden, () => {\r\n                    jQuery(REGION.JUMPTOINPUT).val('');\r\n                    modal.destroy();\r\n                });\r\n                return modal;\r\n            });\r\n        }).done(function(modal) {\r\n            modal.show();\r\n        }).fail(Notification.exception);\r\n    } else {\r\n        let jumpEvent = new CustomEvent('jumpTo', {\r\n            \"detail\": {\"jumpTo\": value}\r\n        });\r\n        dispatchEvent(jumpEvent);\r\n    }\r\n};\r\n\r\nTeacherControlPanel.prototype.finishquestion = function() {\r\n    dispatchEvent(finishquestionEventSelf);\r\n    questionEnd = true;\r\n    jQuery(REGION.SWITCHS).removeClass('disabled');\r\n};\r\n\r\nTeacherControlPanel.prototype.showAnswers = function() {\r\n    dispatchEvent(showAnswers);\r\n};\r\n\r\nTeacherControlPanel.prototype.hideAnswers = function() {\r\n    dispatchEvent(hideAnswers);\r\n};\r\n\r\nTeacherControlPanel.prototype.showStatistics = function() {\r\n    dispatchEvent(showStatistics);\r\n};\r\n\r\nTeacherControlPanel.prototype.hideStatistics = function() {\r\n    dispatchEvent(hideStatistics);\r\n};\r\n\r\nTeacherControlPanel.prototype.showFeedback = function() {\r\n    dispatchEvent(showFeedback);\r\n};\r\n\r\nTeacherControlPanel.prototype.hideFeedback = function() {\r\n    dispatchEvent(hideFeedback);\r\n};\r\n\r\nTeacherControlPanel.prototype.endsession = function() {\r\n    dispatchEvent(endSession);\r\n};\r\n\r\nexport const teacherControlPanel = (region, jqid) => {\r\n    return new TeacherControlPanel(region, jqid);\r\n};\r\n"],"names":["REGION","ACTION","TeacherControlPanel","region","jqid","root","initControlPanel","finishquestionEvent","Event","this","prototype","nextEvent","pauseEvent","playEvent","resendEvent","finishquestionEventSelf","endSession","showAnswers","hideAnswers","showStatistics","hideStatistics","showFeedback","hideFeedback","questionEnd","find","on","next","pause","play","resend","jump","e","key","keyCode","finishquestion","endsession","is","dispatchEvent","addClass","removeClass","numquestion","data","value","val","stringkeys","component","param","then","langStrings","ModalFactory","create","title","body","type","types","CANCEL","modal","getRoot","ModalEvents","hidden","destroy","done","show","fail","Notification","exception","jumpEvent","CustomEvent"],"mappings":"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"}