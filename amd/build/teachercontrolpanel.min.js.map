{"version":3,"file":"teachercontrolpanel.min.js","sources":["../src/teachercontrolpanel.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n// Project implemented by the \"Recovery, Transformation and Resilience Plan.\n// Funded by the European Union - Next GenerationEU\".\n//\n// Produced by the UNIMOODLE University Group: Universities of\n// Valladolid, Complutense de Madrid, UPV/EHU, León, Salamanca,\n// Illes Balears, Valencia, Rey Juan Carlos, La Laguna, Zaragoza, Málaga,\n// Córdoba, Extremadura, Vigo, Las Palmas de Gran Canaria y Burgos..\n\n/**\n *\n * @module    mod_kuet/teachercontrolpanel\n * @copyright  2023 Proyecto UNIMOODLE {@link https://unimoodle.github.io}\n * @author     UNIMOODLE Group (Coordinator) <direccion.area.estrategia.digital@uva.es>\n * @author     3IPUNT <contacte@tresipunt.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n\"use strict\";\n/* eslint-disable no-unused-vars */\n\nimport jQuery from 'jquery';\nimport {get_strings as getStrings} from 'core/str';\nimport Notification from 'core/notification';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\n\nlet REGION = {\n    CONTROLPANEL: '[data-region=\"teacher_control_panel\"]', // This root.\n    JUMPTOINPUT: '[data-input=\"jumpto\"]',\n    SWITCHS: '.showhide-action',\n    ESPECIALS: '.special-action',\n    IMPROVISE: '.special-action.improvise-question',\n};\n\nlet ACTION = {\n    NEXT: '[data-action=\"next\"]',\n    PAUSE: '[data-action=\"pause\"]',\n    PLAY: '[data-action=\"play\"]',\n    RESEND: '[data-action=\"resend\"]',\n    JUMP: '[data-action=\"jump\"]',\n    FINISHQUESTION: '[data-action=\"finishquestion\"]',\n    SHOWHIDE_RESPONSES: '[data-action=\"showhide_responses\"]',\n    SHOWHIDE_STATISTICS: '[data-action=\"showhide_statistics\"]',\n    SHOWHIDE_FEEDBACK: '[data-action=\"showhide_feedback\"]',\n    IMPROVISE: '[data-action=\"improvise\"]',\n    VOTE: '[data-action=\"vote\"]',\n    ENDSESSION: '[data-action=\"endsession\"]',\n    COLLAPSE: '.teacher-control-panel-collapse',\n};\n\nTeacherControlPanel.prototype.root = null;\nTeacherControlPanel.prototype.kid = null;\n\n/**\n * @constructor\n * @param {String} region\n * @param {int} kid\n */\nfunction TeacherControlPanel(region, kid) {\n    this.root = jQuery(region);\n    this.kid = kid;\n    this.initControlPanel();\n    finishquestionEvent = new Event('teacherQuestionEnd_' + this.kid);\n}\n\nconst nextEvent = new Event('nextQuestion');\nconst pauseEvent = new Event('pauseQuestionSelf');\nconst playEvent = new Event('playQuestionSelf');\nconst resendEvent = new Event('resendSelf');\nconst finishquestionEventSelf = new Event('teacherQuestionEndSelf');\nconst endSession = new Event('endSession');\nconst showAnswers = new Event('showAnswersSelf');\nconst hideAnswers = new Event('hideAnswersSelf');\nconst showStatistics = new Event('showStatisticsSelf');\nconst hideStatistics = new Event('hideStatisticsSelf');\nconst showFeedback = new Event('showFeedbackSelf');\nconst hideFeedback = new Event('hideFeedbackSelf');\nconst improvise = new Event('improvise');\nconst vote = new Event('initVote');\nlet finishquestionEvent = null;\nlet questionEnd = false;\n\nTeacherControlPanel.prototype.initControlPanel = function() {\n    this.root.find(ACTION.NEXT).on('click', this.next);\n    this.root.find(ACTION.PAUSE).on('click', this.pause);\n    this.root.find(ACTION.PLAY).on('click', this.play);\n    this.root.find(ACTION.RESEND).on('click', this.resend);\n    this.root.find(ACTION.JUMP).on('click', this.jump);\n    this.root.find(REGION.JUMPTOINPUT).on('keyup', (e) => {\n        if (e.key === 'Enter' || e.keyCode === 13) {\n            TeacherControlPanel.prototype.jump();\n        }\n    });\n    this.root.find(ACTION.FINISHQUESTION).on('click', this.finishquestion);\n    this.root.find(ACTION.ENDSESSION).on('click', this.endsession);\n    this.root.find(ACTION.SHOWHIDE_RESPONSES).on('click', function(e) {\n        if (jQuery(ACTION.SHOWHIDE_RESPONSES).is(':checked')) {\n            TeacherControlPanel.prototype.showAnswers();\n        } else {\n            TeacherControlPanel.prototype.hideAnswers();\n        }\n    });\n    this.root.find(ACTION.SHOWHIDE_STATISTICS).on('click', function() {\n        if (jQuery(ACTION.SHOWHIDE_STATISTICS).is(':checked')) {\n            TeacherControlPanel.prototype.showStatistics();\n        } else {\n            TeacherControlPanel.prototype.hideStatistics();\n        }\n    });\n    this.root.find(ACTION.SHOWHIDE_FEEDBACK).on('click', function() {\n        if (jQuery(ACTION.SHOWHIDE_FEEDBACK).is(':checked')) {\n            TeacherControlPanel.prototype.showFeedback();\n        } else {\n            TeacherControlPanel.prototype.hideFeedback();\n        }\n    });\n    this.root.find(ACTION.IMPROVISE).on('click', function() {\n        TeacherControlPanel.prototype.improvise();\n    });\n    this.root.find(ACTION.VOTE).on('click', function() {\n        TeacherControlPanel.prototype.vote();\n    });\n    jQuery(ACTION.COLLAPSE).on('click', function() {\n        setTimeout(function() {\n            if (jQuery(ACTION.COLLAPSE + '.collapsed').length !== 0) {\n                jQuery('.content-raceresults').animate({\n                    width: '100%'\n                }, 400).css({\n                    width: '100%'\n                });\n            } else {\n                jQuery('.content-raceresults').animate({\n                    width: jQuery('.question-body').width() - 260 + 'px'\n                }, 400).css({\n                    width: 'calc(100% - 260px)'\n                });\n            }\n        }, 100);\n    });\n};\n\nTeacherControlPanel.prototype.next = function() {\n    dispatchEvent(nextEvent);\n};\n\nTeacherControlPanel.prototype.pause = function() {\n    dispatchEvent(pauseEvent);\n    jQuery(ACTION.PAUSE).addClass('d-none');\n    jQuery(ACTION.PLAY).removeClass('d-none');\n};\n\nTeacherControlPanel.prototype.play = function(e) {\n    dispatchEvent(playEvent);\n    jQuery(ACTION.PAUSE).removeClass('d-none');\n    jQuery(ACTION.PLAY).addClass('d-none');\n};\n\nTeacherControlPanel.prototype.resend = function() {\n    dispatchEvent(resendEvent);\n};\n\nTeacherControlPanel.prototype.jump = function() {\n    let numquestion = jQuery(REGION.JUMPTOINPUT).data('numquestions');\n    let value = jQuery(REGION.JUMPTOINPUT).val();\n    if (value > numquestion || value < 1) {\n        const stringkeys = [\n            {key: 'jump', component: 'mod_kuet'},\n            {key: 'jumpto_error', component: 'mod_kuet', param: numquestion},\n            {key: 'confirm', component: 'mod_kuet'}\n        ];\n        getStrings(stringkeys).then((langStrings) => {\n            return ModalFactory.create({\n                title: langStrings[0],\n                body: langStrings[1],\n                type: ModalFactory.types.CANCEL\n            }).then(modal => {\n                modal.getRoot().on(ModalEvents.hidden, () => {\n                    jQuery(REGION.JUMPTOINPUT).val('');\n                    modal.destroy();\n                });\n                return modal;\n            });\n        }).done(function(modal) {\n            modal.show();\n        }).fail(Notification.exception);\n    } else {\n        let jumpEvent = new CustomEvent('jumpTo', {\n            \"detail\": {\"jumpTo\": value}\n        });\n        dispatchEvent(jumpEvent);\n    }\n};\n\nTeacherControlPanel.prototype.finishquestion = function() {\n    dispatchEvent(finishquestionEventSelf);\n    questionEnd = true;\n    jQuery(REGION.SWITCHS).removeClass('disabled');\n    jQuery(REGION.IMPROVISE).removeClass('disabled');\n    jQuery(ACTION.FINISHQUESTION).addClass('d-none');\n    jQuery(ACTION.NEXT).removeClass('d-none');\n};\n\nTeacherControlPanel.prototype.showAnswers = function() {\n    dispatchEvent(showAnswers);\n};\n\nTeacherControlPanel.prototype.hideAnswers = function() {\n    dispatchEvent(hideAnswers);\n};\n\nTeacherControlPanel.prototype.showStatistics = function() {\n    dispatchEvent(showStatistics);\n};\n\nTeacherControlPanel.prototype.hideStatistics = function() {\n    dispatchEvent(hideStatistics);\n};\n\nTeacherControlPanel.prototype.showFeedback = function() {\n    dispatchEvent(showFeedback);\n};\n\nTeacherControlPanel.prototype.hideFeedback = function() {\n    dispatchEvent(hideFeedback);\n};\n\nTeacherControlPanel.prototype.improvise = function() {\n    dispatchEvent(improvise);\n};\n\nTeacherControlPanel.prototype.vote = function() {\n    dispatchEvent(vote);\n};\n\nTeacherControlPanel.prototype.endsession = function() {\n    dispatchEvent(endSession);\n};\n\nexport const teacherControlPanel = (region, kid) => {\n    return new TeacherControlPanel(region, kid);\n};\n"],"names":["REGION","ACTION","TeacherControlPanel","region","kid","root","initControlPanel","finishquestionEvent","Event","this","prototype","nextEvent","pauseEvent","playEvent","resendEvent","finishquestionEventSelf","endSession","showAnswers","hideAnswers","showStatistics","hideStatistics","showFeedback","hideFeedback","improvise","vote","questionEnd","find","on","next","pause","play","resend","jump","e","key","keyCode","finishquestion","endsession","is","setTimeout","length","animate","width","css","dispatchEvent","addClass","removeClass","numquestion","data","value","val","stringkeys","component","param","then","langStrings","ModalFactory","create","title","body","type","types","CANCEL","modal","getRoot","ModalEvents","hidden","destroy","done","show","fail","Notification","exception","jumpEvent","CustomEvent"],"mappings":"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"}