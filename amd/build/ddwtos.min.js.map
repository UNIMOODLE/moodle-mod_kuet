{"version":3,"file":"ddwtos.min.js","sources":["../src/ddwtos.js"],"sourcesContent":["\"use strict\";\n\nimport jQuery from 'jquery';\nimport Ajax from 'core/ajax';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\nimport mEvent from 'core/event';\n/*import DragDrop from 'core/local/reactive/dragdrop';*/\nimport dragDrop from 'core/dragdrop';\n\nlet ACTION = {\n    SEND_RESPONSE: '[data-action=\"send-response\"]',\n};\n\nlet REGION = {\n    ROOT: '[data-region=\"question-content\"]',\n    LOADING: '[data-region=\"overlay-icon-container\"]',\n    NEXT: '[data-action=\"next-question\"]',\n    TIMER: '[data-region=\"question-timer\"]',\n    SECONDS: '[data-region=\"seconds\"]',\n    CONTENTFEEDBACKS: '[data-region=\"containt-feedbacks\"]',\n    FEEDBACK: '[data-region=\"statement-feedback\"]',\n    FEEDBACKANSWER: '[data-region=\"answer-feedback\"]',\n    FEEDBACKBACGROUND: '[data-region=\"feedback-background\"]',\n    AREA: '#drag_and_drop_area',\n    DRAGHOME: '.draghome',\n    DRAGELEMENT: '.draghome.user-select-none',\n    DROPELEMENT: '.drop.active',\n    INPUTPLACE: '.placeinput',\n    STATEMENTTEXT: '[data-region=\"statement-text\"]',\n    STATEMENTTEXT_CONTENT: '[data-region=\"statement-text\"] .statement-text',\n    ICONSANSWERS: '.icon.text-success, .icon.text-danger'\n};\n\nlet SERVICES = {\n    REPLY: 'mod_jqshow_ddwtos'\n};\n\nlet TEMPLATES = {\n    LOADING: 'core/overlay_loading'\n};\n\nlet cmId;\nlet sId;\nlet questionid;\nlet jqshowId;\nlet jqid;\nlet questionEnd = false;\nlet showQuestionFeedback = false;\nlet manualMode = false;\n\n/** @type {jQuery} The jQuery node for the page region. */\nDdwtos.prototype.node = null;\nDdwtos.prototype.endTimer = new Event('endTimer');\nDdwtos.prototype.studentQuestionEnd = new Event('studentQuestionEnd');\nDdwtos.prototype.questionAnswer = {};\n\n/**\n * @constructor\n * @param {String} selector\n * @param {Boolean} showquestionfeedback\n * @param {Boolean} manualmode\n * @param {String} jsonresponse\n */\nfunction Ddwtos(selector, showquestionfeedback = false, manualmode = false, jsonresponse = '') {\n    this.node = jQuery(selector);\n    sId = this.node.attr('data-sid');\n    cmId = this.node.attr('data-cmid');\n    questionid = this.node.attr('data-questionid');\n    jqshowId = this.node.attr('data-jqshowid');\n    jqid = this.node.attr('data-jqid');\n    showQuestionFeedback = showquestionfeedback;\n    manualMode = manualmode;\n    questionEnd = false;\n    if (jsonresponse !== '') {\n        this.answered(JSON.parse(jsonresponse), false);\n        if (manualMode === false || jQuery('.modal-body').length) {\n            questionEnd = true;\n            if (showQuestionFeedback === true) {\n                this.showFeedback();\n            }\n            this.showAnswers();\n        }\n    }\n    Ddwtos.prototype.initDdwtos();\n    questionManager.init('drag_and_drop_area', false);\n}\n\nDdwtos.prototype.initDdwtos = function() {\n    jQuery(ACTION.SEND_RESPONSE).on('click', Ddwtos.prototype.reply);\n    Ddwtos.prototype.initEvents();\n    Ddwtos.prototype.resizeAllDragsAndDrops();\n    Ddwtos.prototype.cloneDrags();\n    Ddwtos.prototype.positionDrags();\n    if (questionEnd === false) {\n        Ddwtos.prototype.initDragAndDrop();\n    }\n};\n\nDdwtos.prototype.initEvents = function() {\n    addEventListener('timeFinish', Ddwtos.prototype.reply, {once: true});\n    if (manualMode !== false) {\n        addEventListener('teacherQuestionEnd_' + jqid, (e) => {\n            if (questionEnd !== true) {\n                Ddwtos.prototype.reply();\n            }\n            e.detail.statistics.forEach((statistic) => {\n                jQuery('[data-answerid=\"' + statistic.answerid + '\"] .numberofreplies').html(statistic.numberofreplies);\n            });\n        }, {once: true});\n        addEventListener('pauseQuestion_' + jqid, () => {\n            Ddwtos.prototype.pauseQuestion();\n        }, false);\n        addEventListener('playQuestion_' + jqid, () => {\n            Ddwtos.prototype.playQuestion();\n        }, false);\n        addEventListener('showAnswers_' + jqid, () => {\n            Ddwtos.prototype.showAnswers();\n        }, false);\n        addEventListener('hideAnswers_' + jqid, () => {\n            Ddwtos.prototype.hideAnswers();\n        }, false);\n        addEventListener('showStatistics_' + jqid, () => {\n            Ddwtos.prototype.showStatistics();\n        }, false);\n        addEventListener('hideStatistics_' + jqid, () => {\n            Ddwtos.prototype.hideStatistics();\n        }, false);\n        addEventListener('showFeedback_' + jqid, () => {\n            Ddwtos.prototype.showFeedback();\n        }, false);\n        addEventListener('hideFeedback_' + jqid, () => {\n            Ddwtos.prototype.hideFeedback();\n        }, false);\n    }\n\n    window.onbeforeunload = function() {\n        if (jQuery(REGION.SECONDS).length > 0 && questionEnd === false) {\n            Ddwtos.prototype.reply();\n            return 'Because the question is overdue and an attempt has been made to reload the page,' +\n                ' the question has remained unanswered.';\n        }\n    };\n};\n\nDdwtos.prototype.removeEvents = function() {\n    removeEventListener('timeFinish', Ddwtos.prototype.reply, {once: true});\n};\n\nDdwtos.prototype.reply = function() {\n    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n        jQuery(REGION.ROOT).append(html);\n        dispatchEvent(Ddwtos.prototype.endTimer);\n        Ddwtos.prototype.removeEvents();\n        let inputPlaces = document.querySelectorAll(REGION.INPUTPLACE);\n        let response = {};\n        let i = 1;\n        inputPlaces.forEach(function(input) {\n            response['p' + i] = input.value;\n            i++;\n        });\n        let timeLeft = parseInt(jQuery(REGION.SECONDS).text());\n        let request = {\n            methodname: SERVICES.REPLY,\n            args: {\n                sessionid: sId,\n                jqshowid: jqshowId,\n                cmid: cmId,\n                questionid: questionid,\n                jqid: jqid,\n                timeleft: timeLeft || 0,\n                preview: false,\n                response: JSON.stringify(response)\n            }\n        };\n        Ajax.call([request])[0].done(function(response) {\n            if (response.reply_status === true) {\n                questionEnd = true;\n                Ddwtos.prototype.answered(response, true);\n                dispatchEvent(Ddwtos.prototype.studentQuestionEnd);\n                if (jQuery('.modal-body').length) { // Preview.\n                    Ddwtos.prototype.showAnswers();\n                    if (showQuestionFeedback === true) {\n                        Ddwtos.prototype.showFeedback();\n                    }\n                } else {\n                    if (manualMode === false) {\n                        Ddwtos.prototype.showAnswers();\n                        if (showQuestionFeedback === true) {\n                            Ddwtos.prototype.showFeedback();\n                        }\n                    }\n                }\n            } else {\n                alert('error');\n            }\n            jQuery(REGION.LOADING).remove();\n        }).fail(Notification.exception);\n    });\n};\n\n/* DRAG&DROP */\nDdwtos.prototype.initDragAndDrop = function() {\n    let dragItems = document.querySelectorAll(REGION.DRAGELEMENT);\n    dragItems.forEach(function(dragElement) {\n        dragElement.setAttribute('draggable', 'false');\n        jQuery(dragElement).unbind('mousedown touchstart');\n        jQuery(dragElement).on('mousedown touchstart', Ddwtos.prototype.handleDragStart.bind(this));\n    });\n};\n\nDdwtos.prototype.handleDragStart = function(e) {\n    // TODO there is an error in closest when dropping an option on the options, check that the container is not answercontainer.\n    let drag = jQuery(e.target).closest('.draghome');\n    let info = dragDrop.prepare(e);\n    if (!info.start || drag.hasClass('beingdragged')) {\n        return;\n    }\n    drag.addClass('beingdragged');\n    let currentPlace = Ddwtos.prototype.getClassnameNumericSuffix(drag, 'inplace');\n    if (currentPlace !== null) {\n        Ddwtos.prototype.setInputValue(currentPlace, 0);\n        drag.removeClass('inplace' + currentPlace);\n        let hiddenDrop = Ddwtos.prototype.getDrop(drag, currentPlace);\n        if (hiddenDrop.length) {\n            hiddenDrop.addClass('active');\n            drag.offset(hiddenDrop.offset());\n        }\n    } else {\n        let hiddenDrag = Ddwtos.prototype.getDragClone(drag);\n        if (hiddenDrag.length) {\n            if (drag.hasClass('infinite')) {\n                let noOfDrags = Ddwtos.prototype.noOfDropsInGroup(Ddwtos.prototype.getGroup(drag));\n                let cloneDrags = Ddwtos.prototype.getInfiniteDragClones(drag, false);\n                if (cloneDrags.length < noOfDrags) {\n                    let cloneDrag = drag.clone();\n                    cloneDrag.removeClass('beingdragged');\n                    hiddenDrag.after(cloneDrag);\n                    questionManager.addEventHandlersToDrag(cloneDrag);\n                    drag.offset(cloneDrag.offset());\n                } else {\n                    hiddenDrag.addClass('active');\n                    drag.offset(hiddenDrag.offset());\n                }\n            } else {\n                hiddenDrag.addClass('active');\n                drag.offset(hiddenDrag.offset());\n            }\n        }\n    }\n    dragDrop.start(e, drag, function(x, y, drag) {\n        Ddwtos.prototype.dragMove(x, y, drag);\n    }, function(x, y, drag) {\n        Ddwtos.prototype.dragEnd(x, y, drag);\n    });\n};\n\n\n/* EVENTS */\nDdwtos.prototype.answered = function(response, fromService = false) {\n    questionEnd = true;\n    if (response.hasfeedbacks) {\n        jQuery(REGION.FEEDBACK).html(response.statment_feedback);\n        jQuery(REGION.FEEDBACKANSWER).html(response.answer_feedback);\n    }\n    jQuery(ACTION.SEND_RESPONSE).addClass('d-none');\n    jQuery(REGION.FEEDBACKBACGROUND).css('display', 'block');\n    jQuery(REGION.STATEMENTTEXT).css({'z-index': 3, 'padding': '15px'});\n    jQuery(REGION.TIMER).css('z-index', 3);\n    if (manualMode === false) {\n        jQuery(REGION.NEXT).removeClass('d-none');\n    }\n    if (fromService === true) {\n        jQuery(REGION.STATEMENTTEXT_CONTENT).html(decodeURIComponent(escape(atob(response.question_text_feedback))));\n        Ddwtos.prototype.resizeAllDragsAndDrops();\n        Ddwtos.prototype.cloneDrags();\n        Ddwtos.prototype.positionDrags();\n    }\n    let dragItems = document.querySelectorAll(REGION.DRAGHOME);\n    dragItems.forEach(function(dragElement) {\n        dragElement.setAttribute('draggable', 'false');\n        jQuery(dragElement).unbind('mousedown touchstart');\n        jQuery(dragElement).off('mousedown touchstart');\n        jQuery(dragElement).css({'pointer-events': 'none'});\n    });\n    mEvent.notifyFilterContentUpdated(document.querySelector(REGION.CONTENTFEEDBACKS));\n};\n\nDdwtos.prototype.pauseQuestion = function() {\n    dispatchEvent(new Event('pauseQuestion'));\n    jQuery(REGION.TIMER).css('z-index', 3);\n    jQuery(REGION.FEEDBACKBACGROUND).css('display', 'block');\n    jQuery(ACTION.REPLY).css('pointer-events', 'none');\n};\n\nDdwtos.prototype.playQuestion = function() {\n    if (questionEnd !== true) {\n        dispatchEvent(new Event('playQuestion'));\n        jQuery(REGION.TIMER).css('z-index', 1);\n        jQuery(REGION.FEEDBACKBACGROUND).css('display', 'none');\n        jQuery(ACTION.REPLY).css('pointer-events', 'auto');\n    }\n};\n\nDdwtos.prototype.showFeedback = function() {\n    if (questionEnd === true) {\n        jQuery(REGION.CONTENTFEEDBACKS).css({'display': 'block', 'z-index': 3});\n    }\n};\n\nDdwtos.prototype.hideFeedback = function() {\n    if (questionEnd === true) {\n        jQuery(REGION.CONTENTFEEDBACKS).css({'display': 'none', 'z-index': 0});\n    }\n};\n\nDdwtos.prototype.showAnswers = function() {\n    if (questionEnd === true) {\n        jQuery(REGION.ICONSANSWERS).css({'display': 'inline-block'});\n    }\n};\n\nDdwtos.prototype.hideAnswers = function() {\n    if (questionEnd === true) {\n        jQuery(REGION.ICONSANSWERS).css({'display': 'none'});\n    }\n};\n\n/* CORE */\nDdwtos.prototype.resizeAllDragsAndDrops = function() {\n    let thisQ = this;\n    jQuery(REGION.AREA).find('.answercontainer > div').each(function(i, node) {\n        thisQ.resizeAllDragsAndDropsInGroup(\n            thisQ.getClassnameNumericSuffix(jQuery(node), 'draggrouphomes'));\n    });\n};\n\nDdwtos.prototype.cloneDrags = function() {\n    jQuery(REGION.AREA).find('span.draghome').each(function(index, draghome) {\n        let drag = jQuery(draghome);\n        let placeHolder = drag.clone();\n        placeHolder.removeClass();\n        placeHolder.addClass('draghome choice' +\n            Ddwtos.prototype.getChoice(drag) + ' group' +\n            Ddwtos.prototype.getGroup(drag) + ' dragplaceholder');\n        drag.before(placeHolder);\n    });\n};\n\nDdwtos.prototype.positionDrags = function() {\n    let root = jQuery(REGION.AREA);\n    root.find('span.draghome').not('.dragplaceholder').each(function(i, dragNode) {\n        let drag = jQuery(dragNode),\n            currentPlace = Ddwtos.prototype.getClassnameNumericSuffix(drag, 'inplace');\n        drag.addClass('unplaced')\n            .removeClass('placed');\n        drag.removeAttr('tabindex');\n        if (currentPlace !== null) {\n            drag.removeClass('inplace' + currentPlace);\n        }\n    });\n    root.find('input.placeinput').each(function(i, inputNode) {\n        let input = jQuery(inputNode),\n            choice = input.val(),\n            place = Ddwtos.prototype.getPlace(input);\n        let drop = root.find('.drop.place' + place),\n            dropPosition = drop.offset();\n        drop.data('prev-top', dropPosition.top).data('prev-left', dropPosition.left);\n\n        if (choice === '0') {\n            return;\n        }\n        let unplacedDrag = Ddwtos.prototype.getUnplacedChoice(Ddwtos.prototype.getGroup(input), choice);\n        let hiddenDrag = Ddwtos.prototype.getDragClone(unplacedDrag);\n        if (hiddenDrag.length) {\n            if (unplacedDrag.hasClass('infinite')) {\n                let noOfDrags = Ddwtos.prototype.noOfDropsInGroup(Ddwtos.prototype.getGroup(unplacedDrag));\n                let cloneDrags = Ddwtos.prototype.getInfiniteDragClones(unplacedDrag, false);\n                if (cloneDrags.length < noOfDrags) {\n                    let cloneDrag = unplacedDrag.clone();\n                    hiddenDrag.after(cloneDrag);\n                    questionManager.addEventHandlersToDrag(cloneDrag);\n                } else {\n                    hiddenDrag.addClass('active');\n                }\n            } else {\n                hiddenDrag.addClass('active');\n            }\n        }\n        // Send the drag to drop.\n        Ddwtos.prototype.sendDragToDrop(Ddwtos.prototype.getUnplacedChoice(Ddwtos.prototype.getGroup(input), choice), drop);\n    });\n\n    // Save the question answer.\n    Ddwtos.prototype.questionAnswer = Ddwtos.prototype.getQuestionAnsweredValues();\n};\n\nDdwtos.prototype.handleDragMoved = function(e, drag, target) {\n    drag.removeClass('beingdragged');\n    drag.css('top', '').css('left', '');\n    target.after(drag);\n    target.removeClass('active');\n    if (typeof drag.data('unplaced') !== 'undefined' && drag.data('unplaced') === true) {\n        drag.removeClass('placed').addClass('unplaced');\n        drag.removeAttr('tabindex');\n        drag.removeData('unplaced');\n        if (drag.hasClass('infinite') && Ddwtos.prototype.getInfiniteDragClones(drag, true).length > 1) {\n            Ddwtos.prototype.getInfiniteDragClones(drag, true).first().remove();\n        }\n    }\n    if (typeof drag.data('isfocus') !== 'undefined' && drag.data('isfocus') === true) {\n        drag.focus();\n        drag.removeData('isfocus');\n    }\n    if (typeof target.data('isfocus') !== 'undefined' && target.data('isfocus') === true) {\n        target.removeData('isfocus');\n    }\n    if (Ddwtos.prototype.isQuestionInteracted()) {\n        Ddwtos.prototype.questionAnswer = Ddwtos.prototype.getQuestionAnsweredValues();\n    }\n};\n\nDdwtos.prototype.isPointInDrop = function(pageX, pageY, drop) {\n    let position = drop.offset();\n    return pageX >= position.left && pageX < position.left + drop.width()\n        && pageY >= position.top && pageY < position.top + drop.height();\n};\n\nDdwtos.prototype.sendDragToDrop = function(drag, drop) {\n    let oldDrag = Ddwtos.prototype.getCurrentDragInPlace(Ddwtos.prototype.getPlace(drop));\n    if (oldDrag.length !== 0) {\n        let currentPlace = Ddwtos.prototype.getClassnameNumericSuffix(oldDrag, 'inplace');\n        let hiddenDrop = Ddwtos.prototype.getDrop(oldDrag, currentPlace);\n        hiddenDrop.addClass('active');\n        oldDrag.addClass('beingdragged');\n        oldDrag.offset(hiddenDrop.offset());\n        Ddwtos.prototype.sendDragHome(oldDrag);\n    }\n\n    if (drag.length === 0) {\n        Ddwtos.prototype.setInputValue(Ddwtos.prototype.getPlace(drop), 0);\n        if (drop.data('isfocus')) {\n            drop.focus();\n        }\n    } else {\n        // Prevent the drag item drop into two drop-zone.\n        if (Ddwtos.prototype.getClassnameNumericSuffix(drag, 'inplace')) {\n            return;\n        }\n\n        Ddwtos.prototype.setInputValue(Ddwtos.prototype.getPlace(drop), Ddwtos.prototype.getChoice(drag));\n        drag.removeClass('unplaced')\n            .addClass('placed inplace' + Ddwtos.prototype.getPlace(drop));\n        drag.attr('tabindex', 0);\n        Ddwtos.prototype.animateTo(drag, drop);\n    }\n};\n\nDdwtos.prototype.sendDragHome = function(drag) {\n    let currentPlace = Ddwtos.prototype.getClassnameNumericSuffix(drag, 'inplace');\n    if (currentPlace !== null) {\n        drag.removeClass('inplace' + currentPlace);\n    }\n    drag.data('unplaced', true);\n\n    Ddwtos.prototype.animateTo(\n        drag,\n        Ddwtos.prototype.getDragHome(Ddwtos.prototype.getGroup(drag),\n            Ddwtos.prototype.getChoice(drag))\n    );\n};\n\nDdwtos.prototype.getPlace = function(node) {\n    return Ddwtos.prototype.getClassnameNumericSuffix(node, 'place');\n};\n\nDdwtos.prototype.getQuestionAnsweredValues = function() {\n    let result = {};\n    jQuery(REGION.AREA).find('input.placeinput').each((i, inputNode) => {\n        result[inputNode.id] = inputNode.value;\n    });\n\n    return result;\n};\n\nDdwtos.prototype.animateTo = function(drag, target) {\n    if (target !== undefined) {\n        let currentPos = drag.offset(),\n            targetPos = target.offset(),\n            thisQ = this;\n        if (targetPos !== undefined) {\n            drag.animate(\n                {\n                    left: parseInt(drag.css('left')) + targetPos.left - currentPos.left,\n                    top: parseInt(drag.css('top')) + targetPos.top - currentPos.top\n                },\n                {\n                    duration: 'fast',\n                    done: function() {\n                        jQuery('body').trigger('qtype_ddwtos-dragmoved', [drag, target, thisQ]);\n                    }\n                }\n            );\n        }\n    }\n};\n\nDdwtos.prototype.getDragHome = function(group, choice) {\n    if (!jQuery(REGION.AREA).find('.draghome.dragplaceholder.group' + group + '.choice' + choice).is(':visible')) {\n        return jQuery(REGION.AREA).find('.draggrouphomes' + group +\n            ' span.draghome.infinite' +\n            '.choice' + choice +\n            '.group' + group);\n    }\n    return jQuery(REGION.AREA).find('.draghome.dragplaceholder.group' + group + '.choice' + choice);\n};\n\nDdwtos.prototype.getCurrentDragInPlace = function(place) {\n    return jQuery(REGION.AREA).find('span.draghome.inplace' + place);\n};\n\nDdwtos.prototype.resizeAllDragsAndDropsInGroup = function(group) {\n    let thisQ = this,\n        dragHomes = jQuery(REGION.AREA).find('.draggrouphomes' + group + ' span.draghome'),\n        maxWidth = 0,\n        maxHeight = 0;\n    dragHomes.each(function(i, drag) {\n        maxWidth = Math.max(maxWidth, Math.ceil(drag.offsetWidth));\n        maxHeight = Math.max(maxHeight, Math.ceil(0 + drag.offsetHeight));\n    });\n    maxWidth += 8;\n    maxHeight += 2;\n    dragHomes.each(function(i, drag) {\n        thisQ.setElementSize(drag, maxWidth, maxHeight);\n    });\n    jQuery(REGION.AREA).find('span.drop.group' + group).each(function(i, drop) {\n        thisQ.setElementSize(drop, maxWidth, maxHeight);\n    });\n};\n\nDdwtos.prototype.setElementSize = function(element, width, height) {\n    jQuery(element).width(width).height(height).css('lineHeight', height + 'px');\n};\n\nDdwtos.prototype.getClassnameNumericSuffix = function(node, prefix) {\n    let classes = node.attr('class');\n    if (classes !== '' && classes !== undefined) {\n        let classesArr = classes.split(' ');\n        for (let index = 0; index < classesArr.length; index++) {\n            let patt1 = new RegExp('^' + prefix + '([0-9])+$');\n            if (patt1.test(classesArr[index])) {\n                let patt2 = new RegExp('([0-9])+$');\n                let match = patt2.exec(classesArr[index]);\n                return Number(match[0]);\n            }\n        }\n    }\n    return null;\n};\n\nDdwtos.prototype.setInputValue = function(place, choice) {\n    jQuery(REGION.AREA).find('input.placeinput.place' + place).val(choice);\n};\n\nDdwtos.prototype.getDrop = function(drag, currentPlace) {\n    return jQuery(REGION.AREA).find('.drop.group' + Ddwtos.prototype.getGroup(drag) + '.place' + currentPlace);\n};\n\nDdwtos.prototype.getGroup = function(node) {\n    return Ddwtos.prototype.getClassnameNumericSuffix(node, 'group');\n};\n\nDdwtos.prototype.getDragClone = function(drag) {\n    return jQuery(REGION.AREA).find('.draggrouphomes' +\n        Ddwtos.prototype.getGroup(drag) +\n        ' span.draghome' +\n        '.choice' + Ddwtos.prototype.getChoice(drag) +\n        '.group' + Ddwtos.prototype.getGroup(drag) +\n        '.dragplaceholder');\n};\n\nDdwtos.prototype.getChoice = function(drag) {\n    return Ddwtos.prototype.getClassnameNumericSuffix(drag, 'choice');\n};\n\nDdwtos.prototype.noOfDropsInGroup = function(group) {\n    return jQuery(REGION.AREA).find('.drop.group' + group).length;\n};\n\nDdwtos.prototype.getInfiniteDragClones = function(drag, inHome) {\n    if (inHome) {\n        return jQuery(REGION.AREA).find('.draggrouphomes' +\n            Ddwtos.prototype.getGroup(drag) +\n            ' span.draghome' +\n            '.choice' + Ddwtos.prototype.getChoice(drag) +\n            '.group' + Ddwtos.prototype.getGroup(drag) +\n            '.infinite').not('.dragplaceholder');\n    }\n    return jQuery(REGION.AREA).find('span.draghome' +\n        '.choice' + Ddwtos.prototype.getChoice(drag) +\n        '.group' + Ddwtos.prototype.getGroup(drag) +\n        '.infinite').not('.dragplaceholder');\n};\n\nDdwtos.prototype.dragMove = function(pageX, pageY, drag) {\n    jQuery(REGION.AREA).find('span.group' + Ddwtos.prototype.getGroup(drag)).not('.beingdragged').each(function(i, dropNode) {\n        let drop = jQuery(dropNode);\n        if (Ddwtos.prototype.isPointInDrop(pageX, pageY, drop)) {\n            drop.addClass('valid-drag-over-drop');\n        } else {\n            drop.removeClass('valid-drag-over-drop');\n        }\n    });\n};\n\nDdwtos.prototype.dragEnd = function(pageX, pageY, drag) {\n    let root = jQuery(REGION.AREA);\n    let placed = false;\n    root.find('span.group' + Ddwtos.prototype.getGroup(drag)).not('.beingdragged').each(function(i, dropNode) {\n        if (placed) {\n            return false;\n        }\n        const dropZone = jQuery(dropNode);\n        if (!Ddwtos.prototype.isPointInDrop(pageX, pageY, dropZone)) {\n            // Not this drop zone.\n            return true;\n        }\n        let drop = null;\n        if (dropZone.hasClass('placed')) {\n            // This is an placed drag item in a drop.\n            dropZone.removeClass('valid-drag-over-drop');\n            // Get the correct drop.\n            drop = Ddwtos.prototype.getDrop(drag, Ddwtos.prototype.getClassnameNumericSuffix(dropZone, 'inplace'));\n        } else {\n            // Empty drop.\n            drop = dropZone;\n        }\n        if (drop.hasClass('draghome')) {\n            // Not this drop zone.\n            return true;\n        }\n        // Now put this drag into the drop.\n        drop.removeClass('valid-drag-over-drop');\n        Ddwtos.prototype.sendDragToDrop(drag, drop);\n        placed = true;\n        return false; // Stop the each() here.\n    });\n    if (!placed) {\n        Ddwtos.prototype.sendDragHome(drag);\n    }\n};\n\nDdwtos.prototype.isQuestionInteracted = function() {\n    const oldAnswer = Ddwtos.prototype.questionAnswer;\n    const newAnswer = Ddwtos.prototype.getQuestionAnsweredValues();\n    let isInteracted = false;\n\n    // First, check both answers have the same structure or not.\n    if (JSON.stringify(newAnswer) !== JSON.stringify(oldAnswer)) {\n        isInteracted = true;\n        return isInteracted;\n    }\n    // Check the values.\n    Object.keys(newAnswer).forEach(key => {\n        if (newAnswer[key] !== oldAnswer[key]) {\n            isInteracted = true;\n        }\n    });\n\n    return isInteracted;\n};\n\nDdwtos.prototype.getUnplacedChoice = function(group, choice) {\n    return jQuery(REGION.AREA).find('.draghome.group' + group + '.choice' + choice + '.unplaced').slice(0, 1);\n};\n\nlet questionManager = {\n    eventHandlersInitialised: false,\n    dragEventHandlersInitialised: {},\n    isKeyboardNavigation: false,\n    questions: {},\n\n    /**\n     * Initialise questions.\n     *\n     * @param {String} containerId id of the outer div for this question.\n     */\n    init: function(containerId) {\n        questionManager.questions[containerId] = Ddwtos.prototype;\n        if (!questionManager.eventHandlersInitialised) {\n            questionManager.setupEventHandlers();\n            questionManager.eventHandlersInitialised = true;\n        }\n        if (!questionManager.dragEventHandlersInitialised.hasOwnProperty(containerId)) {\n            questionManager.dragEventHandlersInitialised[containerId] = true;\n            // We do not use the body event here to prevent the other event on Mobile device, such as scroll event.\n            let questionContainer = document.getElementById(containerId);\n            if (questionContainer.classList.contains('ddwtos') &&\n                !questionContainer.classList.contains('qtype_ddwtos-readonly')) {\n            }\n        }\n    },\n\n    setupEventHandlers: function() {\n        jQuery('body').on('qtype_ddwtos-dragmoved', Ddwtos.prototype.handleDragMoved.bind(this));\n    },\n\n    /**\n     * Binding the drag/touch event again for newly created element.\n     *\n     * @param {jQuery} element Element to bind the event\n     */\n    addEventHandlersToDrag: function(element) {\n        // Unbind all the mousedown and touchstart events to prevent double binding.\n        element.unbind('mousedown touchstart');\n        element.on('mousedown touchstart', Ddwtos.prototype.handleDragStart);\n    },\n\n    /**\n     * Given an event, work out which question it affects.\n     *\n     * @param {Event} e the event.\n     * @returns {DragDropToTextQuestion|undefined} The question, or undefined.\n     */\n    getQuestionForEvent: function(e) {\n        let containerId = jQuery(e.currentTarget).closest('.que.ddwtos').attr('id');\n        return questionManager.questions[containerId];\n    }\n};\n\nexport const initDdwtos = (selector, showquestionfeedback, manualmode, jsonresponse) => {\n    return new Ddwtos(selector, showquestionfeedback, manualmode, jsonresponse);\n};\n"],"names":["_interopRequireDefault","obj","__esModule","default","Object","defineProperty","_exports","value","initDdwtos","_jquery","_ajax","_templates","_notification","_event","_dragdrop","cmId","sId","questionid","jqshowId","jqid","ACTION","SEND_RESPONSE","REGION","SERVICES","TEMPLATES","questionEnd","showQuestionFeedback","manualMode","Ddwtos","selector","showquestionfeedback","arguments","length","undefined","manualmode","jsonresponse","this","node","jQuery","attr","answered","JSON","parse","showFeedback","showAnswers","prototype","questionManager","init","endTimer","Event","studentQuestionEnd","questionAnswer","on","reply","initEvents","resizeAllDragsAndDrops","cloneDrags","positionDrags","initDragAndDrop","addEventListener","once","e","detail","statistics","forEach","statistic","answerid","html","numberofreplies","pauseQuestion","playQuestion","hideAnswers","showStatistics","hideStatistics","hideFeedback","window","onbeforeunload","removeEvents","removeEventListener","Templates","render","visible","done","append","dispatchEvent","inputPlaces","document","querySelectorAll","response","i","input","timeLeft","parseInt","text","request","methodname","args","sessionid","jqshowid","cmid","timeleft","preview","stringify","Ajax","call","reply_status","alert","remove","fail","Notification","exception","dragElement","setAttribute","unbind","handleDragStart","bind","drag","target","closest","dragDrop","prepare","start","hasClass","addClass","currentPlace","getClassnameNumericSuffix","setInputValue","removeClass","hiddenDrop","getDrop","offset","hiddenDrag","getDragClone","noOfDrags","noOfDropsInGroup","getGroup","getInfiniteDragClones","cloneDrag","clone","after","addEventHandlersToDrag","x","y","dragMove","dragEnd","fromService","hasfeedbacks","statment_feedback","answer_feedback","css","padding","decodeURIComponent","escape","atob","question_text_feedback","off","mEvent","notifyFilterContentUpdated","querySelector","REPLY","display","thisQ","find","each","resizeAllDragsAndDropsInGroup","index","draghome","placeHolder","getChoice","before","root","not","dragNode","removeAttr","inputNode","choice","val","place","getPlace","drop","dropPosition","data","top","left","unplacedDrag","getUnplacedChoice","sendDragToDrop","getQuestionAnsweredValues","handleDragMoved","removeData","first","focus","isQuestionInteracted","isPointInDrop","pageX","pageY","position","width","height","oldDrag","getCurrentDragInPlace","sendDragHome","animateTo","getDragHome","result","id","currentPos","targetPos","animate","duration","trigger","group","is","dragHomes","maxWidth","maxHeight","Math","max","ceil","offsetWidth","offsetHeight","setElementSize","element","prefix","classes","classesArr","split","RegExp","test","match","exec","Number","inHome","dropNode","placed","dropZone","oldAnswer","newAnswer","isInteracted","keys","key","slice","eventHandlersInitialised","dragEventHandlersInitialised","isKeyboardNavigation","questions","containerId","setupEventHandlers","hasOwnProperty","questionContainer","getElementById","classList","contains","getQuestionForEvent","currentTarget"],"mappings":"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"}