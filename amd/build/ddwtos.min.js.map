{"version":3,"file":"ddwtos.min.js","sources":["../src/ddwtos.js"],"sourcesContent":["\"use strict\";\n\nimport jQuery from 'jquery';\nimport Ajax from 'core/ajax';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\nimport mEvent from 'core/event';\n/*import DragDrop from 'core/local/reactive/dragdrop';*/\nimport dragDrop from 'core/dragdrop';\n\nlet ACTION = {\n    SEND_RESPONSE: '[data-action=\"send-response\"]',\n};\n\nlet REGION = {\n    ROOT: '[data-region=\"question-content\"]',\n    LOADING: '[data-region=\"overlay-icon-container\"]',\n    NEXT: '[data-action=\"next-question\"]',\n    TIMER: '[data-region=\"question-timer\"]',\n    SECONDS: '[data-region=\"seconds\"]',\n    CONTENTFEEDBACKS: '[data-region=\"containt-feedbacks\"]',\n    FEEDBACK: '[data-region=\"statement-feedback\"]',\n    FEEDBACKANSWER: '[data-region=\"answer-feedback\"]',\n    FEEDBACKBACGROUND: '[data-region=\"feedback-background\"]',\n    AREA: '#drag_and_drop_area',\n    DRAGHOME: '.draghome',\n    DRAGELEMENT: '.draghome.user-select-none',\n    DROPELEMENT: '.drop.active',\n    INPUTPLACE: '.placeinput',\n    STATEMENTTEXT: '[data-region=\"statement-text\"]',\n    STATEMENTTEXT_CONTENT: '[data-region=\"statement-text\"] .statement-text',\n    ICONSANSWERS: '.icon.text-success, .icon.text-danger',\n    ANSWERSCONTENT: '.answercontainer',\n    ANSWERSCONTENTGROUP: '.answercontainer [class*=\"draggrouphomes\"]',\n    MODALBODY: '.modal-body'\n};\n\nlet SERVICES = {\n    REPLY: 'mod_jqshow_ddwtos'\n};\n\nlet TEMPLATES = {\n    LOADING: 'core/overlay_loading'\n};\n\nlet cmId;\nlet sId;\nlet questionid;\nlet jqshowId;\nlet jqid;\nlet questionEnd = false;\nlet showQuestionFeedback = false;\nlet manualMode = false;\n\n/** @type {jQuery} The jQuery node for the page region. */\nDdwtos.prototype.node = null;\nDdwtos.prototype.endTimer = new Event('endTimer');\nDdwtos.prototype.studentQuestionEnd = new Event('studentQuestionEnd');\nDdwtos.prototype.questionAnswer = {};\n\n/**\n * @constructor\n * @param {String} selector\n * @param {Boolean} showquestionfeedback\n * @param {Boolean} manualmode\n * @param {String} jsonresponse\n */\nfunction Ddwtos(selector, showquestionfeedback = false, manualmode = false, jsonresponse = '') {\n    this.node = jQuery(selector);\n    sId = this.node.attr('data-sid');\n    cmId = this.node.attr('data-cmid');\n    questionid = this.node.attr('data-questionid');\n    jqshowId = this.node.attr('data-jqshowid');\n    jqid = this.node.attr('data-jqid');\n    showQuestionFeedback = showquestionfeedback;\n    manualMode = manualmode;\n    questionEnd = false;\n    if (jsonresponse !== '') {\n        this.answered(jsonresponse, false);\n        if (manualMode === false || jQuery(REGION.MODALBODY).length) {\n            questionEnd = true;\n            if (showQuestionFeedback === true) {\n                this.showFeedback();\n            }\n            this.showAnswers();\n        }\n    }\n    if (jQuery(REGION.MODALBODY).length) {\n        setTimeout(() => {\n            Ddwtos.prototype.initDdwtos();\n        }, 500); // For modal preview, is executed before the DOM is rendered.\n    } else {\n        Ddwtos.prototype.initDdwtos();\n    }\n    questionManager.init('drag_and_drop_area');\n}\n\nDdwtos.prototype.initDdwtos = function() {\n    jQuery(ACTION.SEND_RESPONSE).on('click', Ddwtos.prototype.reply);\n    if (jQuery(REGION.STATEMENTTEXT_CONTENT).hasClass('randomanswers')) {\n        let groups = document.querySelectorAll(REGION.ANSWERSCONTENTGROUP);\n        groups.forEach(function(element){\n            let draghomes = Array.prototype.slice.call(element.getElementsByClassName('draghome'));\n            draghomes.forEach(function(drag){\n                element.removeChild(drag);\n            });\n            Ddwtos.prototype.shuffleArray(draghomes);\n            draghomes.forEach(function(drag){\n                element.appendChild(drag);\n            });\n        });\n    }\n    Ddwtos.prototype.initEvents();\n    Ddwtos.prototype.resizeAllDragsAndDrops();\n    Ddwtos.prototype.cloneDrags();\n    Ddwtos.prototype.positionDrags();\n    if (questionEnd === false) {\n        Ddwtos.prototype.initDragAndDrop();\n    }\n};\n\nDdwtos.prototype.shuffleArray = function(array) {\n    for (let i = array.length - 1; i > 0; i--) {\n        let j = Math.floor(Math.random() * (i + 1));\n        let temp = array[i];\n        array[i] = array[j];\n        array[j] = temp;\n    }\n    return array;\n};\n\nDdwtos.prototype.initEvents = function() {\n    addEventListener('timeFinish', Ddwtos.prototype.reply, {once: true});\n    if (manualMode !== false) {\n        addEventListener('teacherQuestionEnd_' + jqid, (e) => {\n            if (questionEnd !== true) {\n                Ddwtos.prototype.reply();\n            }\n            e.detail.statistics.forEach((statistic) => {\n                jQuery('[data-answerid=\"' + statistic.answerid + '\"] .numberofreplies').html(statistic.numberofreplies);\n            });\n        }, {once: true});\n        addEventListener('pauseQuestion_' + jqid, () => {\n            Ddwtos.prototype.pauseQuestion();\n        }, false);\n        addEventListener('playQuestion_' + jqid, () => {\n            Ddwtos.prototype.playQuestion();\n        }, false);\n        addEventListener('showAnswers_' + jqid, () => {\n            Ddwtos.prototype.showAnswers();\n        }, false);\n        addEventListener('hideAnswers_' + jqid, () => {\n            Ddwtos.prototype.hideAnswers();\n        }, false);\n        addEventListener('showStatistics_' + jqid, () => {\n            Ddwtos.prototype.showStatistics();\n        }, false);\n        addEventListener('hideStatistics_' + jqid, () => {\n            Ddwtos.prototype.hideStatistics();\n        }, false);\n        addEventListener('showFeedback_' + jqid, () => {\n            Ddwtos.prototype.showFeedback();\n        }, false);\n        addEventListener('hideFeedback_' + jqid, () => {\n            Ddwtos.prototype.hideFeedback();\n        }, false);\n        addEventListener('removeEvents', () => {\n            Ddwtos.prototype.removeEvents();\n        }, {once: true});\n    }\n\n    window.onbeforeunload = function() {\n        if (jQuery(REGION.SECONDS).length > 0 && questionEnd === false) {\n            Ddwtos.prototype.reply();\n            return 'Because the question is overdue and an attempt has been made to reload the page,' +\n                ' the question has remained unanswered.';\n        }\n    };\n};\n\nDdwtos.prototype.removeEvents = function() {\n    removeEventListener('timeFinish', Ddwtos.prototype.reply, {once: true});\n    if (manualMode !== false) {\n        removeEventListener('teacherQuestionEnd_' + jqid, (e) => {\n            if (questionEnd !== true) {\n                Ddwtos.prototype.reply();\n            }\n            e.detail.statistics.forEach((statistic) => {\n                jQuery('[data-answerid=\"' + statistic.answerid + '\"] .numberofreplies').html(statistic.numberofreplies);\n            });\n        }, {once: true});\n        removeEventListener('pauseQuestion_' + jqid, () => {\n            Ddwtos.prototype.pauseQuestion();\n        }, false);\n        removeEventListener('playQuestion_' + jqid, () => {\n            Ddwtos.prototype.playQuestion();\n        }, false);\n        removeEventListener('showAnswers_' + jqid, () => {\n            Ddwtos.prototype.showAnswers();\n        }, false);\n        removeEventListener('hideAnswers_' + jqid, () => {\n            Ddwtos.prototype.hideAnswers();\n        }, false);\n        removeEventListener('showStatistics_' + jqid, () => {\n            Ddwtos.prototype.showStatistics();\n        }, false);\n        removeEventListener('hideStatistics_' + jqid, () => {\n            Ddwtos.prototype.hideStatistics();\n        }, false);\n        removeEventListener('showFeedback_' + jqid, () => {\n            Ddwtos.prototype.showFeedback();\n        }, false);\n        removeEventListener('hideFeedback_' + jqid, () => {\n            Ddwtos.prototype.hideFeedback();\n        }, false);\n        removeEventListener('removeEvents', () => {\n            Ddwtos.prototype.removeEvents();\n        }, {once: true});\n    }\n};\n\nDdwtos.prototype.reply = function() {\n    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n        jQuery(REGION.ROOT).append(html);\n        dispatchEvent(Ddwtos.prototype.endTimer);\n        Ddwtos.prototype.removeEvents();\n        let inputPlaces = document.querySelectorAll(REGION.INPUTPLACE);\n        let response = {};\n        let i = 1;\n        inputPlaces.forEach(function(input) {\n            response['p' + i] = input.value;\n            i++;\n        });\n        let timeLeft = parseInt(jQuery(REGION.SECONDS).text());\n        let request = {\n            methodname: SERVICES.REPLY,\n            args: {\n                sessionid: sId,\n                jqshowid: jqshowId,\n                cmid: cmId,\n                questionid: questionid,\n                jqid: jqid,\n                timeleft: timeLeft || 0,\n                preview: false,\n                response: JSON.stringify(response)\n            }\n        };\n        Ajax.call([request])[0].done(function(response) {\n            if (response.reply_status === true) {\n                questionEnd = true;\n                Ddwtos.prototype.answered(response, true);\n                dispatchEvent(Ddwtos.prototype.studentQuestionEnd);\n                if (jQuery('.modal-body').length) { // Preview.\n                    Ddwtos.prototype.showAnswers();\n                    if (showQuestionFeedback === true) {\n                        Ddwtos.prototype.showFeedback();\n                    }\n                } else {\n                    if (manualMode === false) {\n                        Ddwtos.prototype.showAnswers();\n                        if (showQuestionFeedback === true) {\n                            Ddwtos.prototype.showFeedback();\n                        }\n                    }\n                }\n            } else {\n                alert('error');\n            }\n            jQuery(REGION.LOADING).remove();\n        }).fail(Notification.exception);\n    });\n};\n\n/* DRAG&DROP */\nDdwtos.prototype.initDragAndDrop = function() {\n    let dragItems = document.querySelectorAll(REGION.DRAGELEMENT);\n    dragItems.forEach(function(dragElement) {\n        dragElement.setAttribute('draggable', 'false');\n        jQuery(dragElement).unbind('mousedown touchstart');\n        jQuery(dragElement).on('mousedown touchstart', Ddwtos.prototype.handleDragStart.bind(this));\n    });\n};\n\nDdwtos.prototype.handleDragStart = function(e) {\n    let drag = jQuery(e.target).closest('.draghome');\n    let info = dragDrop.prepare(e);\n    if (!info.start || drag.hasClass('beingdragged')) {\n        return;\n    }\n    drag.addClass('beingdragged');\n    let currentPlace = Ddwtos.prototype.getClassnameNumericSuffix(drag, 'inplace');\n    if (currentPlace !== null) {\n        Ddwtos.prototype.setInputValue(currentPlace, 0);\n        drag.removeClass('inplace' + currentPlace);\n        let hiddenDrop = Ddwtos.prototype.getDrop(drag, currentPlace);\n        if (hiddenDrop.length) {\n            hiddenDrop.addClass('active');\n            drag.offset(hiddenDrop.offset());\n        }\n    } else {\n        let hiddenDrag = Ddwtos.prototype.getDragClone(drag);\n        if (hiddenDrag.length) {\n            if (drag.hasClass('infinite')) {\n                let noOfDrags = Ddwtos.prototype.noOfDropsInGroup(Ddwtos.prototype.getGroup(drag));\n                let cloneDrags = Ddwtos.prototype.getInfiniteDragClones(drag, false);\n                if (cloneDrags.length < noOfDrags) {\n                    let cloneDrag = drag.clone();\n                    cloneDrag.removeClass('beingdragged');\n                    hiddenDrag.after(cloneDrag);\n                    questionManager.addEventHandlersToDrag(cloneDrag);\n                    drag.offset(cloneDrag.offset());\n                } else {\n                    hiddenDrag.addClass('active');\n                    drag.offset(hiddenDrag.offset());\n                }\n            } else {\n                hiddenDrag.addClass('active');\n                drag.offset(hiddenDrag.offset());\n            }\n        }\n    }\n    dragDrop.start(e, drag, function(x, y, drag) {\n        Ddwtos.prototype.dragMove(x, y, drag);\n    }, function(x, y, drag) {\n        Ddwtos.prototype.dragEnd(x, y, drag);\n    });\n};\n\n\n/* EVENTS */\nDdwtos.prototype.answered = function(response, fromService = false) {\n    questionEnd = true;\n    if (response.hasfeedbacks) {\n        jQuery(REGION.FEEDBACK).html(response.statment_feedback);\n        jQuery(REGION.FEEDBACKANSWER).html(response.answer_feedback);\n    }\n    jQuery(ACTION.SEND_RESPONSE).addClass('d-none');\n    jQuery(REGION.FEEDBACKBACGROUND).css('display', 'block');\n    jQuery(REGION.STATEMENTTEXT).css({'z-index': 3, 'padding': '15px'});\n    jQuery(REGION.TIMER).css('z-index', 3);\n    if (manualMode === false) {\n        jQuery(REGION.NEXT).removeClass('d-none');\n    }\n    if (fromService === true) {\n        jQuery(REGION.STATEMENTTEXT_CONTENT).html(decodeURIComponent(escape(atob(response.question_text_feedback))));\n        Ddwtos.prototype.resizeAllDragsAndDrops();\n        Ddwtos.prototype.cloneDrags();\n        Ddwtos.prototype.positionDrags();\n    }\n    let dragItems = document.querySelectorAll(REGION.DRAGHOME);\n    dragItems.forEach(function(dragElement) {\n        dragElement.setAttribute('draggable', 'false');\n        jQuery(dragElement).unbind('mousedown touchstart');\n        jQuery(dragElement).off('mousedown touchstart');\n        jQuery(dragElement).css({'pointer-events': 'none'});\n    });\n    mEvent.notifyFilterContentUpdated(document.querySelector(REGION.CONTENTFEEDBACKS));\n};\n\nDdwtos.prototype.pauseQuestion = function() {\n    dispatchEvent(new Event('pauseQuestion'));\n    jQuery(REGION.TIMER).css('z-index', 3);\n    jQuery(REGION.FEEDBACKBACGROUND).css('display', 'block');\n    jQuery(ACTION.REPLY).css('pointer-events', 'none');\n};\n\nDdwtos.prototype.playQuestion = function() {\n    if (questionEnd !== true) {\n        dispatchEvent(new Event('playQuestion'));\n        jQuery(REGION.TIMER).css('z-index', 1);\n        jQuery(REGION.FEEDBACKBACGROUND).css('display', 'none');\n        jQuery(ACTION.REPLY).css('pointer-events', 'auto');\n    }\n};\n\nDdwtos.prototype.showFeedback = function() {\n    if (questionEnd === true) {\n        jQuery(REGION.CONTENTFEEDBACKS).css({'display': 'block', 'z-index': 3});\n    }\n};\n\nDdwtos.prototype.hideFeedback = function() {\n    if (questionEnd === true) {\n        jQuery(REGION.CONTENTFEEDBACKS).css({'display': 'none', 'z-index': 0});\n    }\n};\n\nDdwtos.prototype.showAnswers = function() {\n    if (questionEnd === true) {\n        jQuery(REGION.ICONSANSWERS).css({'display': 'inline-block'});\n    }\n};\n\nDdwtos.prototype.hideAnswers = function() {\n    if (questionEnd === true) {\n        jQuery(REGION.ICONSANSWERS).css({'display': 'none'});\n    }\n};\n\n/* CORE */\nDdwtos.prototype.resizeAllDragsAndDrops = function() {\n    let thisQ = this;\n    jQuery(REGION.AREA).find('.answercontainer > div').each(function(i, node) {\n        thisQ.resizeAllDragsAndDropsInGroup(\n            thisQ.getClassnameNumericSuffix(jQuery(node), 'draggrouphomes'));\n    });\n};\n\nDdwtos.prototype.cloneDrags = function() {\n    jQuery(REGION.AREA).find('span.draghome').each(function(index, draghome) {\n        let drag = jQuery(draghome);\n        let placeHolder = drag.clone();\n        placeHolder.removeClass();\n        placeHolder.addClass('draghome choice' +\n            Ddwtos.prototype.getChoice(drag) + ' group' +\n            Ddwtos.prototype.getGroup(drag) + ' dragplaceholder');\n        drag.before(placeHolder);\n    });\n};\n\nDdwtos.prototype.positionDrags = function() {\n    let root = jQuery(REGION.AREA);\n    root.find('span.draghome').not('.dragplaceholder').each(function(i, dragNode) {\n        let drag = jQuery(dragNode),\n            currentPlace = Ddwtos.prototype.getClassnameNumericSuffix(drag, 'inplace');\n        drag.addClass('unplaced')\n            .removeClass('placed');\n        drag.removeAttr('tabindex');\n        if (currentPlace !== null) {\n            drag.removeClass('inplace' + currentPlace);\n        }\n    });\n    root.find('input.placeinput').each(function(i, inputNode) {\n        let input = jQuery(inputNode),\n            choice = input.val(),\n            place = Ddwtos.prototype.getPlace(input);\n        let drop = root.find('.drop.place' + place),\n            dropPosition = drop.offset();\n        drop.data('prev-top', dropPosition.top).data('prev-left', dropPosition.left);\n\n        if (choice === '0') {\n            return;\n        }\n        let unplacedDrag = Ddwtos.prototype.getUnplacedChoice(Ddwtos.prototype.getGroup(input), choice);\n        let hiddenDrag = Ddwtos.prototype.getDragClone(unplacedDrag);\n        if (hiddenDrag.length) {\n            if (unplacedDrag.hasClass('infinite')) {\n                let noOfDrags = Ddwtos.prototype.noOfDropsInGroup(Ddwtos.prototype.getGroup(unplacedDrag));\n                let cloneDrags = Ddwtos.prototype.getInfiniteDragClones(unplacedDrag, false);\n                if (cloneDrags.length < noOfDrags) {\n                    let cloneDrag = unplacedDrag.clone();\n                    hiddenDrag.after(cloneDrag);\n                    questionManager.addEventHandlersToDrag(cloneDrag);\n                } else {\n                    hiddenDrag.addClass('active');\n                }\n            } else {\n                hiddenDrag.addClass('active');\n            }\n        }\n        // Send the drag to drop.\n        Ddwtos.prototype.sendDragToDrop(Ddwtos.prototype.getUnplacedChoice(Ddwtos.prototype.getGroup(input), choice), drop);\n    });\n\n    // Save the question answer.\n    Ddwtos.prototype.questionAnswer = Ddwtos.prototype.getQuestionAnsweredValues();\n};\n\nDdwtos.prototype.handleDragMoved = function(e, drag, target) {\n    drag.removeClass('beingdragged');\n    drag.css('top', '').css('left', '');\n    target.after(drag);\n    target.removeClass('active');\n    if (typeof drag.data('unplaced') !== 'undefined' && drag.data('unplaced') === true) {\n        drag.removeClass('placed').addClass('unplaced');\n        drag.removeAttr('tabindex');\n        drag.removeData('unplaced');\n        if (drag.hasClass('infinite') && Ddwtos.prototype.getInfiniteDragClones(drag, true).length > 1) {\n            Ddwtos.prototype.getInfiniteDragClones(drag, true).first().remove();\n        }\n    }\n    if (typeof drag.data('isfocus') !== 'undefined' && drag.data('isfocus') === true) {\n        drag.focus();\n        drag.removeData('isfocus');\n    }\n    if (typeof target.data('isfocus') !== 'undefined' && target.data('isfocus') === true) {\n        target.removeData('isfocus');\n    }\n    if (Ddwtos.prototype.isQuestionInteracted()) {\n        Ddwtos.prototype.questionAnswer = Ddwtos.prototype.getQuestionAnsweredValues();\n    }\n};\n\nDdwtos.prototype.isPointInDrop = function(pageX, pageY, drop) {\n    let position = drop.offset();\n    return pageX >= position.left && pageX < position.left + drop.width()\n        && pageY >= position.top && pageY < position.top + drop.height();\n};\n\nDdwtos.prototype.sendDragToDrop = function(drag, drop) {\n    let oldDrag = Ddwtos.prototype.getCurrentDragInPlace(Ddwtos.prototype.getPlace(drop));\n    if (oldDrag.length !== 0) {\n        let currentPlace = Ddwtos.prototype.getClassnameNumericSuffix(oldDrag, 'inplace');\n        let hiddenDrop = Ddwtos.prototype.getDrop(oldDrag, currentPlace);\n        hiddenDrop.addClass('active');\n        oldDrag.addClass('beingdragged');\n        oldDrag.offset(hiddenDrop.offset());\n        Ddwtos.prototype.sendDragHome(oldDrag);\n    }\n\n    if (drag.length === 0) {\n        Ddwtos.prototype.setInputValue(Ddwtos.prototype.getPlace(drop), 0);\n        if (drop.data('isfocus')) {\n            drop.focus();\n        }\n    } else {\n        // Prevent the drag item drop into two drop-zone.\n        if (Ddwtos.prototype.getClassnameNumericSuffix(drag, 'inplace')) {\n            return;\n        }\n\n        Ddwtos.prototype.setInputValue(Ddwtos.prototype.getPlace(drop), Ddwtos.prototype.getChoice(drag));\n        drag.removeClass('unplaced')\n            .addClass('placed inplace' + Ddwtos.prototype.getPlace(drop));\n        drag.attr('tabindex', 0);\n        Ddwtos.prototype.animateTo(drag, drop);\n    }\n};\n\nDdwtos.prototype.sendDragHome = function(drag) {\n    let currentPlace = Ddwtos.prototype.getClassnameNumericSuffix(drag, 'inplace');\n    if (currentPlace !== null) {\n        drag.removeClass('inplace' + currentPlace);\n    }\n    drag.data('unplaced', true);\n\n    Ddwtos.prototype.animateTo(\n        drag,\n        Ddwtos.prototype.getDragHome(Ddwtos.prototype.getGroup(drag),\n            Ddwtos.prototype.getChoice(drag))\n    );\n};\n\nDdwtos.prototype.getPlace = function(node) {\n    return Ddwtos.prototype.getClassnameNumericSuffix(node, 'place');\n};\n\nDdwtos.prototype.getQuestionAnsweredValues = function() {\n    let result = {};\n    jQuery(REGION.AREA).find('input.placeinput').each((i, inputNode) => {\n        result[inputNode.id] = inputNode.value;\n    });\n\n    return result;\n};\n\nDdwtos.prototype.animateTo = function(drag, target) {\n    if (target !== undefined) {\n        let currentPos = drag.offset(),\n            targetPos = target.offset(),\n            thisQ = this;\n        if (targetPos !== undefined) {\n            drag.animate(\n                {\n                    left: parseInt(drag.css('left')) + targetPos.left - currentPos.left,\n                    top: parseInt(drag.css('top')) + targetPos.top - currentPos.top\n                },\n                {\n                    duration: 'fast',\n                    done: function() {\n                        jQuery('body').trigger('qtype_ddwtos-dragmoved', [drag, target, thisQ]);\n                    }\n                }\n            );\n        }\n    }\n};\n\nDdwtos.prototype.getDragHome = function(group, choice) {\n    if (!jQuery(REGION.AREA).find('.draghome.dragplaceholder.group' + group + '.choice' + choice).is(':visible')) {\n        return jQuery(REGION.AREA).find('.draggrouphomes' + group +\n            ' span.draghome.infinite' +\n            '.choice' + choice +\n            '.group' + group);\n    }\n    return jQuery(REGION.AREA).find('.draghome.dragplaceholder.group' + group + '.choice' + choice);\n};\n\nDdwtos.prototype.getCurrentDragInPlace = function(place) {\n    return jQuery(REGION.AREA).find('span.draghome.inplace' + place);\n};\n\nDdwtos.prototype.resizeAllDragsAndDropsInGroup = function(group) {\n    let thisQ = this,\n        dragHomes = jQuery(REGION.AREA).find('.draggrouphomes' + group + ' span.draghome'),\n        maxWidth = 0,\n        maxHeight = 0;\n    dragHomes.each(function(i, drag) {\n        maxWidth = Math.max(maxWidth, Math.ceil(drag.offsetWidth));\n        maxHeight = Math.max(maxHeight, Math.ceil(0 + drag.offsetHeight));\n    });\n    maxWidth += 8;\n    maxHeight += 2;\n    dragHomes.each(function(i, drag) {\n        thisQ.setElementSize(drag, maxWidth, maxHeight);\n    });\n    jQuery(REGION.AREA).find('span.drop.group' + group).each(function(i, drop) {\n        thisQ.setElementSize(drop, maxWidth, maxHeight);\n    });\n};\n\nDdwtos.prototype.setElementSize = function(element, width, height) {\n    jQuery(element).width(width).height(height).css('lineHeight', height + 'px');\n};\n\nDdwtos.prototype.getClassnameNumericSuffix = function(node, prefix) {\n    let classes = node.attr('class');\n    if (classes !== '' && classes !== undefined) {\n        let classesArr = classes.split(' ');\n        for (let index = 0; index < classesArr.length; index++) {\n            let patt1 = new RegExp('^' + prefix + '([0-9])+$');\n            if (patt1.test(classesArr[index])) {\n                let patt2 = new RegExp('([0-9])+$');\n                let match = patt2.exec(classesArr[index]);\n                return Number(match[0]);\n            }\n        }\n    }\n    return null;\n};\n\nDdwtos.prototype.setInputValue = function(place, choice) {\n    jQuery(REGION.AREA).find('input.placeinput.place' + place).val(choice);\n};\n\nDdwtos.prototype.getDrop = function(drag, currentPlace) {\n    return jQuery(REGION.AREA).find('.drop.group' + Ddwtos.prototype.getGroup(drag) + '.place' + currentPlace);\n};\n\nDdwtos.prototype.getGroup = function(node) {\n    return Ddwtos.prototype.getClassnameNumericSuffix(node, 'group');\n};\n\nDdwtos.prototype.getDragClone = function(drag) {\n    return jQuery(REGION.AREA).find('.draggrouphomes' +\n        Ddwtos.prototype.getGroup(drag) +\n        ' span.draghome' +\n        '.choice' + Ddwtos.prototype.getChoice(drag) +\n        '.group' + Ddwtos.prototype.getGroup(drag) +\n        '.dragplaceholder');\n};\n\nDdwtos.prototype.getChoice = function(drag) {\n    return Ddwtos.prototype.getClassnameNumericSuffix(drag, 'choice');\n};\n\nDdwtos.prototype.noOfDropsInGroup = function(group) {\n    return jQuery(REGION.AREA).find('.drop.group' + group).length;\n};\n\nDdwtos.prototype.getInfiniteDragClones = function(drag, inHome) {\n    if (inHome) {\n        return jQuery(REGION.AREA).find('.draggrouphomes' +\n            Ddwtos.prototype.getGroup(drag) +\n            ' span.draghome' +\n            '.choice' + Ddwtos.prototype.getChoice(drag) +\n            '.group' + Ddwtos.prototype.getGroup(drag) +\n            '.infinite').not('.dragplaceholder');\n    }\n    return jQuery(REGION.AREA).find('span.draghome' +\n        '.choice' + Ddwtos.prototype.getChoice(drag) +\n        '.group' + Ddwtos.prototype.getGroup(drag) +\n        '.infinite').not('.dragplaceholder');\n};\n\nDdwtos.prototype.dragMove = function(pageX, pageY, drag) {\n    jQuery(REGION.AREA).find('span.group' + Ddwtos.prototype.getGroup(drag)).not('.beingdragged').each(function(i, dropNode) {\n        let drop = jQuery(dropNode);\n        if (Ddwtos.prototype.isPointInDrop(pageX, pageY, drop)) {\n            drop.addClass('valid-drag-over-drop');\n        } else {\n            drop.removeClass('valid-drag-over-drop');\n        }\n    });\n};\n\nDdwtos.prototype.dragEnd = function(pageX, pageY, drag) {\n    let root = jQuery(REGION.AREA);\n    let placed = false;\n    root.find('span.group' + Ddwtos.prototype.getGroup(drag)).not('.beingdragged').each(function(i, dropNode) {\n        if (placed) {\n            return false;\n        }\n        const dropZone = jQuery(dropNode);\n        if (!Ddwtos.prototype.isPointInDrop(pageX, pageY, dropZone)) {\n            // Not this drop zone.\n            return true;\n        }\n        let drop = null;\n        if (dropZone.hasClass('placed')) {\n            // This is an placed drag item in a drop.\n            dropZone.removeClass('valid-drag-over-drop');\n            // Get the correct drop.\n            drop = Ddwtos.prototype.getDrop(drag, Ddwtos.prototype.getClassnameNumericSuffix(dropZone, 'inplace'));\n        } else {\n            // Empty drop.\n            drop = dropZone;\n        }\n        if (drop.hasClass('draghome')) {\n            // Not this drop zone.\n            return true;\n        }\n        // Now put this drag into the drop.\n        drop.removeClass('valid-drag-over-drop');\n        Ddwtos.prototype.sendDragToDrop(drag, drop);\n        placed = true;\n        return false; // Stop the each() here.\n    });\n    if (!placed) {\n        Ddwtos.prototype.sendDragHome(drag);\n    }\n};\n\nDdwtos.prototype.isQuestionInteracted = function() {\n    const oldAnswer = Ddwtos.prototype.questionAnswer;\n    const newAnswer = Ddwtos.prototype.getQuestionAnsweredValues();\n    let isInteracted = false;\n\n    // First, check both answers have the same structure or not.\n    if (JSON.stringify(newAnswer) !== JSON.stringify(oldAnswer)) {\n        isInteracted = true;\n        return isInteracted;\n    }\n    // Check the values.\n    Object.keys(newAnswer).forEach(key => {\n        if (newAnswer[key] !== oldAnswer[key]) {\n            isInteracted = true;\n        }\n    });\n\n    return isInteracted;\n};\n\nDdwtos.prototype.getUnplacedChoice = function(group, choice) {\n    return jQuery(REGION.AREA).find('.draghome.group' + group + '.choice' + choice + '.unplaced').slice(0, 1);\n};\n\nlet questionManager = {\n    eventHandlersInitialised: false,\n    dragEventHandlersInitialised: {},\n    isKeyboardNavigation: false,\n    questions: {},\n\n    /**\n     * Initialise questions.\n     *\n     * @param {String} containerId id of the outer div for this question.\n     */\n    init: function(containerId) {\n        questionManager.questions[containerId] = Ddwtos.prototype;\n        if (!questionManager.eventHandlersInitialised) {\n            questionManager.setupEventHandlers();\n            questionManager.eventHandlersInitialised = true;\n        }\n        if (!questionManager.dragEventHandlersInitialised.hasOwnProperty(containerId)) {\n            questionManager.dragEventHandlersInitialised[containerId] = true;\n            // We do not use the body event here to prevent the other event on Mobile device, such as scroll event.\n            let questionContainer = document.getElementById(containerId);\n            if (questionContainer.classList.contains('ddwtos') &&\n                !questionContainer.classList.contains('qtype_ddwtos-readonly')) {\n            }\n        }\n    },\n\n    setupEventHandlers: function() {\n        jQuery('body').on('qtype_ddwtos-dragmoved', Ddwtos.prototype.handleDragMoved.bind(this));\n    },\n\n    /**\n     * Binding the drag/touch event again for newly created element.\n     *\n     * @param {jQuery} element Element to bind the event\n     */\n    addEventHandlersToDrag: function(element) {\n        // Unbind all the mousedown and touchstart events to prevent double binding.\n        element.unbind('mousedown touchstart');\n        element.on('mousedown touchstart', Ddwtos.prototype.handleDragStart);\n    },\n\n    /**\n     * Given an event, work out which question it affects.\n     *\n     * @param {Event} e the event.\n     * @returns {DragDropToTextQuestion|undefined} The question, or undefined.\n     */\n    getQuestionForEvent: function(e) {\n        let containerId = jQuery(e.currentTarget).closest('.que.ddwtos').attr('id');\n        return questionManager.questions[containerId];\n    }\n};\n\nexport const initDdwtos = (selector, showquestionfeedback, manualmode, jsonresponse) => {\n    return new Ddwtos(selector, showquestionfeedback, manualmode, jsonresponse);\n};\n"],"names":["cmId","sId","questionid","jqshowId","jqid","ACTION","SEND_RESPONSE","REGION","ROOT","LOADING","NEXT","TIMER","SECONDS","CONTENTFEEDBACKS","FEEDBACK","FEEDBACKANSWER","FEEDBACKBACGROUND","AREA","DRAGHOME","DRAGELEMENT","DROPELEMENT","INPUTPLACE","STATEMENTTEXT","STATEMENTTEXT_CONTENT","ICONSANSWERS","ANSWERSCONTENT","ANSWERSCONTENTGROUP","MODALBODY","SERVICES","TEMPLATES","questionEnd","showQuestionFeedback","manualMode","Ddwtos","selector","showquestionfeedback","manualmode","jsonresponse","node","this","attr","answered","length","showFeedback","showAnswers","setTimeout","prototype","initDdwtos","questionManager","init","endTimer","Event","studentQuestionEnd","questionAnswer","on","reply","hasClass","document","querySelectorAll","forEach","element","draghomes","Array","slice","call","getElementsByClassName","drag","removeChild","shuffleArray","appendChild","initEvents","resizeAllDragsAndDrops","cloneDrags","positionDrags","initDragAndDrop","array","i","j","Math","floor","random","temp","addEventListener","once","e","detail","statistics","statistic","answerid","html","numberofreplies","pauseQuestion","playQuestion","hideAnswers","showStatistics","hideStatistics","hideFeedback","removeEvents","window","onbeforeunload","removeEventListener","render","visible","done","append","dispatchEvent","inputPlaces","response","input","value","timeLeft","parseInt","text","request","methodname","args","sessionid","jqshowid","cmid","timeleft","preview","JSON","stringify","reply_status","alert","remove","fail","Notification","exception","dragElement","setAttribute","unbind","handleDragStart","bind","target","closest","dragDrop","prepare","start","addClass","currentPlace","getClassnameNumericSuffix","setInputValue","removeClass","hiddenDrop","getDrop","offset","hiddenDrag","getDragClone","noOfDrags","noOfDropsInGroup","getGroup","getInfiniteDragClones","cloneDrag","clone","after","addEventHandlersToDrag","x","y","dragMove","dragEnd","fromService","hasfeedbacks","statment_feedback","answer_feedback","css","decodeURIComponent","escape","atob","question_text_feedback","off","notifyFilterContentUpdated","querySelector","REPLY","thisQ","find","each","resizeAllDragsAndDropsInGroup","index","draghome","placeHolder","getChoice","before","root","not","dragNode","removeAttr","inputNode","choice","val","place","getPlace","drop","dropPosition","data","top","left","unplacedDrag","getUnplacedChoice","sendDragToDrop","getQuestionAnsweredValues","handleDragMoved","removeData","first","focus","isQuestionInteracted","isPointInDrop","pageX","pageY","position","width","height","oldDrag","getCurrentDragInPlace","sendDragHome","animateTo","getDragHome","result","id","undefined","currentPos","targetPos","animate","duration","trigger","group","is","dragHomes","maxWidth","maxHeight","max","ceil","offsetWidth","offsetHeight","setElementSize","prefix","classes","classesArr","split","RegExp","test","match","exec","Number","inHome","dropNode","placed","dropZone","oldAnswer","newAnswer","isInteracted","Object","keys","key","eventHandlersInitialised","dragEventHandlersInitialised","isKeyboardNavigation","questions","containerId","setupEventHandlers","hasOwnProperty","questionContainer","getElementById","classList","contains","getQuestionForEvent","currentTarget"],"mappings":"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"}