{"version":3,"file":"sessionquestions.min.js","sources":["../src/sessionquestions.js"],"sourcesContent":["\"use strict\";\r\n/* eslint-disable no-unused-vars */ // TODO remove.\r\n\r\nimport jQuery from 'jquery';\r\nimport {get_strings as getStrings} from 'core/str';\r\nimport Ajax from 'core/ajax';\r\nimport ModalFactory from 'core/modal_factory';\r\nimport ModalEvents from 'core/modal_events';\r\nimport Templates from 'core/templates';\r\nimport Notification from 'core/notification';\r\n\r\nlet ACTION = {\r\n    COPYQUESTION: '[data-action=\"copy_question\"]',\r\n    DELETEQUESTION: '[data-action=\"delete_question\"]',\r\n};\r\n\r\nlet SERVICES = {\r\n    COPYQUESTION: 'mod_jqshow_copyquestion',\r\n    DELETEQUESTION: 'mod_jqshow_deletequestion',\r\n    SESSIONQUESTIONS: 'mod_jqshow_sessionquestions',\r\n};\r\n\r\nlet REGION = {\r\n    PANEL: '[data-region=\"questions-panel\"]',\r\n    LOADING: '[data-region=\"overlay-icon-container\"]',\r\n    SESSIONQUESTIONS: '[data-region=\"session-questions\"]'\r\n};\r\n\r\nlet TEMPLATES = {\r\n    LOADING: 'core/overlay_loading',\r\n    SUCCESS: 'core/notification_success',\r\n    ERROR: 'core/notification_error',\r\n    QUESTIONSSELECTED: 'mod_jqshow/createsession/sessionquestions'\r\n};\r\n\r\nlet cmId;\r\nlet sId;\r\nlet jqshowId;\r\n\r\n/**\r\n * @constructor\r\n * @param {String} selector The selector for the page region containing the page.\r\n */\r\nfunction SessionQuestions(selector) {\r\n    this.node = jQuery(selector);\r\n    sId = this.node.attr('data-sid');\r\n    cmId = this.node.attr('data-cmid');\r\n    jqshowId = this.node.attr('data-jqshowid');\r\n    this.initPanel();\r\n}\r\n\r\n/** @type {jQuery} The jQuery node for the page region. */\r\nSessionQuestions.prototype.node = null;\r\n\r\nSessionQuestions.prototype.initPanel = function() {\r\n    this.node.find(ACTION.COPYQUESTION).on('click', this.copyQuestion.bind(this));\r\n    this.node.find(ACTION.DELETEQUESTION).on('click', this.deleteQuestion.bind(this));\r\n};\r\n\r\nSessionQuestions.prototype.copyQuestion = function(e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    let that = this;\r\n    let questionId = jQuery(e.currentTarget).attr('data-questionnid');\r\n    const stringkeys = [\r\n        {key: 'copyquestion', component: 'mod_jqshow'},\r\n        {key: 'copyquestion_desc', component: 'mod_jqshow'},\r\n        {key: 'confirm', component: 'mod_jqshow'}\r\n    ];\r\n    getStrings(stringkeys).then((langStrings) => {\r\n        const title = langStrings[0];\r\n        const message = langStrings[1];\r\n        const buttonText = langStrings[2];\r\n        return ModalFactory.create({\r\n            title: title,\r\n            body: message,\r\n            type: ModalFactory.types.SAVE_CANCEL\r\n        }).then(modal => {\r\n            modal.setSaveButtonText(buttonText);\r\n            modal.getRoot().on(ModalEvents.save, () => {\r\n                Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\r\n                    let identifier = jQuery(REGION.PANEL);\r\n                    identifier.append(html);\r\n                });\r\n                let request = {\r\n                    methodname: SERVICES.COPYQUESTION,\r\n                    args: {\r\n                        qid: questionId,\r\n                    }\r\n                };\r\n                Ajax.call([request])[0].done(function(response) {\r\n                    if (response.copied) {\r\n                        that.reloadSessionQuestionsHtml();\r\n                    } else {\r\n                        jQuery(REGION.LOADING).remove();\r\n                        alert('no se ha podido borrar la pregunta. intentalo de nuevo mas tarde.');\r\n                    }\r\n                });\r\n            });\r\n            modal.getRoot().on(ModalEvents.hidden, () => {\r\n                modal.destroy();\r\n            });\r\n            return modal;\r\n        });\r\n    }).done(function(modal) {\r\n        modal.show();\r\n        // eslint-disable-next-line no-restricted-globals\r\n    }).fail(Notification.exception);\r\n};\r\n\r\nSessionQuestions.prototype.reloadSessionQuestionsHtml = function() {\r\n    let request = {\r\n        methodname: SERVICES.SESSIONQUESTIONS,\r\n        args: {\r\n            jqshowid: jqshowId,\r\n            cmid: cmId,\r\n            sid: sId\r\n        }\r\n    };\r\n    Ajax.call([request])[0].done(function(response) {\r\n        Templates.render(TEMPLATES.QUESTIONSSELECTED, response).then(function(html, js) {\r\n            jQuery(REGION.SESSIONQUESTIONS).html(html);\r\n            Templates.runTemplateJS(js);\r\n            jQuery(REGION.LOADING).remove();\r\n        }).fail(function(e) {\r\n            alert(\"error template\");\r\n        });\r\n    }).fail(function(e) {\r\n        alert(\"error ajax\");\r\n    });\r\n}\r\nSessionQuestions.prototype.deleteQuestion = function(e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    let that = this;\r\n    let questionId = jQuery(e.currentTarget).attr('data-questionnid');\r\n    const stringkeys = [\r\n        {key: 'deletequestion', component: 'mod_jqshow'},\r\n        {key: 'deletequestion_desc', component: 'mod_jqshow'},\r\n        {key: 'confirm', component: 'mod_jqshow'}\r\n    ];\r\n    getStrings(stringkeys).then((langStrings) => {\r\n        const title = langStrings[0];\r\n        const message = langStrings[1];\r\n        const buttonText = langStrings[2];\r\n        return ModalFactory.create({\r\n            title: title,\r\n            body: message,\r\n            type: ModalFactory.types.SAVE_CANCEL\r\n        }).then(modal => {\r\n            modal.setSaveButtonText(buttonText);\r\n            modal.getRoot().on(ModalEvents.save, () => {\r\n                Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\r\n                    let identifier = jQuery(REGION.PANEL);\r\n                    identifier.append(html);\r\n                });\r\n                let request = {\r\n                    methodname: SERVICES.DELETEQUESTION,\r\n                    args: {\r\n                        qid: questionId,\r\n                        sid: sId\r\n                    }\r\n                };\r\n                Ajax.call([request])[0].done(function(response) {\r\n                    if (response.deleted) {\r\n                        that.reloadSessionQuestionsHtml();\r\n                    } else {\r\n                        jQuery(REGION.LOADING).remove();\r\n                        alert('no se ha podido borrar la pregunta. intentalo de nuevo mas tarde.');\r\n                    }\r\n                });\r\n            });\r\n            modal.getRoot().on(ModalEvents.hidden, () => {\r\n                modal.destroy();\r\n            });\r\n            return modal;\r\n        });\r\n    }).done(function(modal) {\r\n        modal.show();\r\n        // eslint-disable-next-line no-restricted-globals\r\n    }).fail(Notification.exception);\r\n};\r\n\r\nexport const initSessionQuestions = (selector) => {\r\n    return new SessionQuestions(selector);\r\n};\r\n"],"names":["cmId","sId","jqshowId","ACTION","SERVICES","REGION","TEMPLATES","SessionQuestions","selector","node","this","attr","initPanel","prototype","find","on","copyQuestion","bind","deleteQuestion","e","preventDefault","stopPropagation","that","questionId","currentTarget","key","component","then","langStrings","title","message","buttonText","ModalFactory","create","body","type","types","SAVE_CANCEL","modal","setSaveButtonText","getRoot","ModalEvents","save","render","visible","done","html","append","request","methodname","args","qid","call","response","copied","reloadSessionQuestionsHtml","remove","alert","hidden","destroy","show","fail","Notification","exception","jqshowid","cmid","sid","js","runTemplateJS","deleted"],"mappings":"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"}