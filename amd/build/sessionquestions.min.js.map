{"version":3,"file":"sessionquestions.min.js","sources":["../src/sessionquestions.js"],"sourcesContent":["\"use strict\";\n/* eslint-disable no-unused-vars */ // TODO remove.\n\nimport jQuery from 'jquery';\nimport {get_strings as getStrings} from 'core/str';\nimport Ajax from 'core/ajax';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\n\nlet ACTION = {\n    COPYQUESTION: '[data-action=\"copy_question\"]',\n    DELETEQUESTION: '[data-action=\"delete_question\"]',\n};\n\nlet SERVICES = {\n    COPYQUESTION: 'mod_jqshow_copyquestion',\n    DELETEQUESTION: 'mod_jqshow_deletequestion',\n    SESSIONQUESTIONS: 'mod_jqshow_sessionquestions'\n};\n\nlet REGION = {\n    PANEL: '[data-region=\"questions-panel\"]',\n    LOADING: '[data-region=\"overlay-icon-container\"]',\n    SESSIONQUESTIONS: '[data-region=\"session-questions\"]'\n};\n\nlet TEMPLATES = {\n    LOADING: 'core/overlay_loading',\n    SUCCESS: 'core/notification_success',\n    ERROR: 'core/notification_error',\n    QUESTIONSSELECTED: 'mod_jqshow/createsession/sessionquestions'\n};\n\nlet cmId;\nlet sId;\nlet jqshowId;\n\n/**\n * @constructor\n * @param {String} selector The selector for the page region containing the page.\n */\nfunction SessionQuestions(selector) {\n    this.node = jQuery(selector);\n    sId = this.node.attr('data-sid');\n    cmId = this.node.attr('data-cmid');\n    jqshowId = this.node.attr('data-jqshowid');\n    this.initPanel();\n}\n\n/** @type {jQuery} The jQuery node for the page region. */\nSessionQuestions.prototype.node = null;\n\nSessionQuestions.prototype.initPanel = function() {\n    this.node.find(ACTION.COPYQUESTION).on('click', this.copyQuestion.bind(this));\n    this.node.find(ACTION.DELETEQUESTION).on('click', this.deleteQuestion.bind(this));\n};\n\nSessionQuestions.prototype.copyQuestion = function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    let that = this;\n    let questionId = jQuery(e.currentTarget).attr('data-questionnid');\n    const stringkeys = [\n        {key: 'copyquestion', component: 'mod_jqshow'},\n        {key: 'copyquestion_desc', component: 'mod_jqshow'},\n        {key: 'confirm', component: 'mod_jqshow'}\n    ];\n    getStrings(stringkeys).then((langStrings) => {\n        const title = langStrings[0];\n        const message = langStrings[1];\n        const buttonText = langStrings[2];\n        return ModalFactory.create({\n            title: title,\n            body: message,\n            type: ModalFactory.types.SAVE_CANCEL\n        }).then(modal => {\n            modal.setSaveButtonText(buttonText);\n            modal.getRoot().on(ModalEvents.save, () => {\n                Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                    let identifier = jQuery(REGION.PANEL);\n                    identifier.append(html);\n                });\n                let request = {\n                    methodname: SERVICES.COPYQUESTION,\n                    args: {\n                        qid: questionId,\n                    }\n                };\n                Ajax.call([request])[0].done(function(response) {\n                    if (response.copied) {\n                        that.reloadSessionQuestionsHtml();\n                    } else {\n                        jQuery(REGION.LOADING).remove();\n                        alert('no se ha podido borrar la pregunta. intentalo de nuevo mas tarde.');\n                    }\n                });\n            });\n            modal.getRoot().on(ModalEvents.hidden, () => {\n                modal.destroy();\n            });\n            return modal;\n        });\n    }).done(function(modal) {\n        modal.show();\n        // eslint-disable-next-line no-restricted-globals\n    }).fail(Notification.exception);\n};\n\nSessionQuestions.prototype.reloadSessionQuestionsHtml = function() {\n    let request = {\n        methodname: SERVICES.SESSIONQUESTIONS,\n        args: {\n            jqshowid: jqshowId,\n            cmid: cmId,\n            sid: sId\n        }\n    };\n    Ajax.call([request])[0].done(function(response) {\n        Templates.render(TEMPLATES.QUESTIONSSELECTED, response).then(function(html, js) {\n            jQuery(REGION.SESSIONQUESTIONS).html(html);\n            Templates.runTemplateJS(js);\n            jQuery(REGION.LOADING).remove();\n        }).fail(Notification.exception);\n    }).fail(Notification.exception);\n};\n\nSessionQuestions.prototype.deleteQuestion = function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    let that = this;\n    let questionId = jQuery(e.currentTarget).attr('data-questionnid');\n    const stringkeys = [\n        {key: 'deletequestion', component: 'mod_jqshow'},\n        {key: 'deletequestion_desc', component: 'mod_jqshow'},\n        {key: 'confirm', component: 'mod_jqshow'}\n    ];\n    getStrings(stringkeys).then((langStrings) => {\n        const title = langStrings[0];\n        const message = langStrings[1];\n        const buttonText = langStrings[2];\n        return ModalFactory.create({\n            title: title,\n            body: message,\n            type: ModalFactory.types.SAVE_CANCEL\n        }).then(modal => {\n            modal.setSaveButtonText(buttonText);\n            modal.getRoot().on(ModalEvents.save, () => {\n                Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                    let identifier = jQuery(REGION.PANEL);\n                    identifier.append(html);\n                });\n                let request = {\n                    methodname: SERVICES.DELETEQUESTION,\n                    args: {\n                        qid: questionId,\n                        sid: sId\n                    }\n                };\n                Ajax.call([request])[0].done(function(response) {\n                    if (response.deleted) {\n                        that.reloadSessionQuestionsHtml();\n                    } else {\n                        jQuery(REGION.LOADING).remove();\n                        alert('no se ha podido borrar la pregunta. intentalo de nuevo mas tarde.');\n                    }\n                });\n            });\n            modal.getRoot().on(ModalEvents.hidden, () => {\n                modal.destroy();\n            });\n            return modal;\n        });\n    }).done(function(modal) {\n        modal.show();\n        // eslint-disable-next-line no-restricted-globals\n    }).fail(Notification.exception);\n};\n\nexport const initSessionQuestions = (selector) => {\n    return new SessionQuestions(selector);\n};\n"],"names":["_interopRequireDefault","obj","__esModule","default","Object","defineProperty","_exports","value","initSessionQuestions","_jquery","_ajax","_modal_factory","_modal_events","_templates","_notification","cmId","sId","jqshowId","ACTION","SERVICES","REGION","TEMPLATES","SessionQuestions","selector","this","node","jQuery","attr","initPanel","prototype","find","on","copyQuestion","bind","deleteQuestion","e","preventDefault","stopPropagation","that","questionId","currentTarget","getStrings","key","component","then","langStrings","title","message","buttonText","ModalFactory","create","body","type","types","SAVE_CANCEL","modal","setSaveButtonText","getRoot","ModalEvents","save","Templates","render","visible","done","html","append","request","methodname","args","qid","Ajax","call","response","copied","reloadSessionQuestionsHtml","remove","alert","hidden","destroy","show","fail","Notification","exception","jqshowid","cmid","sid","js","runTemplateJS","deleted"],"mappings":"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"}