{"version":3,"file":"user_report.min.js","sources":["../src/user_report.js"],"sourcesContent":["\"use strict\";\r\n/* eslint-disable no-unused-vars */\r\n\r\nimport jQuery from 'jquery';\r\nimport Templates from 'core/templates';\r\nimport ModalFactory from 'core/modal_factory';\r\nimport ModalEvents from 'core/modal_events';\r\nimport ModalJqshow from 'mod_jqshow/modal';\r\nimport Ajax from 'core/ajax';\r\nimport Notification from 'core/notification';\r\nimport {get_string as getString} from 'core/str';\r\n\r\nlet REGION = {\r\n    ROOT: '[data-region=\"question-list\"]', // This root.\r\n    LOADING: '[data-region=\"overlay-icon-container\"]',\r\n};\r\n\r\nlet ACTION = {\r\n    SEEANSWER: '[data-action=\"seeanswer\"]',\r\n};\r\n\r\nlet SERVICES = {\r\n    GETQUESTION: 'mod_jqshow_getquestion',\r\n    USERQUESTIONRESPONSE: 'mod_jqshow_getuserquestionresponse',\r\n};\r\n\r\nlet TEMPLATES = {\r\n    LOADING: 'core/overlay_loading',\r\n    QUESTION: 'mod_jqshow/questions/encasement'\r\n};\r\n\r\nUserReport.prototype.root = null;\r\n\r\n/**\r\n * @constructor\r\n * @param {String} region\r\n */\r\nfunction UserReport(region) {\r\n    this.root = jQuery(region);\r\n    this.root.find(ACTION.SEEANSWER).on('click', this.seeAnswer);\r\n}\r\n\r\nUserReport.prototype.seeAnswer = function(e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    let userId = jQuery(e.currentTarget).attr('data-userid');\r\n    let sessionId = jQuery(e.currentTarget).attr('data-sessionid');\r\n    let questionnId = jQuery(e.currentTarget).attr('data-questionnid');\r\n    let cmId = jQuery(e.currentTarget).attr('data-cmid');\r\n    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\r\n        let identifier = jQuery(REGION.ROOT);\r\n        identifier.append(html);\r\n        let request = {\r\n            methodname: SERVICES.GETQUESTION,\r\n            args: {\r\n                cmid: cmId,\r\n                sid: sessionId,\r\n                jqid: questionnId\r\n            }\r\n        };\r\n        Ajax.call([request])[0].done(function(question) {\r\n            let requestAnswer = {\r\n                methodname: SERVICES.USERQUESTIONRESPONSE,\r\n                args: {\r\n                    jqid: question.jqid,\r\n                    cmid: cmId,\r\n                    sid: sessionId,\r\n                    uid: userId\r\n                }\r\n            };\r\n            Ajax.call([requestAnswer])[0].done(function(answer) {\r\n                const questionData = {\r\n                    ...question,\r\n                    ...answer\r\n                };\r\n                getString('viewquestion_user', 'mod_jqshow').done((title) => {\r\n                    Templates.render(TEMPLATES.QUESTION, questionData).then(function(html, js) {\r\n                        ModalFactory.create({\r\n                            classes: 'modal_jqshow',\r\n                            body: html,\r\n                            title: title,\r\n                            footer: '',\r\n                            type: ModalJqshow.TYPE\r\n                        }).then(modal => {\r\n                            modal.getRoot().on(ModalEvents.hidden, function() {\r\n                                modal.destroy();\r\n                            });\r\n                            jQuery(REGION.LOADING).remove();\r\n                            modal.show();\r\n                            Templates.runTemplateJS(js);\r\n                        }).fail(Notification.exception);\r\n                    }).fail(Notification.exception);\r\n                }).fail(Notification.exception);\r\n            });\r\n        });\r\n    });\r\n};\r\n\r\nexport const userReport = (region) => {\r\n    return new UserReport(region);\r\n};\r\n"],"names":["REGION","ACTION","SERVICES","TEMPLATES","UserReport","region","root","find","on","this","seeAnswer","prototype","e","preventDefault","stopPropagation","userId","currentTarget","attr","sessionId","questionnId","cmId","render","visible","done","html","append","request","methodname","args","cmid","sid","jqid","call","question","requestAnswer","uid","answer","questionData","title","then","js","create","classes","body","footer","type","ModalJqshow","TYPE","modal","getRoot","ModalEvents","hidden","destroy","remove","show","runTemplateJS","fail","Notification","exception"],"mappings":"wvBAYIA,YACM,gCADNA,eAES,yCAGTC,iBACW,4BAGXC,qBACa,yBADbA,8BAEsB,qCAGtBC,kBACS,uBADTA,mBAEU,2CASLC,WAAWC,aACXC,MAAO,mBAAOD,aACdC,KAAKC,KAAKN,kBAAkBO,GAAG,QAASC,KAAKC,WARtDN,WAAWO,UAAUL,KAAO,KAW5BF,WAAWO,UAAUD,UAAY,SAASE,GACtCA,EAAEC,iBACFD,EAAEE,sBACEC,QAAS,mBAAOH,EAAEI,eAAeC,KAAK,eACtCC,WAAY,mBAAON,EAAEI,eAAeC,KAAK,kBACzCE,aAAc,mBAAOP,EAAEI,eAAeC,KAAK,oBAC3CG,MAAO,mBAAOR,EAAEI,eAAeC,KAAK,gCAC9BI,OAAOlB,kBAAmB,CAACmB,SAAS,IAAOC,MAAK,SAASC,OAC9C,mBAAOxB,aACbyB,OAAOD,UACdE,QAAU,CACVC,WAAYzB,qBACZ0B,KAAM,CACFC,KAAMT,KACNU,IAAKZ,UACLa,KAAMZ,4BAGTa,KAAK,CAACN,UAAU,GAAGH,MAAK,SAASU,cAC9BC,cAAgB,CAChBP,WAAYzB,8BACZ0B,KAAM,CACFG,KAAME,SAASF,KACfF,KAAMT,KACNU,IAAKZ,UACLiB,IAAKpB,uBAGRiB,KAAK,CAACE,gBAAgB,GAAGX,MAAK,SAASa,cAClCC,aAAe,IACdJ,YACAG,4BAEG,oBAAqB,cAAcb,MAAMe,2BACrCjB,OAAOlB,mBAAoBkC,cAAcE,MAAK,SAASf,KAAMgB,2BACtDC,OAAO,CAChBC,QAAS,eACTC,KAAMnB,KACNc,MAAOA,MACPM,OAAQ,GACRC,KAAMC,eAAYC,OACnBR,MAAKS,QACJA,MAAMC,UAAUzC,GAAG0C,sBAAYC,QAAQ,WACnCH,MAAMI,iCAEHpD,gBAAgBqD,SACvBL,MAAMM,0BACIC,cAAcf,OACzBgB,KAAKC,sBAAaC,cACtBF,KAAKC,sBAAaC,cACtBF,KAAKC,sBAAaC,yCAMVrD,QAChB,IAAID,WAAWC"}