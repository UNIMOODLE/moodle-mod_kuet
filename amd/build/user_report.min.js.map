{"version":3,"file":"user_report.min.js","sources":["../src/user_report.js"],"sourcesContent":["\"use strict\";\n/* eslint-disable no-unused-vars */\n\nimport jQuery from 'jquery';\nimport Templates from 'core/templates';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport ModalJqshow from 'mod_jqshow/modal';\nimport Ajax from 'core/ajax';\nimport Notification from 'core/notification';\nimport {get_string as getString} from 'core/str';\n\nlet REGION = {\n    ROOT: '[data-region=\"question-list\"]', // This root.\n    LOADING: '[data-region=\"overlay-icon-container\"]',\n};\n\nlet ACTION = {\n    SEEANSWER: '[data-action=\"seeanswer\"]',\n};\n\nlet SERVICES = {\n    GETQUESTION: 'mod_jqshow_getquestion',\n    USERQUESTIONRESPONSE: 'mod_jqshow_getuserquestionresponse',\n};\n\nlet TEMPLATES = {\n    LOADING: 'core/overlay_loading',\n    QUESTION: 'mod_jqshow/questions/encasement'\n};\n\nUserReport.prototype.root = null;\n\n/**\n * @constructor\n * @param {String} region\n */\nfunction UserReport(region) {\n    this.root = jQuery(region);\n    this.root.find(ACTION.SEEANSWER).on('click', this.seeAnswer);\n}\n\nUserReport.prototype.seeAnswer = function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    let userId = jQuery(e.currentTarget).attr('data-userid');\n    let sessionId = jQuery(e.currentTarget).attr('data-sessionid');\n    let questionnId = jQuery(e.currentTarget).attr('data-questionnid');\n    let cmId = jQuery(e.currentTarget).attr('data-cmid');\n    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n        let identifier = jQuery(REGION.ROOT);\n        identifier.append(html);\n        let request = {\n            methodname: SERVICES.GETQUESTION,\n            args: {\n                cmid: cmId,\n                sid: sessionId,\n                jqid: questionnId\n            }\n        };\n        Ajax.call([request])[0].done(function(question) {\n            let requestAnswer = {\n                methodname: SERVICES.USERQUESTIONRESPONSE,\n                args: {\n                    jqid: question.jqid,\n                    cmid: cmId,\n                    sid: sessionId,\n                    uid: userId\n                }\n            };\n            Ajax.call([requestAnswer])[0].done(function(answer) {\n                const questionData = {\n                    ...question,\n                    ...answer\n                };\n                getString('viewquestion_user', 'mod_jqshow').done((title) => {\n                    Templates.render(TEMPLATES.QUESTION, questionData).then(function(html, js) {\n                        ModalFactory.create({\n                            classes: 'modal_jqshow',\n                            body: html,\n                            title: title,\n                            footer: '',\n                            type: ModalJqshow.TYPE\n                        }).then(modal => {\n                            modal.getRoot().on(ModalEvents.hidden, function() {\n                                modal.destroy();\n                            });\n                            jQuery(REGION.LOADING).remove();\n                            modal.show();\n                            Templates.runTemplateJS(js);\n                        }).fail(Notification.exception);\n                    }).fail(Notification.exception);\n                }).fail(Notification.exception);\n            });\n        });\n    });\n};\n\nexport const userReport = (region) => {\n    return new UserReport(region);\n};\n"],"names":["REGION","ACTION","SERVICES","TEMPLATES","UserReport","region","root","find","on","this","seeAnswer","prototype","e","preventDefault","stopPropagation","userId","currentTarget","attr","sessionId","questionnId","cmId","render","visible","done","html","append","request","methodname","args","cmid","sid","jqid","call","question","requestAnswer","uid","answer","questionData","title","then","js","create","classes","body","footer","type","ModalJqshow","TYPE","modal","getRoot","ModalEvents","hidden","destroy","remove","show","runTemplateJS","fail","Notification","exception"],"mappings":"wvBAYIA,YACM,gCADNA,eAES,yCAGTC,iBACW,4BAGXC,qBACa,yBADbA,8BAEsB,qCAGtBC,kBACS,uBADTA,mBAEU,2CASLC,WAAWC,aACXC,MAAO,mBAAOD,aACdC,KAAKC,KAAKN,kBAAkBO,GAAG,QAASC,KAAKC,WARtDN,WAAWO,UAAUL,KAAO,KAW5BF,WAAWO,UAAUD,UAAY,SAASE,GACtCA,EAAEC,iBACFD,EAAEE,sBACEC,QAAS,mBAAOH,EAAEI,eAAeC,KAAK,eACtCC,WAAY,mBAAON,EAAEI,eAAeC,KAAK,kBACzCE,aAAc,mBAAOP,EAAEI,eAAeC,KAAK,oBAC3CG,MAAO,mBAAOR,EAAEI,eAAeC,KAAK,gCAC9BI,OAAOlB,kBAAmB,CAACmB,SAAS,IAAOC,MAAK,SAASC,OAC9C,mBAAOxB,aACbyB,OAAOD,UACdE,QAAU,CACVC,WAAYzB,qBACZ0B,KAAM,CACFC,KAAMT,KACNU,IAAKZ,UACLa,KAAMZ,4BAGTa,KAAK,CAACN,UAAU,GAAGH,MAAK,SAASU,cAC9BC,cAAgB,CAChBP,WAAYzB,8BACZ0B,KAAM,CACFG,KAAME,SAASF,KACfF,KAAMT,KACNU,IAAKZ,UACLiB,IAAKpB,uBAGRiB,KAAK,CAACE,gBAAgB,GAAGX,MAAK,SAASa,cAClCC,aAAe,IACdJ,YACAG,4BAEG,oBAAqB,cAAcb,MAAMe,2BACrCjB,OAAOlB,mBAAoBkC,cAAcE,MAAK,SAASf,KAAMgB,2BACtDC,OAAO,CAChBC,QAAS,eACTC,KAAMnB,KACNc,MAAOA,MACPM,OAAQ,GACRC,KAAMC,eAAYC,OACnBR,MAAKS,QACJA,MAAMC,UAAUzC,GAAG0C,sBAAYC,QAAQ,WACnCH,MAAMI,iCAEHpD,gBAAgBqD,SACvBL,MAAMM,0BACIC,cAAcf,OACzBgB,KAAKC,sBAAaC,cACtBF,KAAKC,sBAAaC,cACtBF,KAAKC,sBAAaC,yCAMVrD,QAChB,IAAID,WAAWC"}