{"version":3,"file":"user_report.min.js","sources":["../src/user_report.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n// Project implemented by the \"Recovery, Transformation and Resilience Plan.\n// Funded by the European Union - Next GenerationEU\".\n//\n// Produced by the UNIMOODLE University Group: Universities of\n// Valladolid, Complutense de Madrid, UPV/EHU, León, Salamanca,\n// Illes Balears, Valencia, Rey Juan Carlos, La Laguna, Zaragoza, Málaga,\n// Córdoba, Extremadura, Vigo, Las Palmas de Gran Canaria y Burgos..\n\n/**\n *\n * @module    mod_kuet/user_report\n * @copyright  2023 Proyecto UNIMOODLE {@link https://unimoodle.github.io}\n * @author     UNIMOODLE Group (Coordinator) <direccion.area.estrategia.digital@uva.es>\n * @author     3IPUNT <contacte@tresipunt.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n\"use strict\";\n\nimport jQuery from 'jquery';\nimport Templates from 'core/templates';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport ModalKuet from 'mod_kuet/modal';\nimport Ajax from 'core/ajax';\nimport Notification from 'core/notification';\nimport {get_string as getString} from 'core/str';\n\nlet REGION = {\n    ROOT: '[data-region=\"question-list\"]', // This root.\n    LOADING: '[data-region=\"overlay-icon-container\"]',\n};\n\nlet ACTION = {\n    SEEANSWER: '[data-action=\"seeanswer\"]',\n};\n\nlet SERVICES = {\n    GETQUESTION: 'mod_kuet_getquestion',\n    USERQUESTIONRESPONSE: 'mod_kuet_getuserquestionresponse',\n};\n\nlet TEMPLATES = {\n    LOADING: 'core/overlay_loading',\n    QUESTION: 'mod_kuet/questions/encasement'\n};\n\nUserReport.prototype.root = null;\n\n/**\n * @constructor\n * @param {String} region\n */\nfunction UserReport(region) {\n    this.root = jQuery(region);\n    this.root.find(ACTION.SEEANSWER).on('click', this.seeAnswer);\n}\n\nUserReport.prototype.seeAnswer = function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    let userId = jQuery(e.currentTarget).attr('data-userid');\n    let sessionId = jQuery(e.currentTarget).attr('data-sessionid');\n    let questionnId = jQuery(e.currentTarget).attr('data-questionnid');\n    let cmId = jQuery(e.currentTarget).attr('data-cmid');\n    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n        let identifier = jQuery(REGION.ROOT);\n        identifier.append(html);\n        let request = {\n            methodname: SERVICES.GETQUESTION,\n            args: {\n                cmid: cmId,\n                sid: sessionId,\n                kid: questionnId\n            }\n        };\n        Ajax.call([request])[0].done(function(question) {\n            let requestAnswer = {\n                methodname: SERVICES.USERQUESTIONRESPONSE,\n                args: {\n                    kid: question.kid,\n                    cmid: cmId,\n                    sid: sessionId,\n                    uid: userId,\n                    preview: true\n                }\n            };\n            Ajax.call([requestAnswer])[0].done(function(answer) {\n                const questionData = {\n                    ...question,\n                    ...answer\n                };\n                getString('viewquestion_user', 'mod_kuet').done((title) => {\n                    Templates.render(TEMPLATES.QUESTION, questionData).then(function(html, js) {\n                        ModalFactory.create({\n                            classes: 'modal_kuet',\n                            body: html,\n                            title: title,\n                            footer: '',\n                            type: ModalKuet.TYPE\n                        }).then(modal => {\n                            modal.getRoot().on(ModalEvents.hidden, function() {\n                                modal.destroy();\n                            });\n                            jQuery(REGION.LOADING).remove();\n                            modal.show();\n                            Templates.runTemplateJS(js);\n                        }).fail(Notification.exception);\n                    }).fail(Notification.exception);\n                }).fail(Notification.exception);\n            });\n        });\n    });\n};\n\nexport const userReport = (region) => {\n    return new UserReport(region);\n};\n"],"names":["REGION","ACTION","SERVICES","TEMPLATES","UserReport","region","root","find","on","this","seeAnswer","prototype","e","preventDefault","stopPropagation","userId","currentTarget","attr","sessionId","questionnId","cmId","render","visible","done","html","append","request","methodname","args","cmid","sid","kid","call","question","requestAnswer","uid","preview","answer","questionData","title","then","js","create","classes","body","footer","type","ModalKuet","TYPE","modal","getRoot","ModalEvents","hidden","destroy","remove","show","runTemplateJS","fail","Notification","exception"],"mappings":"ovBA2CIA,YACM,gCADNA,eAES,yCAGTC,iBACW,4BAGXC,qBACa,uBADbA,8BAEsB,mCAGtBC,kBACS,uBADTA,mBAEU,yCASLC,WAAWC,aACXC,MAAO,mBAAOD,aACdC,KAAKC,KAAKN,kBAAkBO,GAAG,QAASC,KAAKC,WARtDN,WAAWO,UAAUL,KAAO,KAW5BF,WAAWO,UAAUD,UAAY,SAASE,GACtCA,EAAEC,iBACFD,EAAEE,sBACEC,QAAS,mBAAOH,EAAEI,eAAeC,KAAK,eACtCC,WAAY,mBAAON,EAAEI,eAAeC,KAAK,kBACzCE,aAAc,mBAAOP,EAAEI,eAAeC,KAAK,oBAC3CG,MAAO,mBAAOR,EAAEI,eAAeC,KAAK,gCAC9BI,OAAOlB,kBAAmB,CAACmB,SAAS,IAAOC,MAAK,SAASC,OAC9C,mBAAOxB,aACbyB,OAAOD,UACdE,QAAU,CACVC,WAAYzB,qBACZ0B,KAAM,CACFC,KAAMT,KACNU,IAAKZ,UACLa,IAAKZ,4BAGRa,KAAK,CAACN,UAAU,GAAGH,MAAK,SAASU,cAC9BC,cAAgB,CAChBP,WAAYzB,8BACZ0B,KAAM,CACFG,IAAKE,SAASF,IACdF,KAAMT,KACNU,IAAKZ,UACLiB,IAAKpB,OACLqB,SAAS,kBAGZJ,KAAK,CAACE,gBAAgB,GAAGX,MAAK,SAASc,cAClCC,aAAe,IACdL,YACAI,4BAEG,oBAAqB,YAAYd,MAAMgB,2BACnClB,OAAOlB,mBAAoBmC,cAAcE,MAAK,SAAShB,KAAMiB,2BACtDC,OAAO,CAChBC,QAAS,aACTC,KAAMpB,KACNe,MAAOA,MACPM,OAAQ,GACRC,KAAMC,eAAUC,OACjBR,MAAKS,QACJA,MAAMC,UAAU1C,GAAG2C,sBAAYC,QAAQ,WACnCH,MAAMI,iCAEHrD,gBAAgBsD,SACvBL,MAAMM,0BACIC,cAAcf,OACzBgB,KAAKC,sBAAaC,cACtBF,KAAKC,sBAAaC,cACtBF,KAAKC,sBAAaC,yCAMVtD,QAChB,IAAID,WAAWC"}