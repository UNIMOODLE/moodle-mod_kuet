{"version":3,"file":"matchConnections.min.js","sources":["../src/matchConnections.js"],"sourcesContent":["\"use strict\";\n\nimport jQuery from 'jquery';\n\nexport const connections = function(from, options) {\n    if (options === \"update\") {\n        return processConnections(update, this);\n    } else if (options === \"remove\") {\n        return processConnections(destroy, this);\n    } else {\n        options = jQuery.extend(\n            true,\n            {\n                borderClasses: {},\n                class: \"connection\",\n                css: {},\n                from: from,\n                tag: \"connection\",\n                to: this,\n                within: \":root\"\n            },\n            options\n        );\n        connect(options);\n        return this;\n    }\n};\n\nlet connect = function(options) {\n    let borderClasses = options.borderClasses;\n    let tag = options.tag;\n    let end1 = jQuery(options.from);\n    let end2 = jQuery(options.to);\n    let within = jQuery(options.within);\n    delete options.borderClasses;\n    delete options.tag;\n    delete options.from;\n    delete options.to;\n    delete options.within;\n    within.each(function() {\n        let container = this;\n        let done = [];\n        end1.each(function() {\n            let node = this;\n            done.push(this);\n            end2.not(done).each(function() {\n                createConnection(\n                    container,\n                    [node, this],\n                    tag,\n                    borderClasses,\n                    options\n                );\n            });\n        });\n    });\n};\n\nlet createConnection = function(\n    container,\n    nodes,\n    tag,\n    borderClasses,\n    options\n) {\n    let css = jQuery.extend({ position: \"absolute\" }, options.css);\n    let connection = jQuery(\"<\" + tag + \"/>\", options).css(css);\n    connection.appendTo(container);\n\n    let border_w = (connection.outerWidth() - connection.innerWidth()) / 2;\n    let border_h = (connection.outerHeight() - connection.innerHeight()) / 2;\n\n    if (border_w <= 0 && border_h <= 0) {\n        border_w = border_h = 1;\n    }\n\n    let data = {\n        borderClasses: borderClasses,\n        border_h: border_h,\n        border_w: border_w,\n        node_from: jQuery(nodes[0]),\n        node_to: jQuery(nodes[1]),\n        nodes_dom: nodes,\n        css: css\n    };\n\n    if (\"none\" === connection.css(\"border-top-style\")) {\n        data.css.borderStyle = \"solid\";\n    }\n    jQuery.data(connection.get(0), \"connection\", data);\n    jQuery.data(connection.get(0), \"connections\", [connection.get(0)]);\n    for (let i = 0; i < 2; i++) {\n        let connections = connection.add(jQuery.data(nodes[i], \"connections\")).get();\n        jQuery.data(nodes[i], \"connections\", connections);\n        if (connections.length == 1) {\n            jQuery(nodes[i]).on(\"connections.connections\", false);\n        }\n    }\n    update(connection.get(0));\n};\n\nlet destroy = function(connection) {\n    let nodes = jQuery.data(connection, \"connection\").nodes_dom;\n    for (let i = 0; i < 2; i++) {\n        let connections = jQuery(jQuery.data(nodes[i], \"connections\"))\n            .not(connection)\n            .get();\n        jQuery.data(nodes[i], \"connections\", connections);\n    }\n    jQuery(connection).remove();\n};\n\nlet getState = function(data) {\n    data.rect_from = data.nodes_dom[0].getBoundingClientRect();\n    data.rect_to = data.nodes_dom[1].getBoundingClientRect();\n    let cached = data.cache;\n    data.cache = [\n        data.rect_from.top,\n        data.rect_from.right,\n        data.rect_from.bottom,\n        data.rect_from.left,\n        data.rect_to.top,\n        data.rect_to.right,\n        data.rect_to.bottom,\n        data.rect_to.left\n    ];\n    data.hidden =\n        // eslint-disable-next-line no-bitwise\n        0 === (data.cache[0] | data.cache[1] | data.cache[2] | data.cache[3]) ||\n        // eslint-disable-next-line no-bitwise\n        0 === (data.cache[4] | data.cache[5] | data.cache[6] | data.cache[7]);\n    data.unmodified = true;\n    if (cached === undefined) {\n        return (data.unmodified = false);\n    }\n    for (let i = 0; i < 8; i++) {\n        if (cached[i] !== data.cache[i]) {\n            return (data.unmodified = false);\n        }\n    }\n};\n\nlet update = function(connection) {\n    let data = jQuery.data(connection, \"connection\");\n    getState(data);\n    if (data.unmodified) {\n        return;\n    }\n    let border_h = data.border_h;\n    let border_w = data.border_w;\n    let from = data.rect_from;\n    let to = data.rect_to;\n    let b = (from.bottom + from.top) / 2;\n    let r = (to.left + to.right) / 2;\n    let t = (to.bottom + to.top) / 2;\n    let l = (from.left + from.right) / 2;\n\n    let h = [\"right\", \"left\"];\n    if (l > r) {\n        h = [\"left\", \"right\"];\n        let x = Math.max(r - border_w / 2, Math.min(from.right, to.right));\n        r = l + border_w / 2;\n        l = x;\n    } else {\n        l -= border_w / 2;\n        r = Math.min(r + border_w / 2, Math.max(from.left, to.left));\n    }\n    let v = [\"bottom\", \"top\"];\n    if (t > b) {\n        v = [\"top\", \"bottom\"];\n        let x = Math.max(b - border_h / 2, Math.min(from.bottom, to.bottom));\n        b = t + border_h / 2;\n        t = x;\n    } else {\n        b = Math.min(b, Math.max(from.top, to.top));\n        t -= border_h / 2;\n    }\n    let width = r - l;\n    let height = b - t;\n    if (width < border_w) {\n        t = Math.max(t, Math.min(from.bottom, to.bottom));\n        b = Math.min(b, Math.max(from.top, to.top));\n        l = Math.max(from.left, to.left);\n        r = Math.min(from.right, to.right);\n        r = l = (l + r - border_w) / 2;\n    }\n    if (height < border_h) {\n        l = Math.max(l, Math.min(from.right, to.right));\n        r = Math.min(r, Math.max(from.left, to.left));\n        t = Math.max(from.top, to.top);\n        b = Math.min(from.bottom, to.bottom);\n        b = t = (t + b - border_h) / 2;\n    }\n    width = r - l;\n    height = b - t;\n    // eslint-disable-next-line babel/no-unused-expressions\n    width <= 0 && (border_h = 0);\n    // eslint-disable-next-line babel/no-unused-expressions\n    height <= 0 && (border_w = 0);\n    let style =\n        \"border-\" +\n        v[0] +\n        \"-\" +\n        h[0] +\n        \"-radius: 0;\" +\n        \"border-\" +\n        v[0] +\n        \"-\" +\n        h[1] +\n        \"-radius: 0;\" +\n        \"border-\" +\n        v[1] +\n        \"-\" +\n        h[0] +\n        \"-radius: 0;\";\n    // eslint-disable-next-line babel/no-unused-expressions\n    (border_h <= 0 || border_w <= 0) &&\n    (style += \"border-\" + v[1] + \"-\" + h[1] + \"-radius: 0;\");\n    if (data.hidden) {\n        style += \"display: none;\";\n    } else {\n        data.css[\"border-\" + v[0] + \"-width\"] = 0;\n        data.css[\"border-\" + h[0] + \"-width\"] = 0;\n        data.css[\"border-\" + v[1] + \"-width\"] = border_h;\n        data.css[\"border-\" + h[1] + \"-width\"] = border_w;\n        let current_rect = connection.getBoundingClientRect();\n        data.css.left = connection.offsetLeft + l - current_rect.left;\n        data.css.top = connection.offsetTop + t - current_rect.top;\n        data.css.width = width - border_w;\n        data.css.height = height - border_h;\n    }\n    let bc = data.borderClasses;\n    jQuery(connection)\n        .removeClass(bc[v[0]])\n        .removeClass(bc[h[0]])\n        .addClass(bc[v[1]])\n        .addClass(bc[h[1]])\n        .attr(\"style\", style)\n        .css(data.css);\n};\n\nlet processConnections = function(method, elements) {\n    return elements.each(function() {\n        let connections = jQuery.data(this, \"connections\");\n        if (connections instanceof Array) {\n            for (let i = 0, len = connections.length; i < len; i++) {\n                method(connections[i]);\n            }\n        }\n    });\n};\n\n\nexport default {\n    connections\n};"],"names":["obj","Object","defineProperty","_exports","value","default","connections","_jquery","__esModule","from","options","processConnections","update","this","destroy","jQuery","extend","borderClasses","class","css","tag","to","within","connect","end1","end2","each","container","done","node","push","not","createConnection","nodes","position","connection","appendTo","border_w","outerWidth","innerWidth","border_h","outerHeight","innerHeight","data","node_from","node_to","nodes_dom","borderStyle","get","i","add","length","on","remove","rect_from","getBoundingClientRect","rect_to","cached","cache","top","right","bottom","left","hidden","unmodified","undefined","getState","b","r","t","l","h","x","Math","max","min","v","width","height","style","current_rect","offsetLeft","offsetTop","bc","removeClass","addClass","attr","method","elements","Array","len","_default"],"mappings":"sFAE4B,IAAAA,IAFfC,OAAAC,eAAAC,SAAA,aAAA,CAAAC,OAAA,IAAAD,SAAAE,QAAAF,SAAAG,iBAAA,EAEbC,SAA4BP,IAA5BO,UAA4BP,IAAAQ,WAAAR,IAAAK,CAAAA,QAAAL,KAErB,IAAMM,YAAc,SAASG,KAAMC,SACtC,MAAgB,WAAZA,QACOC,mBAAmBC,OAAQC,MACf,WAAZH,QACAC,mBAAmBG,QAASD,OAEnCH,QAAUK,QAAMV,QAACW,QACb,EACA,CACIC,cAAe,CAAE,EACjBC,MAAO,aACPC,IAAK,CAAE,EACPV,KAAMA,KACNW,IAAK,aACLC,GAAIR,KACJS,OAAQ,SAEZZ,SAEJa,QAAQb,SACDG,OAEbV,SAAAG,YAAAA,YAEF,IAAIiB,QAAU,SAASb,SACnB,IAAIO,cAAgBP,QAAQO,cACxBG,IAAMV,QAAQU,IACdI,MAAO,EAAAT,QAAAA,SAAOL,QAAQD,MACtBgB,MAAO,EAAAV,QAAAA,SAAOL,QAAQW,IACtBC,QAAS,EAAAP,QAAAA,SAAOL,QAAQY,eACrBZ,QAAQO,qBACRP,QAAQU,WACRV,QAAQD,YACRC,QAAQW,UACRX,QAAQY,OACfA,OAAOI,MAAK,WACR,IAAIC,UAAYd,KACZe,KAAO,GACXJ,KAAKE,MAAK,WACN,IAAIG,KAAOhB,KACXe,KAAKE,KAAKjB,MACVY,KAAKM,IAAIH,MAAMF,MAAK,WAChBM,iBACIL,UACA,CAACE,KAAMhB,MACPO,IACAH,cACAP,QAER,GACJ,GACJ,KAGAsB,iBAAmB,SACnBL,UACAM,MACAb,IACAH,cACAP,SAEA,IAAIS,IAAMJ,QAAMV,QAACW,OAAO,CAAEkB,SAAU,YAAcxB,QAAQS,KACtDgB,YAAa,EAAApB,QAAMV,SAAC,IAAMe,IAAM,KAAMV,SAASS,IAAIA,KACvDgB,WAAWC,SAAST,WAEpB,IAAIU,UAAYF,WAAWG,aAAeH,WAAWI,cAAgB,EACjEC,UAAYL,WAAWM,cAAgBN,WAAWO,eAAiB,EAEnEL,UAAY,GAAKG,UAAY,IAC7BH,SAAWG,SAAW,GAG1B,IAAIG,KAAO,CACP1B,cAAeA,cACfuB,SAAUA,SACVH,SAAUA,SACVO,WAAW,EAAA7B,QAAMV,SAAC4B,MAAM,IACxBY,SAAS,EAAA9B,QAAMV,SAAC4B,MAAM,IACtBa,UAAWb,MACXd,IAAKA,KAGL,SAAWgB,WAAWhB,IAAI,sBAC1BwB,KAAKxB,IAAI4B,YAAc,SAE3BhC,QAAAA,QAAO4B,KAAKR,WAAWa,IAAI,GAAI,aAAcL,MAC7C5B,QAAMV,QAACsC,KAAKR,WAAWa,IAAI,GAAI,cAAe,CAACb,WAAWa,IAAI,KAC9D,IAAK,IAAIC,EAAI,EAAGA,EAAI,EAAGA,IAAK,CACxB,IAAI3C,aAAc6B,WAAWe,IAAInC,QAAAA,QAAO4B,KAAKV,MAAMgB,GAAI,gBAAgBD,MACvEjC,QAAMV,QAACsC,KAAKV,MAAMgB,GAAI,cAAe3C,cACX,GAAtBA,aAAY6C,SACZ,EAAApC,QAAMV,SAAC4B,MAAMgB,IAAIG,GAAG,2BAA2B,EAEvD,CACAxC,OAAOuB,WAAWa,IAAI,KAGtBlC,QAAU,SAASqB,YAEnB,IADA,IAAIF,MAAQlB,QAAAA,QAAO4B,KAAKR,WAAY,cAAcW,UACzCG,EAAI,EAAGA,EAAI,EAAGA,IAAK,CACxB,IAAI3C,eAAc,EAAAS,QAAMV,SAACU,gBAAO4B,KAAKV,MAAMgB,GAAI,gBAC1ClB,IAAII,YACJa,MACLjC,QAAMV,QAACsC,KAAKV,MAAMgB,GAAI,cAAe3C,cACzC,EACA,EAAAS,iBAAOoB,YAAYkB,UAiCnBzC,OAAS,SAASuB,YAClB,IAAIQ,KAAO5B,QAAMV,QAACsC,KAAKR,WAAY,cAEnC,GAjCW,SAASQ,MACpBA,KAAKW,UAAYX,KAAKG,UAAU,GAAGS,wBACnCZ,KAAKa,QAAUb,KAAKG,UAAU,GAAGS,wBACjC,IAAIE,OAASd,KAAKe,MAiBlB,GAhBAf,KAAKe,MAAQ,CACTf,KAAKW,UAAUK,IACfhB,KAAKW,UAAUM,MACfjB,KAAKW,UAAUO,OACflB,KAAKW,UAAUQ,KACfnB,KAAKa,QAAQG,IACbhB,KAAKa,QAAQI,MACbjB,KAAKa,QAAQK,OACblB,KAAKa,QAAQM,MAEjBnB,KAAKoB,OAED,IAAOpB,KAAKe,MAAM,GAAKf,KAAKe,MAAM,GAAKf,KAAKe,MAAM,GAAKf,KAAKe,MAAM,KAElE,IAAOf,KAAKe,MAAM,GAAKf,KAAKe,MAAM,GAAKf,KAAKe,MAAM,GAAKf,KAAKe,MAAM,IACtEf,KAAKqB,YAAa,OACHC,IAAXR,OACA,OAAQd,KAAKqB,YAAa,EAE9B,IAAK,IAAIf,EAAI,EAAGA,EAAI,EAAGA,IACnB,GAAIQ,OAAOR,KAAON,KAAKe,MAAMT,GACzB,OAAQN,KAAKqB,YAAa,EAOlCE,CAASvB,OACLA,KAAKqB,WAAT,CAGA,IAAIxB,SAAWG,KAAKH,SAChBH,SAAWM,KAAKN,SAChB5B,KAAOkC,KAAKW,UACZjC,GAAKsB,KAAKa,QACVW,GAAK1D,KAAKoD,OAASpD,KAAKkD,KAAO,EAC/BS,GAAK/C,GAAGyC,KAAOzC,GAAGuC,OAAS,EAC3BS,GAAKhD,GAAGwC,OAASxC,GAAGsC,KAAO,EAC3BW,GAAK7D,KAAKqD,KAAOrD,KAAKmD,OAAS,EAE/BW,EAAI,CAAC,QAAS,QAClB,GAAID,EAAIF,EAAG,CACPG,EAAI,CAAC,OAAQ,SACb,IAAIC,EAAIC,KAAKC,IAAIN,EAAI/B,SAAW,EAAGoC,KAAKE,IAAIlE,KAAKmD,MAAOvC,GAAGuC,QAC3DQ,EAAIE,EAAIjC,SAAW,EACnBiC,EAAIE,CACR,MACIF,GAAKjC,SAAW,EAChB+B,EAAIK,KAAKE,IAAIP,EAAI/B,SAAW,EAAGoC,KAAKC,IAAIjE,KAAKqD,KAAMzC,GAAGyC,OAE1D,IAAIc,EAAI,CAAC,SAAU,OACnB,GAAIP,EAAIF,EAAG,CACPS,EAAI,CAAC,MAAO,UACZ,IAAIJ,GAAIC,KAAKC,IAAIP,EAAI3B,SAAW,EAAGiC,KAAKE,IAAIlE,KAAKoD,OAAQxC,GAAGwC,SAC5DM,EAAIE,EAAI7B,SAAW,EACnB6B,EAAIG,EACR,MACIL,EAAIM,KAAKE,IAAIR,EAAGM,KAAKC,IAAIjE,KAAKkD,IAAKtC,GAAGsC,MACtCU,GAAK7B,SAAW,EAEpB,IAAIqC,MAAQT,EAAIE,EACZQ,OAASX,EAAIE,EACbQ,MAAQxC,WACRgC,EAAII,KAAKC,IAAIL,EAAGI,KAAKE,IAAIlE,KAAKoD,OAAQxC,GAAGwC,SACzCM,EAAIM,KAAKE,IAAIR,EAAGM,KAAKC,IAAIjE,KAAKkD,IAAKtC,GAAGsC,MAGtCS,EAAIE,IAFJA,EAAIG,KAAKC,IAAIjE,KAAKqD,KAAMzC,GAAGyC,QAC3BM,EAAIK,KAAKE,IAAIlE,KAAKmD,MAAOvC,GAAGuC,QACXvB,UAAY,GAE7ByC,OAAStC,WACT8B,EAAIG,KAAKC,IAAIJ,EAAGG,KAAKE,IAAIlE,KAAKmD,MAAOvC,GAAGuC,QACxCQ,EAAIK,KAAKE,IAAIP,EAAGK,KAAKC,IAAIjE,KAAKqD,KAAMzC,GAAGyC,OAGvCK,EAAIE,IAFJA,EAAII,KAAKC,IAAIjE,KAAKkD,IAAKtC,GAAGsC,OAC1BQ,EAAIM,KAAKE,IAAIlE,KAAKoD,OAAQxC,GAAGwC,SACZrB,UAAY,IAEjCqC,MAAQT,EAAIE,IAGH,IAAM9B,SAAW,IAF1BsC,OAASX,EAAIE,IAIH,IAAMhC,SAAW,GAC3B,IAAI0C,MACA,UACAH,EAAE,GACF,IACAL,EAAE,GAHF,qBAMAK,EAAE,GACF,IACAL,EAAE,GARF,qBAWAK,EAAE,GACF,IACAL,EAAE,GACF,cAIJ,IAFC/B,UAAY,GAAKH,UAAY,KAC7B0C,OAAS,UAAYH,EAAE,GAAK,IAAML,EAAE,GAAK,eACtC5B,KAAKoB,OACLgB,OAAS,qBACN,CACHpC,KAAKxB,IAAI,UAAYyD,EAAE,GAAK,UAAY,EACxCjC,KAAKxB,IAAI,UAAYoD,EAAE,GAAK,UAAY,EACxC5B,KAAKxB,IAAI,UAAYyD,EAAE,GAAK,UAAYpC,SACxCG,KAAKxB,IAAI,UAAYoD,EAAE,GAAK,UAAYlC,SACxC,IAAI2C,aAAe7C,WAAWoB,wBAC9BZ,KAAKxB,IAAI2C,KAAO3B,WAAW8C,WAAaX,EAAIU,aAAalB,KACzDnB,KAAKxB,IAAIwC,IAAMxB,WAAW+C,UAAYb,EAAIW,aAAarB,IACvDhB,KAAKxB,IAAI0D,MAAQA,MAAQxC,SACzBM,KAAKxB,IAAI2D,OAASA,OAAStC,QAC/B,CACA,IAAI2C,GAAKxC,KAAK1B,eACd,EAAAF,QAAMV,SAAC8B,YACFiD,YAAYD,GAAGP,EAAE,KACjBQ,YAAYD,GAAGZ,EAAE,KACjBc,SAASF,GAAGP,EAAE,KACdS,SAASF,GAAGZ,EAAE,KACde,KAAK,QAASP,OACd5D,IAAIwB,KAAKxB,IA3Fd,GA8FAR,mBAAqB,SAAS4E,OAAQC,UACtC,OAAOA,SAAS9D,MAAK,WACjB,IAAIpB,YAAcS,QAAMV,QAACsC,KAAK9B,KAAM,eACpC,GAAIP,uBAAuBmF,MACvB,IAAK,IAAIxC,EAAI,EAAGyC,IAAMpF,YAAY6C,OAAQF,EAAIyC,IAAKzC,IAC/CsC,OAAOjF,YAAY2C,GAG/B,KACF0C,SAGa,CACXrF,YAAAA,aACH,OAAAH,SAAAE,QAAAsF,SAAAxF,SAAAE,OAAA"}