{"version":3,"file":"questionspanel.min.js","sources":["../src/questionspanel.js"],"sourcesContent":["\"use strict\";\n/* eslint-disable no-unused-vars */ // TODO remove.\n\nimport jQuery from 'jquery';\nimport {get_strings as getStrings} from 'core/str';\nimport Ajax from 'core/ajax';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\n\nlet ACTION = {\n    SELECTCATEGORY: '#id_movetocategory',\n};\n\nlet SERVICES = {\n    SELECTCATEGORY: 'mod_jqshow_selectquestionscategory',\n};\n\nlet REGION = {\n    PANEL: '[data-region=\"questions-panel\"]',\n    NUMBERSELECT: '#number_select',\n    SELECTQUESTION: '.select_question',\n    CONTENTQUESTIONS: '[data-region=\"content-question\"]',\n    LOADING: '[data-region=\"overlay-icon-container\"]'\n};\n\nlet TEMPLATES = {\n    LOADING: 'core/overlay_loading',\n    SUCCESS: 'core/notification_success',\n    ERROR: 'core/notification_error'\n};\n\nlet cmId;\nlet sId;\n\n/**\n * @constructor\n * @param {String} selector The selector for the page region containing the page.\n */\nfunction QuestionsPanel(selector) {\n    this.node = jQuery(selector);\n    sId = this.node.attr('data-sid');\n    cmId = this.node.attr('data-cmid');\n    this.initPanel();\n}\n\n/** @type {jQuery} The jQuery node for the page region. */\nQuestionsPanel.prototype.node = null;\n\nQuestionsPanel.prototype.initPanel = function() {\n    this.node.find(ACTION.SELECTCATEGORY).on('change', this.selectCategory.bind(this));\n};\n\nQuestionsPanel.prototype.selectCategory = function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    let categoryKey = jQuery(e.currentTarget).val();\n    let identifier = jQuery(REGION.CONTENTQUESTIONS);\n    // eslint-disable-next-line no-console\n    console.log(jQuery(REGION.SELECTQUESTION + ':checked').length);\n    if (jQuery(REGION.SELECTQUESTION + ':checked').length > 0) {\n        const stringkeys = [\n            {key: 'changecategory', component: 'mod_jqshow'},\n            {key: 'changecategory_desc', component: 'mod_jqshow'},\n            {key: 'confirm', component: 'mod_jqshow'},\n            {key: 'copysessionerror', component: 'mod_jqshow'},\n        ];\n        getStrings(stringkeys).then((langStrings) => {\n            const title = langStrings[0];\n            const message = langStrings[1];\n            const buttonText = langStrings[2];\n            return ModalFactory.create({\n                title: title,\n                body: message,\n                type: ModalFactory.types.SAVE_CANCEL\n            }).then(modal => {\n                modal.setSaveButtonText(buttonText);\n                modal.getRoot().on(ModalEvents.save, () => {\n                    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                        let identifier = jQuery(REGION.PANEL);\n                        identifier.append(html);\n                    });\n                    let request = {\n                        methodname: SERVICES.SELECTCATEGORY,\n                        args: {\n                            categorykey: categoryKey,\n                            cmid: cmId\n                        }\n                    };\n                    Ajax.call([request])[0].done(function(response) {\n                        let templateQuestions = TEMPLATES.QUESTIONSFORSELECT;\n                        Templates.render(templateQuestions, response).then(function(html, js) {\n                            identifier.html(html);\n                            Templates.runTemplateJS(js);\n                            jQuery(REGION.LOADING).remove();\n                        }).fail(Notification.exception);\n                    });\n                });\n                modal.getRoot().on(ModalEvents.hidden, () => {\n                    modal.destroy();\n                });\n                return modal;\n            });\n        }).done(function(modal) {\n            modal.show();\n            // eslint-disable-next-line no-restricted-globals\n        }).fail(Notification.exception);\n    } else {\n        Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n            let identifier = jQuery(REGION.PANEL);\n            identifier.append(html);\n        });\n        let request = {\n            methodname: SERVICES.SELECTCATEGORY,\n            args: {\n                categorykey: categoryKey,\n                cmid: cmId\n            }\n        };\n        Ajax.call([request])[0].done(function(response) {\n            let templateQuestions = TEMPLATES.QUESTIONSFORSELECT;\n            Templates.render(templateQuestions, response).then(function(html, js) {\n                identifier.html(html);\n                Templates.runTemplateJS(js);\n                jQuery(REGION.LOADING).remove();\n            }).fail(Notification.exception);\n        });\n    }\n};\n\nexport const initQuestionsPanel = (selector) => {\n    return new QuestionsPanel(selector);\n};\n"],"names":["_interopRequireDefault","obj","__esModule","default","Object","defineProperty","_exports","value","initQuestionsPanel","_jquery","_ajax","_modal_factory","_modal_events","_templates","_notification","cmId","ACTION","SERVICES","REGION","TEMPLATES","LOADING","SUCCESS","ERROR","QuestionsPanel","selector","this","node","jQuery","attr","initPanel","prototype","find","on","selectCategory","bind","e","preventDefault","stopPropagation","categoryKey","currentTarget","val","identifier","console","log","length","getStrings","key","component","then","langStrings","title","message","buttonText","ModalFactory","create","body","type","types","SAVE_CANCEL","modal","setSaveButtonText","getRoot","ModalEvents","save","Templates","render","visible","done","html","append","request","methodname","args","categorykey","cmid","Ajax","call","response","templateQuestions","QUESTIONSFORSELECT","js","runTemplateJS","remove","fail","Notification","exception","hidden","destroy","show"],"mappings":"0PAS6C,SAAAA,uBAAAC,KAAAA,OAAAA,KAAAA,IAAAC,WAAAD,IAAAE,CAAAA,QAAAF,IAAA,CAThCG,OAAAC,eAAAC,SAAA,aAAA,CAAAC,OAAA,IAAAD,SAAAE,wBAAA,EAGbC,QAAAT,uBAAAS,SAEAC,MAAAV,uBAAAU,OACAC,eAAAX,uBAAAW,gBACAC,cAAAZ,uBAAAY,eACAC,WAAAb,uBAAAa,YACAC,cAAAd,uBAAAc,eAEA,IAsBIC,KAtBAC,sBACgB,qBAGhBC,wBACgB,qCAGhBC,aACO,kCADPA,sBAGgB,mBAHhBA,wBAIkB,mCAJlBA,eAKS,yCAGTC,UAAY,CACZC,QAAS,uBACTC,QAAS,4BACTC,MAAO,2BAUX,SAASC,eAAeC,UACpBC,KAAKC,MAAO,EAAAC,QAAMxB,SAACqB,UACbC,KAAKC,KAAKE,KAAK,YACrBb,KAAOU,KAAKC,KAAKE,KAAK,aACtBH,KAAKI,WACT,CAGAN,eAAeO,UAAUJ,KAAO,KAEhCH,eAAeO,UAAUD,UAAY,WACjCJ,KAAKC,KAAKK,KAAKf,uBAAuBgB,GAAG,SAAUP,KAAKQ,eAAeC,KAAKT,QAGhFF,eAAeO,UAAUG,eAAiB,SAASE,GAC/CA,EAAEC,iBACFD,EAAEE,kBACF,IAAIC,aAAc,EAAAX,QAAMxB,SAACgC,EAAEI,eAAeC,MACtCC,YAAa,EAAAd,QAAAA,SAAOT,yBAGxB,GADAwB,QAAQC,KAAI,EAAAhB,iBAAOT,sBAAwB,YAAY0B,SACnD,EAAAjB,QAAAA,SAAOT,sBAAwB,YAAY0B,OAAS,EAAG,EAOvD,EAAAC,KAAAA,aANmB,CACf,CAACC,IAAK,iBAAkBC,UAAW,cACnC,CAACD,IAAK,sBAAuBC,UAAW,cACxC,CAACD,IAAK,UAAWC,UAAW,cAC5B,CAACD,IAAK,mBAAoBC,UAAW,gBAElBC,MAAK,SAACC,aACzB,IAAMC,MAAQD,YAAY,GACpBE,QAAUF,YAAY,GACtBG,WAAaH,YAAY,GAC/B,OAAOI,eAAAA,QAAaC,OAAO,CACvBJ,MAAOA,MACPK,KAAMJ,QACNK,KAAMH,eAAAA,QAAaI,MAAMC,cAC1BV,MAAK,SAAAW,OA0BJ,OAzBAA,MAAMC,kBAAkBR,YACxBO,MAAME,UAAU7B,GAAG8B,cAAW3D,QAAC4D,MAAM,WACjCC,WAAAA,QAAUC,OAAO9C,UAAUC,QAAS,CAAC8C,SAAS,IAAOC,MAAK,SAASC,OAC9C,EAAAzC,QAAAA,SAAOT,cACbmD,OAAOD,KACtB,IACA,IAAIE,QAAU,CACVC,WAAYtD,wBACZuD,KAAM,CACFC,YAAanC,YACboC,KAAM3D,OAGd4D,MAAAA,QAAKC,KAAK,CAACN,UAAU,GAAGH,MAAK,SAASU,UAClC,IAAIC,kBAAoB3D,UAAU4D,mBAClCf,WAAAA,QAAUC,OAAOa,kBAAmBD,UAAU7B,MAAK,SAASoB,KAAMY,IAC9DvC,WAAW2B,KAAKA,MAChBJ,WAAAA,QAAUiB,cAAcD,KACxB,EAAArD,QAAAA,SAAOT,gBAAgBgE,QAC1B,IAAEC,KAAKC,cAAYjF,QAACkF,UACzB,GACJ,IACA1B,MAAME,UAAU7B,GAAG8B,cAAW3D,QAACmF,QAAQ,WACnC3B,MAAM4B,SACV,IACO5B,KACX,GACJ,IAAGQ,MAAK,SAASR,OACbA,MAAM6B,MAET,IAAEL,KAAKC,cAAYjF,QAACkF,UACzB,KAAO,CACHrB,WAAAA,QAAUC,OAAO9C,UAAUC,QAAS,CAAC8C,SAAS,IAAOC,MAAK,SAASC,OAC9C,EAAAzC,QAAAA,SAAOT,cACbmD,OAAOD,KACtB,IACA,IAAIE,QAAU,CACVC,WAAYtD,wBACZuD,KAAM,CACFC,YAAanC,YACboC,KAAM3D,OAGd4D,MAAAA,QAAKC,KAAK,CAACN,UAAU,GAAGH,MAAK,SAASU,UAClC,IAAIC,kBAAoB3D,UAAU4D,mBAClCf,WAAAA,QAAUC,OAAOa,kBAAmBD,UAAU7B,MAAK,SAASoB,KAAMY,IAC9DvC,WAAW2B,KAAKA,MAChBJ,WAAAA,QAAUiB,cAAcD,KACxB,EAAArD,QAAAA,SAAOT,gBAAgBgE,QAC1B,IAAEC,KAAKC,cAAYjF,QAACkF,UACzB,GACJ,GAKF/E,SAAAE,mBAFgC,SAACgB,UAC/B,OAAO,IAAID,eAAeC,UAC5B"}