{"version":3,"file":"questionspanel.min.js","sources":["../src/questionspanel.js"],"sourcesContent":["\"use strict\";\r\n/* eslint-disable no-unused-vars */ // TODO remove.\r\n\r\nimport jQuery from 'jquery';\r\nimport {get_strings as getStrings} from 'core/str';\r\nimport Ajax from 'core/ajax';\r\nimport ModalFactory from 'core/modal_factory';\r\nimport ModalEvents from 'core/modal_events';\r\nimport Templates from 'core/templates';\r\nimport Notification from 'core/notification';\r\n\r\nlet ACTION = {\r\n    COPYQUESTION: '[data-action=\"copy_question\"]',\r\n    DELETEQUESTION: '[data-action=\"delete_question\"]',\r\n    SELECTCATEGORY: '#id_movetocategory',\r\n    ADDQUESTIONS: '[data-action=\"add_questions\"]',\r\n    ADDQUESTION: '[data-action=\"add_question\"]',\r\n    SELECTTALL: '#selectall',\r\n};\r\n\r\nlet SERVICES = {\r\n    COPYQUESTION: 'mod_jqshow_copyquestion',\r\n    DELETEQUESTION: 'mod_jqshow_deletequestion',\r\n    SELECTCATEGORY: 'mod_jqshow_selectquestionscategory',\r\n};\r\n\r\nlet REGION = {\r\n    PANEL: '[data-region=\"questions-panel\"]',\r\n    NUMBERSELECT: '#number_select',\r\n    SELECTQUESTION: '.select_question',\r\n    CONTENTQUESTIONS: '[data-region=\"content-question\"]',\r\n    LOADING: '[data-region=\"overlay-icon-container\"]'\r\n};\r\n\r\nlet TEMPLATES = {\r\n    LOADING: 'core/overlay_loading',\r\n    SUCCESS: 'core/notification_success',\r\n    ERROR: 'core/notification_error',\r\n    QUESTIONSFORSELECT: 'mod_jqshow/createsession/contentquestions'\r\n};\r\n\r\nlet cmId;\r\nlet sId;\r\n\r\n/**\r\n * @constructor\r\n * @param {String} selector The selector for the page region containing the page.\r\n */\r\nfunction QuestionsPanel(selector) {\r\n    this.node = jQuery(selector);\r\n    sId = this.node.attr('data-sid');\r\n    cmId = this.node.attr('data-cmid');\r\n    this.initPanel();\r\n}\r\n\r\n/** @type {jQuery} The jQuery node for the page region. */\r\nQuestionsPanel.prototype.node = null;\r\n\r\nQuestionsPanel.prototype.initPanel = function() {\r\n    this.node.find(ACTION.COPYQUESTION).on('click', this.copyQuestion);\r\n    this.node.find(ACTION.DELETEQUESTION).on('click', this.deleteQuestion);\r\n    this.node.find(ACTION.SELECTCATEGORY).on('change', this.selectCategory.bind(this));\r\n};\r\n\r\nQuestionsPanel.prototype.selectCategory = function(e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    let categoryKey = jQuery(e.currentTarget).val();\r\n    let identifier = jQuery(REGION.CONTENTQUESTIONS);\r\n    // eslint-disable-next-line no-console\r\n    console.log(jQuery(REGION.SELECTQUESTION + ':checked').length);\r\n    if (jQuery(REGION.SELECTQUESTION + ':checked').length > 0) {\r\n        const stringkeys = [\r\n            {key: 'changecategory', component: 'mod_jqshow'},\r\n            {key: 'changecategory_desc', component: 'mod_jqshow'},\r\n            {key: 'confirm', component: 'mod_jqshow'},\r\n            {key: 'copysessionerror', component: 'mod_jqshow'},\r\n        ];\r\n        getStrings(stringkeys).then((langStrings) => {\r\n            const title = langStrings[0];\r\n            const message = langStrings[1];\r\n            const buttonText = langStrings[2];\r\n            return ModalFactory.create({\r\n                title: title,\r\n                body: message,\r\n                type: ModalFactory.types.SAVE_CANCEL\r\n            }).then(modal => {\r\n                modal.setSaveButtonText(buttonText);\r\n                modal.getRoot().on(ModalEvents.save, () => {\r\n                    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\r\n                        let identifier = jQuery(REGION.PANEL);\r\n                        identifier.append(html);\r\n                    });\r\n                    let request = {\r\n                        methodname: SERVICES.SELECTCATEGORY,\r\n                        args: {\r\n                            categorykey: categoryKey,\r\n                            cmid: cmId\r\n                        }\r\n                    };\r\n                    Ajax.call([request])[0].done(function(response) {\r\n                        let templateQuestions = TEMPLATES.QUESTIONSFORSELECT;\r\n                        Templates.render(templateQuestions, response).then(function(html, js) {\r\n                            identifier.html(html);\r\n                            Templates.runTemplateJS(js);\r\n                            jQuery(REGION.LOADING).remove();\r\n                        }).fail(Notification.exception);\r\n                    });\r\n                });\r\n                modal.getRoot().on(ModalEvents.hidden, () => {\r\n                    modal.destroy();\r\n                });\r\n                return modal;\r\n            });\r\n        }).done(function(modal) {\r\n            modal.show();\r\n            // eslint-disable-next-line no-restricted-globals\r\n        }).fail(Notification.exception);\r\n    } else {\r\n        Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\r\n            let identifier = jQuery(REGION.PANEL);\r\n            identifier.append(html);\r\n        });\r\n        let request = {\r\n            methodname: SERVICES.SELECTCATEGORY,\r\n            args: {\r\n                categorykey: categoryKey,\r\n                cmid: cmId\r\n            }\r\n        };\r\n        Ajax.call([request])[0].done(function(response) {\r\n            let templateQuestions = TEMPLATES.QUESTIONSFORSELECT;\r\n            Templates.render(templateQuestions, response).then(function(html, js) {\r\n                identifier.html(html);\r\n                Templates.runTemplateJS(js);\r\n                jQuery(REGION.LOADING).remove();\r\n            }).fail(Notification.exception);\r\n        });\r\n    }\r\n};\r\n\r\nQuestionsPanel.prototype.copyQuestion = function(e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    let questionId = jQuery(e.currentTarget).attr('data-questionnid');\r\n    alert('copyQuestion ' + questionId);\r\n};\r\n\r\nQuestionsPanel.prototype.deleteQuestion = function(e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    let questiontoremove = jQuery(e.currentTarget).parent().parent().parent();\r\n    let questionId = jQuery(e.currentTarget).attr('data-questionnid');\r\n    const stringkeys = [\r\n        {key: 'deletequestion', component: 'mod_jqshow'},\r\n        {key: 'deletequestion_desc', component: 'mod_jqshow'},\r\n        {key: 'confirm', component: 'mod_jqshow'}\r\n    ];\r\n    getStrings(stringkeys).then((langStrings) => {\r\n        const title = langStrings[0];\r\n        const message = langStrings[1];\r\n        const buttonText = langStrings[2];\r\n        return ModalFactory.create({\r\n            title: title,\r\n            body: message,\r\n            type: ModalFactory.types.SAVE_CANCEL\r\n        }).then(modal => {\r\n            modal.setSaveButtonText(buttonText);\r\n            modal.getRoot().on(ModalEvents.save, () => {\r\n                Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\r\n                    let identifier = jQuery(REGION.PANEL);\r\n                    identifier.append(html);\r\n                });\r\n                let request = {\r\n                    methodname: SERVICES.DELETEQUESTION,\r\n                    args: {\r\n                        qid: questionId,\r\n                        sid: sId\r\n                    }\r\n                };\r\n                Ajax.call([request])[0].done(function(response) {\r\n                    console.log(\"done!\");\r\n                    if (response.deleted) {\r\n                        // Eliminar esa pregunta de la sesion.\r\n                        questiontoremove.remove();\r\n                        jQuery(REGION.LOADING).remove();\r\n                    } else {\r\n                        jQuery(REGION.LOADING).remove();\r\n                        alert('no se ha podido borrar la pregunta. intentalo de nuevo mas tarde.');\r\n                    }\r\n                });\r\n            });\r\n            modal.getRoot().on(ModalEvents.hidden, () => {\r\n                modal.destroy();\r\n            });\r\n            return modal;\r\n        });\r\n    }).done(function(modal) {\r\n        modal.show();\r\n        // eslint-disable-next-line no-restricted-globals\r\n    }).fail(Notification.exception);\r\n};\r\n\r\nexport const initQuestionsPanel = (selector) => {\r\n    return new QuestionsPanel(selector);\r\n};\r\n"],"names":["cmId","sId","ACTION","SERVICES","REGION","TEMPLATES","QuestionsPanel","selector","node","this","attr","initPanel","prototype","find","on","copyQuestion","deleteQuestion","selectCategory","bind","e","preventDefault","stopPropagation","categoryKey","currentTarget","val","identifier","console","log","length","stringkeys","key","component","then","langStrings","title","message","buttonText","ModalFactory","create","body","type","types","SAVE_CANCEL","modal","setSaveButtonText","getRoot","ModalEvents","save","render","visible","done","html","append","request","methodname","args","categorykey","cmid","call","response","templateQuestions","js","runTemplateJS","remove","fail","Notification","exception","hidden","destroy","show","questionId","alert","questiontoremove","parent","qid","sid","deleted"],"mappings":"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"}