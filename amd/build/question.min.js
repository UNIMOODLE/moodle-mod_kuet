define("mod_jqshow/question",["exports","jquery","core/ajax","core/templates","core/notification","core/event"],(function(_exports,_jquery,_ajax,_templates,_notification,_event){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.initQuestion=void 0,_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax),_templates=_interopRequireDefault(_templates),_notification=_interopRequireDefault(_notification),_event=_interopRequireDefault(_event);let cmId,sId,jqId,ACTION_EXPAND='[data-action="question-fullscreen"]',ACTION_COMPRESS='[data-action="question-exit-fullscreen"]',ACTION_NEXTQUESTION='[data-action="next-question"]',REGION={PAGE_HEADER:"#page-header",BODY:"body.path-mod-jqshow",NAV:"nav.navbar",SESSIONCONTENT:'[data-region="session-content"]',QUESTIONCONTENT:'[data-region="question-content"]',RANKINGCONTENT:'[data-region="ranking-content"]'},SERVICES_NEXTQUESTION="mod_jqshow_nextquestion",SERVICES_GETSESSIONCONFIG="mod_jqshow_getsession",SERVICES_GETPROVISIONALRANKING="mod_jqshow_getprovisionalranking",SERVICES_GETFINALRANKING="mod_jqshow_getfinalranking",TEMPLATES_LOADING="core/overlay_loading",TEMPLATES_QUESTION="mod_jqshow/questions/encasement",TEMPLATES_PROVISIONALRANKING="mod_jqshow/ranking/provisional",isRanking=!1;function Question(selector){this.node=(0,_jquery.default)(selector),"ranking-content"===this.node.attr("data-region")&&(isRanking=!0),this.initQuestion()}Question.prototype.node=null,Question.prototype.initQuestion=function(){sId=this.node.attr("data-sid"),cmId=this.node.attr("data-cmid"),jqId=this.node.attr("data-jqid"),this.node.find(ACTION_EXPAND).on("click",this.fullScreen),this.node.find(ACTION_COMPRESS).on("click",this.exitFullScreen),(0,_jquery.default)(ACTION_NEXTQUESTION).on("click",this.nextQuestion);let that=this;(0,_jquery.default)(document).keyup((function(e){"Escape"===e.key&&that.exitFullScreen()})),addEventListener("questionEnd",(()=>{(0,_jquery.default)(ACTION_NEXTQUESTION).removeClass("d-none")}),!1)},Question.prototype.fullScreen=function(e){e.preventDefault(),e.stopPropagation(),(0,_jquery.default)(ACTION_EXPAND).css("display","none"),(0,_jquery.default)(ACTION_COMPRESS).css("display","block"),(0,_jquery.default)(REGION.BODY).addClass("fullscreen"),(0,_jquery.default)(window).scrollTop(0),(0,_jquery.default)("html, body").animate({scrollTop:0},500);let element=document.getElementById("page-mod-jqshow-view");null==element&&(element=document.getElementById("page-mod-jqshow-preview")),element.requestFullscreen?element.requestFullscreen():element.webkitRequestFullscreen?element.webkitRequestFullscreen():element.msRequestFullscreen&&element.msRequestFullscreen()},Question.prototype.exitFullScreen=function(){(0,_jquery.default)(ACTION_EXPAND).css("display","block"),(0,_jquery.default)(ACTION_COMPRESS).css("display","none"),(0,_jquery.default)(REGION.BODY).removeClass("fullscreen"),document.fullscreen&&document.exitFullscreen()},Question.prototype.nextQuestion=function(e){e.preventDefault(),e.stopPropagation();let identifier=(0,_jquery.default)(REGION.SESSIONCONTENT);_templates.default.render(TEMPLATES_LOADING,{visible:!0}).done((function(html){identifier.append(html),console.log("isRanking",isRanking);let requestConfig={methodname:SERVICES_GETSESSIONCONFIG,args:{sid:sId,cmid:cmId}};_ajax.default.call([requestConfig])[0].done((function(sessionConfig){if(1===sessionConfig.session.showgraderanking&&!1===isRanking){let requestProvisional={methodname:SERVICES_GETPROVISIONALRANKING,args:{sid:sId,cmid:cmId,jqid:jqId}};_ajax.default.call([requestProvisional])[0].done((function(provisionalRanking){provisionalRanking.programmedmode=!0,_templates.default.render(TEMPLATES_PROVISIONALRANKING,provisionalRanking).then((function(html,js){identifier.html(html),_templates.default.runTemplateJS(js),(0,_jquery.default)(REGION.LOADING).remove()})).fail(_notification.default.exception)})).fail(_notification.default.exception)}else{let requestNext={methodname:SERVICES_NEXTQUESTION,args:{cmid:cmId,sessionid:sId,jqid:jqId,manual:!1}};_ajax.default.call([requestNext])[0].done((function(nextQuestion){isRanking=!1;let templateQuestions=TEMPLATES_QUESTION;if(!0===nextQuestion.endsession&&1===sessionConfig.session.showfinalgrade){let requestFinal={methodname:SERVICES_GETFINALRANKING,args:{sid:sId,cmid:cmId}};_ajax.default.call([requestFinal])[0].done((function(finalRanking){finalRanking.programmedmode=!0,_templates.default.render(TEMPLATES_QUESTION,finalRanking).then((function(html,js){identifier.html(html),_templates.default.runTemplateJS(js),(0,_jquery.default)(REGION.LOADING).remove()})).fail(_notification.default.exception)})).fail(_notification.default.exception)}else _templates.default.render(templateQuestions,nextQuestion).then((function(html,js){identifier.html(html),_templates.default.runTemplateJS(js),_event.default.notifyFilterContentUpdated(document.querySelector(REGION.SESSIONCONTENT)),(0,_jquery.default)(REGION.LOADING).remove()})).fail(_notification.default.exception)})).fail(_notification.default.exception)}})).fail(_notification.default.exception)}))};_exports.initQuestion=selector=>new Question(selector)}));

//# sourceMappingURL=question.min.js.map