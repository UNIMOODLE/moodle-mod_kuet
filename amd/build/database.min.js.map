{"version":3,"file":"database.min.js","sources":["../src/database.js"],"sourcesContent":["\"use strict\";\n\nlet indexedDb = null;\nlet dbName;\nlet dbVersion = 1;\n\n/**\n * @constructor\n * @param {int} sid\n * @param {int} userid\n */\nfunction Db(sid, userid) {\n    dbName = `${sid}_${userid}`;\n    this.openDb();\n}\n\nDb.prototype.openDb = function() {\n    let req = indexedDB.open(dbName, dbVersion);\n    req.onsuccess = function(evt) {\n        indexedDb = evt.target.result;\n        // eslint-disable-next-line no-console\n        console.log(\"db open\");\n    };\n    req.onerror = function(event) {\n        // eslint-disable-next-line no-console\n        console.error(`Database error: ${event.target.errorCode}`);\n    };\n    req.onupgradeneeded = function(evt) {\n        // eslint-disable-next-line no-console\n        console.log(\"openDb.onupgradeneeded\");\n        // We create the database with the necessary objects and indexes.\n        let questions = evt.currentTarget.result.createObjectStore(\n            'questions', {keyPath: 'jqid'});\n        questions.createIndex('jqid', 'jqid', {unique: true});\n\n        let statequestions = evt.currentTarget.result.createObjectStore('statequestions', {keyPath: 'state'});\n        statequestions.createIndex('state', 'state', {unique: true});\n    };\n};\n\nDb.prototype.add = function(storeName, value) {\n    let store = this.getObjectStore(storeName, 'readwrite');\n    store.add(value);\n};\n\nDb.prototype.update = function(storeName, value) {\n    let store = this.getObjectStore(storeName, 'readwrite');\n    store.put(value);\n};\n\nDb.prototype.get = function(storeName, id) {\n    let store = this.getObjectStore(storeName, 'readonly');\n    return store.get(id);\n};\n\nDb.prototype.delete = function(storeName, id) {\n    let store = this.getObjectStore(storeName, 'readwrite');\n    store.delete(id);\n};\n\nDb.prototype.getObjectStore = function(storeName, mode) {\n    let tx = indexedDb.transaction(storeName, mode);\n    return tx.objectStore(storeName);\n};\n\nDb.prototype.clearObjectStore = function(storeName) {\n    let store = this.getObjectStore(storeName, 'readwrite');\n    let req = store.clear();\n    req.onsuccess = function() {\n        // eslint-disable-next-line no-console\n        console.log(\"clearObjectStore\");\n    };\n    req.onerror = function(evt) {\n        // eslint-disable-next-line no-console\n        console.error(\"clearObjectStore:\", evt.target.errorCode);\n    };\n};\n\nDb.prototype.deleteDatabase = function() {\n    indexedDb.close();\n    return window.indexedDB.deleteDatabase(dbName);\n};\n\nexport const initDb = (sid, userid) => {\n    return new Db(sid, userid);\n};\n\nexport default {\n    initDb\n};\n"],"names":["Object","defineProperty","_exports","value","initDb","default","dbName","indexedDb","Db","sid","userid","concat","this","openDb","prototype","req","indexedDB","open","onsuccess","evt","target","result","console","log","onerror","event","error","errorCode","onupgradeneeded","currentTarget","createObjectStore","keyPath","createIndex","unique","add","storeName","getObjectStore","update","put","get","id","delete","mode","transaction","objectStore","clearObjectStore","clear","deleteDatabase","close","window","_default"],"mappings":"6DAAaA,OAAAC,eAAAC,SAAA,aAAA,CAAAC,OAAA,IAAAD,SAAAE,OAAAF,SAAAG,aAAA,EAEb,IACIC,OADAC,UAAY,KAShB,SAASC,GAAGC,IAAKC,QACbJ,OAAM,GAAAK,OAAMF,SAAGE,OAAID,QACnBE,KAAKC,QACT,CAEAL,GAAGM,UAAUD,OAAS,WAClB,IAAIE,IAAMC,UAAUC,KAAKX,OAbb,GAcZS,IAAIG,UAAY,SAASC,KACrBZ,UAAYY,IAAIC,OAAOC,OAEvBC,QAAQC,IAAI,YAEhBR,IAAIS,QAAU,SAASC,OAEnBH,QAAQI,MAAK,mBAAAf,OAAoBc,MAAML,OAAOO,aAElDZ,IAAIa,gBAAkB,SAAST,KAE3BG,QAAQC,IAAI,0BAEIJ,IAAIU,cAAcR,OAAOS,kBACrC,YAAa,CAACC,QAAS,SACjBC,YAAY,OAAQ,OAAQ,CAACC,QAAQ,IAE1Bd,IAAIU,cAAcR,OAAOS,kBAAkB,iBAAkB,CAACC,QAAS,UAC7EC,YAAY,QAAS,QAAS,CAACC,QAAQ,MAI9DzB,GAAGM,UAAUoB,IAAM,SAASC,UAAWhC,OACvBS,KAAKwB,eAAeD,UAAW,aACrCD,IAAI/B,QAGdK,GAAGM,UAAUuB,OAAS,SAASF,UAAWhC,OAC1BS,KAAKwB,eAAeD,UAAW,aACrCG,IAAInC,QAGdK,GAAGM,UAAUyB,IAAM,SAASJ,UAAWK,IAEnC,OADY5B,KAAKwB,eAAeD,UAAW,YAC9BI,IAAIC,KAGrBhC,GAAGM,UAAU2B,OAAS,SAASN,UAAWK,IAC1B5B,KAAKwB,eAAeD,UAAW,aACrCM,OAAOD,KAGjBhC,GAAGM,UAAUsB,eAAiB,SAASD,UAAWO,MAE9C,OADSnC,UAAUoC,YAAYR,UAAWO,MAChCE,YAAYT,YAG1B3B,GAAGM,UAAU+B,iBAAmB,SAASV,WACrC,IACIpB,IADQH,KAAKwB,eAAeD,UAAW,aAC3BW,QAChB/B,IAAIG,UAAY,WAEZI,QAAQC,IAAI,qBAEhBR,IAAIS,QAAU,SAASL,KAEnBG,QAAQI,MAAM,oBAAqBP,IAAIC,OAAOO,aAItDnB,GAAGM,UAAUiC,eAAiB,WAE1B,OADAxC,UAAUyC,QACHC,OAAOjC,UAAU+B,eAAezC,SAGpC,IAAMF,OAAS,SAACK,IAAKC,QACxB,OAAO,IAAIF,GAAGC,IAAKC,SACrBR,SAAAE,OAAAA,OAAA,IAAA8C,SAEa,CACX9C,OAAAA,QACH,OAAAF,SAAAG,QAAA6C,SAAAhD,SAAAG,OAAA"}