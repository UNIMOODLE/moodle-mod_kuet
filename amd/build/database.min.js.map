{"version":3,"file":"database.min.js","sources":["../src/database.js"],"sourcesContent":["\"use strict\";\n\nlet indexedDb = null;\nlet dbName;\nlet dbVersion = 1;\n\n/**\n * @constructor\n * @param {int} sid\n * @param {int} userid\n */\nfunction Db(sid, userid) {\n    dbName = `${sid}_${userid}`;\n    this.openDb();\n}\n\nDb.prototype.openDb = function() {\n    let req = indexedDB.open(dbName, dbVersion);\n    req.onsuccess = function(evt) {\n        indexedDb = evt.target.result;\n        // eslint-disable-next-line no-console\n        console.log(\"db open\");\n    };\n    req.onerror = function(event) {\n        // eslint-disable-next-line no-console\n        console.error(`Database error: ${event.target.errorCode}`);\n    };\n    req.onupgradeneeded = function(evt) {\n        // eslint-disable-next-line no-console\n        console.log(\"openDb.onupgradeneeded\");\n        // We create the database with the necessary objects and indexes.\n        let questions = evt.currentTarget.result.createObjectStore(\n            'questions', {keyPath: 'jqid'});\n        questions.createIndex('jqid', 'jqid', {unique: true});\n\n        let statequestions = evt.currentTarget.result.createObjectStore('statequestions', {keyPath: 'state'});\n        statequestions.createIndex('state', 'state', {unique: true});\n    };\n};\n\nDb.prototype.add = function(storeName, value) {\n    let store = this.getObjectStore(storeName, 'readwrite');\n    store.add(value);\n};\n\nDb.prototype.update = function(storeName, value) {\n    let store = this.getObjectStore(storeName, 'readwrite');\n    store.put(value);\n};\n\nDb.prototype.get = function(storeName, id) {\n    let store = this.getObjectStore(storeName, 'readonly');\n    return store.get(id);\n};\n\nDb.prototype.delete = function(storeName, id) {\n    let store = this.getObjectStore(storeName, 'readwrite');\n    store.delete(id);\n};\n\nDb.prototype.getObjectStore = function(storeName, mode) {\n    let tx = indexedDb.transaction(storeName, mode);\n    return tx.objectStore(storeName);\n};\n\nDb.prototype.clearObjectStore = function(storeName) {\n    let store = this.getObjectStore(storeName, 'readwrite');\n    let req = store.clear();\n    req.onsuccess = function() {\n        // eslint-disable-next-line no-console\n        console.log(\"clearObjectStore\");\n    };\n    req.onerror = function(evt) {\n        // eslint-disable-next-line no-console\n        console.error(\"clearObjectStore:\", evt.target.errorCode);\n    };\n};\n\nDb.prototype.deleteDatabase = function() {\n    indexedDb.close();\n    return window.indexedDB.deleteDatabase(dbName);\n};\n\nexport const initDb = (sid, userid) => {\n    return new Db(sid, userid);\n};\n\nexport default {\n    initDb\n};\n"],"names":["dbName","indexedDb","Db","sid","userid","openDb","prototype","req","indexedDB","open","onsuccess","evt","target","result","console","log","onerror","event","error","errorCode","onupgradeneeded","currentTarget","createObjectStore","keyPath","createIndex","unique","add","storeName","value","this","getObjectStore","update","put","get","id","delete","mode","transaction","objectStore","clearObjectStore","clear","deleteDatabase","close","window","initDb"],"mappings":"iKAGIA,OADAC,UAAY,cASPC,GAAGC,IAAKC,QACbJ,iBAAYG,gBAAOC,aACdC,SAGTH,GAAGI,UAAUD,OAAS,eACdE,IAAMC,UAAUC,KAAKT,OAbb,GAcZO,IAAIG,UAAY,SAASC,KACrBV,UAAYU,IAAIC,OAAOC,OAEvBC,QAAQC,IAAI,YAEhBR,IAAIS,QAAU,SAASC,OAEnBH,QAAQI,gCAAyBD,MAAML,OAAOO,aAElDZ,IAAIa,gBAAkB,SAAST,KAE3BG,QAAQC,IAAI,0BAEIJ,IAAIU,cAAcR,OAAOS,kBACrC,YAAa,CAACC,QAAS,SACjBC,YAAY,OAAQ,OAAQ,CAACC,QAAQ,IAE1Bd,IAAIU,cAAcR,OAAOS,kBAAkB,iBAAkB,CAACC,QAAS,UAC7EC,YAAY,QAAS,QAAS,CAACC,QAAQ,MAI9DvB,GAAGI,UAAUoB,IAAM,SAASC,UAAWC,OACvBC,KAAKC,eAAeH,UAAW,aACrCD,IAAIE,QAGd1B,GAAGI,UAAUyB,OAAS,SAASJ,UAAWC,OAC1BC,KAAKC,eAAeH,UAAW,aACrCK,IAAIJ,QAGd1B,GAAGI,UAAU2B,IAAM,SAASN,UAAWO,WACvBL,KAAKC,eAAeH,UAAW,YAC9BM,IAAIC,KAGrBhC,GAAGI,UAAU6B,OAAS,SAASR,UAAWO,IAC1BL,KAAKC,eAAeH,UAAW,aACrCQ,OAAOD,KAGjBhC,GAAGI,UAAUwB,eAAiB,SAASH,UAAWS,aACrCnC,UAAUoC,YAAYV,UAAWS,MAChCE,YAAYX,YAG1BzB,GAAGI,UAAUiC,iBAAmB,SAASZ,eAEjCpB,IADQsB,KAAKC,eAAeH,UAAW,aAC3Ba,QAChBjC,IAAIG,UAAY,WAEZI,QAAQC,IAAI,qBAEhBR,IAAIS,QAAU,SAASL,KAEnBG,QAAQI,MAAM,oBAAqBP,IAAIC,OAAOO,aAItDjB,GAAGI,UAAUmC,eAAiB,kBAC1BxC,UAAUyC,QACHC,OAAOnC,UAAUiC,eAAezC,eAG9B4C,OAAS,CAACzC,IAAKC,SACjB,IAAIF,GAAGC,IAAKC,4CAGR,CACXwC"}