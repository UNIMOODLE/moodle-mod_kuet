{"version":3,"file":"database.min.js","sources":["../src/database.js"],"sourcesContent":["\"use strict\";\r\n\r\nlet indexedDb = null;\r\nlet dbName;\r\nlet dbVersion = 1;\r\n\r\n/**\r\n * @constructor\r\n * @param {int} sid\r\n * @param {int} userid\r\n */\r\nfunction Db(sid, userid) {\r\n    dbName = `${sid}_${userid}`;\r\n    this.openDb();\r\n}\r\n\r\nDb.prototype.openDb = function() {\r\n    let req = indexedDB.open(dbName, dbVersion);\r\n    req.onsuccess = function(evt) {\r\n        indexedDb = evt.target.result;\r\n        // eslint-disable-next-line no-console\r\n        console.log(\"db open\");\r\n    };\r\n    req.onerror = function(event) {\r\n        // eslint-disable-next-line no-console\r\n        console.error(`Database error: ${event.target.errorCode}`);\r\n        alert(`Error DB ${event.target.errorCode}`);\r\n    };\r\n    req.onupgradeneeded = function(evt) {\r\n        // eslint-disable-next-line no-console\r\n        console.log(\"openDb.onupgradeneeded\");\r\n        // We create the database with the necessary objects and indexes.\r\n        let questions = evt.currentTarget.result.createObjectStore(\r\n            'questions', {keyPath: 'jqid'});\r\n        questions.createIndex('jqid', 'jqid', {unique: true});\r\n\r\n        let statequestions = evt.currentTarget.result.createObjectStore('statequestions', {keyPath: 'state'});\r\n        statequestions.createIndex('state', 'state', {unique: true});\r\n    };\r\n};\r\n\r\nDb.prototype.add = function(storeName, value) {\r\n    let store = this.getObjectStore(storeName, 'readwrite');\r\n    store.add(value);\r\n};\r\n\r\nDb.prototype.update = function(storeName, value) {\r\n    let store = this.getObjectStore(storeName, 'readwrite');\r\n    store.put(value);\r\n};\r\n\r\nDb.prototype.get = function(storeName, id) {\r\n    let store = this.getObjectStore(storeName, 'readonly');\r\n    return store.get(id);\r\n};\r\n\r\nDb.prototype.delete = function(storeName, id) {\r\n    let store = this.getObjectStore(storeName, 'readwrite');\r\n    store.delete(id);\r\n};\r\n\r\nDb.prototype.getObjectStore = function(storeName, mode) {\r\n    let tx = indexedDb.transaction(storeName, mode);\r\n    return tx.objectStore(storeName);\r\n};\r\n\r\nDb.prototype.clearObjectStore = function(storeName) {\r\n    let store = this.getObjectStore(storeName, 'readwrite');\r\n    let req = store.clear();\r\n    req.onsuccess = function() {\r\n        // eslint-disable-next-line no-console\r\n        console.log(\"clearObjectStore\");\r\n    };\r\n    req.onerror = function(evt) {\r\n        // eslint-disable-next-line no-console\r\n        console.error(\"clearObjectStore:\", evt.target.errorCode);\r\n    };\r\n};\r\n\r\nDb.prototype.deleteDatabase = function() {\r\n    indexedDb.close();\r\n    return window.indexedDB.deleteDatabase(dbName);\r\n};\r\n\r\nexport const initDb = (sid, userid) => {\r\n    return new Db(sid, userid);\r\n};\r\n\r\nexport default {\r\n    initDb\r\n};\r\n"],"names":["dbName","indexedDb","Db","sid","userid","openDb","prototype","req","indexedDB","open","onsuccess","evt","target","result","console","log","onerror","event","error","errorCode","alert","onupgradeneeded","currentTarget","createObjectStore","keyPath","createIndex","unique","add","storeName","value","this","getObjectStore","update","put","get","id","delete","mode","transaction","objectStore","clearObjectStore","clear","deleteDatabase","close","window","initDb"],"mappings":"iKAGIA,OADAC,UAAY,cASPC,GAAGC,IAAKC,QACbJ,iBAAYG,gBAAOC,aACdC,SAGTH,GAAGI,UAAUD,OAAS,eACdE,IAAMC,UAAUC,KAAKT,OAbb,GAcZO,IAAIG,UAAY,SAASC,KACrBV,UAAYU,IAAIC,OAAOC,OAEvBC,QAAQC,IAAI,YAEhBR,IAAIS,QAAU,SAASC,OAEnBH,QAAQI,gCAAyBD,MAAML,OAAOO,YAC9CC,yBAAkBH,MAAML,OAAOO,aAEnCZ,IAAIc,gBAAkB,SAASV,KAE3BG,QAAQC,IAAI,0BAEIJ,IAAIW,cAAcT,OAAOU,kBACrC,YAAa,CAACC,QAAS,SACjBC,YAAY,OAAQ,OAAQ,CAACC,QAAQ,IAE1Bf,IAAIW,cAAcT,OAAOU,kBAAkB,iBAAkB,CAACC,QAAS,UAC7EC,YAAY,QAAS,QAAS,CAACC,QAAQ,MAI9DxB,GAAGI,UAAUqB,IAAM,SAASC,UAAWC,OACvBC,KAAKC,eAAeH,UAAW,aACrCD,IAAIE,QAGd3B,GAAGI,UAAU0B,OAAS,SAASJ,UAAWC,OAC1BC,KAAKC,eAAeH,UAAW,aACrCK,IAAIJ,QAGd3B,GAAGI,UAAU4B,IAAM,SAASN,UAAWO,WACvBL,KAAKC,eAAeH,UAAW,YAC9BM,IAAIC,KAGrBjC,GAAGI,UAAU8B,OAAS,SAASR,UAAWO,IAC1BL,KAAKC,eAAeH,UAAW,aACrCQ,OAAOD,KAGjBjC,GAAGI,UAAUyB,eAAiB,SAASH,UAAWS,aACrCpC,UAAUqC,YAAYV,UAAWS,MAChCE,YAAYX,YAG1B1B,GAAGI,UAAUkC,iBAAmB,SAASZ,eAEjCrB,IADQuB,KAAKC,eAAeH,UAAW,aAC3Ba,QAChBlC,IAAIG,UAAY,WAEZI,QAAQC,IAAI,qBAEhBR,IAAIS,QAAU,SAASL,KAEnBG,QAAQI,MAAM,oBAAqBP,IAAIC,OAAOO,aAItDjB,GAAGI,UAAUoC,eAAiB,kBAC1BzC,UAAU0C,QACHC,OAAOpC,UAAUkC,eAAe1C,eAG9B6C,OAAS,CAAC1C,IAAKC,SACjB,IAAIF,GAAGC,IAAKC,4CAGR,CACXyC"}