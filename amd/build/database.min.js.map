{"version":3,"file":"database.min.js","sources":["../src/database.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n// Project implemented by the \"Recovery, Transformation and Resilience Plan.\n// Funded by the European Union - Next GenerationEU\".\n//\n// Produced by the UNIMOODLE University Group: Universities of\n// Valladolid, Complutense de Madrid, UPV/EHU, León, Salamanca,\n// Illes Balears, Valencia, Rey Juan Carlos, La Laguna, Zaragoza, Málaga,\n// Córdoba, Extremadura, Vigo, Las Palmas de Gran Canaria y Burgos..\n\n/**\n *\n * @module    mod_kuet/database\n * @copyright  2023 Proyecto UNIMOODLE {@link https://unimoodle.github.io}\n * @author     UNIMOODLE Group (Coordinator) <direccion.area.estrategia.digital@uva.es>\n * @author     3IPUNT <contacte@tresipunt.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n\"use strict\";\n\nlet indexedDb = null;\nlet dbName;\nlet dbVersion = 1;\n\n/**\n * @constructor\n * @param {int} sid\n * @param {int} userid\n */\nfunction Db(sid, userid) {\n    dbName = `${sid}_${userid}`;\n    this.openDb();\n}\n\nDb.prototype.openDb = function() {\n    let req = indexedDB.open(dbName, dbVersion);\n    req.onsuccess = function(evt) {\n        indexedDb = evt.target.result;\n    };\n    req.onerror = function(event) {\n        // eslint-disable-next-line no-console\n        console.error(`Database error: ${event.target.errorCode}`);\n    };\n    req.onupgradeneeded = function(evt) {\n        // We create the database with the necessary objects and indexes.\n        let questions = evt.currentTarget.result.createObjectStore(\n            'questions', {keyPath: 'kid'});\n        questions.createIndex('kid', 'kid', {unique: true});\n\n        let statequestions = evt.currentTarget.result.createObjectStore('statequestions', {keyPath: 'state'});\n        statequestions.createIndex('state', 'state', {unique: true});\n    };\n};\n\nDb.prototype.add = function(storeName, value) {\n    let store = this.getObjectStore(storeName, 'readwrite');\n    store.add(value);\n};\n\nDb.prototype.update = function(storeName, value) {\n    let store = this.getObjectStore(storeName, 'readwrite');\n    store.put(value);\n};\n\nDb.prototype.get = function(storeName, id) {\n    let store = this.getObjectStore(storeName, 'readonly');\n    return store.get(id);\n};\n\nDb.prototype.delete = function(storeName, id) {\n    let store = this.getObjectStore(storeName, 'readwrite');\n    store.delete(id);\n};\n\nDb.prototype.getObjectStore = function(storeName, mode) {\n    let tx = indexedDb.transaction(storeName, mode);\n    return tx.objectStore(storeName);\n};\n\nDb.prototype.clearObjectStore = function(storeName) {\n    let store = this.getObjectStore(storeName, 'readwrite');\n    let req = store.clear();\n    req.onsuccess = function() {\n        // eslint-disable-next-line no-console\n        console.log(\"clearObjectStore\");\n    };\n    req.onerror = function(evt) {\n        // eslint-disable-next-line no-console\n        console.error(\"clearObjectStore:\", evt.target.errorCode);\n    };\n};\n\nDb.prototype.deleteDatabase = function() {\n    indexedDb.close();\n    return window.indexedDB.deleteDatabase(dbName);\n};\n\nexport const initDb = (sid, userid) => {\n    return new Db(sid, userid);\n};\n\nexport default {\n    initDb\n};\n"],"names":["dbName","indexedDb","Db","sid","userid","openDb","prototype","req","indexedDB","open","onsuccess","evt","target","result","onerror","event","console","error","errorCode","onupgradeneeded","currentTarget","createObjectStore","keyPath","createIndex","unique","add","storeName","value","this","getObjectStore","update","put","get","id","delete","mode","transaction","objectStore","clearObjectStore","clear","log","deleteDatabase","close","window","initDb"],"mappings":"+JAmCIA,OADAC,UAAY,cASPC,GAAGC,IAAKC,QACbJ,iBAAYG,gBAAOC,aACdC,SAGTH,GAAGI,UAAUD,OAAS,eACdE,IAAMC,UAAUC,KAAKT,OAbb,GAcZO,IAAIG,UAAY,SAASC,KACrBV,UAAYU,IAAIC,OAAOC,QAE3BN,IAAIO,QAAU,SAASC,OAEnBC,QAAQC,gCAAyBF,MAAMH,OAAOM,aAElDX,IAAIY,gBAAkB,SAASR,KAEXA,IAAIS,cAAcP,OAAOQ,kBACrC,YAAa,CAACC,QAAS,QACjBC,YAAY,MAAO,MAAO,CAACC,QAAQ,IAExBb,IAAIS,cAAcP,OAAOQ,kBAAkB,iBAAkB,CAACC,QAAS,UAC7EC,YAAY,QAAS,QAAS,CAACC,QAAQ,MAI9DtB,GAAGI,UAAUmB,IAAM,SAASC,UAAWC,OACvBC,KAAKC,eAAeH,UAAW,aACrCD,IAAIE,QAGdzB,GAAGI,UAAUwB,OAAS,SAASJ,UAAWC,OAC1BC,KAAKC,eAAeH,UAAW,aACrCK,IAAIJ,QAGdzB,GAAGI,UAAU0B,IAAM,SAASN,UAAWO,WACvBL,KAAKC,eAAeH,UAAW,YAC9BM,IAAIC,KAGrB/B,GAAGI,UAAU4B,OAAS,SAASR,UAAWO,IAC1BL,KAAKC,eAAeH,UAAW,aACrCQ,OAAOD,KAGjB/B,GAAGI,UAAUuB,eAAiB,SAASH,UAAWS,aACrClC,UAAUmC,YAAYV,UAAWS,MAChCE,YAAYX,YAG1BxB,GAAGI,UAAUgC,iBAAmB,SAASZ,eAEjCnB,IADQqB,KAAKC,eAAeH,UAAW,aAC3Ba,QAChBhC,IAAIG,UAAY,WAEZM,QAAQwB,IAAI,qBAEhBjC,IAAIO,QAAU,SAASH,KAEnBK,QAAQC,MAAM,oBAAqBN,IAAIC,OAAOM,aAItDhB,GAAGI,UAAUmC,eAAiB,kBAC1BxC,UAAUyC,QACHC,OAAOnC,UAAUiC,eAAezC,eAG9B4C,OAAS,CAACzC,IAAKC,SACjB,IAAIF,GAAGC,IAAKC,4CAGR,CACXwC,OAAAA"}