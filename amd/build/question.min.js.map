{"version":3,"file":"question.min.js","sources":["../src/question.js"],"sourcesContent":["\"use strict\";\r\n/* eslint-disable no-unused-vars */ // TODO remove.\r\n\r\nimport jQuery from 'jquery';\r\nimport Ajax from 'core/ajax';\r\nimport Templates from 'core/templates';\r\nimport Notification from 'core/notification';\r\n\r\nlet ACTION = {\r\n    EXPAND: '[data-action=\"question-fullscreen\"]',\r\n    COMPRESS: '[data-action=\"question-exit-fullscreen\"]',\r\n    NEXTQUESTION: '[data-action=\"next-question\"]'\r\n};\r\n\r\nlet REGION = {\r\n    PAGE_HEADER: '#page-header',\r\n    BODY: 'body.path-mod-jqshow',\r\n    NAV: 'nav.navbar',\r\n    SESSIONCONTENT: '[data-region=\"session-content\"]'\r\n};\r\n\r\nlet SERVICES = {\r\n    NEXTQUESTION: 'mod_jqshow_nextquestion'\r\n};\r\n\r\nlet TEMPLATES = {\r\n    LOADING: 'core/overlay_loading',\r\n    QUESTION: 'mod_jqshow/questions/encasement'\r\n};\r\n\r\nlet cmId;\r\nlet sId;\r\n\r\n/**\r\n * @constructor\r\n * @param {String} selector\r\n */\r\nfunction Question(selector) {\r\n    this.node = jQuery(selector);\r\n    this.initQuestion();\r\n}\r\n\r\n/** @type {jQuery} The jQuery node for the page region. */\r\nQuestion.prototype.node = null;\r\n\r\nQuestion.prototype.initQuestion = function() {\r\n    sId = this.node.attr('data-sid');\r\n    cmId = this.node.attr('data-cmid');\r\n    this.node.find(ACTION.EXPAND).on('click', this.fullScreen);\r\n    this.node.find(ACTION.COMPRESS).on('click', this.exitFullScreen);\r\n    jQuery(ACTION.NEXTQUESTION).on('click', this.nextQuestion);\r\n    let that = this;\r\n    jQuery(document).keyup(function(e) {\r\n        if (e.key === 'Escape') {\r\n            that.exitFullScreen();\r\n        }\r\n    });\r\n    addEventListener('questionEnd', () => {\r\n        jQuery(ACTION.NEXTQUESTION).removeClass('d-none');\r\n    }, false);\r\n};\r\n\r\nQuestion.prototype.fullScreen = function(e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    jQuery(ACTION.EXPAND).css('display', 'none');\r\n    jQuery(ACTION.COMPRESS).css('display', 'block');\r\n    jQuery(REGION.BODY).addClass('fullscreen');\r\n    jQuery(window).scrollTop(0);\r\n    jQuery('html, body').animate({scrollTop: 0}, 500);\r\n    let element = document.getElementById(\"page-mod-jqshow-view\");\r\n    if (element === undefined || element === null) {\r\n        element = document.getElementById(\"page-mod-jqshow-preview\");\r\n    }\r\n    if (element.requestFullscreen) {\r\n        element.requestFullscreen();\r\n    } else if (element.webkitRequestFullscreen) { /* Safari */\r\n        element.webkitRequestFullscreen();\r\n    } else if (element.msRequestFullscreen) { /* IE11 */\r\n        element.msRequestFullscreen();\r\n    }\r\n};\r\n\r\nQuestion.prototype.exitFullScreen = function() {\r\n    jQuery(ACTION.EXPAND).css('display', 'block');\r\n    jQuery(ACTION.COMPRESS).css('display', 'none');\r\n    jQuery(REGION.BODY).removeClass('fullscreen');\r\n    if (document.fullscreen) {\r\n        document.exitFullscreen();\r\n    }\r\n};\r\n\r\nQuestion.prototype.nextQuestion = function(e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\r\n        let identifier = jQuery(REGION.SESSIONCONTENT);\r\n        identifier.append(html);\r\n        let request = {\r\n            methodname: SERVICES.NEXTQUESTION,\r\n            args: {\r\n                cmid: cmId,\r\n                sessionid: sId,\r\n                jqid: jQuery(e.currentTarget).attr('data-jqid')\r\n            }\r\n        };\r\n        // eslint-disable-next-line no-console\r\n        console.log(request);\r\n        Ajax.call([request])[0].done(function(response) {\r\n            let templateQuestions = TEMPLATES.QUESTION;\r\n            Templates.render(templateQuestions, response).then(function(html, js) {\r\n                identifier.html(html);\r\n                Templates.runTemplateJS(js);\r\n                jQuery(REGION.LOADING).remove();\r\n            }).fail(Notification.exception);\r\n        });\r\n    });\r\n};\r\n\r\nexport const initQuestion = (selector) => {\r\n    return new Question(selector);\r\n};\r\n"],"names":["cmId","sId","ACTION","REGION","PAGE_HEADER","BODY","NAV","SESSIONCONTENT","SERVICES","TEMPLATES","Question","selector","node","initQuestion","prototype","this","attr","find","on","fullScreen","exitFullScreen","nextQuestion","that","document","keyup","e","key","addEventListener","removeClass","preventDefault","stopPropagation","css","addClass","window","scrollTop","animate","element","getElementById","requestFullscreen","webkitRequestFullscreen","msRequestFullscreen","fullscreen","exitFullscreen","render","visible","done","html","identifier","append","request","methodname","args","cmid","sessionid","jqid","currentTarget","console","log","call","response","templateQuestions","then","js","runTemplateJS","LOADING","remove","fail","Notification","exception"],"mappings":"ufA8BIA,KACAC,IAvBAC,cACQ,sCADRA,gBAEU,2CAFVA,oBAGc,gCAGdC,OAAS,CACTC,YAAa,eACbC,KAAM,uBACNC,IAAK,aACLC,eAAgB,mCAGhBC,sBACc,0BAGdC,kBACS,uBADTA,mBAEU,2CAULC,SAASC,eACTC,MAAO,mBAAOD,eACdE,eAITH,SAASI,UAAUF,KAAO,KAE1BF,SAASI,UAAUD,aAAe,WAC9BZ,IAAMc,KAAKH,KAAKI,KAAK,YACrBhB,KAAOe,KAAKH,KAAKI,KAAK,kBACjBJ,KAAKK,KAAKf,eAAegB,GAAG,QAASH,KAAKI,iBAC1CP,KAAKK,KAAKf,iBAAiBgB,GAAG,QAASH,KAAKK,oCAC1ClB,qBAAqBgB,GAAG,QAASH,KAAKM,kBACzCC,KAAOP,yBACJQ,UAAUC,OAAM,SAASC,GACd,WAAVA,EAAEC,KACFJ,KAAKF,oBAGbO,iBAAiB,eAAe,yBACrBzB,qBAAqB0B,YAAY,aACzC,IAGPlB,SAASI,UAAUK,WAAa,SAASM,GACrCA,EAAEI,iBACFJ,EAAEK,sCACK5B,eAAe6B,IAAI,UAAW,4BAC9B7B,iBAAiB6B,IAAI,UAAW,6BAChC5B,OAAOE,MAAM2B,SAAS,kCACtBC,QAAQC,UAAU,uBAClB,cAAcC,QAAQ,CAACD,UAAW,GAAI,SACzCE,QAAUb,SAASc,eAAe,wBAClCD,gBACAA,QAAUb,SAASc,eAAe,4BAElCD,QAAQE,kBACRF,QAAQE,oBACDF,QAAQG,wBACfH,QAAQG,0BACDH,QAAQI,qBACfJ,QAAQI,uBAIhB9B,SAASI,UAAUM,eAAiB,+BACzBlB,eAAe6B,IAAI,UAAW,6BAC9B7B,iBAAiB6B,IAAI,UAAW,4BAChC5B,OAAOE,MAAMuB,YAAY,cAC5BL,SAASkB,YACTlB,SAASmB,kBAIjBhC,SAASI,UAAUO,aAAe,SAASI,GACvCA,EAAEI,iBACFJ,EAAEK,qCACQa,OAAOlC,kBAAmB,CAACmC,SAAS,IAAOC,MAAK,SAASC,UAC3DC,YAAa,mBAAO5C,OAAOI,gBAC/BwC,WAAWC,OAAOF,UACdG,QAAU,CACVC,WAAY1C,sBACZ2C,KAAM,CACFC,KAAMpD,KACNqD,UAAWpD,IACXqD,MAAM,mBAAO7B,EAAE8B,eAAevC,KAAK,eAI3CwC,QAAQC,IAAIR,uBACPS,KAAK,CAACT,UAAU,GAAGJ,MAAK,SAASc,cAC9BC,kBAAoBnD,sCACdkC,OAAOiB,kBAAmBD,UAAUE,MAAK,SAASf,KAAMgB,IAC9Df,WAAWD,KAAKA,yBACNiB,cAAcD,wBACjB3D,OAAO6D,SAASC,YACxBC,KAAKC,sBAAaC,wCAKJzD,UAClB,IAAID,SAASC"}