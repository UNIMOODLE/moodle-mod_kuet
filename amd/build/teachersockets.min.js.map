{"version":3,"file":"teachersockets.min.js","sources":["../src/teachersockets.js"],"sourcesContent":["\"use strict\";\n/* eslint-disable no-unused-vars */ // TODO remove.\n\nimport jQuery from 'jquery';\n\nlet REGION = {\n    MESSAGEBOX: '#message-box',\n    USERLIST: '#userlist',\n    COUNTUSERS: '#countusers'\n};\n\nlet ACTION = {\n    BACKSESSION: '[data-action=\"back-session\"]',\n    INITSESSION: '[data-action=\"init-session\"]',\n};\n\nlet portUrl = '8080'; // It is rewritten in the constructor.\n\n/**\n * @constructor\n * @param {String} region\n * @param {String} port\n */\nfunction Sockets(region, port) {\n    this.root = jQuery(region);\n    portUrl = port;\n    this.initSockets();\n}\n\n/** @type {jQuery} The jQuery node for the page region. */\nSockets.prototype.root = null;\n\nlet userid = null;\nlet usersocketid = null;\nlet username = null;\nlet messageBox = null;\nlet userlist = null;\nlet countusers = null;\nlet cmid = null;\nlet sid = null;\n\nSockets.prototype.initSockets = function() {\n    userid = this.root[0].dataset.userid;\n    username = this.root[0].dataset.username;\n    cmid = this.root[0].dataset.cmid;\n    sid = this.root[0].dataset.sid;\n    messageBox = this.root.find(REGION.MESSAGEBOX);\n    userlist = this.root.find(REGION.USERLIST);\n    countusers = this.root.find(REGION.COUNTUSERS);\n\n    this.root.find(ACTION.BACKSESSION).on('click', this.backSession);\n\n    Sockets.prototype.webSocket = new WebSocket(\n        'wss://' + M.cfg.wwwroot.replace(/^https?:\\/\\//, '') + ':' + portUrl + '/jqshow'\n    );\n\n    Sockets.prototype.backSession = function() {\n        // eslint-disable-next-line no-console\n        console.log('back');\n    };\n\n    Sockets.prototype.webSocket.onopen = function(event) {\n        messageBox.append(\n            '<div class=\"system_msg\" style=\"color:#bbbbbb\">' +\n            'Bienvenido a Jam Quiz Show ' + username + '!</div>'\n        );\n    };\n\n    Sockets.prototype.webSocket.onmessage = function(ev) {\n        let response = JSON.parse(ev.data); // PHP sends Json data.\n        let resAction = response.action; // Message type.\n        switch (resAction) {\n            case 'connect':\n                // The server has returned the connected status, it is time to identify yourself.\n                if (response.usersocketid !== undefined) {\n                    usersocketid = response.usersocketid;\n                    // eslint-disable-next-line no-console\n                    console.log(response.usersocketid);\n                    let msg = {\n                        'userid': userid,\n                        'name': username,\n                        'isteacher': true,\n                        'cmid': cmid,\n                        'sid': sid,\n                        'usersocketid': usersocketid,\n                        'action': 'newuser'\n                    };\n                    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n                }\n                break;\n            case 'newuser':\n                if (response.name !== undefined) {\n                    userlist.append(\n                        '<li data-userid=\"' + response.usersocketid + '\">' +\n                        response.name + '</li>'\n                    );\n                    messageBox.append('<div>' + response.message + '</div>');\n                }\n                countusers.html(response.count);\n                break;\n            case 'countusers':\n                countusers.html(response.count);\n                break;\n            case 'teacherSend':\n                messageBox.append('<div>' + response.message + '</div>');\n                break;\n            case 'userdisconnected':\n                jQuery('[data-userid=\"' + response.usersocketid + '\"]').remove();\n                messageBox.append('<div>' + response.message + '</div>');\n                countusers.html(response.count);\n                break;\n            default:\n                break;\n        }\n        messageBox[0].scrollTop = messageBox[0].scrollHeight;\n    };\n\n    Sockets.prototype.webSocket.onerror = function(ev) {\n        messageBox.append('<div class=\"system_error\">Error Occurred - ' + ev.data + '</div>');\n    };\n\n    Sockets.prototype.webSocket.onclose = function() {\n        messageBox.append('<div class=\"system_msg\">Connection Closed</div>');\n    };\n};\n\nSockets.prototype.sendMessageSocket = function(msg) {\n    this.webSocket.send(msg);\n};\n\nexport const teacherInitSockets = (region, port) => {\n    return new Sockets(region, port);\n};\n"],"names":["obj","Object","defineProperty","_exports","value","teacherInitSockets","_jquery","__esModule","default","REGION","ACTION","portUrl","Sockets","region","port","this","root","jQuery","initSockets","prototype","userid","usersocketid","username","messageBox","userlist","countusers","cmid","sid","dataset","find","on","backSession","webSocket","WebSocket","M","cfg","wwwroot","replace","console","log","onopen","event","append","onmessage","ev","response","JSON","parse","data","action","undefined","msg","name","isteacher","sendMessageSocket","stringify","message","html","count","remove","scrollTop","scrollHeight","onerror","onclose","send"],"mappings":"oFAG4B,IAAAA,IAHfC,OAAAC,eAAAC,SAAA,aAAA,CAAAC,OAAA,IAAAD,SAAAE,wBAAA,EAGbC,SAA4BN,IAA5BM,UAA4BN,IAAAO,WAAAP,IAAAQ,CAAAA,QAAAR,KAE5B,IAAIS,kBACY,eADZA,gBAEU,YAFVA,kBAGY,cAGZC,mBACa,+BAIbC,QAAU,OAOd,SAASC,QAAQC,OAAQC,MACrBC,KAAKC,MAAO,EAAAC,QAAMT,SAACK,QACnBF,QAAUG,KACVC,KAAKG,aACT,CAGAN,QAAQO,UAAUH,KAAO,KAEzB,IAAII,OAAS,KACTC,aAAe,KACfC,SAAW,KACXC,WAAa,KACbC,SAAW,KACXC,WAAa,KACbC,KAAO,KACPC,IAAM,KAEVf,QAAQO,UAAUD,YAAc,WAC5BE,OAASL,KAAKC,KAAK,GAAGY,QAAQR,OAC9BE,SAAWP,KAAKC,KAAK,GAAGY,QAAQN,SAChCI,KAAOX,KAAKC,KAAK,GAAGY,QAAQF,KAC5BC,IAAMZ,KAAKC,KAAK,GAAGY,QAAQD,IAC3BJ,WAAaR,KAAKC,KAAKa,KAAKpB,mBAC5Be,SAAWT,KAAKC,KAAKa,KAAKpB,iBAC1BgB,WAAaV,KAAKC,KAAKa,KAAKpB,mBAE5BM,KAAKC,KAAKa,KAAKnB,oBAAoBoB,GAAG,QAASf,KAAKgB,aAEpDnB,QAAQO,UAAUa,UAAY,IAAIC,UAC9B,SAAWC,EAAEC,IAAIC,QAAQC,QAAQ,eAAgB,IAAM,IAAM1B,QAAU,WAG3EC,QAAQO,UAAUY,YAAc,WAE5BO,QAAQC,IAAI,SAGhB3B,QAAQO,UAAUa,UAAUQ,OAAS,SAASC,OAC1ClB,WAAWmB,OACP,4EACgCpB,SAAW,YAInDV,QAAQO,UAAUa,UAAUW,UAAY,SAASC,IAC7C,IAAIC,SAAWC,KAAKC,MAAMH,GAAGI,MAE7B,OADgBH,SAASI,QAErB,IAAK,UAED,QAA8BC,IAA1BL,SAASxB,aAA4B,CACrCA,aAAewB,SAASxB,aAExBiB,QAAQC,IAAIM,SAASxB,cACrB,IAAI8B,IAAM,CACN/B,OAAUA,OACVgC,KAAQ9B,SACR+B,WAAa,EACb3B,KAAQA,KACRC,IAAOA,IACPN,aAAgBA,aAChB4B,OAAU,WAEdrC,QAAQO,UAAUmC,kBAAkBR,KAAKS,UAAUJ,KACvD,CACA,MACJ,IAAK,eACqBD,IAAlBL,SAASO,OACT5B,SAASkB,OACL,oBAAsBG,SAASxB,aAAe,KAC9CwB,SAASO,KAAO,SAEpB7B,WAAWmB,OAAO,QAAUG,SAASW,QAAU,WAEnD/B,WAAWgC,KAAKZ,SAASa,OACzB,MACJ,IAAK,aACDjC,WAAWgC,KAAKZ,SAASa,OACzB,MACJ,IAAK,cACDnC,WAAWmB,OAAO,QAAUG,SAASW,QAAU,UAC/C,MACJ,IAAK,oBACD,EAAAvC,QAAMT,SAAC,iBAAmBqC,SAASxB,aAAe,MAAMsC,SACxDpC,WAAWmB,OAAO,QAAUG,SAASW,QAAU,UAC/C/B,WAAWgC,KAAKZ,SAASa,OAKjCnC,WAAW,GAAGqC,UAAYrC,WAAW,GAAGsC,cAG5CjD,QAAQO,UAAUa,UAAU8B,QAAU,SAASlB,IAC3CrB,WAAWmB,OAAO,8CAAgDE,GAAGI,KAAO,WAGhFpC,QAAQO,UAAUa,UAAU+B,QAAU,WAClCxC,WAAWmB,OAAO,qDAI1B9B,QAAQO,UAAUmC,kBAAoB,SAASH,KAC3CpC,KAAKiB,UAAUgC,KAAKb,MAKtBhD,SAAAE,mBAFgC,SAACQ,OAAQC,MACvC,OAAO,IAAIF,QAAQC,OAAQC,MAC7B"}