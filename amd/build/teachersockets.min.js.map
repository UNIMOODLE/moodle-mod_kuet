{"version":3,"file":"teachersockets.min.js","sources":["../src/teachersockets.js"],"sourcesContent":["\"use strict\";\n\nimport jQuery from 'jquery';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\nimport {get_string as getString, get_strings as getStrings} from 'core/str';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport Ajax from 'core/ajax';\nimport Encryptor from 'mod_jqshow/encryptor';\nimport Database from 'mod_jqshow/database';\nimport mEvent from 'core/event';\n\nlet REGION = {\n    MESSAGEBOX: '#message-box',\n    USERLIST: '[data-region=\"active-users\"]',\n    COUNTUSERS: '#countusers',\n    TEACHERCANVASCONTENT: '[data-region=\"teacher-canvas-content\"]', // This root.\n    TEACHERCANVAS: '[data-region=\"teacher-canvas\"]',\n    TEACHERPANEL: '[data-region=\"teacher-panel\"]',\n    SESSIONCONTROLER: '[data-region=\"session-controller\"]',\n    SESSIONRESUME: '[data-region=\"session-resume\"]',\n    LISTRESULTS: '[data-region=\"list-results\"]',\n};\n\nlet ACTION = {\n    BACKSESSION: '[data-action=\"back-session\"]',\n    INITSESSION: '[data-action=\"init-session\"]',\n    ENDSESSION: '[data-action=\"end-session\"]'\n};\n\nlet SERVICES = {\n    ACTIVESESSION: 'mod_jqshow_activesession',\n    GETALLQUESTIONS: 'mod_jqshow_session_getallquestions',\n    NEXTQUESTION: 'mod_jqshow_nextquestion',\n    FIRSTQUESTION: 'mod_jqshow_firstquestion',\n    FINISHSESSION: 'mod_jqshow_finishsession',\n    DELETERESPONSES: 'mod_jqshow_deleteresponses',\n    JUMPTOQUESTION: 'mod_jqshow_jumptoquestion',\n    GETSESSIONRESUME: 'mod_jqshow_getsessionresume',\n    GETLISTRESULTS: 'mod_jqshow_getlistresults',\n    GETQUESTIONSTATISTICS: 'mod_jqshow_getquestionstatistics',\n    GETSESSIONCONFIG: 'mod_jqshow_getsession',\n    GETPROVISIONALRANKING: 'mod_jqshow_getprovisionalranking',\n    GETFINALRANKING: 'mod_jqshow_getfinalranking',\n};\n\nlet TEMPLATES = {\n    LOADING: 'core/overlay_loading',\n    SUCCESS: 'core/notification_success',\n    ERROR: 'core/notification_error',\n    PARTICIPANT: 'mod_jqshow/session/manual/waitingroom/participant',\n    QUESTION: 'mod_jqshow/questions/encasement',\n    SESSIONRESUME: 'mod_jqshow/session/sessionresume',\n    LISTRESULTS: 'mod_jqshow/session/listresults',\n    PROVISIONALRANKING: 'mod_jqshow/ranking/provisional'\n};\n\nlet portUrl = '8080'; // It is rewritten in the constructor.\nlet userid = null;\nlet usersocketid = null;\nlet username = null;\nlet userimage = null;\nlet messageBox = null;\nlet countusers = null;\nlet cmid = null;\nlet sid = null;\nlet db = null;\nlet questionsJqids = [];\nlet waitingRoom = true;\nlet currentQuestionJqid = null;\nlet nextQuestionJqid = null;\nlet sessionMode = null;\nlet showRankingBetweenQuestions = false;\nlet showRankingBetweenQuestionsSwitch = false;\nlet showRankingFinal = false;\n\n/**\n * @constructor\n * @param {String} region\n * @param {String} port\n * @param {String} sessionmode\n */\nfunction Sockets(region, port, sessionmode) {\n    this.root = jQuery(region);\n    portUrl = port;\n    userid = this.root[0].dataset.userid;\n    username = this.root[0].dataset.username;\n    userimage = this.root[0].dataset.userimage;\n    cmid = this.root[0].dataset.cmid;\n    sid = this.root[0].dataset.sid;\n    messageBox = this.root.find(REGION.MESSAGEBOX);\n    countusers = this.root.find(REGION.COUNTUSERS);\n    sessionMode = sessionmode;\n    switch (sessionMode) {\n        case 'inactive_manual':\n        default:\n            showRankingBetweenQuestions = false;\n            showRankingBetweenQuestionsSwitch = false;\n            showRankingFinal = false;\n            break;\n        case 'podium_manual': {\n            let request = {\n                methodname: SERVICES.GETSESSIONCONFIG,\n                args: {\n                    sid: sid,\n                    cmid: cmid\n                }\n            };\n            Ajax.call([request])[0].done(function(response) {\n                if (response.session.showgraderanking === 1) {\n                    showRankingBetweenQuestions = true;\n                }\n                if (response.session.showfinalgrade === 1) {\n                    showRankingFinal = true;\n                }\n            }).fail(Notification.exception);\n            break;\n        }\n    }\n    this.measuringSpeed(); // TODO extend to the whole mod.\n    this.disableDevTools(); // TODO extend to the whole mod.\n    this.initSockets();\n    this.cleanMessages(); // TODO only for develop.\n    this.initListeners();\n}\n\nSockets.prototype.cleanMessages = function() {\n    setInterval(function() {\n        messageBox.find(':first-child').remove();\n    }, 10000);\n};\n\nSockets.prototype.disableDevTools = function(){\n    document.addEventListener('contextmenu', (e) => e.preventDefault());\n    document.onkeydown = (e) => {\n        return !(event.keyCode === 123 ||\n            this.ctrlShiftKey(e, 'I') ||\n            this.ctrlShiftKey(e, 'J') ||\n            this.ctrlShiftKey(e, 'C') ||\n            (e.ctrlKey && e.keyCode === 'U'.charCodeAt(0)));\n    };\n};\n\nSockets.prototype.ctrlShiftKey = function(e, keyCode) {\n    return e.ctrlKey && e.shiftKey && e.keyCode === keyCode.charCodeAt(0);\n};\n\nSockets.prototype.measuringSpeed = function() {\n    let connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;\n    if (connection) {\n        let typeConnection = connection.effectiveType;\n        let speedMbps = connection.downlink;\n        // eslint-disable-next-line no-console\n        console.log(\"Type of Connection: \" + typeConnection, \"Estimated speed: \" + speedMbps + \" Mbps\");\n        if (speedMbps < 1) {\n            let reason = {\n                effectiveType: connection.effectiveType,\n                downlink: connection.downlink\n            };\n            getString('lowspeed', 'mod_jqshow', reason).done((s) => {\n                messageBox.append(\n                    '<div class=\"alert alert-danger\" role=\"alert\">' + s + '</div>'\n                );\n            });\n        }\n    } else {\n        // eslint-disable-next-line no-console\n        console.log(\"Connection speed detection is not supported in this browser.\");\n    }\n};\n\nSockets.prototype.backSession = function() {\n    const stringkeys = [\n        {key: 'backtopanelfromsession', component: 'mod_jqshow'},\n        {key: 'backtopanelfromsession_desc', component: 'mod_jqshow'},\n        {key: 'confirm', component: 'mod_jqshow'}\n    ];\n    getStrings(stringkeys).then((langStrings) => {\n        return ModalFactory.create({\n            title: langStrings[0],\n            body: langStrings[1],\n            type: ModalFactory.types.SAVE_CANCEL\n        }).then(modal => {\n            modal.setSaveButtonText(langStrings[2]);\n            modal.getRoot().on(ModalEvents.save, () => {\n                let request = {\n                    methodname: SERVICES.ACTIVESESSION,\n                    args: {\n                        cmid: cmid,\n                        sessionid: sid\n                    }\n                };\n                Ajax.call([request])[0].done(function() {\n                    window.location.replace(M.cfg.wwwroot + '/mod/jqshow/view.php?id=' + cmid);\n                }).fail(Notification.exception);\n            });\n            modal.getRoot().on(ModalEvents.hidden, () => {\n                modal.destroy();\n            });\n            return modal;\n        });\n    }).done(function(modal) {\n        modal.show();\n        // eslint-disable-next-line no-restricted-globals\n    }).fail(Notification.exception);\n};\n\n/* ****************** */\n\n/** @type {jQuery} The jQuery node for the page region. */\nSockets.prototype.root = null;\n\nSockets.prototype.initSockets = function() {\n    let that = this;\n    this.root.find(ACTION.BACKSESSION).on('click', this.backSession);\n\n    db = Database.initDb(sid, userid);\n    Sockets.prototype.webSocket = new WebSocket(\n        'wss://' + M.cfg.wwwroot.replace(/^https?:\\/\\//, '') + ':' + portUrl + '/jqshow'\n    );\n\n    Sockets.prototype.webSocket.onopen = function() { // Waitingroom.\n        /* The first and second questions are obtained.\n        When the teacher clicks on init session, the teacher will send the first question over the socket to all\n        students, and will get the 3rd question. When a student answers a question, a service will be called to save the answer\n        and progress, and the teacher will be informed via the socket. When the teacher clicks on next question,\n        the 2nd question will be sent by socket to all students, and the 3th question will be obtained.\n        The questions will be stored in the teacher's data storage, you can even store the user's answers so that you\n        don't have to call a service at the end for the ranking.\n        */\n\n        let request = {\n            methodname: SERVICES.FIRSTQUESTION,\n            args: {\n                cmid: cmid,\n                sessionid: sid\n            }\n        };\n        Ajax.call([request])[0].done(function(firstquestion) {\n            let data = {\n                jqid: firstquestion.jqid,\n                value: firstquestion\n            };\n            db.add('questions', data);\n            questionsJqids.push(firstquestion.jqid);\n            currentQuestionJqid = firstquestion.jqid;\n            that.setCurrentQuestion(firstquestion.jqid);\n            that.getNextQuestion(firstquestion.jqid);\n            that.root.find(ACTION.INITSESSION).removeClass('disabled');\n            that.root.find(ACTION.INITSESSION).on('click', that.initSession);\n            that.root.find(ACTION.ENDSESSION).on('click', that.endSession);\n        }).fail(Notification.exception);\n    };\n\n    Sockets.prototype.webSocket.onmessage = function(ev) {\n        // TODO Refactor.\n        let msgDecrypt = Encryptor.decrypt(ev.data);\n        let response = JSON.parse(msgDecrypt); // PHP sends Json data.\n        switch (response.action) {\n            case 'connect':\n                // The server has returned the connected status, it is time to identify yourself.\n                if (response.usersocketid !== undefined) {\n                    usersocketid = response.usersocketid;\n                    let msg = {\n                        'userid': userid,\n                        'name': username,\n                        'pic': userimage, // TODO encrypt.\n                        'isteacher': true,\n                        'cmid': cmid,\n                        'sid': sid,\n                        'usersocketid': usersocketid,\n                        'action': 'newuser'\n                    };\n                    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n                }\n                break;\n            case 'newuser': {\n                let identifier = jQuery(REGION.USERLIST);\n                let data = response.students;\n                identifier.html('');\n                if (waitingRoom === false) {\n                    Sockets.prototype.normalizeUser(response.usersocketid);\n                }\n                jQuery.each(data, function(i, student) {\n                    let templateContext = {\n                        'usersocketid': student.usersocketid,\n                        'userimage': student.picture,\n                        'userfullname': student.name,\n                    };\n                    Templates.render(TEMPLATES.PARTICIPANT, templateContext).then(function(html) {\n                        identifier.append(html);\n                    }).fail(Notification.exception);\n                });\n                countusers.html(response.count);\n                break;\n            }\n            case 'countusers':\n                countusers.html(response.count);\n                break;\n            case 'studentQuestionEnd':\n                messageBox.append('<div>' + response.message + '</div>');\n                break;\n            case 'userdisconnected':\n                jQuery('[data-userid=\"' + response.usersocketid + '\"]').remove();\n                countusers.html(response.count);\n                messageBox.append('<div>' + response.message + '</div>');\n                break;\n            case 'alreadyteacher':\n                messageBox.append(\n                    '<div class=\"alert alert-danger\" role=\"alert\">' + response.message + '</div>'\n                );\n                break;\n            case 'pauseQuestion':\n                dispatchEvent(new Event('pauseQuestion_' + response.jqid));\n                break;\n            case 'playQuestion':\n                dispatchEvent(new Event('playQuestion_' + response.jqid));\n                break;\n            case 'showAnswers':\n                dispatchEvent(new Event('showAnswers_' + response.jqid));\n                break;\n            case 'hideAnswers':\n                dispatchEvent(new Event('hideAnswers_' + response.jqid));\n                break;\n            case 'showStatistics':\n                dispatchEvent(new Event('showStatistics_' + response.jqid));\n                break;\n            case 'hideStatistics':\n                dispatchEvent(new Event('hideStatistics_' + response.jqid));\n                break;\n            case 'showFeedback':\n                dispatchEvent(new Event('showFeedback_' + response.jqid));\n                break;\n            case 'hideFeedback':\n                dispatchEvent(new Event('hideFeedback_' + response.jqid));\n                break;\n            default:\n                break;\n        }\n        messageBox[0].scrollTop = messageBox[0].scrollHeight;\n    };\n\n    Sockets.prototype.webSocket.onerror = function() {\n        getString('system_error', 'mod_jqshow').done((s) => {\n            messageBox.append(\n                '<div class=\"alert alert-danger\" role=\"alert\">' + s + '</div>'\n            );\n        });\n    };\n\n    Sockets.prototype.webSocket.onclose = function(ev) {\n        let reason = {\n            reason: ev.reason,\n            code: ev.code\n        };\n        getString('connection_closed', 'mod_jqshow', reason).done((s) => {\n            jQuery(REGION.TEACHERCANVASCONTENT).prepend(\n                '<div class=\"alert alert-danger\" role=\"alert\">' + s + '</div>'\n            );\n        });\n    };\n};\n\nSockets.prototype.initListeners = function() {\n    let that = this;\n    addEventListener('nextQuestion', () => {\n        switch (sessionMode) {\n            case 'inactive_programmed':\n            case 'inactive_manual':\n            default:\n                that.nextQuestion();\n                break;\n            case 'podium_manual':\n            case 'podium_programmed':\n                that.manageNext();\n                break;\n        }\n    }, false);\n    addEventListener('pauseQuestionSelf', () => {\n        that.pauseQuestion();\n    }, false);\n    addEventListener('playQuestionSelf', () => {\n        that.playQuestion();\n    }, false);\n    addEventListener('resendSelf', () => {\n        that.resendSelf();\n    }, false);\n    addEventListener('jumpTo', (e) => {\n        that.jumpTo(e.detail.jumpTo);\n    }, false);\n    addEventListener('teacherQuestionEndSelf', () => {\n        that.questionEnd();\n    }, false);\n    addEventListener('showAnswersSelf', () => {\n        that.showAnswers();\n    }, false);\n    addEventListener('hideAnswersSelf', () => {\n        that.hideAnswers();\n    }, false);\n    addEventListener('showStatisticsSelf', () => {\n        that.showStatistics();\n    }, false);\n    addEventListener('hideStatisticsSelf', () => {\n        that.hideStatistics();\n    }, false);\n    addEventListener('showFeedbackSelf', () => {\n        that.showFeedback();\n    }, false);\n    addEventListener('hideFeedbackSelf', () => {\n        that.hideFeedback();\n    }, false);\n    addEventListener('endSession', () => {\n        that.endSession();\n    }, {once: true});\n};\n\nSockets.prototype.setCurrentQuestion = function(currentQuestion) {\n    let data = {\n        state: 'currentQuestion',\n        value: currentQuestion\n    };\n    db.update('statequestions', data);\n};\n\nSockets.prototype.setNextQuestion = function(nextQuestion) {\n    let data = {\n        state: 'nextQuestion',\n        value: nextQuestion\n    };\n    db.update('statequestions', data);\n};\n\nSockets.prototype.setEndSession = function(endData) {\n    db.delete('statequestions', 'nextQuestion');\n    let data = {\n        state: 'endSession',\n        value: endData\n    };\n    db.update('statequestions', data);\n    showRankingBetweenQuestionsSwitch = false;\n};\n\nSockets.prototype.getNextQuestion = function(jqid) {\n    let that = this;\n    let request = {\n        methodname: SERVICES.NEXTQUESTION,\n        args: {\n            cmid: cmid,\n            sessionid: sid,\n            jqid: jqid,\n            manual: true\n        }\n    };\n    nextQuestionJqid = null;\n    Ajax.call([request])[0].done(function(nextquestion) {\n        if (nextquestion.endsession !== true) {\n            let data = {\n                jqid: nextquestion.jqid,\n                value: nextquestion\n            };\n            db.add('questions', data);\n            nextQuestionJqid = nextquestion.jqid;\n            that.setNextQuestion(nextquestion.jqid);\n        } else {\n            // End session.\n            nextQuestionJqid = null;\n            that.setEndSession(nextquestion);\n        }\n    }).fail(Notification.exception);\n};\n\nSockets.prototype.initSession = function() {\n    db.delete('statequestions', 'endSession');\n    const stringkeys = [\n        {key: 'init_session', component: 'mod_jqshow'},\n        {key: 'init_session_desc', component: 'mod_jqshow'},\n        {key: 'confirm', component: 'mod_jqshow'},\n        {key: 'sessionstarted', component: 'mod_jqshow'},\n        {key: 'sessionstarted_info', component: 'mod_jqshow'}\n    ];\n    getStrings(stringkeys).then((langStrings) => {\n        return ModalFactory.create({\n            title: langStrings[0],\n            body: langStrings[1],\n            type: ModalFactory.types.SAVE_CANCEL\n        }).then(modal => {\n            modal.setSaveButtonText(langStrings[2]);\n            modal.getRoot().on(ModalEvents.save, () => {\n                let firstQuestion = db.get('questions', currentQuestionJqid);\n                firstQuestion.onsuccess = function() {\n                    let msg = {\n                        'action': 'question',\n                        'sid': sid,\n                        'context': firstQuestion.result\n                    };\n                    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n                    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                        Sockets.prototype.initPanel();\n                        let identifier = jQuery(REGION.TEACHERCANVAS);\n                        identifier.append(html);\n                        currentQuestionJqid = firstQuestion.result.jqid;\n                        firstQuestion.result.value.isteacher = true;\n                        Templates.render(TEMPLATES.QUESTION, firstQuestion.result.value).then(function(html, js) {\n                            identifier.html(html);\n                            jQuery(REGION.TEACHERCANVASCONTENT).find('.content-title h2').html(langStrings[3]);\n                            jQuery(REGION.TEACHERCANVASCONTENT).find('.content-title small').html(langStrings[4]);\n                            jQuery(ACTION.BACKSESSION).remove();\n                            jQuery(ACTION.INITSESSION).remove();\n                            jQuery(ACTION.ENDSESSION).removeClass('hidden').removeClass('disabled');\n                            waitingRoom = false;\n                            if (showRankingBetweenQuestions) {\n                                showRankingBetweenQuestionsSwitch = true;\n                            }\n                            Templates.runTemplateJS(js);\n                            jQuery(REGION.LOADING).remove();\n                            mEvent.notifyFilterContentUpdated(document.querySelector(REGION.TEACHERCANVAS));\n                        }).fail(Notification.exception);\n                    });\n                };\n            });\n            modal.getRoot().on(ModalEvents.hidden, () => {\n                modal.destroy();\n            });\n            return modal;\n        });\n    }).done(function(modal) {\n        modal.show();\n        // eslint-disable-next-line no-restricted-globals\n    }).fail(Notification.exception);\n};\n\nSockets.prototype.initPanel = function() {\n    let requestResume = {\n        methodname: SERVICES.GETSESSIONRESUME,\n        args: {\n            sid: sid,\n            cmid: cmid,\n        }\n    };\n    Ajax.call([requestResume])[0].done(function(responseResume) {\n        Templates.render(TEMPLATES.SESSIONRESUME, responseResume).then(function(html) {\n            jQuery(REGION.SESSIONRESUME).append(html);\n        });\n    });\n    setInterval(function() {\n        let requestResults = {\n            methodname: SERVICES.GETLISTRESULTS,\n            args: {\n                sid: sid,\n                cmid: cmid,\n            }\n        };\n        Ajax.call([requestResults])[0].done(function(responseResults) {\n            Templates.render(TEMPLATES.LISTRESULTS, responseResults).then(function(html) {\n                jQuery(REGION.LISTRESULTS).html(html);\n            });\n        });\n    }, 20000);\n    jQuery(REGION.TEACHERPANEL).removeClass('d-none');\n};\n\nSockets.prototype.endSession = function() {\n    const stringkeys = [\n        {key: 'end_session', component: 'mod_jqshow'},\n        {key: 'end_session_manual_desc', component: 'mod_jqshow'},\n        {key: 'confirm', component: 'mod_jqshow'},\n        {key: 'end_session_error', component: 'mod_jqshow'}\n    ];\n    getStrings(stringkeys).then((langStrings) => {\n        return ModalFactory.create({\n            title: langStrings[0],\n            body: langStrings[1],\n            type: ModalFactory.types.SAVE_CANCEL\n        }).then(modal => {\n            modal.setSaveButtonText(langStrings[2]);\n            modal.getRoot().on(ModalEvents.save, () => {\n                let request = {\n                    methodname: SERVICES.FINISHSESSION,\n                    args: {\n                        cmid: cmid,\n                        sessionid: sid\n                    }\n                };\n                Ajax.call([request])[0].done(function(response) {\n                    if (response.finished === true) {\n                        let deleteDb = db.deleteDatabase();\n                        deleteDb.onerror = function(event) {\n                            // eslint-disable-next-line no-console\n                            console.error(\"Error deleting database.\", event);\n                        };\n                        deleteDb.onsuccess = function() {\n                            window.location.replace(M.cfg.wwwroot + '/mod/jqshow/view.php?id=' + cmid);\n                        };\n                    } else {\n                        Notification.alert('Error', langStrings[3], langStrings[2]);\n                    }\n                }).fail(Notification.exception);\n            });\n            modal.getRoot().on(ModalEvents.hidden, () => {\n                modal.destroy();\n            });\n            return modal;\n        });\n    }).done(function(modal) {\n        modal.show();\n        // eslint-disable-next-line no-restricted-globals\n    }).fail(Notification.exception);\n};\n\nSockets.prototype.nextQuestion = function() {\n    let that = this;\n    if (nextQuestionJqid === null) {\n        this.getNextQuestion(currentQuestionJqid);\n    }\n    let nextQuestion = db.get('statequestions', 'nextQuestion');\n    nextQuestion.onsuccess = function() {\n        if (nextQuestion.result !== undefined) {\n            let nextQuestionData = db.get('questions', nextQuestion.result.value);\n            nextQuestionData.onsuccess = function() {\n                let msg = {\n                    'action': 'question',\n                    'sid': sid,\n                    'context': nextQuestionData.result\n                };\n                Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n                Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                    let identifier = jQuery(REGION.TEACHERCANVAS);\n                    identifier.append(html);\n                    currentQuestionJqid = nextQuestionData.result.jqid;\n                    // The following question is marked as current.\n                    that.setCurrentQuestion(nextQuestionData.result.jqid);\n                    // And get the next question to store it.\n                    that.getNextQuestion(nextQuestionData.result.jqid);\n                    nextQuestionData.result.value.isteacher = true;\n                    Templates.render(TEMPLATES.QUESTION, nextQuestionData.result.value).then(function(html, js) {\n                        identifier.html(html);\n                        Templates.runTemplateJS(js);\n                        mEvent.notifyFilterContentUpdated(document.querySelector(REGION.TEACHERCANVAS));\n                        jQuery(REGION.LOADING).remove();\n                    }).fail(Notification.exception);\n                });\n            };\n        } else {\n            let endSession = db.get('statequestions', 'endSession');\n            if (showRankingFinal === false) {\n                endSession.onsuccess = function() {\n                    let msg = {\n                        'action': 'endSession',\n                        'sid': sid,\n                        'context': endSession.result\n                    };\n                    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n                    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                        let identifier = jQuery(REGION.TEACHERCANVAS);\n                        identifier.append(html);\n                        currentQuestionJqid = null;\n                        db.delete('statequestions', 'currentQuestion');\n                        that.setEndSession(endSession.result);\n                        endSession.result.value.isteacher = true;\n                        Templates.render(TEMPLATES.QUESTION, endSession.result.value).then(function(html, js) {\n                            identifier.html(html);\n                            Templates.runTemplateJS(js);\n                            jQuery(REGION.LOADING).remove();\n                        }).fail(Notification.exception);\n                    });\n                };\n            } else {\n                endSession.onsuccess = function() {\n                    let request = {\n                        methodname: SERVICES.GETFINALRANKING,\n                        args: {\n                            sid: sid,\n                            cmid: cmid\n                        }\n                    };\n                    Ajax.call([request])[0].done(function(finalRanking) {\n                        endSession.result.value = finalRanking;\n                        let msg = {\n                            'action': 'endSession',\n                            'sid': sid,\n                            'context': endSession.result\n                        };\n                        Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n                        Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                            let identifier = jQuery(REGION.TEACHERCANVAS);\n                            identifier.append(html);\n                            currentQuestionJqid = null;\n                            db.delete('statequestions', 'currentQuestion');\n                            that.setEndSession(endSession.result);\n                            endSession.result.value.isteacher = true;\n                            Templates.render(TEMPLATES.QUESTION, endSession.result.value).then(function(html, js) {\n                                identifier.html(html);\n                                Templates.runTemplateJS(js);\n                                jQuery(REGION.LOADING).remove();\n                            }).fail(Notification.exception);\n                        });\n                    }).fail(Notification.exception);\n                };\n            }\n        }\n    };\n};\n\nSockets.prototype.manageNext = function() {\n    let that = this;\n    if (showRankingBetweenQuestions === false) {\n        that.nextQuestion();\n    } else {\n        if (showRankingBetweenQuestionsSwitch === false) {\n            that.nextQuestion();\n            showRankingBetweenQuestionsSwitch = true;\n        } else {\n            let request = {\n                methodname: SERVICES.GETPROVISIONALRANKING,\n                args: {\n                    sid: sid,\n                    cmid: cmid,\n                    jqid: currentQuestionJqid\n                }\n            };\n            Ajax.call([request])[0].done(function(provisionalRanking) {\n                let msg = {\n                    'action': 'ranking',\n                    'sid': sid,\n                    'context': provisionalRanking\n                };\n                Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n                showRankingBetweenQuestionsSwitch = false;\n                Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                    let identifier = jQuery(REGION.TEACHERCANVAS);\n                    identifier.append(html);\n                    provisionalRanking.isteacher = true;\n                    Templates.render(TEMPLATES.PROVISIONALRANKING, provisionalRanking).then(function(html, js) {\n                        identifier.html(html);\n                        Templates.runTemplateJS(js);\n                        jQuery(REGION.LOADING).remove();\n                    }).fail(Notification.exception);\n                });\n            }).fail(Notification.exception);\n        }\n    }\n};\n\nSockets.prototype.pauseQuestion = function() {\n    let msg = {\n        'action': 'pauseQuestion',\n        'sid': sid,\n        'jqid': currentQuestionJqid\n    };\n    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n};\n\nSockets.prototype.playQuestion = function() {\n    let msg = {\n        'action': 'playQuestion',\n        'sid': sid,\n        'jqid': currentQuestionJqid\n    };\n    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n};\n\nSockets.prototype.resendSelf = function() {\n    let request = {\n        methodname: SERVICES.DELETERESPONSES,\n        args: {\n            cmid: cmid,\n            sessionid: sid,\n            jqid: currentQuestionJqid\n        }\n    };\n    Ajax.call([request])[0].done(function(response) {\n        if (response.deleted === true) {\n            let currentQuestionData = db.get('questions', currentQuestionJqid);\n            currentQuestionData.onsuccess = function() {\n                let msg = {\n                    'action': 'question',\n                    'sid': sid,\n                    'context': currentQuestionData.result\n                };\n                Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n                showRankingBetweenQuestionsSwitch = true;\n                Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                    let identifier = jQuery(REGION.TEACHERCANVAS);\n                    identifier.append(html);\n                    currentQuestionData.result.value.isteacher = true;\n                    Templates.render(TEMPLATES.QUESTION, currentQuestionData.result.value).then(function(html, js) {\n                        identifier.html(html);\n                        Templates.runTemplateJS(js);\n                        mEvent.notifyFilterContentUpdated(document.querySelector(REGION.TEACHERCANVAS));\n                        jQuery(REGION.LOADING).remove();\n                    }).fail(Notification.exception);\n                });\n            };\n        }\n    }).fail(Notification.exception);\n};\n\nSockets.prototype.jumpTo = function(questionNumber) {\n    let that = this;\n    let request = {\n        methodname: SERVICES.JUMPTOQUESTION,\n        args: {\n            cmid: cmid,\n            sessionid: sid,\n            position: questionNumber,\n            manual: true\n        }\n    };\n    nextQuestionJqid = null;\n    Ajax.call([request])[0].done(function(question) {\n        let data = {\n            jqid: question.jqid,\n            value: question\n        };\n        db.add('questions', data);\n        currentQuestionJqid = question.jqid;\n        that.setCurrentQuestion(question.jqid);\n        that.getNextQuestion(question.jqid);\n        let msg = {\n            'action': 'question',\n            'sid': sid,\n            'context': data\n        };\n        Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n        showRankingBetweenQuestionsSwitch = true;\n        Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n            let identifier = jQuery(REGION.TEACHERCANVAS);\n            identifier.append(html);\n            question.isteacher = true;\n            Templates.render(TEMPLATES.QUESTION, question).then(function(html, js) {\n                identifier.html(html);\n                Templates.runTemplateJS(js);\n                mEvent.notifyFilterContentUpdated(document.querySelector(REGION.TEACHERCANVAS));\n                jQuery(REGION.LOADING).remove();\n            }).fail(Notification.exception);\n        });\n    }).fail(Notification.exception);\n};\n\nSockets.prototype.questionEnd = function() {\n    let request = {\n        methodname: SERVICES.GETQUESTIONSTATISTICS,\n        args: {\n            sid: sid,\n            jqid: currentQuestionJqid\n        }\n    };\n    Ajax.call([request])[0].done(function(response) {\n        let msg = {\n            'action': 'teacherQuestionEnd',\n            'sid': sid,\n            'jqid': currentQuestionJqid,\n            'statistics': response.statistics\n        };\n        Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n        dispatchEvent(new CustomEvent('teacherQuestionEnd_' + currentQuestionJqid, {\n            \"detail\": {\"statistics\": response.statistics}\n        }));\n    }).fail(Notification.exception);\n};\n\nSockets.prototype.showAnswers = function() {\n    let msg = {\n        'action': 'showAnswers',\n        'sid': sid,\n        'jqid': currentQuestionJqid\n    };\n    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n};\n\nSockets.prototype.hideAnswers = function() {\n    let msg = {\n        'action': 'hideAnswers',\n        'sid': sid,\n        'jqid': currentQuestionJqid\n    };\n    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n};\n\nSockets.prototype.showStatistics = function() {\n    let msg = {\n        'action': 'showStatistics',\n        'sid': sid,\n        'jqid': currentQuestionJqid\n    };\n    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n};\n\nSockets.prototype.hideStatistics = function() {\n    let msg = {\n        'action': 'hideStatistics',\n        'sid': sid,\n        'jqid': currentQuestionJqid\n    };\n    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n};\n\nSockets.prototype.showFeedback = function() {\n    let msg = {\n        'action': 'showFeedback',\n        'sid': sid,\n        'jqid': currentQuestionJqid\n    };\n    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n};\n\nSockets.prototype.hideFeedback = function() {\n    let msg = {\n        'action': 'hideFeedback',\n        'sid': sid,\n        'jqid': currentQuestionJqid\n    };\n    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n};\n\nSockets.prototype.normalizeUser = function(usersocketid) {\n    let currentQuestion = db.get('statequestions', 'currentQuestion');\n    currentQuestion.onsuccess = function() {\n        let currentQuestiondata = db.get('questions', currentQuestion.result.value);\n        currentQuestiondata.onsuccess = function() {\n            let msg = {\n                'action': 'normalizeUser',\n                'sid': sid,\n                'ofs': true, // Only for student.\n                'usersocketid': usersocketid,\n                'context': currentQuestiondata.result\n            };\n            Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n        };\n    };\n};\n\nSockets.prototype.sendMessageSocket = function(msg) {\n    this.webSocket.send(msg);\n};\n\nexport const teacherInitSockets = (region, port, sessionmode) => {\n    return new Sockets(region, port, sessionmode);\n};\n"],"names":["_interopRequireDefault","obj","__esModule","default","Object","defineProperty","_exports","value","teacherInitSockets","_jquery","_templates","_notification","_modal_factory","_modal_events","_ajax","_encryptor","_database","_event","REGION","MESSAGEBOX","USERLIST","COUNTUSERS","TEACHERCANVASCONTENT","TEACHERCANVAS","TEACHERPANEL","SESSIONCONTROLER","SESSIONRESUME","LISTRESULTS","ACTION","SERVICES","ACTIVESESSION","GETALLQUESTIONS","NEXTQUESTION","FIRSTQUESTION","FINISHSESSION","DELETERESPONSES","JUMPTOQUESTION","GETSESSIONRESUME","GETLISTRESULTS","GETQUESTIONSTATISTICS","GETSESSIONCONFIG","GETPROVISIONALRANKING","GETFINALRANKING","TEMPLATES","portUrl","userid","usersocketid","username","userimage","messageBox","countusers","cmid","sid","db","questionsJqids","waitingRoom","currentQuestionJqid","nextQuestionJqid","sessionMode","showRankingBetweenQuestions","showRankingBetweenQuestionsSwitch","showRankingFinal","Sockets","region","port","sessionmode","this","root","jQuery","dataset","find","request","methodname","args","Ajax","call","done","response","session","showgraderanking","showfinalgrade","fail","Notification","exception","measuringSpeed","disableDevTools","initSockets","cleanMessages","initListeners","prototype","setInterval","remove","_this","document","addEventListener","e","preventDefault","onkeydown","event","keyCode","ctrlShiftKey","ctrlKey","charCodeAt","shiftKey","connection","navigator","mozConnection","webkitConnection","typeConnection","effectiveType","speedMbps","downlink","console","log","reason","getString","get_string","s","append","backSession","getStrings","key","component","then","langStrings","ModalFactory","create","title","body","type","types","SAVE_CANCEL","modal","setSaveButtonText","getRoot","on","ModalEvents","save","sessionid","window","location","replace","M","cfg","wwwroot","hidden","destroy","show","that","Database","initDb","webSocket","WebSocket","onopen","firstquestion","data","jqid","add","push","setCurrentQuestion","getNextQuestion","removeClass","initSession","endSession","onmessage","ev","msgDecrypt","Encryptor","decrypt","JSON","parse","action","undefined","msg","name","pic","isteacher","sendMessageSocket","stringify","identifier","students","html","normalizeUser","each","i","student","templateContext","picture","userfullname","Templates","render","count","message","dispatchEvent","Event","scrollTop","scrollHeight","onerror","onclose","code","prepend","nextQuestion","manageNext","pauseQuestion","playQuestion","resendSelf","jumpTo","detail","questionEnd","showAnswers","hideAnswers","showStatistics","hideStatistics","showFeedback","hideFeedback","once","currentQuestion","state","update","setNextQuestion","setEndSession","endData","delete","manual","nextquestion","endsession","firstQuestion","get","onsuccess","context","result","visible","initPanel","js","runTemplateJS","LOADING","mEvent","notifyFilterContentUpdated","querySelector","requestResume","responseResume","requestResults","responseResults","finished","deleteDb","deleteDatabase","error","alert","nextQuestionData","finalRanking","provisionalRanking","deleted","currentQuestionData","questionNumber","position","question","statistics","CustomEvent","currentQuestiondata","ofs","send"],"mappings":"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"}