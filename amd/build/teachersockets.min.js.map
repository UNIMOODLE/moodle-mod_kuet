{"version":3,"file":"teachersockets.min.js","sources":["../src/teachersockets.js"],"sourcesContent":["\"use strict\";\nimport jQuery from 'jquery';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\nimport {get_string as getString, get_strings as getStrings} from 'core/str';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport Ajax from 'core/ajax';\nimport Encryptor from 'mod_jqshow/encryptor';\nimport Database from 'mod_jqshow/database';\nimport mEvent from 'core/event';\n\nlet REGION = {\n    MESSAGEBOX: '#message-box',\n    USERLIST: '[data-region=\"active-users\"]',\n    COUNTUSERS: '#countusers',\n    TEACHERCANVASCONTENT: '[data-region=\"teacher-canvas-content\"]', // This root.\n    TEACHERCANVAS: '[data-region=\"teacher-canvas\"]',\n    TEACHERPANEL: '[data-region=\"teacher-panel\"]',\n    SESSIONCONTROLER: '[data-region=\"session-controller\"]',\n    SESSIONRESUME: '[data-region=\"session-resume\"]',\n    LISTRESULTS: '[data-region=\"list-results\"]',\n    RACERESULTS: '[data-region=\"race-results\"]',\n    SWITCHS: '.showhide-action',\n    ESPECIALS: '.special-action',\n    VOTEIMPROVISE: '.special-action.vote-question',\n    CLOUDTAGS: '.cloud',\n    IMPROVISE: '[data-region=\"teacher-improvise\"]',\n    IMPROVISESTATEMENT: '.improvise-form #statement',\n    IMPROVISEREPLY: '.improvise-form #reply_improvise',\n    TAGSCONTENT: '[data-region=\"tags-content\"]',\n};\n\nlet ACTION = {\n    BACKSESSION: '[data-action=\"back-session\"]',\n    INITSESSION: '[data-action=\"init-session\"]',\n    ENDSESSION: '[data-action=\"end-session\"]',\n    CLOSEIMPROVISE: '[data-action=\"close-improvise\"]',\n    SUBMITIMPROVISE: '[data-action=\"submit-improvise\"]',\n    NEXT: '[data-action=\"next\"]',\n    VOTE: '[data-action=\"vote\"]',\n    JUMP: '[data-action=\"jump\"]',\n    FINISHQUESTION: '[data-action=\"finishquestion\"]',\n};\n\nlet SERVICES = {\n    ACTIVESESSION: 'mod_jqshow_activesession',\n    GETALLQUESTIONS: 'mod_jqshow_session_getallquestions',\n    NEXTQUESTION: 'mod_jqshow_nextquestion',\n    FIRSTQUESTION: 'mod_jqshow_firstquestion',\n    FINISHSESSION: 'mod_jqshow_finishsession',\n    DELETERESPONSES: 'mod_jqshow_deleteresponses',\n    JUMPTOQUESTION: 'mod_jqshow_jumptoquestion',\n    GETSESSIONRESUME: 'mod_jqshow_getsessionresume',\n    GETLISTRESULTS: 'mod_jqshow_getlistresults',\n    GETGROUPLISTRESULTS: 'mod_jqshow_getgrouplistresults',\n    GETQUESTIONSTATISTICS: 'mod_jqshow_getquestionstatistics',\n    GETSESSIONCONFIG: 'mod_jqshow_getsession',\n    GETPROVISIONALRANKING: 'mod_jqshow_getprovisionalranking',\n    GETFINALRANKING: 'mod_jqshow_getfinalranking',\n    GETRACERESULTS: 'mod_jqshow_getraceresults'\n};\n\nlet TEMPLATES = {\n    LOADING: 'core/overlay_loading',\n    SUCCESS: 'core/notification_success',\n    ERROR: 'core/notification_error',\n    PARTICIPANT: 'mod_jqshow/session/manual/waitingroom/participant',\n    GROUPPARTICIPANT: 'mod_jqshow/session/manual/waitingroom/groupparticipant',\n    QUESTION: 'mod_jqshow/questions/encasement',\n    SESSIONRESUME: 'mod_jqshow/session/sessionresume',\n    LISTRESULTS: 'mod_jqshow/session/listresults',\n    PROVISIONALRANKING: 'mod_jqshow/ranking/provisional',\n    RACERESULTS: 'mod_jqshow/session/raceresults'\n};\n\nlet socketUrl = '';\nlet portUrl = '8080'; // It is rewritten in the constructor.\nlet userid = null;\nlet usersocketid = null;\nlet username = null;\nlet userimage = null;\nlet messageBox = null;\nlet countusers = null;\nlet cmid = null;\nlet sid = null;\nlet db = null;\nlet questionsJqids = [];\nlet waitingRoom = true;\nlet currentQuestionJqid = null;\nlet nextQuestionJqid = null;\nlet sessionMode = null;\nlet showRankingBetweenQuestions = false;\nlet showRankingBetweenQuestionsSwitch = false;\nlet showRankingFinal = false;\nlet groupMode = false;\nlet currentQuestionDataForRace = {};\nlet cloudTags = [];\nlet voting = false;\n\n/**\n * @constructor\n * @param {String} region\n * @param {String} socketurl\n * @param {String} port\n * @param {String} sessionmode\n * @param {Boolean} groupmode\n */\nfunction Sockets(region, socketurl, port, sessionmode, groupmode) {\n    this.root = jQuery(region);\n    socketUrl = socketurl;\n    portUrl = port;\n    userid = this.root[0].dataset.userid;\n    username = this.root[0].dataset.username;\n    userimage = this.root[0].dataset.userimage;\n    cmid = this.root[0].dataset.cmid;\n    sid = this.root[0].dataset.sid;\n    messageBox = this.root.find(REGION.MESSAGEBOX);\n    countusers = this.root.find(REGION.COUNTUSERS);\n    groupMode = groupmode;\n    sessionMode = sessionmode;\n    switch (sessionMode) {\n        case 'inactive_manual':\n        default:\n            showRankingBetweenQuestions = false;\n            showRankingBetweenQuestionsSwitch = false;\n            showRankingFinal = false;\n            break;\n        case 'podium_manual':\n        case 'race_manual': {\n            let request = {\n                methodname: SERVICES.GETSESSIONCONFIG,\n                args: {\n                    sid: sid,\n                    cmid: cmid\n                }\n            };\n            Ajax.call([request])[0].done(function(response) {\n                if (response.session.showgraderanking === 1) {\n                    showRankingBetweenQuestions = true;\n                }\n                if (response.session.showfinalgrade === 1) {\n                    showRankingFinal = true;\n                }\n            }).fail(Notification.exception);\n            break;\n        }\n    }\n    this.measuringSpeed(); // TODO extend to the whole mod.\n    this.disableDevTools(); // TODO extend to the whole mod.\n    this.initSockets();\n    this.cleanMessages(); // TODO only for develop.\n    this.initListeners();\n}\n\nSockets.prototype.cleanMessages = function() {\n    setInterval(function() {\n        messageBox.find(':first-child').remove();\n    }, 10000);\n};\n\nSockets.prototype.disableDevTools = function(){\n    document.addEventListener('contextmenu', (e) => e.preventDefault());\n    document.onkeydown = (e) => {\n        return !(event.keyCode === 123 ||\n            this.ctrlShiftKey(e, 'I') ||\n            this.ctrlShiftKey(e, 'J') ||\n            this.ctrlShiftKey(e, 'C') ||\n            (e.ctrlKey && e.keyCode === 'U'.charCodeAt(0)));\n    };\n};\n\nSockets.prototype.ctrlShiftKey = function(e, keyCode) {\n    return e.ctrlKey && e.shiftKey && e.keyCode === keyCode.charCodeAt(0);\n};\n\nSockets.prototype.measuringSpeed = function() {\n    let connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;\n    if (connection) {\n        let typeConnection = connection.effectiveType;\n        let speedMbps = connection.downlink;\n        // eslint-disable-next-line no-console\n        console.log(\"Type of Connection: \" + typeConnection, \"Estimated speed: \" + speedMbps + \" Mbps\");\n        if (speedMbps < 1) {\n            let reason = {\n                effectiveType: connection.effectiveType,\n                downlink: connection.downlink\n            };\n            getString('lowspeed', 'mod_jqshow', reason).done((s) => {\n                messageBox.append(\n                    '<div class=\"alert alert-danger\" role=\"alert\">' + s + '</div>'\n                );\n            });\n        }\n    } else {\n        // eslint-disable-next-line no-console\n        console.error(\"Connection speed detection is not supported in this browser.\");\n    }\n};\n\nSockets.prototype.backSession = function() {\n    const stringkeys = [\n        {key: 'backtopanelfromsession', component: 'mod_jqshow'},\n        {key: 'backtopanelfromsession_desc', component: 'mod_jqshow'},\n        {key: 'confirm', component: 'mod_jqshow'}\n    ];\n    getStrings(stringkeys).then((langStrings) => {\n        return ModalFactory.create({\n            title: langStrings[0],\n            body: langStrings[1],\n            type: ModalFactory.types.SAVE_CANCEL\n        }).then(modal => {\n            modal.setSaveButtonText(langStrings[2]);\n            modal.getRoot().on(ModalEvents.save, () => {\n                let request = {\n                    methodname: SERVICES.ACTIVESESSION,\n                    args: {\n                        cmid: cmid,\n                        sessionid: sid\n                    }\n                };\n                Ajax.call([request])[0].done(function() {\n                    window.location.replace(M.cfg.wwwroot + '/mod/jqshow/view.php?id=' + cmid);\n                }).fail(Notification.exception);\n            });\n            modal.getRoot().on(ModalEvents.hidden, () => {\n                modal.destroy();\n            });\n            return modal;\n        });\n    }).done(function(modal) {\n        modal.show();\n        // eslint-disable-next-line no-restricted-globals\n    }).fail(Notification.exception);\n};\n\n/* ****************** */\n\n/** @type {jQuery} The jQuery node for the page region. */\nSockets.prototype.root = null;\n\nSockets.prototype.initSockets = function() {\n    let that = this;\n    this.root.find(ACTION.BACKSESSION).on('click', this.backSession);\n    this.root.find(ACTION.CLOSEIMPROVISE).on('click', this.closeImprovise);\n    this.root.find(ACTION.SUBMITIMPROVISE).on('click', this.submitImprovise);\n\n    db = Database.initDb(sid, userid);\n    Sockets.prototype.webSocket = new WebSocket(\n        'wss://' + socketUrl.replace(/^https?:\\/\\//, '') + ':' + portUrl + '/jqshow'\n    );\n\n    Sockets.prototype.webSocket.onopen = function() { // Waitingroom.\n        /* The first and second questions are obtained.\n        When the teacher clicks on init session, the teacher will send the first question over the socket to all\n        students, and will get the 3rd question. When a student answers a question, a service will be called to save the answer\n        and progress, and the teacher will be informed via the socket. When the teacher clicks on next question,\n        the 2nd question will be sent by socket to all students, and the 3th question will be obtained.\n        The questions will be stored in the teacher's data storage, you can even store the user's answers so that you\n        don't have to call a service at the end for the ranking.\n        */\n\n        let request = {\n            methodname: SERVICES.FIRSTQUESTION,\n            args: {\n                cmid: cmid,\n                sessionid: sid\n            }\n        };\n        Ajax.call([request])[0].done(function(firstquestion) {\n            let data = {\n                jqid: firstquestion.jqid,\n                value: firstquestion\n            };\n            db.add('questions', data);\n            questionsJqids.push(firstquestion.jqid);\n            currentQuestionJqid = firstquestion.jqid;\n            that.setCurrentQuestion(firstquestion.jqid);\n            that.getNextQuestion(firstquestion.jqid);\n            that.root.find(ACTION.INITSESSION).removeClass('disabled');\n            that.root.find(ACTION.INITSESSION).on('click', that.initSession);\n            that.root.find(ACTION.ENDSESSION).on('click', that.endSession);\n        }).fail(Notification.exception);\n    };\n\n    Sockets.prototype.webSocket.onmessage = function(ev) {\n        let msgDecrypt = Encryptor.decrypt(ev.data);\n        let response = JSON.parse(msgDecrypt); // PHP sends Json data.\n        switch (response.action) {\n            case 'connect':\n                // The server has returned the connected status, it is time to identify yourself.\n                if (response.usersocketid !== undefined) {\n                    usersocketid = response.usersocketid;\n                    let msg = {\n                        'userid': userid,\n                        'name': username,\n                        'pic': userimage,\n                        'isteacher': true,\n                        'cmid': cmid,\n                        'sid': sid,\n                        'usersocketid': usersocketid,\n                        'action': 'newuser'\n                    };\n                    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n                }\n                break;\n            case 'newuser': {\n                let identifier = jQuery(REGION.USERLIST);\n                let data = response.students;\n                identifier.html('');\n                if (waitingRoom === false) {\n                    Sockets.prototype.normalizeUser(response.usersocketid);\n                }\n                jQuery.each(data, function(i, student) {\n                    let templateContext = {\n                        'usersocketid': student.usersocketid,\n                        'userimage': student.picture,\n                        'userfullname': student.name,\n                    };\n                    Templates.render(TEMPLATES.PARTICIPANT, templateContext).then(function(html) {\n                        identifier.append(html);\n                    }).fail(Notification.exception);\n                });\n                countusers.html(response.count);\n                break;\n            }\n            case 'newgroup': {\n                let participantshtml = jQuery(REGION.USERLIST);\n                let grouplist = response.groups;\n                participantshtml.html('');\n                jQuery.each(grouplist, function (i, group) {\n                    let templateContext = {\n                        'usersocketid': group.usersocketid,\n                        'groupimage': group.picture,\n                        'groupid': group.groupid,\n                        'name': group.name,\n                        'numgroupusers': group.numgroupusers,\n                    };\n                    Templates.render(TEMPLATES.GROUPPARTICIPANT, templateContext).then(function(html) {\n                        participantshtml.append(html);\n                    }).fail(Notification.exception);\n                });\n                countusers.html(response.count);\n                break;\n            }\n            case 'countusers':\n                countusers.html(response.count);\n                break;\n            case 'studentQuestionEnd':\n                messageBox.append('<div>' + response.message + '</div>');\n                if (sessionMode === 'race_manual') {\n                    Sockets.prototype.raceResults();\n                }\n                break;\n            case 'userdisconnected':\n                jQuery('[data-userid=\"' + response.usersocketid + '\"]').remove();\n                countusers.html(response.count);\n                messageBox.append('<div>' + response.message + '</div>');\n                break;\n            case 'alreadyteacher':\n                messageBox.append(\n                    '<div class=\"alert alert-danger\" role=\"alert\">' + response.message + '</div>'\n                );\n                break;\n            case 'pauseQuestion':\n                dispatchEvent(new Event('pauseQuestion_' + response.jqid));\n                break;\n            case 'playQuestion':\n                dispatchEvent(new Event('playQuestion_' + response.jqid));\n                break;\n            case 'showAnswers':\n                dispatchEvent(new Event('showAnswers_' + response.jqid));\n                break;\n            case 'hideAnswers':\n                dispatchEvent(new Event('hideAnswers_' + response.jqid));\n                break;\n            case 'showStatistics':\n                dispatchEvent(new Event('showStatistics_' + response.jqid));\n                break;\n            case 'hideStatistics':\n                dispatchEvent(new Event('hideStatistics_' + response.jqid));\n                break;\n            case 'showFeedback':\n                dispatchEvent(new Event('showFeedback_' + response.jqid));\n                break;\n            case 'hideFeedback':\n                dispatchEvent(new Event('hideFeedback_' + response.jqid));\n                break;\n            case 'ImproviseStudentTag':\n                Sockets.prototype.manageCloudTags(response.improvisereply);\n                Sockets.prototype.printNewTag();\n                break;\n            case 'StudentVotedTag':\n                if (voting === true) {\n                    Sockets.prototype.manageTagsVotes(response.votedtag);\n                    Sockets.prototype.printNewTag();\n                }\n                break;\n            default:\n                break;\n        }\n        messageBox[0].scrollTop = messageBox[0].scrollHeight;\n    };\n\n    Sockets.prototype.webSocket.onerror = function() {\n        getString('system_error', 'mod_jqshow').done((s) => {\n            messageBox.append(\n                '<div class=\"alert alert-danger\" role=\"alert\">' + s + '</div>'\n            );\n        });\n        that.root.find(ACTION.INITSESSION).addClass('disabled');\n        that.root.find(ACTION.INITSESSION).off('click');\n        that.root.find(ACTION.ENDSESSION).off('click');\n    };\n\n    Sockets.prototype.webSocket.onclose = function(ev) {\n        let reason = {\n            reason: ev.reason,\n            code: ev.code\n        };\n        getString('connection_closed', 'mod_jqshow', reason).done((s) => {\n            jQuery(REGION.TEACHERCANVASCONTENT).prepend(\n                '<div class=\"alert alert-danger\" role=\"alert\">' + s + '</div>'\n            );\n        });\n        that.root.find(ACTION.INITSESSION).addClass('disabled');\n        that.root.find(ACTION.INITSESSION).off('click');\n        that.root.find(ACTION.ENDSESSION).off('click');\n    };\n};\n\nSockets.prototype.initListeners = function() {\n    let that = this;\n    addEventListener('nextQuestion', () => {\n        switch (sessionMode) {\n            case 'inactive_programmed':\n            case 'inactive_manual':\n            default:\n                that.nextQuestion();\n                break;\n            case 'podium_manual':\n            case 'podium_programmed':\n            case 'race_manual':\n            case 'race_programmed':\n                that.manageNext();\n                break;\n        }\n        // TODO send tag cloud to a service to persist it in DB for retrieval in reports..\n        cloudTags = [];\n        voting = false;\n    }, false);\n    addEventListener('pauseQuestionSelf', () => {\n        that.pauseQuestion();\n    }, false);\n    addEventListener('playQuestionSelf', () => {\n        that.playQuestion();\n    }, false);\n    addEventListener('resendSelf', () => {\n        that.resendSelf();\n    }, false);\n    addEventListener('jumpTo', (e) => {\n        that.jumpTo(e.detail.jumpTo);\n    }, false);\n    addEventListener('teacherQuestionEndSelf', () => {\n        if (sessionMode === 'race_manual') {\n            currentQuestionDataForRace.isteacher = true;\n            Templates.render(TEMPLATES.QUESTION, currentQuestionDataForRace).then(function(html, js) {\n                let identifier = jQuery(REGION.TEACHERCANVAS);\n                identifier.html(html);\n                Templates.runTemplateJS(js);\n                jQuery(REGION.SWITCHS).removeClass('disabled');\n                // TODO only improvise.\n                jQuery(REGION.ESPECIALS).removeClass('disabled');\n                setTimeout(() => {\n                    that.questionEnd();\n                    jQuery(REGION.SWITCHS).removeClass('disabled');\n                    jQuery(REGION.IMPROVISE).removeClass('disabled');\n                    jQuery(ACTION.FINISHQUESTION).addClass('d-none');\n                    jQuery(ACTION.NEXT).removeClass('d-none');\n                    jQuery(ACTION.VOTE).addClass('disabled');\n                    jQuery(ACTION.JUMP).addClass('disabled');\n                    mEvent.notifyFilterContentUpdated(document.querySelector(REGION.TEACHERCANVAS));\n                }, 250);\n            }).fail(Notification.exception);\n        } else {\n            that.questionEnd();\n        }\n        cloudTags = [];\n    }, false);\n    addEventListener('showAnswersSelf', () => {\n        that.showAnswers();\n    }, false);\n    addEventListener('hideAnswersSelf', () => {\n        that.hideAnswers();\n    }, false);\n    addEventListener('showStatisticsSelf', () => {\n        that.showStatistics();\n    }, false);\n    addEventListener('hideStatisticsSelf', () => {\n        that.hideStatistics();\n    }, false);\n    addEventListener('showFeedbackSelf', () => {\n        that.showFeedback();\n    }, false);\n    addEventListener('hideFeedbackSelf', () => {\n        that.hideFeedback();\n    }, false);\n    addEventListener('endSession', () => {\n        that.endSession();\n    }, {once: true});\n    addEventListener('improvise', () => {\n        that.improvise();\n    }, false);\n    addEventListener('initVote', () => {\n        that.vote();\n    }, false);\n};\n\nSockets.prototype.setCurrentQuestion = function(currentQuestion) {\n    let data = {\n        state: 'currentQuestion',\n        value: currentQuestion\n    };\n    db.update('statequestions', data);\n};\n\nSockets.prototype.setNextQuestion = function(nextQuestion) {\n    let data = {\n        state: 'nextQuestion',\n        value: nextQuestion\n    };\n    db.update('statequestions', data);\n};\n\nSockets.prototype.setEndSession = function(endData) {\n    db.delete('statequestions', 'nextQuestion');\n    let data = {\n        state: 'endSession',\n        value: endData\n    };\n    db.update('statequestions', data);\n    showRankingBetweenQuestionsSwitch = false;\n};\n\nSockets.prototype.getNextQuestion = function(jqid) {\n    let that = this;\n    let request = {\n        methodname: SERVICES.NEXTQUESTION,\n        args: {\n            cmid: cmid,\n            sessionid: sid,\n            jqid: jqid,\n            manual: true\n        }\n    };\n    nextQuestionJqid = null;\n    Ajax.call([request])[0].done(function(nextquestion) {\n        if (nextquestion.endsession !== true) {\n            let data = {\n                jqid: nextquestion.jqid,\n                value: nextquestion\n            };\n            db.add('questions', data);\n            nextQuestionJqid = nextquestion.jqid;\n            that.setNextQuestion(nextquestion.jqid);\n        } else {\n            // End session.\n            nextQuestionJqid = null;\n            that.setEndSession(nextquestion);\n        }\n    }).fail(Notification.exception);\n};\n\nSockets.prototype.initSession = function() {\n    db.delete('statequestions', 'endSession');\n    const stringkeys = [\n        {key: 'init_session', component: 'mod_jqshow'},\n        {key: 'init_session_desc', component: 'mod_jqshow'},\n        {key: 'confirm', component: 'mod_jqshow'},\n        {key: 'sessionstarted', component: 'mod_jqshow'},\n        {key: 'sessionstarted_info', component: 'mod_jqshow'}\n    ];\n    getStrings(stringkeys).then((langStrings) => {\n        return ModalFactory.create({\n            title: langStrings[0],\n            body: langStrings[1],\n            type: ModalFactory.types.SAVE_CANCEL\n        }).then(modal => {\n            modal.setSaveButtonText(langStrings[2]);\n            modal.getRoot().on(ModalEvents.save, () => {\n                let firstQuestion = db.get('questions', currentQuestionJqid);\n                firstQuestion.onsuccess = function() {\n                    let msg = {\n                        'action': 'question',\n                        'sid': sid,\n                        'context': firstQuestion.result\n                    };\n                    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n                    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                        Sockets.prototype.initPanel();\n                        let identifier = jQuery(REGION.TEACHERCANVAS);\n                        identifier.append(html);\n                        currentQuestionJqid = firstQuestion.result.jqid;\n                        firstQuestion.result.value.isteacher = true;\n                        currentQuestionDataForRace = firstQuestion.result.value;\n                        if (sessionMode === 'podium_manual' || sessionMode === 'inactive_manual') {\n                            Templates.render(TEMPLATES.QUESTION, firstQuestion.result.value).then(function(html, js) {\n                                identifier.html(html);\n                                Templates.runTemplateJS(js);\n                                jQuery(REGION.LOADING).remove();\n                                mEvent.notifyFilterContentUpdated(document.querySelector(REGION.TEACHERCANVAS));\n                            }).fail(Notification.exception);\n                        }\n                        if (sessionMode === 'race_manual') {\n                            Sockets.prototype.raceResults();\n                        }\n                        jQuery(REGION.TEACHERCANVASCONTENT).find('.content-title h2').html(langStrings[3]);\n                        jQuery(REGION.TEACHERCANVASCONTENT).find('.content-title small').html(langStrings[4]);\n                        jQuery(ACTION.BACKSESSION).remove();\n                        jQuery(ACTION.INITSESSION).remove();\n                        jQuery(ACTION.ENDSESSION).removeClass('hidden').removeClass('disabled');\n                        waitingRoom = false;\n                        if (showRankingBetweenQuestions) {\n                            showRankingBetweenQuestionsSwitch = true;\n                        }\n                    });\n                };\n            });\n            modal.getRoot().on(ModalEvents.hidden, () => {\n                modal.destroy();\n            });\n            return modal;\n        });\n    }).done(function(modal) {\n        modal.show();\n        // eslint-disable-next-line no-restricted-globals\n    }).fail(Notification.exception);\n};\n\nSockets.prototype.initPanel = function() {\n    let requestResume = {\n        methodname: SERVICES.GETSESSIONRESUME,\n        args: {\n            sid: sid,\n            cmid: cmid,\n        }\n    };\n    Ajax.call([requestResume])[0].done(function(responseResume) {\n        Templates.render(TEMPLATES.SESSIONRESUME, responseResume).then(function(html) {\n            jQuery(REGION.SESSIONRESUME).append(html);\n        });\n    });\n    let methodname = SERVICES.GETLISTRESULTS;\n    if (groupMode === true) {\n        methodname = SERVICES.GETGROUPLISTRESULTS;\n    }\n    setInterval(function() {\n        let requestResults = {\n            methodname: methodname,\n            args: {\n                sid: sid,\n                cmid: cmid,\n            }\n        };\n        Ajax.call([requestResults])[0].done(function(responseResults) {\n            Templates.render(TEMPLATES.LISTRESULTS, responseResults).then(function(html) {\n                jQuery(REGION.LISTRESULTS).html(html);\n            });\n        });\n    }, 20000);\n    jQuery(REGION.TEACHERPANEL).removeClass('d-none');\n};\n\nSockets.prototype.endSession = function() {\n    const stringkeys = [\n        {key: 'end_session', component: 'mod_jqshow'},\n        {key: 'end_session_manual_desc', component: 'mod_jqshow'},\n        {key: 'confirm', component: 'mod_jqshow'},\n        {key: 'end_session_error', component: 'mod_jqshow'}\n    ];\n    getStrings(stringkeys).then((langStrings) => {\n        return ModalFactory.create({\n            title: langStrings[0],\n            body: langStrings[1],\n            type: ModalFactory.types.SAVE_CANCEL\n        }).then(modal => {\n            modal.setSaveButtonText(langStrings[2]);\n            modal.getRoot().on(ModalEvents.save, () => {\n                let request = {\n                    methodname: SERVICES.FINISHSESSION,\n                    args: {\n                        cmid: cmid,\n                        sessionid: sid\n                    }\n                };\n                Ajax.call([request])[0].done(function(response) {\n                    if (response.finished === true) {\n                        let deleteDb = db.deleteDatabase();\n                        deleteDb.onerror = function(event) {\n                            // eslint-disable-next-line no-console\n                            console.error(\"Error deleting database.\", event);\n                        };\n                        deleteDb.onsuccess = function() {\n                            window.location.replace(M.cfg.wwwroot + '/mod/jqshow/view.php?id=' + cmid);\n                        };\n                    } else {\n                        Notification.alert('Error', langStrings[3], langStrings[2]);\n                    }\n                }).fail(Notification.exception);\n            });\n            modal.getRoot().on(ModalEvents.hidden, () => {\n                modal.destroy();\n            });\n            return modal;\n        });\n    }).done(function(modal) {\n        modal.show();\n        // eslint-disable-next-line no-restricted-globals\n    }).fail(Notification.exception);\n};\n\nSockets.prototype.nextQuestion = function() {\n    let that = this;\n    if (nextQuestionJqid === null) {\n        this.getNextQuestion(currentQuestionJqid);\n    }\n    let nextQuestion = db.get('statequestions', 'nextQuestion');\n    nextQuestion.onsuccess = function() {\n        if (nextQuestion.result !== undefined) {\n            let nextQuestionData = db.get('questions', nextQuestion.result.value);\n            nextQuestionData.onsuccess = function() {\n                let msg = {\n                    'action': 'question',\n                    'sid': sid,\n                    'context': nextQuestionData.result\n                };\n                currentQuestionDataForRace = nextQuestionData.result.value;\n                Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n                let removeEvents = new CustomEvent('removeEvents');\n                dispatchEvent(removeEvents);\n                Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                    let identifier = jQuery(REGION.TEACHERCANVAS);\n                    identifier.append(html);\n                    currentQuestionJqid = nextQuestionData.result.jqid;\n                    // The following question is marked as current.\n                    that.setCurrentQuestion(nextQuestionData.result.jqid);\n                    // And get the next question to store it.\n                    that.getNextQuestion(nextQuestionData.result.jqid);\n                    if (sessionMode === 'podium_manual' || sessionMode === 'inactive_manual') {\n                        nextQuestionData.result.value.isteacher = true;\n                        // Render questin for teacher.\n                        Templates.render(TEMPLATES.QUESTION, nextQuestionData.result.value).then(function(html, js) {\n                            identifier.html(html);\n                            Templates.runTemplateJS(js);\n                            mEvent.notifyFilterContentUpdated(document.querySelector(REGION.TEACHERCANVAS));\n                            jQuery(REGION.LOADING).remove();\n                        }).fail(Notification.exception);\n                    }\n                    if (sessionMode === 'race_manual') {\n                        Sockets.prototype.raceResults();\n                    }\n                });\n            };\n        } else {\n            let endSession = db.get('statequestions', 'endSession');\n            if (showRankingFinal === false) {\n                endSession.onsuccess = function() {\n                    let msg = {\n                        'action': 'endSession',\n                        'sid': sid,\n                        'context': endSession.result\n                    };\n                    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n                    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                        let identifier = jQuery(REGION.TEACHERCANVAS);\n                        identifier.append(html);\n                        currentQuestionJqid = null;\n                        db.delete('statequestions', 'currentQuestion');\n                        that.setEndSession(endSession.result);\n                        endSession.result.value.isteacher = true;\n                        Templates.render(TEMPLATES.QUESTION, endSession.result.value).then(function(html, js) {\n                            identifier.html(html);\n                            Templates.runTemplateJS(js);\n                            jQuery(REGION.LOADING).remove();\n                        }).fail(Notification.exception);\n                    });\n                };\n            } else {\n                endSession.onsuccess = function() {\n                    let request = {\n                        methodname: SERVICES.GETFINALRANKING,\n                        args: {\n                            sid: sid,\n                            cmid: cmid\n                        }\n                    };\n                    Ajax.call([request])[0].done(function(finalRanking) {\n                        endSession.result.value = finalRanking;\n                        let msg = {\n                            'action': 'endSession',\n                            'sid': sid,\n                            'context': endSession.result\n                        };\n                        Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n                        Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                            let identifier = jQuery(REGION.TEACHERCANVAS);\n                            identifier.append(html);\n                            currentQuestionJqid = null;\n                            db.delete('statequestions', 'currentQuestion');\n                            that.setEndSession(endSession.result);\n                            endSession.result.value.isteacher = true;\n                            Templates.render(TEMPLATES.QUESTION, endSession.result.value).then(function(html, js) {\n                                identifier.html(html);\n                                Templates.runTemplateJS(js);\n                                jQuery(REGION.LOADING).remove();\n                            }).fail(Notification.exception);\n                        });\n                    }).fail(Notification.exception);\n                };\n            }\n        }\n    };\n};\n\nSockets.prototype.raceResults = function() {\n    let identifier = jQuery(REGION.TEACHERCANVAS);\n    let request = {\n        methodname: SERVICES.GETRACERESULTS,\n        args: {\n            sid: sid,\n            cmid: cmid\n        }\n    };\n    Ajax.call([request])[0].done(function(response) {\n        response.raceresults = true;\n        response.isteacher = true;\n        response.programmedmode = false;\n        response.sessionprogress = currentQuestionDataForRace.sessionprogress;\n        // eslint-disable-next-line camelcase\n        response.question_index_string = currentQuestionDataForRace.question_index_string;\n        response.numquestions = currentQuestionDataForRace.numquestions;\n        Templates.render(TEMPLATES.QUESTION, response).then((html, js) => {\n            let scrollUsersTop = 0;\n            let scrollQuestionsLeft = 0;\n            if (document.querySelector('#content-users') !== null) {\n                scrollUsersTop = document.querySelector('#content-users').scrollTop;\n                scrollQuestionsLeft = document.querySelector('#questions-list').scrollLeft;\n            }\n            identifier.html(html);\n            Templates.runTemplateJS(js);\n            let newScrollUsers = document.querySelector('#content-users');\n            let newScrollQuestions = document.querySelector('#questions-list');\n            let scrollUsers = document.querySelector('#content-users');\n            let questions = document.querySelectorAll('.content-responses');\n            scrollUsers.addEventListener('scroll', function() {\n                questions.forEach((question) => {\n                    question.scrollTop = scrollUsers.scrollTop;\n                });\n            }, {passive: true});\n            newScrollUsers.scrollTop = scrollUsersTop;\n            newScrollQuestions.scrollLeft = scrollQuestionsLeft;\n        }).fail(Notification.exception);\n    }).fail(Notification.exception);\n};\n\nSockets.prototype.manageNext = function() {\n    let that = this;\n    if (showRankingBetweenQuestions === false) {\n        that.nextQuestion();\n    } else {\n        if (showRankingBetweenQuestionsSwitch === false) {\n            that.nextQuestion();\n            showRankingBetweenQuestionsSwitch = true;\n        } else {\n            let request = {\n                methodname: SERVICES.GETPROVISIONALRANKING,\n                args: {\n                    sid: sid,\n                    cmid: cmid,\n                    jqid: currentQuestionJqid\n                }\n            };\n            Ajax.call([request])[0].done(function(provisionalRanking) {\n                let msg = {\n                    'action': 'ranking',\n                    'sid': sid,\n                    'context': provisionalRanking\n                };\n                Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n                showRankingBetweenQuestionsSwitch = false;\n                Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                    let identifier = jQuery(REGION.TEACHERCANVAS);\n                    identifier.append(html);\n                    provisionalRanking.isteacher = true;\n                    Templates.render(TEMPLATES.PROVISIONALRANKING, provisionalRanking).then(function(html, js) {\n                        identifier.html(html);\n                        Templates.runTemplateJS(js);\n                        jQuery(REGION.LOADING).remove();\n                    }).fail(Notification.exception);\n                });\n            }).fail(Notification.exception);\n        }\n    }\n};\n\nSockets.prototype.pauseQuestion = function() {\n    let msg = {\n        'action': 'pauseQuestion',\n        'sid': sid,\n        'jqid': currentQuestionJqid\n    };\n    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n};\n\nSockets.prototype.playQuestion = function() {\n    let msg = {\n        'action': 'playQuestion',\n        'sid': sid,\n        'jqid': currentQuestionJqid\n    };\n    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n};\n\nSockets.prototype.resendSelf = function() {\n    let request = {\n        methodname: SERVICES.DELETERESPONSES,\n        args: {\n            cmid: cmid,\n            sessionid: sid,\n            jqid: currentQuestionJqid\n        }\n    };\n    let removeEvents = new CustomEvent('removeEvents');\n    dispatchEvent(removeEvents);\n    Ajax.call([request])[0].done(function(response) {\n        if (response.deleted === true) {\n            let currentQuestionData = db.get('questions', currentQuestionJqid);\n            currentQuestionData.onsuccess = function() {\n                let msg = {\n                    'action': 'question',\n                    'sid': sid,\n                    'context': currentQuestionData.result\n                };\n                Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n                showRankingBetweenQuestionsSwitch = true;\n                currentQuestionDataForRace = currentQuestionData.result.value;\n                if (sessionMode === 'race_manual') {\n                    Sockets.prototype.raceResults();\n                } else {\n                    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                        let identifier = jQuery(REGION.TEACHERCANVAS);\n                        identifier.append(html);\n                        currentQuestionData.result.value.isteacher = true;\n                        Templates.render(TEMPLATES.QUESTION, currentQuestionData.result.value).then(function(html, js) {\n                            identifier.html(html);\n                            Templates.runTemplateJS(js);\n                            mEvent.notifyFilterContentUpdated(document.querySelector(REGION.TEACHERCANVAS));\n                            jQuery(REGION.LOADING).remove();\n                        }).fail(Notification.exception);\n                    });\n                }\n            };\n        }\n    }).fail(Notification.exception);\n};\n\nSockets.prototype.jumpTo = function(questionNumber) {\n    let that = this;\n    let request = {\n        methodname: SERVICES.JUMPTOQUESTION,\n        args: {\n            cmid: cmid,\n            sessionid: sid,\n            position: questionNumber,\n            manual: true\n        }\n    };\n    nextQuestionJqid = null;\n    let removeEvents = new CustomEvent('removeEvents');\n    dispatchEvent(removeEvents);\n    Ajax.call([request])[0].done(function(question) {\n        let data = {\n            jqid: question.jqid,\n            value: question\n        };\n        db.add('questions', data);\n        currentQuestionJqid = question.jqid;\n        that.setCurrentQuestion(question.jqid);\n        that.getNextQuestion(question.jqid);\n        let msg = {\n            'action': 'question',\n            'sid': sid,\n            'context': data\n        };\n        Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n        showRankingBetweenQuestionsSwitch = true;\n        Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n            let identifier = jQuery(REGION.TEACHERCANVAS);\n            identifier.append(html);\n            question.isteacher = true;\n            currentQuestionDataForRace = question;\n            if (sessionMode === 'race_manual') {\n                Sockets.prototype.raceResults();\n            } else {\n                Templates.render(TEMPLATES.QUESTION, question).then(function(html, js) {\n                    identifier.html(html);\n                    Templates.runTemplateJS(js);\n                    mEvent.notifyFilterContentUpdated(document.querySelector(REGION.TEACHERCANVAS));\n                    jQuery(REGION.LOADING).remove();\n                }).fail(Notification.exception);\n            }\n        });\n    }).fail(Notification.exception);\n};\n\nSockets.prototype.questionEnd = function() {\n    let request = {\n        methodname: SERVICES.GETQUESTIONSTATISTICS,\n        args: {\n            sid: sid,\n            jqid: currentQuestionJqid\n        }\n    };\n    Ajax.call([request])[0].done(function(response) {\n        let msg = {\n            'action': 'teacherQuestionEnd',\n            'sid': sid,\n            'jqid': currentQuestionJqid,\n            'statistics': response.statistics\n        };\n        Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n        dispatchEvent(new CustomEvent('teacherQuestionEnd_' + currentQuestionJqid, {\n            \"detail\": {\"statistics\": response.statistics}\n        }));\n    }).fail(Notification.exception);\n};\n\nSockets.prototype.showAnswers = function() {\n    let msg = {\n        'action': 'showAnswers',\n        'sid': sid,\n        'jqid': currentQuestionJqid\n    };\n    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n};\n\nSockets.prototype.hideAnswers = function() {\n    let msg = {\n        'action': 'hideAnswers',\n        'sid': sid,\n        'jqid': currentQuestionJqid\n    };\n    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n};\n\nSockets.prototype.showStatistics = function() {\n    let msg = {\n        'action': 'showStatistics',\n        'sid': sid,\n        'jqid': currentQuestionJqid\n    };\n    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n};\n\nSockets.prototype.hideStatistics = function() {\n    let msg = {\n        'action': 'hideStatistics',\n        'sid': sid,\n        'jqid': currentQuestionJqid\n    };\n    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n};\n\nSockets.prototype.showFeedback = function() {\n    let msg = {\n        'action': 'showFeedback',\n        'sid': sid,\n        'jqid': currentQuestionJqid\n    };\n    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n};\n\nSockets.prototype.hideFeedback = function() {\n    let msg = {\n        'action': 'hideFeedback',\n        'sid': sid,\n        'jqid': currentQuestionJqid\n    };\n    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n};\n\nSockets.prototype.closeImprovise = function() {\n    let msg = {\n        'action': 'closeImprovise',\n        'sid': sid\n    };\n    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n    jQuery(REGION.IMPROVISE).addClass('d-none');\n    jQuery(REGION.TEACHERCANVAS).addClass('d-flex').removeClass('d-none');\n};\n\nSockets.prototype.improvise = function() {\n    let msg = {\n        'action': 'improvising',\n        'sid': sid\n    };\n    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n    jQuery(REGION.IMPROVISE).removeClass('d-none');\n    jQuery(REGION.TEACHERCANVAS).removeClass('d-flex').addClass('d-none');\n};\n\nSockets.prototype.submitImprovise = function() {\n    let improviseStatement = jQuery(REGION.IMPROVISESTATEMENT).val();\n    let improviseReply = jQuery(REGION.IMPROVISEREPLY).val();\n    if (improviseStatement === '') {\n        jQuery(REGION.IMPROVISESTATEMENT).focus(() => {\n            jQuery(REGION.IMPROVISESTATEMENT).css({'border-color': 'red'});\n        });\n    } else {\n        jQuery(REGION.IMPROVISESTATEMENT).val('');\n        jQuery(REGION.IMPROVISEREPLY).val('');\n        let msg = {\n            'action': 'improvised',\n            'sid': sid,\n            'improvisestatement': improviseStatement,\n            'improvisereply': improviseReply,\n            'cmid': cmid\n        };\n        Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n        Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n            jQuery(REGION.IMPROVISE).addClass('d-none');\n            jQuery(REGION.TEACHERCANVAS).addClass('d-flex').removeClass('d-none');\n            let identifier = jQuery(REGION.TEACHERCANVAS);\n            identifier.append(html);\n            if (improviseReply !== '') {\n                Sockets.prototype.manageCloudTags(improviseReply);\n            }\n            let cloudtagsData = {\n                'sessionid': sid,\n                'cmid': cmid,\n                'improvised': true,\n                'sessionprogress': 0,\n                'cloudtags': true,\n                'isteacher': true,\n                'questiontext': improviseStatement,\n                'programmedmode': false,\n                'preview': false,\n                'tags': cloudTags\n            };\n            Templates.render(TEMPLATES.QUESTION, cloudtagsData).then(function(html, js) {\n                identifier.html(html);\n                jQuery('[data-action=\"delete-tag\"]').on('click', Sockets.prototype.deleteTag.bind(this));\n                Templates.runTemplateJS(js);\n                jQuery(REGION.LOADING).remove();\n                jQuery(REGION.VOTEIMPROVISE).removeClass('disabled');\n            }).fail(Notification.exception);\n        });\n    }\n};\n\nSockets.prototype.manageCloudTags = function(newtag) {\n    if (newtag !== '') {\n        let exist = false;\n        if (cloudTags.length) {\n            cloudTags = cloudTags.map((tag) => {\n                if (tag.name.toLowerCase() === newtag.toLowerCase()) {\n                    tag.count = tag.count + 1;\n                    tag.votenum = 0;\n                    exist = true;\n                }\n                return tag;\n            });\n        }\n        if (!exist) {\n            cloudTags.push({name: newtag, count: 1, votenum: 0});\n        }\n        const maxCount = Math.max(...cloudTags.map(item => item.count));\n        cloudTags.forEach((item) => {\n            item.size = Math.ceil((item.count / maxCount) * 10);\n        });\n    }\n};\n\nSockets.prototype.manageTagsVotes = function(voteTag) {\n    if (cloudTags.length) {\n        cloudTags = cloudTags.map((tag) => {\n            if (tag.name.toLowerCase() === voteTag.toLowerCase()) {\n                tag.votenum = tag.votenum + 1;\n            }\n            return tag;\n        });\n        const maxCount = Math.max(...cloudTags.map(item => item.votenum));\n        cloudTags.forEach((item) => {\n            item.size = Math.ceil((item.votenum / maxCount) * 10);\n        });\n    }\n};\n\nSockets.prototype.printNewTag = function() {\n    let htmlTags = '';\n    cloudTags.forEach(tag => {\n        htmlTags +=\n            '<li><span class=\"tag\" data-count=\"' + tag.count + '\" data-vote=\"' + tag.votenum + '\"  data-size=\"' + tag.size + '\">' +\n                '<div class=\"delete-tag\" data-name=\"' + tag.name + '\" data-action=\"delete-tag\">' +\n                    'x' +\n                '</div>' +\n            tag.name +\n            '</span></li>';\n    });\n    jQuery(REGION.TAGSCONTENT).html(htmlTags);\n    jQuery('[data-action=\"delete-tag\"]').on('click', Sockets.prototype.deleteTag.bind(this));\n    let msg = {\n        'action': 'printNewTag',\n        'sid': sid,\n        'tags': cloudTags\n    };\n    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n};\n\nSockets.prototype.deleteTag = function(e) {\n    let nameToDelete = jQuery(e.currentTarget).attr('data-name');\n    if (cloudTags.length) {\n        const indexToDelete = cloudTags.findIndex(item => item.name === nameToDelete);\n        if (indexToDelete !== -1) {\n            cloudTags.splice(indexToDelete, 1);\n        }\n    }\n    Sockets.prototype.printNewTag();\n};\n\nSockets.prototype.vote = function() {\n    voting = true;\n    jQuery(REGION.VOTEIMPROVISE).addClass('disabled');\n    jQuery(REGION.CLOUDTAGS).attr('data-show-votes', true);\n    jQuery(REGION.CLOUDTAGS).attr('data-show-value', false);\n    let msg = {\n        'action': 'initVote',\n        'sid': sid\n    };\n    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n};\n\nSockets.prototype.normalizeUser = function(usersocketid) {\n    let currentQuestion = db.get('statequestions', 'currentQuestion');\n    currentQuestion.onsuccess = function() {\n        let currentQuestiondata = db.get('questions', currentQuestion.result.value);\n        currentQuestiondata.onsuccess = function() {\n            let msg = {\n                'action': 'normalizeUser',\n                'sid': sid,\n                'ofs': true, // Only for student.\n                'usersocketid': usersocketid,\n                'context': currentQuestiondata.result\n            };\n            Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n        };\n    };\n};\n\nSockets.prototype.sendMessageSocket = function(msg) {\n    this.webSocket.send(msg);\n};\n\nexport const teacherInitSockets = (region, socketurl, port, sessionmode, groupmode) => {\n    return new Sockets(region, socketurl, port, sessionmode, groupmode);\n};\n"],"names":["_interopRequireDefault","obj","__esModule","default","_toConsumableArray","arr","_arrayWithoutHoles","Array","isArray","_arrayLikeToArray","iter","Symbol","iterator","from","_iterableToArray","o","minLen","n","Object","prototype","toString","call","slice","constructor","name","test","_unsupportedIterableToArray","TypeError","_nonIterableSpread","len","length","i","arr2","defineProperty","_exports","value","teacherInitSockets","_jquery","_templates","_notification","_modal_factory","_modal_events","_ajax","_encryptor","_database","_event","REGION","MESSAGEBOX","USERLIST","COUNTUSERS","TEACHERCANVASCONTENT","TEACHERCANVAS","TEACHERPANEL","SESSIONCONTROLER","SESSIONRESUME","LISTRESULTS","RACERESULTS","SWITCHS","ESPECIALS","VOTEIMPROVISE","CLOUDTAGS","IMPROVISE","IMPROVISESTATEMENT","IMPROVISEREPLY","TAGSCONTENT","ACTION","SERVICES","ACTIVESESSION","GETALLQUESTIONS","NEXTQUESTION","FIRSTQUESTION","FINISHSESSION","DELETERESPONSES","JUMPTOQUESTION","GETSESSIONRESUME","GETLISTRESULTS","GETGROUPLISTRESULTS","GETQUESTIONSTATISTICS","GETSESSIONCONFIG","GETPROVISIONALRANKING","GETFINALRANKING","GETRACERESULTS","TEMPLATES","socketUrl","portUrl","userid","usersocketid","username","userimage","messageBox","countusers","cmid","sid","db","questionsJqids","waitingRoom","currentQuestionJqid","nextQuestionJqid","sessionMode","showRankingBetweenQuestions","showRankingBetweenQuestionsSwitch","showRankingFinal","groupMode","currentQuestionDataForRace","cloudTags","voting","Sockets","region","socketurl","port","sessionmode","groupmode","this","root","jQuery","dataset","find","request","methodname","args","Ajax","done","response","session","showgraderanking","showfinalgrade","fail","Notification","exception","measuringSpeed","disableDevTools","initSockets","cleanMessages","initListeners","setInterval","remove","_this","document","addEventListener","e","preventDefault","onkeydown","event","keyCode","ctrlShiftKey","ctrlKey","charCodeAt","shiftKey","connection","navigator","mozConnection","webkitConnection","typeConnection","effectiveType","speedMbps","downlink","console","log","reason","getString","get_string","s","append","error","backSession","getStrings","key","component","then","langStrings","ModalFactory","create","title","body","type","types","SAVE_CANCEL","modal","setSaveButtonText","getRoot","on","ModalEvents","save","sessionid","window","location","replace","M","cfg","wwwroot","hidden","destroy","show","that","closeImprovise","submitImprovise","Database","initDb","webSocket","WebSocket","onopen","firstquestion","data","jqid","add","push","setCurrentQuestion","getNextQuestion","removeClass","initSession","endSession","onmessage","ev","msgDecrypt","Encryptor","decrypt","JSON","parse","action","undefined","msg","pic","isteacher","sendMessageSocket","stringify","identifier","students","html","normalizeUser","each","student","templateContext","picture","userfullname","Templates","render","count","participantshtml","grouplist","groups","group","groupimage","groupid","numgroupusers","message","raceResults","dispatchEvent","Event","manageCloudTags","improvisereply","printNewTag","manageTagsVotes","votedtag","scrollTop","scrollHeight","onerror","addClass","off","onclose","code","prepend","nextQuestion","manageNext","pauseQuestion","playQuestion","resendSelf","jumpTo","detail","js","runTemplateJS","setTimeout","questionEnd","mEvent","notifyFilterContentUpdated","querySelector","showAnswers","hideAnswers","showStatistics","hideStatistics","showFeedback","hideFeedback","once","improvise","vote","currentQuestion","state","update","setNextQuestion","setEndSession","endData","delete","manual","nextquestion","endsession","firstQuestion","get","onsuccess","context","result","visible","initPanel","LOADING","requestResume","responseResume","requestResults","responseResults","finished","deleteDb","deleteDatabase","alert","nextQuestionData","removeEvents","CustomEvent","finalRanking","raceresults","programmedmode","sessionprogress","question_index_string","numquestions","scrollUsersTop","scrollQuestionsLeft","scrollLeft","newScrollUsers","newScrollQuestions","scrollUsers","questions","querySelectorAll","forEach","question","passive","provisionalRanking","deleted","currentQuestionData","questionNumber","position","statistics","improviseStatement","val","improviseReply","focus","css","improvisestatement","cloudtagsData","improvised","cloudtags","questiontext","preview","tags","deleteTag","bind","newtag","exist","map","tag","toLowerCase","votenum","maxCount","Math","max","apply","item","size","ceil","voteTag","htmlTags","nameToDelete","currentTarget","attr","indexToDelete","findIndex","splice","currentQuestiondata","ofs","send"],"mappings":"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"}