{"version":3,"file":"teachersockets.min.js","sources":["../src/teachersockets.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n// Project implemented by the \"Recovery, Transformation and Resilience Plan.\n// Funded by the European Union - Next GenerationEU\".\n//\n// Produced by the UNIMOODLE University Group: Universities of\n// Valladolid, Complutense de Madrid, UPV/EHU, León, Salamanca,\n// Illes Balears, Valencia, Rey Juan Carlos, La Laguna, Zaragoza, Málaga,\n// Córdoba, Extremadura, Vigo, Las Palmas de Gran Canaria y Burgos..\n\n/**\n *\n * @module    mod_kuet/teachersockets\n * @copyright  2023 Proyecto UNIMOODLE {@link https://unimoodle.github.io}\n * @author     UNIMOODLE Group (Coordinator) <direccion.area.estrategia.digital@uva.es>\n * @author     3IPUNT <contacte@tresipunt.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n\"use strict\";\nimport jQuery from 'jquery';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\nimport {get_string as getString, get_strings as getStrings} from 'core/str';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport Ajax from 'core/ajax';\nimport Encryptor from 'mod_kuet/encryptor';\nimport Database from 'mod_kuet/database';\nimport mEvent from 'core/event';\n\nlet REGION = {\n    MESSAGEBOX: '#message-box',\n    USERLIST: '[data-region=\"active-users\"]',\n    COUNTUSERS: '#countusers',\n    TEACHERCANVASCONTENT: '[data-region=\"teacher-canvas-content\"]', // This root.\n    TEACHERCANVAS: '[data-region=\"teacher-canvas\"]',\n    TEACHERPANEL: '[data-region=\"teacher-panel\"]',\n    SESSIONCONTROLER: '[data-region=\"session-controller\"]',\n    SESSIONRESUME: '[data-region=\"session-resume\"]',\n    LISTRESULTS: '[data-region=\"list-results\"]',\n    RACERESULTS: '[data-region=\"race-results\"]',\n    SWITCHS: '.showhide-action',\n    ESPECIALS: '.special-action',\n    VOTEIMPROVISE: '.special-action.vote-question',\n    CLOUDTAGS: '.cloud',\n    IMPROVISE: '[data-region=\"teacher-improvise\"]',\n    IMPROVISESTATEMENT: '.improvise-form #statement',\n    IMPROVISEREPLY: '.improvise-form #reply_improvise',\n    TAGSCONTENT: '[data-region=\"tags-content\"]',\n};\n\nlet ACTION = {\n    BACKSESSION: '[data-action=\"back-session\"]',\n    INITSESSION: '[data-action=\"init-session\"]',\n    ENDSESSION: '[data-action=\"end-session\"]',\n    CLOSEIMPROVISE: '[data-action=\"close-improvise\"]',\n    SUBMITIMPROVISE: '[data-action=\"submit-improvise\"]',\n    NEXT: '[data-action=\"next\"]',\n    VOTE: '[data-action=\"vote\"]',\n    JUMP: '[data-action=\"jump\"]',\n    FINISHQUESTION: '[data-action=\"finishquestion\"]',\n};\n\nlet SERVICES = {\n    ACTIVESESSION: 'mod_kuet_activesession',\n    NEXTQUESTION: 'mod_kuet_nextquestion',\n    FIRSTQUESTION: 'mod_kuet_firstquestion',\n    FINISHSESSION: 'mod_kuet_finishsession',\n    DELETERESPONSES: 'mod_kuet_deleteresponses',\n    JUMPTOQUESTION: 'mod_kuet_jumptoquestion',\n    GETSESSIONRESUME: 'mod_kuet_getsessionresume',\n    GETLISTRESULTS: 'mod_kuet_getlistresults',\n    GETGROUPLISTRESULTS: 'mod_kuet_getgrouplistresults',\n    GETQUESTIONSTATISTICS: 'mod_kuet_getquestionstatistics',\n    GETSESSIONCONFIG: 'mod_kuet_getsession',\n    GETPROVISIONALRANKING: 'mod_kuet_getprovisionalranking',\n    GETFINALRANKING: 'mod_kuet_getfinalranking',\n    GETRACERESULTS: 'mod_kuet_getraceresults'\n};\n\nlet TEMPLATES = {\n    LOADING: 'core/overlay_loading',\n    SUCCESS: 'core/notification_success',\n    ERROR: 'core/notification_error',\n    PARTICIPANT: 'mod_kuet/session/manual/waitingroom/participant',\n    GROUPPARTICIPANT: 'mod_kuet/session/manual/waitingroom/groupparticipant',\n    QUESTION: 'mod_kuet/questions/encasement',\n    SESSIONRESUME: 'mod_kuet/session/sessionresume',\n    LISTRESULTS: 'mod_kuet/session/listresults',\n    PROVISIONALRANKING: 'mod_kuet/ranking/provisional',\n    RACERESULTS: 'mod_kuet/session/raceresults'\n};\n\nlet socketUrl = '';\nlet portUrl = '8080'; // It is rewritten in the constructor.\nlet userid = null;\nlet usersocketid = null;\nlet username = null;\nlet userimage = null;\nlet messageBox = null;\nlet countusers = null;\nlet cmid = null;\nlet sid = null;\nlet db = null;\nlet questionsKids = [];\nlet waitingRoom = true;\nlet currentQuestionKqid = null;\nlet nextQuestionKqid = null;\nlet sessionMode = null;\nlet showRankingBetweenQuestions = false;\nlet showRankingBetweenQuestionsSwitch = false;\nlet showRankingFinal = false;\nlet groupMode = false;\nlet currentQuestionDataForRace = {};\nlet cloudTags = [];\nlet voting = false;\n\n/**\n * @constructor\n * @param {String} region\n * @param {String} socketurl\n * @param {String} port\n * @param {String} sessionmode\n * @param {Boolean} groupmode\n */\nfunction Sockets(region, socketurl, port, sessionmode, groupmode) {\n    this.root = jQuery(region);\n    socketUrl = socketurl;\n    portUrl = port;\n    userid = this.root[0].dataset.userid;\n    username = this.root[0].dataset.username;\n    userimage = this.root[0].dataset.userimage;\n    cmid = this.root[0].dataset.cmid;\n    sid = this.root[0].dataset.sid;\n    messageBox = this.root.find(REGION.MESSAGEBOX);\n    countusers = this.root.find(REGION.COUNTUSERS);\n    groupMode = groupmode;\n    sessionMode = sessionmode;\n    switch (sessionMode) {\n        case 'inactive_manual':\n        default:\n            showRankingBetweenQuestions = false;\n            showRankingBetweenQuestionsSwitch = false;\n            showRankingFinal = false;\n            break;\n        case 'podium_manual':\n        case 'race_manual': {\n            let request = {\n                methodname: SERVICES.GETSESSIONCONFIG,\n                args: {\n                    sid: sid,\n                    cmid: cmid\n                }\n            };\n            Ajax.call([request])[0].done(function(response) {\n                if (response.session.showgraderanking === 1) {\n                    showRankingBetweenQuestions = true;\n                }\n                if (response.session.showfinalgrade === 1) {\n                    showRankingFinal = true;\n                }\n            }).fail(Notification.exception);\n            break;\n        }\n    }\n    this.measuringSpeed();\n    this.disableDevTools();\n    this.initSockets();\n    this.cleanMessages();\n    this.initListeners();\n}\n\nSockets.prototype.cleanMessages = function() {\n    setInterval(function() {\n        messageBox.find(':first-child').remove();\n    }, 10000);\n};\n\nSockets.prototype.disableDevTools = function(){\n    document.addEventListener('contextmenu', (e) => e.preventDefault());\n    document.onkeydown = (e) => {\n        return !(event.keyCode === 123 ||\n            this.ctrlShiftKey(e, 'I') ||\n            this.ctrlShiftKey(e, 'J') ||\n            this.ctrlShiftKey(e, 'C') ||\n            (e.ctrlKey && e.keyCode === 'U'.charCodeAt(0)));\n    };\n};\n\nSockets.prototype.ctrlShiftKey = function(e, keyCode) {\n    return e.ctrlKey && e.shiftKey && e.keyCode === keyCode.charCodeAt(0);\n};\n\nSockets.prototype.measuringSpeed = function() {\n    let connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;\n    if (connection) {\n        let typeConnection = connection.effectiveType;\n        let speedMbps = connection.downlink;\n        // eslint-disable-next-line no-console\n        console.log(\"Type of Connection: \" + typeConnection, \"Estimated speed: \" + speedMbps + \" Mbps\");\n        if (speedMbps < 1) {\n            let reason = {\n                effectiveType: connection.effectiveType,\n                downlink: connection.downlink\n            };\n            getString('lowspeed', 'mod_kuet', reason).done((s) => {\n                messageBox.append(\n                    '<div class=\"alert alert-danger\" role=\"alert\">' + s + '</div>'\n                );\n            });\n        }\n    } else {\n        // eslint-disable-next-line no-console\n        console.error(\"Connection speed detection is not supported in this browser.\");\n    }\n};\n\nSockets.prototype.backSession = function() {\n    const stringkeys = [\n        {key: 'backtopanelfromsession', component: 'mod_kuet'},\n        {key: 'backtopanelfromsession_desc', component: 'mod_kuet'},\n        {key: 'confirm', component: 'mod_kuet'}\n    ];\n    getStrings(stringkeys).then((langStrings) => {\n        return ModalFactory.create({\n            title: langStrings[0],\n            body: langStrings[1],\n            type: ModalFactory.types.SAVE_CANCEL\n        }).then(modal => {\n            modal.setSaveButtonText(langStrings[2]);\n            modal.getRoot().on(ModalEvents.save, () => {\n                let request = {\n                    methodname: SERVICES.ACTIVESESSION,\n                    args: {\n                        cmid: cmid,\n                        sessionid: sid\n                    }\n                };\n                Ajax.call([request])[0].done(function() {\n                    window.location.replace(M.cfg.wwwroot + '/mod/kuet/view.php?id=' + cmid);\n                }).fail(Notification.exception);\n            });\n            modal.getRoot().on(ModalEvents.hidden, () => {\n                modal.destroy();\n            });\n            return modal;\n        });\n    }).done(function(modal) {\n        modal.show();\n        // eslint-disable-next-line no-restricted-globals\n    }).fail(Notification.exception);\n};\n\n/* ****************** */\n\n/** @type {jQuery} The jQuery node for the page region. */\nSockets.prototype.root = null;\n\nSockets.prototype.initSockets = function() {\n    let that = this;\n    this.root.find(ACTION.BACKSESSION).on('click', this.backSession);\n    this.root.find(ACTION.CLOSEIMPROVISE).on('click', this.closeImprovise);\n    this.root.find(ACTION.SUBMITIMPROVISE).on('click', this.submitImprovise);\n\n    db = Database.initDb(sid, userid);\n    let normalizeSocketUrl = Sockets.prototype.normalizeSocketUrl(socketUrl, portUrl);\n    let alreadyteacher = false;\n    Sockets.prototype.webSocket = new WebSocket(normalizeSocketUrl);\n\n    Sockets.prototype.webSocket.onopen = function() { // Waitingroom.\n        /* The first and second questions are obtained.\n        When the teacher clicks on init session, the teacher will send the first question over the socket to all\n        students, and will get the 3rd question. When a student answers a question, a service will be called to save the answer\n        and progress, and the teacher will be informed via the socket. When the teacher clicks on next question,\n        the 2nd question will be sent by socket to all students, and the 3th question will be obtained.\n        The questions will be stored in the teacher's data storage, you can even store the user's answers so that you\n        don't have to call a service at the end for the ranking.\n        */\n\n        let request = {\n            methodname: SERVICES.FIRSTQUESTION,\n            args: {\n                cmid: cmid,\n                sessionid: sid\n            }\n        };\n        Ajax.call([request])[0].done(function(firstquestion) {\n            let data = {\n                kid: firstquestion.kid,\n                value: firstquestion\n            };\n            db.add('questions', data);\n            questionsKids.push(firstquestion.kid);\n            currentQuestionKqid = firstquestion.kid;\n            that.setCurrentQuestion(firstquestion.kid);\n            that.getNextQuestion(firstquestion.kid);\n            if (alreadyteacher === false) {\n                that.root.find(ACTION.INITSESSION).removeClass('disabled');\n                that.root.find(ACTION.INITSESSION).on('click', that.initSession);\n                that.root.find(ACTION.ENDSESSION).on('click', that.endSession);\n            }\n        }).fail(Notification.exception);\n    };\n\n    Sockets.prototype.webSocket.onmessage = function(ev) {\n        let msgDecrypt = Encryptor.decrypt(ev.data);\n        let response = JSON.parse(msgDecrypt); // PHP sends Json data.\n        switch (response.action) {\n            case 'connect':\n                // The server has returned the connected status, it is time to identify yourself.\n                if (response.usersocketid !== undefined) {\n                    usersocketid = response.usersocketid;\n                    let msg = {\n                        'userid': userid,\n                        'name': username,\n                        'pic': userimage,\n                        'isteacher': true,\n                        'cmid': cmid,\n                        'sid': sid,\n                        'usersocketid': usersocketid,\n                        'action': 'newuser'\n                    };\n                    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n                }\n                break;\n            case 'newuser': {\n                let identifier = jQuery(REGION.USERLIST);\n                let data = response.students;\n                identifier.html('');\n                if (waitingRoom === false) {\n                    Sockets.prototype.normalizeUser(response.usersocketid);\n                }\n                jQuery.each(data, function(i, student) {\n                    let templateContext = {\n                        'usersocketid': student.usersocketid,\n                        'userimage': student.picture,\n                        'userfullname': student.name,\n                    };\n                    Templates.render(TEMPLATES.PARTICIPANT, templateContext).then(function(html) {\n                        identifier.append(html);\n                    }).fail(Notification.exception);\n                });\n                countusers.html(response.count);\n                break;\n            }\n            case 'newgroup': {\n                let participantshtml = jQuery(REGION.USERLIST);\n                let grouplist = response.groups;\n                participantshtml.html('');\n                jQuery.each(grouplist, function (i, group) {\n                    let templateContext = {\n                        'usersocketid': group.usersocketid,\n                        'groupimage': group.picture,\n                        'groupid': group.groupid,\n                        'name': group.name,\n                        'numgroupusers': group.numgroupusers,\n                    };\n                    Templates.render(TEMPLATES.GROUPPARTICIPANT, templateContext).then(function(html) {\n                        participantshtml.append(html);\n                    }).fail(Notification.exception);\n                });\n                countusers.html(response.count);\n                break;\n            }\n            case 'countusers':\n                countusers.html(response.count);\n                break;\n            case 'studentQuestionEnd':\n                /*messageBox.append('<div>' + response.message + '</div>');*/\n                if (sessionMode === 'race_manual') {\n                    Sockets.prototype.raceResults();\n                }\n                break;\n            case 'userdisconnected':\n                if (groupMode != '1') {\n                    jQuery('[data-userid=\"' + response.usersocketid + '\"]').remove();\n                    countusers.html(response.count);\n                }\n                messageBox.append('<div>' + response.message + '</div>');\n                break;\n            case 'groupdisconnected':\n                jQuery('.participants').find('[data-groupid=\"' + response.groupid + '\"]').remove();\n                countusers.html(response.count);\n                messageBox.append('<div>' + response.message + '</div>');\n                break;\n            case 'groupmemberdisconnected':\n                jQuery('.participants').find('[data-groupid=\"' + response.groupid + '\"]')\n                    .find('.numgroupusers').html('(' + response.count + ')');\n                messageBox.append('<div>' + response.message + '</div>');\n                break;\n            case 'alreadyteacher':\n                messageBox.append(\n                    '<div class=\"alert alert-danger\" role=\"alert\">' + response.message + '</div>'\n                );\n                alreadyteacher = true;\n                jQuery(ACTION.INITSESSION).addClass('disabled');\n                break;\n            case 'pauseQuestion':\n                dispatchEvent(new Event('pauseQuestion_' + response.kid));\n                break;\n            case 'playQuestion':\n                dispatchEvent(new Event('playQuestion_' + response.kid));\n                break;\n            case 'showAnswers':\n                dispatchEvent(new Event('showAnswers_' + response.kid));\n                break;\n            case 'hideAnswers':\n                dispatchEvent(new Event('hideAnswers_' + response.kid));\n                break;\n            case 'showStatistics':\n                dispatchEvent(new Event('showStatistics_' + response.kid));\n                break;\n            case 'hideStatistics':\n                dispatchEvent(new Event('hideStatistics_' + response.kid));\n                break;\n            case 'showFeedback':\n                dispatchEvent(new Event('showFeedback_' + response.kid));\n                break;\n            case 'hideFeedback':\n                dispatchEvent(new Event('hideFeedback_' + response.kid));\n                break;\n            case 'ImproviseStudentTag':\n                Sockets.prototype.manageCloudTags(response.improvisereply);\n                Sockets.prototype.printNewTag();\n                break;\n            case 'StudentVotedTag':\n                if (voting === true) {\n                    Sockets.prototype.manageTagsVotes(response.votedtag);\n                    Sockets.prototype.printNewTag();\n                }\n                break;\n            default:\n                break;\n        }\n        messageBox[0].scrollTop = messageBox[0].scrollHeight;\n    };\n\n    Sockets.prototype.webSocket.onerror = function() {\n        getString('system_error', 'mod_kuet').done((s) => {\n            messageBox.append(\n                '<div class=\"alert alert-danger\" role=\"alert\">' + s + '</div>'\n            );\n        });\n        that.root.find(ACTION.INITSESSION).addClass('disabled');\n        that.root.find(ACTION.INITSESSION).off('click');\n        that.root.find(ACTION.ENDSESSION).off('click');\n    };\n\n    Sockets.prototype.webSocket.onclose = function(ev) {\n        let reason = {\n            reason: ev.reason,\n            code: ev.code\n        };\n        getString('connection_closed', 'mod_kuet', reason).done((s) => {\n            jQuery(REGION.TEACHERCANVASCONTENT).prepend(\n                '<div class=\"alert alert-danger\" role=\"alert\">' + s + '</div>'\n            );\n        });\n        that.root.find(ACTION.INITSESSION).addClass('disabled');\n        that.root.find(ACTION.INITSESSION).off('click');\n        that.root.find(ACTION.ENDSESSION).off('click');\n    };\n};\n\nSockets.prototype.normalizeSocketUrl = function(socketUrl, port) {\n    let jsUrl = new URL(socketUrl);\n    if (jsUrl.protocol === 'https:') {\n        jsUrl.port = port;\n        jsUrl.protocol = 'wss:';\n        if (jsUrl.pathname === '/') {\n            jsUrl.pathname = jsUrl.pathname + 'kuet';\n        } else {\n            jsUrl.pathname = jsUrl.pathname + '/kuet';\n        }\n        return jsUrl.toString();\n    }\n\n    getStrings([\n        {key: 'httpsrequired', component: 'mod_kuet'}\n    ]).done(function(strings) {\n        messageBox = this.root.find('#testresult');\n        messageBox.append('<div class=\"alert alert-danger\" role=\"alert\">' + strings[0] + '</div>');\n    }).fail(Notification.exception);\n    return '';\n};\n\nSockets.prototype.initListeners = function() {\n    let that = this;\n    addEventListener('nextQuestion', () => {\n        switch (sessionMode) {\n            case 'inactive_programmed':\n            case 'inactive_manual':\n            default:\n                that.nextQuestion();\n                break;\n            case 'podium_manual':\n            case 'podium_programmed':\n            case 'race_manual':\n            case 'race_programmed':\n                that.manageNext();\n                break;\n        }\n        // 3IP send tag cloud to a service to persist it in DB for retrieval in reports..\n        cloudTags = [];\n        voting = false;\n    }, false);\n    addEventListener('pauseQuestionSelf', () => {\n        that.pauseQuestion();\n    }, false);\n    addEventListener('playQuestionSelf', () => {\n        that.playQuestion();\n    }, false);\n    addEventListener('resendSelf', () => {\n        that.resendSelf();\n    }, false);\n    addEventListener('jumpTo', (e) => {\n        that.jumpTo(e.detail.jumpTo);\n    }, false);\n    addEventListener('teacherQuestionEndSelf', () => {\n        if (sessionMode === 'race_manual') {\n            currentQuestionDataForRace.isteacher = true;\n            Templates.render(TEMPLATES.QUESTION, currentQuestionDataForRace).then(function(html, js) {\n                let identifier = jQuery(REGION.TEACHERCANVAS);\n                identifier.html(html);\n                Templates.runTemplateJS(js);\n                jQuery(REGION.SWITCHS).removeClass('disabled');\n                jQuery(REGION.ESPECIALS).removeClass('disabled');\n                setTimeout(() => {\n                    that.questionEnd();\n                    jQuery(REGION.SWITCHS).removeClass('disabled');\n                    jQuery(REGION.IMPROVISE).removeClass('disabled');\n                    jQuery(ACTION.FINISHQUESTION).addClass('d-none');\n                    jQuery(ACTION.NEXT).removeClass('d-none');\n                    jQuery(ACTION.VOTE).addClass('disabled');\n                    jQuery(ACTION.JUMP).addClass('disabled');\n                    mEvent.notifyFilterContentUpdated(document.querySelector(REGION.TEACHERCANVAS));\n                }, 300);\n            }).fail(Notification.exception);\n        } else {\n            that.questionEnd();\n        }\n        cloudTags = [];\n    }, false);\n    addEventListener('showAnswersSelf', () => {\n        that.showAnswers();\n    }, false);\n    addEventListener('hideAnswersSelf', () => {\n        that.hideAnswers();\n    }, false);\n    addEventListener('showStatisticsSelf', () => {\n        that.showStatistics();\n    }, false);\n    addEventListener('hideStatisticsSelf', () => {\n        that.hideStatistics();\n    }, false);\n    addEventListener('showFeedbackSelf', () => {\n        that.showFeedback();\n    }, false);\n    addEventListener('hideFeedbackSelf', () => {\n        that.hideFeedback();\n    }, false);\n    addEventListener('endSession', () => {\n        that.endSession();\n    }, {once: true});\n    addEventListener('improvise', () => {\n        that.improvise();\n    }, false);\n    addEventListener('initVote', () => {\n        that.vote();\n    }, false);\n};\n\nSockets.prototype.setCurrentQuestion = function(currentQuestion) {\n    let data = {\n        state: 'currentQuestion',\n        value: currentQuestion\n    };\n    db.update('statequestions', data);\n};\n\nSockets.prototype.setNextQuestion = function(nextQuestion) {\n    let data = {\n        state: 'nextQuestion',\n        value: nextQuestion\n    };\n    db.update('statequestions', data);\n};\n\nSockets.prototype.setEndSession = function(endData) {\n    db.delete('statequestions', 'nextQuestion');\n    let data = {\n        state: 'endSession',\n        value: endData\n    };\n    db.update('statequestions', data);\n    showRankingBetweenQuestionsSwitch = false;\n};\n\nSockets.prototype.getNextQuestion = function(kid) {\n    let that = this;\n    let request = {\n        methodname: SERVICES.NEXTQUESTION,\n        args: {\n            cmid: cmid,\n            sessionid: sid,\n            kid: kid,\n            manual: true\n        }\n    };\n    nextQuestionKqid = null;\n    Ajax.call([request])[0].done(function(nextquestion) {\n        if (nextquestion.endsession !== true) {\n            let data = {\n                kid: nextquestion.kid,\n                value: nextquestion\n            };\n            db.add('questions', data);\n            nextQuestionKqid = nextquestion.kid;\n            that.setNextQuestion(nextquestion.kid);\n        } else {\n            // End session.\n            nextQuestionKqid = null;\n            that.setEndSession(nextquestion);\n        }\n    }).fail(Notification.exception);\n};\n\nSockets.prototype.initSession = function() {\n    db.delete('statequestions', 'endSession');\n    const stringkeys = [\n        {key: 'init_session', component: 'mod_kuet'},\n        {key: 'init_session_desc', component: 'mod_kuet'},\n        {key: 'confirm', component: 'mod_kuet'},\n        {key: 'sessionstarted', component: 'mod_kuet'},\n        {key: 'sessionstarted_info', component: 'mod_kuet'}\n    ];\n    getStrings(stringkeys).then((langStrings) => {\n        return ModalFactory.create({\n            title: langStrings[0],\n            body: langStrings[1],\n            type: ModalFactory.types.SAVE_CANCEL\n        }).then(modal => {\n            modal.setSaveButtonText(langStrings[2]);\n            modal.getRoot().on(ModalEvents.save, () => {\n                let firstQuestion = db.get('questions', currentQuestionKqid);\n                firstQuestion.onsuccess = function() {\n                    let msg = {\n                        'action': 'question',\n                        'sid': sid,\n                        'context': firstQuestion.result\n                    };\n                    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n                    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                        Sockets.prototype.initPanel();\n                        let identifier = jQuery(REGION.TEACHERCANVAS);\n                        identifier.append(html);\n                        currentQuestionKqid = firstQuestion.result.kid;\n                        firstQuestion.result.value.isteacher = true;\n                        currentQuestionDataForRace = firstQuestion.result.value;\n                        if (sessionMode === 'podium_manual' || sessionMode === 'inactive_manual') {\n                            Templates.render(TEMPLATES.QUESTION, firstQuestion.result.value).then(function(html, js) {\n                                identifier.html(html);\n                                Templates.runTemplateJS(js);\n                                jQuery(REGION.LOADING).remove();\n                                mEvent.notifyFilterContentUpdated(document.querySelector(REGION.TEACHERCANVAS));\n                            }).fail(Notification.exception);\n                        }\n                        if (sessionMode === 'race_manual') {\n                            Sockets.prototype.raceResults();\n                        }\n                        jQuery(REGION.TEACHERCANVASCONTENT).find('.content-title h2').html(langStrings[3]);\n                        jQuery(REGION.TEACHERCANVASCONTENT).find('.content-title small').html(langStrings[4]);\n                        jQuery(ACTION.BACKSESSION).remove();\n                        jQuery(ACTION.INITSESSION).remove();\n                        jQuery(ACTION.ENDSESSION).removeClass('hidden').removeClass('disabled');\n                        waitingRoom = false;\n                        if (showRankingBetweenQuestions) {\n                            showRankingBetweenQuestionsSwitch = true;\n                        }\n                    });\n                };\n            });\n            modal.getRoot().on(ModalEvents.hidden, () => {\n                modal.destroy();\n            });\n            return modal;\n        });\n    }).done(function(modal) {\n        modal.show();\n        // eslint-disable-next-line no-restricted-globals\n    }).fail(Notification.exception);\n};\n\nSockets.prototype.initPanel = function() {\n    let requestResume = {\n        methodname: SERVICES.GETSESSIONRESUME,\n        args: {\n            sid: sid,\n            cmid: cmid,\n        }\n    };\n    Ajax.call([requestResume])[0].done(function(responseResume) {\n        Templates.render(TEMPLATES.SESSIONRESUME, responseResume).then(function(html) {\n            jQuery(REGION.SESSIONRESUME).append(html);\n        });\n    });\n    let methodname = SERVICES.GETLISTRESULTS;\n    if (groupMode === true) {\n        methodname = SERVICES.GETGROUPLISTRESULTS;\n    }\n    setInterval(function() {\n        let requestResults = {\n            methodname: methodname,\n            args: {\n                sid: sid,\n                cmid: cmid,\n            }\n        };\n        Ajax.call([requestResults])[0].done(function(responseResults) {\n            Templates.render(TEMPLATES.LISTRESULTS, responseResults).then(function(html) {\n                jQuery(REGION.LISTRESULTS).html(html);\n            });\n        });\n    }, 20000);\n    jQuery(REGION.TEACHERPANEL).removeClass('d-none');\n};\n\nSockets.prototype.endSession = function() {\n    const stringkeys = [\n        {key: 'end_session', component: 'mod_kuet'},\n        {key: 'end_session_manual_desc', component: 'mod_kuet'},\n        {key: 'confirm', component: 'mod_kuet'},\n        {key: 'end_session_error', component: 'mod_kuet'}\n    ];\n    getStrings(stringkeys).then((langStrings) => {\n        return ModalFactory.create({\n            title: langStrings[0],\n            body: langStrings[1],\n            type: ModalFactory.types.SAVE_CANCEL\n        }).then(modal => {\n            modal.setSaveButtonText(langStrings[2]);\n            modal.getRoot().on(ModalEvents.save, () => {\n                let request = {\n                    methodname: SERVICES.FINISHSESSION,\n                    args: {\n                        cmid: cmid,\n                        sessionid: sid\n                    }\n                };\n                Ajax.call([request])[0].done(function(response) {\n                    if (response.finished === true) {\n                        let deleteDb = db.deleteDatabase();\n                        deleteDb.onerror = function(event) {\n                            // eslint-disable-next-line no-console\n                            console.error(\"Error deleting database.\", event);\n                        };\n                        deleteDb.onsuccess = function() {\n                            window.location.replace(M.cfg.wwwroot + '/mod/kuet/view.php?id=' + cmid);\n                        };\n                    } else {\n                        Notification.alert('Error', langStrings[3], langStrings[2]);\n                    }\n                }).fail(Notification.exception);\n            });\n            modal.getRoot().on(ModalEvents.hidden, () => {\n                modal.destroy();\n            });\n            return modal;\n        });\n    }).done(function(modal) {\n        modal.show();\n        // eslint-disable-next-line no-restricted-globals\n    }).fail(Notification.exception);\n};\n\nSockets.prototype.nextQuestion = function() {\n    let that = this;\n    if (nextQuestionKqid === null) {\n        this.getNextQuestion(currentQuestionKqid);\n    }\n    let nextQuestion = db.get('statequestions', 'nextQuestion');\n    nextQuestion.onsuccess = function() {\n        if (nextQuestion.result !== undefined) {\n            let nextQuestionData = db.get('questions', nextQuestion.result.value);\n            nextQuestionData.onsuccess = function() {\n                let msg = {\n                    'action': 'question',\n                    'sid': sid,\n                    'context': nextQuestionData.result\n                };\n                currentQuestionDataForRace = nextQuestionData.result.value;\n                Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n                let removeEvents = new CustomEvent('removeEvents');\n                dispatchEvent(removeEvents);\n                Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                    let identifier = jQuery(REGION.TEACHERCANVAS);\n                    identifier.append(html);\n                    currentQuestionKqid = nextQuestionData.result.kid;\n                    // The following question is marked as current.\n                    that.setCurrentQuestion(nextQuestionData.result.kid);\n                    // And get the next question to store it.\n                    that.getNextQuestion(nextQuestionData.result.kid);\n                    if (sessionMode === 'podium_manual' || sessionMode === 'inactive_manual') {\n                        nextQuestionData.result.value.isteacher = true;\n                        // Render questin for teacher.\n                        Templates.render(TEMPLATES.QUESTION, nextQuestionData.result.value).then(function(html, js) {\n                            identifier.html(html);\n                            Templates.runTemplateJS(js);\n                            mEvent.notifyFilterContentUpdated(document.querySelector(REGION.TEACHERCANVAS));\n                            jQuery(REGION.LOADING).remove();\n                        }).fail(Notification.exception);\n                    }\n                    if (sessionMode === 'race_manual') {\n                        Sockets.prototype.raceResults();\n                    }\n                });\n            };\n        } else {\n            let endSession = db.get('statequestions', 'endSession');\n            if (showRankingFinal === false) {\n                endSession.onsuccess = function() {\n                    let msg = {\n                        'action': 'endSession',\n                        'sid': sid,\n                        'context': endSession.result\n                    };\n                    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n                    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                        let identifier = jQuery(REGION.TEACHERCANVAS);\n                        identifier.append(html);\n                        currentQuestionKqid = null;\n                        db.delete('statequestions', 'currentQuestion');\n                        that.setEndSession(endSession.result);\n                        endSession.result.value.isteacher = true;\n                        Templates.render(TEMPLATES.QUESTION, endSession.result.value).then(function(html, js) {\n                            identifier.html(html);\n                            Templates.runTemplateJS(js);\n                            jQuery(REGION.LOADING).remove();\n                        }).fail(Notification.exception);\n                    });\n                };\n            } else {\n                endSession.onsuccess = function() {\n                    let request = {\n                        methodname: SERVICES.GETFINALRANKING,\n                        args: {\n                            sid: sid,\n                            cmid: cmid\n                        }\n                    };\n                    Ajax.call([request])[0].done(function(finalRanking) {\n                        endSession.result.value = finalRanking;\n                        let msg = {\n                            'action': 'endSession',\n                            'sid': sid,\n                            'context': endSession.result\n                        };\n                        Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n                        Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                            let identifier = jQuery(REGION.TEACHERCANVAS);\n                            identifier.append(html);\n                            currentQuestionKqid = null;\n                            db.delete('statequestions', 'currentQuestion');\n                            that.setEndSession(endSession.result);\n                            endSession.result.value.isteacher = true;\n                            Templates.render(TEMPLATES.QUESTION, endSession.result.value).then(function(html, js) {\n                                identifier.html(html);\n                                Templates.runTemplateJS(js);\n                                jQuery(REGION.LOADING).remove();\n                            }).fail(Notification.exception);\n                        });\n                    }).fail(Notification.exception);\n                };\n            }\n        }\n    };\n};\n\nSockets.prototype.raceResults = function() {\n    let identifier = jQuery(REGION.TEACHERCANVAS);\n    let request = {\n        methodname: SERVICES.GETRACERESULTS,\n        args: {\n            sid: sid,\n            cmid: cmid\n        }\n    };\n    Ajax.call([request])[0].done(function(response) {\n        response.raceresults = true;\n        response.isteacher = true;\n        response.programmedmode = false;\n        response.sessionprogress = currentQuestionDataForRace.sessionprogress;\n        // eslint-disable-next-line camelcase\n        response.question_index_string = currentQuestionDataForRace.question_index_string;\n        response.numquestions = currentQuestionDataForRace.numquestions;\n        Templates.render(TEMPLATES.QUESTION, response).then((html, js) => {\n            let scrollUsersTop = 0;\n            let scrollQuestionsLeft = 0;\n            if (document.querySelector('#content-users') !== null) {\n                scrollUsersTop = document.querySelector('#content-users').scrollTop;\n                scrollQuestionsLeft = document.querySelector('#questions-list').scrollLeft;\n            }\n            identifier.html(html);\n            Templates.runTemplateJS(js);\n            let newScrollUsers = document.querySelector('#content-users');\n            let newScrollQuestions = document.querySelector('#questions-list');\n            let scrollUsers = document.querySelector('#content-users');\n            let questions = document.querySelectorAll('.content-responses');\n            scrollUsers.addEventListener('scroll', function() {\n                questions.forEach((question) => {\n                    question.scrollTop = scrollUsers.scrollTop;\n                });\n            }, {passive: true});\n            newScrollUsers.scrollTop = scrollUsersTop;\n            newScrollQuestions.scrollLeft = scrollQuestionsLeft;\n        }).fail(Notification.exception);\n    }).fail(Notification.exception);\n};\n\nSockets.prototype.manageNext = function() {\n    let that = this;\n    if (showRankingBetweenQuestions === false) {\n        that.nextQuestion();\n    } else {\n        if (showRankingBetweenQuestionsSwitch === false) {\n            that.nextQuestion();\n            showRankingBetweenQuestionsSwitch = true;\n        } else {\n            let request = {\n                methodname: SERVICES.GETPROVISIONALRANKING,\n                args: {\n                    sid: sid,\n                    cmid: cmid,\n                    kid: currentQuestionKqid\n                }\n            };\n            Ajax.call([request])[0].done(function(provisionalRanking) {\n                let msg = {\n                    'action': 'ranking',\n                    'sid': sid,\n                    'context': provisionalRanking\n                };\n                Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n                showRankingBetweenQuestionsSwitch = false;\n                Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                    let identifier = jQuery(REGION.TEACHERCANVAS);\n                    identifier.append(html);\n                    provisionalRanking.isteacher = true;\n                    Templates.render(TEMPLATES.PROVISIONALRANKING, provisionalRanking).then(function(html, js) {\n                        identifier.html(html);\n                        Templates.runTemplateJS(js);\n                        jQuery(REGION.LOADING).remove();\n                    }).fail(Notification.exception);\n                });\n            }).fail(Notification.exception);\n        }\n    }\n};\n\nSockets.prototype.pauseQuestion = function() {\n    let msg = {\n        'action': 'pauseQuestion',\n        'sid': sid,\n        'kid': currentQuestionKqid\n    };\n    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n};\n\nSockets.prototype.playQuestion = function() {\n    let msg = {\n        'action': 'playQuestion',\n        'sid': sid,\n        'kid': currentQuestionKqid\n    };\n    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n};\n\nSockets.prototype.resendSelf = function() {\n    let request = {\n        methodname: SERVICES.DELETERESPONSES,\n        args: {\n            cmid: cmid,\n            sessionid: sid,\n            kid: currentQuestionKqid\n        }\n    };\n    let removeEvents = new CustomEvent('removeEvents');\n    dispatchEvent(removeEvents);\n    Ajax.call([request])[0].done(function(response) {\n        if (response.deleted === true) {\n            let currentQuestionData = db.get('questions', currentQuestionKqid);\n            currentQuestionData.onsuccess = function() {\n                let msg = {\n                    'action': 'question',\n                    'sid': sid,\n                    'context': currentQuestionData.result\n                };\n                Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n                showRankingBetweenQuestionsSwitch = true;\n                currentQuestionDataForRace = currentQuestionData.result.value;\n                if (sessionMode === 'race_manual') {\n                    Sockets.prototype.raceResults();\n                } else {\n                    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                        let identifier = jQuery(REGION.TEACHERCANVAS);\n                        identifier.append(html);\n                        currentQuestionData.result.value.isteacher = true;\n                        Templates.render(TEMPLATES.QUESTION, currentQuestionData.result.value).then(function(html, js) {\n                            identifier.html(html);\n                            Templates.runTemplateJS(js);\n                            mEvent.notifyFilterContentUpdated(document.querySelector(REGION.TEACHERCANVAS));\n                            jQuery(REGION.LOADING).remove();\n                        }).fail(Notification.exception);\n                    });\n                }\n            };\n        }\n    }).fail(Notification.exception);\n};\n\nSockets.prototype.jumpTo = function(questionNumber) {\n    let that = this;\n    let request = {\n        methodname: SERVICES.JUMPTOQUESTION,\n        args: {\n            cmid: cmid,\n            sessionid: sid,\n            position: questionNumber,\n            manual: true\n        }\n    };\n    nextQuestionKqid = null;\n    let removeEvents = new CustomEvent('removeEvents');\n    dispatchEvent(removeEvents);\n    Ajax.call([request])[0].done(function(question) {\n        let data = {\n            kid: question.kid,\n            value: question\n        };\n        db.add('questions', data);\n        currentQuestionKqid = question.kid;\n        that.setCurrentQuestion(question.kid);\n        that.getNextQuestion(question.kid);\n        let msg = {\n            'action': 'question',\n            'sid': sid,\n            'context': data\n        };\n        Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n        showRankingBetweenQuestionsSwitch = true;\n        Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n            let identifier = jQuery(REGION.TEACHERCANVAS);\n            identifier.append(html);\n            question.isteacher = true;\n            currentQuestionDataForRace = question;\n            if (sessionMode === 'race_manual') {\n                Sockets.prototype.raceResults();\n            } else {\n                Templates.render(TEMPLATES.QUESTION, question).then(function(html, js) {\n                    identifier.html(html);\n                    Templates.runTemplateJS(js);\n                    mEvent.notifyFilterContentUpdated(document.querySelector(REGION.TEACHERCANVAS));\n                    jQuery(REGION.LOADING).remove();\n                }).fail(Notification.exception);\n            }\n        });\n    }).fail(Notification.exception);\n};\n\nSockets.prototype.questionEnd = function() {\n    let request = {\n        methodname: SERVICES.GETQUESTIONSTATISTICS,\n        args: {\n            sid: sid,\n            kid: currentQuestionKqid\n        }\n    };\n    Ajax.call([request])[0].done(function(response) {\n        let msg = {\n            'action': 'teacherQuestionEnd',\n            'sid': sid,\n            'kid': currentQuestionKqid,\n            'statistics': response.statistics\n        };\n        Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n        dispatchEvent(new CustomEvent('teacherQuestionEnd_' + currentQuestionKqid, {\n            \"detail\": {\"statistics\": response.statistics}\n        }));\n    }).fail(Notification.exception);\n};\n\nSockets.prototype.showAnswers = function() {\n    let msg = {\n        'action': 'showAnswers',\n        'sid': sid,\n        'kid': currentQuestionKqid\n    };\n    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n};\n\nSockets.prototype.hideAnswers = function() {\n    let msg = {\n        'action': 'hideAnswers',\n        'sid': sid,\n        'kid': currentQuestionKqid\n    };\n    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n};\n\nSockets.prototype.showStatistics = function() {\n    let msg = {\n        'action': 'showStatistics',\n        'sid': sid,\n        'kid': currentQuestionKqid\n    };\n    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n};\n\nSockets.prototype.hideStatistics = function() {\n    let msg = {\n        'action': 'hideStatistics',\n        'sid': sid,\n        'kid': currentQuestionKqid\n    };\n    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n};\n\nSockets.prototype.showFeedback = function() {\n    let msg = {\n        'action': 'showFeedback',\n        'sid': sid,\n        'kid': currentQuestionKqid\n    };\n    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n};\n\nSockets.prototype.hideFeedback = function() {\n    let msg = {\n        'action': 'hideFeedback',\n        'sid': sid,\n        'kid': currentQuestionKqid\n    };\n    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n};\n\nSockets.prototype.closeImprovise = function() {\n    let msg = {\n        'action': 'closeImprovise',\n        'sid': sid\n    };\n    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n    jQuery(REGION.IMPROVISE).addClass('d-none');\n    jQuery(REGION.TEACHERCANVAS).addClass('d-flex').removeClass('d-none');\n};\n\nSockets.prototype.improvise = function() {\n    let msg = {\n        'action': 'improvising',\n        'sid': sid\n    };\n    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n    jQuery(REGION.IMPROVISE).removeClass('d-none');\n    jQuery(REGION.TEACHERCANVAS).removeClass('d-flex').addClass('d-none');\n};\n\nSockets.prototype.submitImprovise = function() {\n    let improviseStatement = jQuery(REGION.IMPROVISESTATEMENT).val();\n    let improviseReply = jQuery(REGION.IMPROVISEREPLY).val();\n    if (improviseStatement === '') {\n        jQuery(REGION.IMPROVISESTATEMENT).focus(() => {\n            jQuery(REGION.IMPROVISESTATEMENT).css({'border-color': 'red'});\n        });\n    } else {\n        jQuery(REGION.IMPROVISESTATEMENT).val('');\n        jQuery(REGION.IMPROVISEREPLY).val('');\n        let msg = {\n            'action': 'improvised',\n            'sid': sid,\n            'improvisestatement': improviseStatement,\n            'improvisereply': improviseReply,\n            'cmid': cmid\n        };\n        Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n        Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n            jQuery(REGION.IMPROVISE).addClass('d-none');\n            jQuery(REGION.TEACHERCANVAS).addClass('d-flex').removeClass('d-none');\n            let identifier = jQuery(REGION.TEACHERCANVAS);\n            identifier.append(html);\n            if (improviseReply !== '') {\n                Sockets.prototype.manageCloudTags(improviseReply);\n            }\n            let cloudtagsData = {\n                'sessionid': sid,\n                'cmid': cmid,\n                'improvised': true,\n                'sessionprogress': 0,\n                'cloudtags': true,\n                'isteacher': true,\n                'questiontext': improviseStatement,\n                'programmedmode': false,\n                'preview': false,\n                'tags': cloudTags\n            };\n            Templates.render(TEMPLATES.QUESTION, cloudtagsData).then(function(html, js) {\n                identifier.html(html);\n                jQuery('[data-action=\"delete-tag\"]').on('click', Sockets.prototype.deleteTag.bind(this));\n                Templates.runTemplateJS(js);\n                jQuery(REGION.LOADING).remove();\n                jQuery(REGION.VOTEIMPROVISE).removeClass('disabled');\n            }).fail(Notification.exception);\n        });\n    }\n};\n\nSockets.prototype.manageCloudTags = function(newtag) {\n    if (newtag !== '') {\n        let exist = false;\n        if (cloudTags.length) {\n            cloudTags = cloudTags.map((tag) => {\n                if (tag.name.toLowerCase() === newtag.toLowerCase()) {\n                    tag.count = tag.count + 1;\n                    tag.votenum = 0;\n                    exist = true;\n                }\n                return tag;\n            });\n        }\n        if (!exist) {\n            cloudTags.push({name: newtag, count: 1, votenum: 0});\n        }\n        const maxCount = Math.max(...cloudTags.map(item => item.count));\n        cloudTags.forEach((item) => {\n            item.size = Math.ceil((item.count / maxCount) * 10);\n        });\n    }\n};\n\nSockets.prototype.manageTagsVotes = function(voteTag) {\n    if (cloudTags.length) {\n        cloudTags = cloudTags.map((tag) => {\n            if (tag.name.toLowerCase() === voteTag.toLowerCase()) {\n                tag.votenum = tag.votenum + 1;\n            }\n            return tag;\n        });\n        const maxCount = Math.max(...cloudTags.map(item => item.votenum));\n        cloudTags.forEach((item) => {\n            item.size = Math.ceil((item.votenum / maxCount) * 10);\n        });\n    }\n};\n\nSockets.prototype.printNewTag = function() {\n    let htmlTags = '';\n    cloudTags.forEach(tag => {\n        htmlTags +=\n            '<li><span class=\"tag\" data-count=\"' + tag.count + '\" data-vote=\"' + tag.votenum + '\"  data-size=\"' + tag.size + '\">' +\n                '<div class=\"delete-tag\" data-name=\"' + tag.name + '\" data-action=\"delete-tag\">' +\n                    'x' +\n                '</div>' +\n            tag.name +\n            '</span></li>';\n    });\n    jQuery(REGION.TAGSCONTENT).html(htmlTags);\n    jQuery('[data-action=\"delete-tag\"]').on('click', Sockets.prototype.deleteTag.bind(this));\n    let msg = {\n        'action': 'printNewTag',\n        'sid': sid,\n        'tags': cloudTags\n    };\n    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n};\n\nSockets.prototype.deleteTag = function(e) {\n    let nameToDelete = jQuery(e.currentTarget).attr('data-name');\n    if (cloudTags.length) {\n        const indexToDelete = cloudTags.findIndex(item => item.name === nameToDelete);\n        if (indexToDelete !== -1) {\n            cloudTags.splice(indexToDelete, 1);\n        }\n    }\n    Sockets.prototype.printNewTag();\n};\n\nSockets.prototype.vote = function() {\n    voting = true;\n    jQuery(REGION.VOTEIMPROVISE).addClass('disabled');\n    jQuery(REGION.CLOUDTAGS).attr('data-show-votes', true);\n    jQuery(REGION.CLOUDTAGS).attr('data-show-value', false);\n    let msg = {\n        'action': 'initVote',\n        'sid': sid\n    };\n    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n};\n\nSockets.prototype.normalizeUser = function(usersocketid) {\n    let currentQuestion = db.get('statequestions', 'currentQuestion');\n    currentQuestion.onsuccess = function() {\n        let currentQuestiondata = db.get('questions', currentQuestion.result.value);\n        currentQuestiondata.onsuccess = function() {\n            let msg = {\n                'action': 'normalizeUser',\n                'sid': sid,\n                'ofs': true, // Only for student.\n                'usersocketid': usersocketid,\n                'context': currentQuestiondata.result\n            };\n            Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n        };\n    };\n};\n\nSockets.prototype.sendMessageSocket = function(msg) {\n    this.webSocket.send(msg);\n};\n\nexport const teacherInitSockets = (region, socketurl, port, sessionmode, groupmode) => {\n    return new Sockets(region, socketurl, port, sessionmode, groupmode);\n};\n"],"names":["REGION","MESSAGEBOX","USERLIST","COUNTUSERS","TEACHERCANVASCONTENT","TEACHERCANVAS","TEACHERPANEL","SESSIONCONTROLER","SESSIONRESUME","LISTRESULTS","RACERESULTS","SWITCHS","ESPECIALS","VOTEIMPROVISE","CLOUDTAGS","IMPROVISE","IMPROVISESTATEMENT","IMPROVISEREPLY","TAGSCONTENT","ACTION","SERVICES","TEMPLATES","socketUrl","portUrl","userid","usersocketid","username","userimage","messageBox","countusers","cmid","sid","db","questionsKids","waitingRoom","currentQuestionKqid","nextQuestionKqid","sessionMode","showRankingBetweenQuestions","showRankingBetweenQuestionsSwitch","showRankingFinal","groupMode","currentQuestionDataForRace","cloudTags","voting","Sockets","region","socketurl","port","sessionmode","groupmode","root","this","dataset","find","request","methodname","args","call","done","response","session","showgraderanking","showfinalgrade","fail","Notification","exception","measuringSpeed","disableDevTools","initSockets","cleanMessages","initListeners","prototype","setInterval","remove","document","addEventListener","e","preventDefault","onkeydown","event","keyCode","ctrlShiftKey","ctrlKey","charCodeAt","shiftKey","connection","navigator","mozConnection","webkitConnection","typeConnection","effectiveType","speedMbps","downlink","console","log","reason","s","append","error","backSession","key","component","then","langStrings","ModalFactory","create","title","body","type","types","SAVE_CANCEL","modal","setSaveButtonText","getRoot","on","ModalEvents","save","sessionid","window","location","replace","M","cfg","wwwroot","hidden","destroy","show","that","closeImprovise","submitImprovise","Database","initDb","normalizeSocketUrl","alreadyteacher","webSocket","WebSocket","onopen","firstquestion","data","kid","value","add","push","setCurrentQuestion","getNextQuestion","removeClass","initSession","endSession","onmessage","ev","msgDecrypt","Encryptor","decrypt","JSON","parse","action","undefined","msg","sendMessageSocket","stringify","identifier","students","html","normalizeUser","each","i","student","templateContext","picture","name","render","count","participantshtml","grouplist","groups","group","groupid","numgroupusers","raceResults","message","addClass","dispatchEvent","Event","manageCloudTags","improvisereply","printNewTag","manageTagsVotes","votedtag","scrollTop","scrollHeight","onerror","off","onclose","code","prepend","jsUrl","URL","protocol","pathname","toString","strings","nextQuestion","manageNext","pauseQuestion","playQuestion","resendSelf","jumpTo","detail","isteacher","js","runTemplateJS","setTimeout","questionEnd","notifyFilterContentUpdated","querySelector","showAnswers","hideAnswers","showStatistics","hideStatistics","showFeedback","hideFeedback","once","improvise","vote","currentQuestion","state","update","setNextQuestion","setEndSession","endData","delete","manual","nextquestion","endsession","firstQuestion","get","onsuccess","result","visible","initPanel","LOADING","requestResume","responseResume","requestResults","responseResults","finished","deleteDb","deleteDatabase","alert","nextQuestionData","removeEvents","CustomEvent","finalRanking","raceresults","programmedmode","sessionprogress","question_index_string","numquestions","scrollUsersTop","scrollQuestionsLeft","scrollLeft","newScrollUsers","newScrollQuestions","scrollUsers","questions","querySelectorAll","forEach","question","passive","provisionalRanking","deleted","currentQuestionData","questionNumber","position","statistics","improviseStatement","val","improviseReply","focus","css","cloudtagsData","deleteTag","bind","newtag","exist","length","map","tag","toLowerCase","votenum","maxCount","Math","max","item","size","ceil","voteTag","htmlTags","nameToDelete","currentTarget","attr","indexToDelete","findIndex","splice","currentQuestiondata","send"],"mappings":"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"}