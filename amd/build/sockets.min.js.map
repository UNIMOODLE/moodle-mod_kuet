{"version":3,"file":"sockets.min.js","sources":["../src/sockets.js"],"sourcesContent":["// TODO translate into @import.\ndefine(['jquery'], function($) {\n    \"use strict\";\n\n    let REGION = {\n        MESSAGEBOX: '#message-box',\n        USERLIST: '#userlist',\n        COUNTUSERS: '#countusers'\n    };\n\n    let ACTION = {\n        TEACHERSEND: '#teacher_send',\n        STUDENTSEND: '#student_send',\n        TEACHERMESSAGES: '#teacher_messages',\n        STUDENTMESSAGES: '#student_messages',\n    };\n\n    let portUrl = '8080';\n\n    /**\n     * @constructor\n     * @param {String} region\n     * @param {String} port\n     */\n    function Sockets(region, port) {\n        this.root = $(region);\n        portUrl = port;\n        this.initSockets();\n    }\n\n    /** @type {jQuery} The jQuery node for the page region. */\n    Sockets.prototype.root = null;\n\n    let userid = null;\n    let username = null;\n    let messageBox = null;\n    let userlist = null;\n    let countusers = null;\n    let teacherMessages = null;\n    let studentMessages = null;\n    let isteacher = null;\n    let cmid = null;\n    let sid = null;\n\n    Sockets.prototype.initSockets = function() {\n        userid = this.root[0].dataset.userid;\n        username = this.root[0].dataset.username;\n        isteacher = this.root[0].dataset.isteacher;\n        cmid = this.root[0].dataset.cmid;\n        sid = this.root[0].dataset.sid;\n        messageBox = this.root.find(REGION.MESSAGEBOX);\n        userlist = this.root.find(REGION.USERLIST);\n        countusers = this.root.find(REGION.COUNTUSERS);\n        teacherMessages = this.root.find(ACTION.TEACHERMESSAGES);\n        studentMessages = this.root.find(ACTION.STUDENTMESSAGES);\n        this.root.find(ACTION.TEACHERSEND).on('click', this.teacherSend.bind(this));\n        this.root.find(ACTION.STUDENTSEND).on('click', this.studentSend.bind(this));\n\n        Sockets.prototype.webSocket = new WebSocket(\n            'wss://' + M.cfg.wwwroot.replace(/^https?:\\/\\//, '') + ':' + portUrl + '/jqshow'\n        );\n\n        Sockets.prototype.webSocket.onopen = function() {\n            let msg = {\n                'id': userid,\n                'name': username,\n                'isteacher': isteacher,\n                'cmid': cmid,\n                'sid': sid,\n                'action': 'newuser',\n            };\n            Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n            messageBox.append(\n                '<div class=\"system_msg\" style=\"color:#bbbbbb\">' +\n                'Bienvenido a Jam Quiz Show ' + username + '!</div>'\n            );\n        };\n\n        Sockets.prototype.webSocket.onmessage = function(ev) {\n            let response = JSON.parse(ev.data); // PHP sends Json data.\n            let resAction = response.action; // Message type.\n            switch (resAction) {\n                case 'newuser':\n                    if (response.name !== undefined) {\n                        userlist.append(\n                            '<li data-userid=\"' + response.userid + '\">' +\n                            response.name + '</li>'\n                        );\n                        teacherMessages.append('<div>' + response.message + '</div>');\n                    }\n                    countusers.html(response.count);\n                    break;\n                case 'countusers':\n                    countusers.html(response.count);\n                    break;\n                case 'teacherSend':\n                    studentMessages.append('<div>' + response.message + '</div>');\n                    break;\n                case 'studentSend':\n                    teacherMessages.append('<div>' + response.message + '</div>');\n                    break;\n                case 'userdisconnected':\n                    $('[data-userid=\"' + response.id + '\"]').remove();\n                    teacherMessages.append('<div>' + response.message + '</div>');\n                    countusers.html(response.count);\n                    break;\n                default:\n                    break;\n            }\n            messageBox[0].scrollTop = messageBox[0].scrollHeight;\n        };\n\n        Sockets.prototype.webSocket.onerror = function(ev) {\n            messageBox.append('<div class=\"system_error\">Error Occurred - ' + ev.data + '</div>');\n        };\n\n        Sockets.prototype.webSocket.onclose = function() {\n            messageBox.append('<div class=\"system_msg\">Connection Closed</div>');\n        };\n    };\n\n    Sockets.prototype.teacherSend = function() {\n        let msg = {\n            'id': userid,\n            'name': username,\n            'action': 'teacherSend',\n        };\n        Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n    };\n\n    Sockets.prototype.studentSend = function() {\n        let msg = {\n            'id': userid,\n            'name': username,\n            'action': 'studentSend',\n        };\n        Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n    };\n\n    Sockets.prototype.sendMessageSocket = function(msg) {\n        this.webSocket.send(msg);\n    };\n\n    return {\n        /**\n         * @param {String} region\n         * @param {String} port\n         * @return {Sockets}\n         */\n        initSockets: function(region, port) {\n            return new Sockets(region, port);\n        },\n    };\n});\n"],"names":["define","$","REGION","ACTION","portUrl","Sockets","region","port","this","root","initSockets","prototype","userid","username","messageBox","userlist","countusers","teacherMessages","studentMessages","isteacher","cmid","sid","dataset","find","on","teacherSend","bind","studentSend","webSocket","WebSocket","M","cfg","wwwroot","replace","onopen","msg","id","name","action","sendMessageSocket","JSON","stringify","append","onmessage","ev","response","parse","data","undefined","message","html","count","remove","scrollTop","scrollHeight","onerror","onclose","send"],"mappings":"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"}