{"version":3,"file":"sockets.min.js","sources":["../src/sockets.js"],"sourcesContent":["// TODO translate into @import.\r\ndefine(['jquery'], function($) {\r\n    \"use strict\";\r\n\r\n    let REGION = {\r\n        MESSAGEBOX: '#message-box',\r\n        USERLIST: '#userlist',\r\n        COUNTUSERS: '#countusers'\r\n    };\r\n\r\n    let ACTION = {\r\n        TEACHERSEND: '#teacher_send',\r\n        STUDENTSEND: '#student_send',\r\n        TEACHERMESSAGES: '#teacher_messages',\r\n        STUDENTMESSAGES: '#student_messages',\r\n    };\r\n\r\n    let portUrl = '8080';\r\n\r\n    /**\r\n     * @constructor\r\n     * @param {String} region\r\n     * @param {String} port\r\n     */\r\n    function Sockets(region, port) {\r\n        this.root = $(region);\r\n        portUrl = port;\r\n        this.initSockets();\r\n    }\r\n\r\n    /** @type {jQuery} The jQuery node for the page region. */\r\n    Sockets.prototype.root = null;\r\n\r\n    let userid = null;\r\n    let username = null;\r\n    let messageBox = null;\r\n    let userlist = null;\r\n    let countusers = null;\r\n    let teacherMessages = null;\r\n    let studentMessages = null;\r\n    let isteacher = null;\r\n    let cmid = null;\r\n    let sid = null;\r\n\r\n    Sockets.prototype.initSockets = function() {\r\n        userid = this.root[0].dataset.userid;\r\n        username = this.root[0].dataset.username;\r\n        isteacher = this.root[0].dataset.isteacher;\r\n        cmid = this.root[0].dataset.cmid;\r\n        sid = this.root[0].dataset.sid;\r\n        messageBox = this.root.find(REGION.MESSAGEBOX);\r\n        userlist = this.root.find(REGION.USERLIST);\r\n        countusers = this.root.find(REGION.COUNTUSERS);\r\n        teacherMessages = this.root.find(ACTION.TEACHERMESSAGES);\r\n        studentMessages = this.root.find(ACTION.STUDENTMESSAGES);\r\n        this.root.find(ACTION.TEACHERSEND).on('click', this.teacherSend.bind(this));\r\n        this.root.find(ACTION.STUDENTSEND).on('click', this.studentSend.bind(this));\r\n\r\n        Sockets.prototype.webSocket = new WebSocket(\r\n            'wss://' + M.cfg.wwwroot.replace(/^https?:\\/\\//, '') + ':' + portUrl + '/jqshow'\r\n        );\r\n\r\n        Sockets.prototype.webSocket.onopen = function() {\r\n            let msg = {\r\n                'id': userid,\r\n                'name': username,\r\n                'isteacher': isteacher,\r\n                'cmid': cmid,\r\n                'sid': sid,\r\n                'action': 'newuser',\r\n            };\r\n            Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\r\n            messageBox.append(\r\n                '<div class=\"system_msg\" style=\"color:#bbbbbb\">' +\r\n                'Bienvenido a Jam Quiz Show ' + username + '!</div>'\r\n            );\r\n        };\r\n\r\n        Sockets.prototype.webSocket.onmessage = function(ev) {\r\n            let response = JSON.parse(ev.data); // PHP sends Json data.\r\n            let resAction = response.action; // Message type.\r\n            switch (resAction) {\r\n                case 'newuser':\r\n                    if (response.name !== undefined) {\r\n                        userlist.append(\r\n                            '<li data-userid=\"' + response.userid + '\">' +\r\n                            response.name + '</li>'\r\n                        );\r\n                        teacherMessages.append('<div>' + response.message + '</div>');\r\n                    }\r\n                    countusers.html(response.count);\r\n                    break;\r\n                case 'countusers':\r\n                    countusers.html(response.count);\r\n                    break;\r\n                case 'teacherSend':\r\n                    studentMessages.append('<div>' + response.message + '</div>');\r\n                    break;\r\n                case 'studentSend':\r\n                    teacherMessages.append('<div>' + response.message + '</div>');\r\n                    break;\r\n                case 'userdisconnected':\r\n                    $('[data-userid=\"' + response.id + '\"]').remove();\r\n                    teacherMessages.append('<div>' + response.message + '</div>');\r\n                    countusers.html(response.count);\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n            messageBox[0].scrollTop = messageBox[0].scrollHeight;\r\n        };\r\n\r\n        Sockets.prototype.webSocket.onerror = function(ev) {\r\n            messageBox.append('<div class=\"system_error\">Error Occurred - ' + ev.data + '</div>');\r\n        };\r\n\r\n        Sockets.prototype.webSocket.onclose = function() {\r\n            messageBox.append('<div class=\"system_msg\">Connection Closed</div>');\r\n        };\r\n    };\r\n\r\n    Sockets.prototype.teacherSend = function() {\r\n        let msg = {\r\n            'id': userid,\r\n            'name': username,\r\n            'action': 'teacherSend',\r\n        };\r\n        Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\r\n    };\r\n\r\n    Sockets.prototype.studentSend = function() {\r\n        let msg = {\r\n            'id': userid,\r\n            'name': username,\r\n            'action': 'studentSend',\r\n        };\r\n        Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\r\n    };\r\n\r\n    Sockets.prototype.sendMessageSocket = function(msg) {\r\n        this.webSocket.send(msg);\r\n    };\r\n\r\n    return {\r\n        /**\r\n         * @param {String} region\r\n         * @param {String} port\r\n         * @return {Sockets}\r\n         */\r\n        initSockets: function(region, port) {\r\n            return new Sockets(region, port);\r\n        },\r\n    };\r\n});\r\n"],"names":["define","$","REGION","ACTION","portUrl","Sockets","region","port","root","initSockets","prototype","userid","username","messageBox","userlist","countusers","teacherMessages","studentMessages","isteacher","cmid","sid","this","dataset","find","on","teacherSend","bind","studentSend","webSocket","WebSocket","M","cfg","wwwroot","replace","onopen","msg","sendMessageSocket","JSON","stringify","append","onmessage","ev","response","parse","data","action","undefined","name","message","html","count","id","remove","scrollTop","scrollHeight","onerror","onclose","send"],"mappings":"AACAA,4BAAO,CAAC,WAAW,SAASC,OAGpBC,kBACY,eADZA,gBAEU,YAFVA,kBAGY,cAGZC,mBACa,gBADbA,mBAEa,gBAFbA,uBAGiB,oBAHjBA,uBAIiB,oBAGjBC,QAAU,gBAOLC,QAAQC,OAAQC,WAChBC,KAAOP,EAAEK,QACdF,QAAUG,UACLE,cAITJ,QAAQK,UAAUF,KAAO,SAErBG,OAAS,KACTC,SAAW,KACXC,WAAa,KACbC,SAAW,KACXC,WAAa,KACbC,gBAAkB,KAClBC,gBAAkB,KAClBC,UAAY,KACZC,KAAO,KACPC,IAAM,YAEVf,QAAQK,UAAUD,YAAc,WAC5BE,OAASU,KAAKb,KAAK,GAAGc,QAAQX,OAC9BC,SAAWS,KAAKb,KAAK,GAAGc,QAAQV,SAChCM,UAAYG,KAAKb,KAAK,GAAGc,QAAQJ,UACjCC,KAAOE,KAAKb,KAAK,GAAGc,QAAQH,KAC5BC,IAAMC,KAAKb,KAAK,GAAGc,QAAQF,IAC3BP,WAAaQ,KAAKb,KAAKe,KAAKrB,mBAC5BY,SAAWO,KAAKb,KAAKe,KAAKrB,iBAC1Ba,WAAaM,KAAKb,KAAKe,KAAKrB,mBAC5Bc,gBAAkBK,KAAKb,KAAKe,KAAKpB,wBACjCc,gBAAkBI,KAAKb,KAAKe,KAAKpB,6BAC5BK,KAAKe,KAAKpB,oBAAoBqB,GAAG,QAASH,KAAKI,YAAYC,KAAKL,YAChEb,KAAKe,KAAKpB,oBAAoBqB,GAAG,QAASH,KAAKM,YAAYD,KAAKL,OAErEhB,QAAQK,UAAUkB,UAAY,IAAIC,UAC9B,SAAWC,EAAEC,IAAIC,QAAQC,QAAQ,eAAgB,IAAM,IAAM7B,QAAU,WAG3EC,QAAQK,UAAUkB,UAAUM,OAAS,eAC7BC,IAAM,IACAxB,YACEC,mBACKM,eACLC,SACDC,WACG,WAEdf,QAAQK,UAAU0B,kBAAkBC,KAAKC,UAAUH,MACnDtB,WAAW0B,OACP,4EACgC3B,SAAW,YAInDP,QAAQK,UAAUkB,UAAUY,UAAY,SAASC,QACzCC,SAAWL,KAAKM,MAAMF,GAAGG,aACbF,SAASG,YAEhB,eACqBC,IAAlBJ,SAASK,OACTjC,SAASyB,OACL,oBAAsBG,SAAS/B,OAAS,KACxC+B,SAASK,KAAO,SAEpB/B,gBAAgBuB,OAAO,QAAUG,SAASM,QAAU,WAExDjC,WAAWkC,KAAKP,SAASQ,iBAExB,aACDnC,WAAWkC,KAAKP,SAASQ,iBAExB,cACDjC,gBAAgBsB,OAAO,QAAUG,SAASM,QAAU,oBAEnD,cACDhC,gBAAgBuB,OAAO,QAAUG,SAASM,QAAU,oBAEnD,mBACD/C,EAAE,iBAAmByC,SAASS,GAAK,MAAMC,SACzCpC,gBAAgBuB,OAAO,QAAUG,SAASM,QAAU,UACpDjC,WAAWkC,KAAKP,SAASQ,OAKjCrC,WAAW,GAAGwC,UAAYxC,WAAW,GAAGyC,cAG5CjD,QAAQK,UAAUkB,UAAU2B,QAAU,SAASd,IAC3C5B,WAAW0B,OAAO,8CAAgDE,GAAGG,KAAO,WAGhFvC,QAAQK,UAAUkB,UAAU4B,QAAU,WAClC3C,WAAW0B,OAAO,qDAI1BlC,QAAQK,UAAUe,YAAc,eACxBU,IAAM,IACAxB,YACEC,gBACE,eAEdP,QAAQK,UAAU0B,kBAAkBC,KAAKC,UAAUH,OAGvD9B,QAAQK,UAAUiB,YAAc,eACxBQ,IAAM,IACAxB,YACEC,gBACE,eAEdP,QAAQK,UAAU0B,kBAAkBC,KAAKC,UAAUH,OAGvD9B,QAAQK,UAAU0B,kBAAoB,SAASD,UACtCP,UAAU6B,KAAKtB,MAGjB,CAMH1B,YAAa,SAASH,OAAQC,aACnB,IAAIF,QAAQC,OAAQC,OAGtC"}