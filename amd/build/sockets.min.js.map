{"version":3,"file":"sockets.min.js","sources":["../src/sockets.js"],"sourcesContent":["// TODO translate into @import.\ndefine(['jquery'], function($) {\n    \"use strict\";\n\n    let REGION = {\n        MESSAGEBOX: '#message-box',\n        USERLIST: '#userlist',\n        COUNTUSERS: '#countusers'\n    };\n\n    let ACTION = {\n        TEACHERSEND: '#teacher_send',\n        STUDENTSEND: '#student_send',\n        TEACHERMESSAGES: '#teacher_messages',\n        STUDENTMESSAGES: '#student_messages',\n    };\n\n    let portUrl = '8080';\n\n    /**\n     * @constructor\n     * @param {String} region\n     * @param {String} port\n     */\n    function Sockets(region, port) {\n        this.root = $(region);\n        portUrl = port;\n        this.initSockets();\n    }\n\n    /** @type {jQuery} The jQuery node for the page region. */\n    Sockets.prototype.root = null;\n\n    let userid = null;\n    let username = null;\n    let messageBox = null;\n    let userlist = null;\n    let countusers = null;\n    let teacherMessages = null;\n    let studentMessages = null;\n    let isteacher = null;\n\n    Sockets.prototype.initSockets = function() {\n        userid = this.root[0].dataset.userid;\n        username = this.root[0].dataset.username;\n        isteacher = this.root[0].dataset.isteacher;\n        messageBox = this.root.find(REGION.MESSAGEBOX);\n        userlist = this.root.find(REGION.USERLIST);\n        countusers = this.root.find(REGION.COUNTUSERS);\n        teacherMessages = this.root.find(ACTION.TEACHERMESSAGES);\n        studentMessages = this.root.find(ACTION.STUDENTMESSAGES);\n        this.root.find(ACTION.TEACHERSEND).on('click', this.teacherSend.bind(this));\n        this.root.find(ACTION.STUDENTSEND).on('click', this.studentSend.bind(this));\n\n        Sockets.prototype.webSocket = new WebSocket(\n            'wss://' + M.cfg.wwwroot.replace(/^https?:\\/\\//, '') + ':' + portUrl + '/jqshow'\n        );\n\n        Sockets.prototype.webSocket.onopen = function() {\n            let msg = {\n                'id': userid,\n                'name': username,\n                'isteacher': isteacher,\n                'action': 'newuser',\n            };\n            Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n            messageBox.append(\n                '<div class=\"system_msg\" style=\"color:#bbbbbb\">' +\n                'Bienvenido a Jam Quiz Show ' + username + '!</div>'\n            );\n        };\n\n        Sockets.prototype.webSocket.onmessage = function(ev) {\n            let response = JSON.parse(ev.data); // PHP sends Json data.\n            let resAction = response.action; // Message type.\n            switch (resAction) {\n                case 'newuser':\n                    if (response.name !== undefined) {\n                        userlist.append(\n                            '<li data-userid=\"' + response.userid + '\">' +\n                            response.name + '</li>'\n                        );\n                        teacherMessages.append('<div>' + response.message + '</div>');\n                    }\n                    countusers.html(response.count);\n                    break;\n                case 'countusers':\n                    countusers.html(response.count);\n                    break;\n                case 'teacherSend':\n                    studentMessages.append('<div>' + response.message + '</div>');\n                    break;\n                case 'studentSend':\n                    teacherMessages.append('<div>' + response.message + '</div>');\n                    break;\n                case 'userdisconnected':\n                    $('[data-userid=\"' + response.id + '\"]').remove();\n                    teacherMessages.append('<div>' + response.message + '</div>');\n                    countusers.html(response.count);\n                    break;\n                default:\n                    break;\n            }\n            messageBox[0].scrollTop = messageBox[0].scrollHeight;\n        };\n\n        Sockets.prototype.webSocket.onerror = function(ev) {\n            messageBox.append('<div class=\"system_error\">Error Occurred - ' + ev.data + '</div>');\n        };\n\n        Sockets.prototype.webSocket.onclose = function() {\n            messageBox.append('<div class=\"system_msg\">Connection Closed</div>');\n        };\n    };\n\n    Sockets.prototype.teacherSend = function() {\n        let msg = {\n            'id': userid,\n            'name': username,\n            'action': 'teacherSend',\n        };\n        Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n    };\n\n    Sockets.prototype.studentSend = function() {\n        let msg = {\n            'id': userid,\n            'name': username,\n            'action': 'studentSend',\n        };\n        Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n    };\n\n    Sockets.prototype.sendMessageSocket = function(msg) {\n        this.webSocket.send(msg);\n    };\n\n    return {\n        /**\n         * @param {String} region\n         * @param {String} port\n         * @return {Sockets}\n         */\n        initSockets: function(region, port) {\n            return new Sockets(region, port);\n        },\n    };\n});\n"],"names":["define","$","REGION","ACTION","portUrl","Sockets","region","port","this","root","initSockets","prototype","userid","username","messageBox","userlist","countusers","teacherMessages","studentMessages","isteacher","dataset","find","on","teacherSend","bind","studentSend","webSocket","WebSocket","M","cfg","wwwroot","replace","onopen","msg","id","name","action","sendMessageSocket","JSON","stringify","append","onmessage","ev","response","parse","data","undefined","message","html","count","remove","scrollTop","scrollHeight","onerror","onclose","send"],"mappings":"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"}