{"version":3,"file":"sockets.min.js","sources":["../src/sockets.js"],"sourcesContent":["define(['jquery'], function($) {\n    \"use strict\";\n\n    let REGION = {\n        MESSAGEBOX: '#message-box',\n        USERLIST: '#userlist',\n        COUNTUSERS: '#countusers'\n    };\n\n    let ACTION = {\n        TEACHERSEND: '#teacher_send',\n        STUDENTSEND: '#student_send',\n        TEACHERMESSAGES: '#teacher_messages',\n        STUDENTMESSAGES: '#student_messages',\n    };\n\n    /**\n     * @constructor\n     * @param {String} region\n     */\n    function Sockets(region) {\n        this.root = $(region);\n        this.initSockets();\n    }\n\n    /** @type {jQuery} The jQuery node for the page region. */\n    Sockets.prototype.root = null;\n    Sockets.prototype.webSocket = new WebSocket('wss://unimoodle311pre.3ip.eu:8080/jqshow');\n    //Sockets.prototype.webSocket = new WebSocket('wss://54.74.57.44:8080/jqshow');\n\n    let userid = null;\n    let username = null;\n    let messageBox = null;\n    let userlist = null;\n    let countusers = null;\n    let teacherMessages = null;\n    let studentMessages = null;\n    let isteacher = null;\n\n    Sockets.prototype.initSockets = function() {\n        userid = this.root[0].dataset.userid;\n        username = this.root[0].dataset.username;\n        isteacher = this.root[0].dataset.isteacher;\n        messageBox = this.root.find(REGION.MESSAGEBOX);\n        userlist = this.root.find(REGION.USERLIST);\n        countusers = this.root.find(REGION.COUNTUSERS);\n        teacherMessages = this.root.find(ACTION.TEACHERMESSAGES);\n        studentMessages = this.root.find(ACTION.STUDENTMESSAGES);\n        this.root.find(ACTION.TEACHERSEND).on('click', this.teacherSend.bind(this));\n        this.root.find(ACTION.STUDENTSEND).on('click', this.studentSend.bind(this));\n    };\n\n    Sockets.prototype.teacherSend = function() {\n        let msg = {\n            'id': userid,\n            'name': username,\n            'action': 'teacherSend',\n        };\n        Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n    };\n\n    Sockets.prototype.studentSend = function() {\n        let msg = {\n            'id': userid,\n            'name': username,\n            'action': 'studentSend',\n        };\n        Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n    };\n\n    /** **************************************************************************************************************/\n    Sockets.prototype.webSocket.onopen = function() {\n        let msg = {\n            'id': userid,\n            'name': username,\n            'isteacher': isteacher,\n            'action': 'newuser',\n        };\n        Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n        messageBox.append(\n            '<div class=\"system_msg\" style=\"color:#bbbbbb\">' +\n            'Bienvenido a Jam Quiz Show ' + username + '!</div>'\n        );\n    };\n\n    Sockets.prototype.webSocket.onmessage = function(ev) {\n        // eslint-disable-next-line no-console\n        //console.log(ev);\n        let response = JSON.parse(ev.data); // PHP sends Json data.\n        let resAction = response.action; // Message type.\n        // eslint-disable-next-line no-console\n        console.log(response);\n        switch (resAction) {\n            case 'newuser':\n                if (response.name !== undefined) {\n                    userlist.append(\n                        '<li data-userid=\"' + response.userid + '\">' +\n                        response.name + '</li>'\n                    );\n                    teacherMessages.append('<div>' + response.message + '</div>');\n                }\n                countusers.html(response.count);\n                break;\n            case 'countusers':\n                countusers.html(response.count);\n                break;\n            case 'teacherSend':\n                studentMessages.append('<div>' + response.message + '</div>');\n                break;\n            case 'studentSend':\n                teacherMessages.append('<div>' + response.message + '</div>');\n                break;\n            case 'userdisconnected':\n                $('[data-userid=\"' + response.id + '\"]').remove();\n                teacherMessages.append('<div>' + response.message + '</div>');\n                countusers.html(response.count);\n                break;\n            default:\n                break;\n        }\n        messageBox[0].scrollTop = messageBox[0].scrollHeight;\n    };\n\n    Sockets.prototype.webSocket.onerror = function(ev) {\n        messageBox.append('<div class=\"system_error\">Error Occurred - ' + ev.data + '</div>');\n    };\n\n    Sockets.prototype.webSocket.onclose = function() {\n        messageBox.append('<div class=\"system_msg\">Connection Closed</div>');\n    };\n\n    Sockets.prototype.sendMessageSocket = function(msg) {\n        this.webSocket.send(msg);\n    };\n\n    return {\n        /**\n         * @param {String} region\n         * @return {Sockets}\n         */\n        initSockets: function(region) {\n            return new Sockets(region);\n        },\n    };\n\n});\n"],"names":["define","$","REGION","ACTION","Sockets","region","this","root","initSockets","prototype","webSocket","WebSocket","userid","username","messageBox","userlist","countusers","teacherMessages","studentMessages","isteacher","dataset","find","on","teacherSend","bind","studentSend","msg","id","name","action","sendMessageSocket","JSON","stringify","onopen","append","onmessage","ev","response","parse","data","resAction","console","log","undefined","message","html","count","remove","scrollTop","scrollHeight","onerror","onclose","send"],"mappings":"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"}
