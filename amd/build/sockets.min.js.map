{"version":3,"file":"sockets.min.js","sources":["../src/sockets.js"],"sourcesContent":["define(['jquery'], function($) {\n    \"use strict\";\n\n    let REGION = {\n        MESSAGEBOX: '#message-box',\n        USERLIST: '#userlist',\n        COUNTUSERS: '#countusers'\n    };\n\n    let ACTION = {\n        TEACHERSEND: '#teacher_send',\n        STUDENTSEND: '#student_send',\n        TEACHERMESSAGES: '#teacher_messages',\n        STUDENTMESSAGES: '#student_messages',\n    };\n\n    /**\n     * @constructor\n     * @param {String} region\n     */\n    function Sockets(region) {\n        this.root = $(region);\n        this.initSockets();\n    }\n\n    /** @type {jQuery} The jQuery node for the page region. */\n    Sockets.prototype.root = null;\n    Sockets.prototype.webSocket = new WebSocket(\n        'wss://' + M.cfg.wwwroot.replace(/^https?:\\/\\//, '') + ':8080/jqshow'\n    );\n\n    let userid = null;\n    let username = null;\n    let messageBox = null;\n    let userlist = null;\n    let countusers = null;\n    let teacherMessages = null;\n    let studentMessages = null;\n    let isteacher = null;\n\n    Sockets.prototype.initSockets = function() {\n        userid = this.root[0].dataset.userid;\n        username = this.root[0].dataset.username;\n        isteacher = this.root[0].dataset.isteacher;\n        messageBox = this.root.find(REGION.MESSAGEBOX);\n        userlist = this.root.find(REGION.USERLIST);\n        countusers = this.root.find(REGION.COUNTUSERS);\n        teacherMessages = this.root.find(ACTION.TEACHERMESSAGES);\n        studentMessages = this.root.find(ACTION.STUDENTMESSAGES);\n        this.root.find(ACTION.TEACHERSEND).on('click', this.teacherSend.bind(this));\n        this.root.find(ACTION.STUDENTSEND).on('click', this.studentSend.bind(this));\n    };\n\n    Sockets.prototype.teacherSend = function() {\n        let msg = {\n            'id': userid,\n            'name': username,\n            'action': 'teacherSend',\n        };\n        Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n    };\n\n    Sockets.prototype.studentSend = function() {\n        let msg = {\n            'id': userid,\n            'name': username,\n            'action': 'studentSend',\n        };\n        Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n    };\n\n    /** **************************************************************************************************************/\n    Sockets.prototype.webSocket.onopen = function() {\n        let msg = {\n            'id': userid,\n            'name': username,\n            'isteacher': isteacher,\n            'action': 'newuser',\n        };\n        Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n        messageBox.append(\n            '<div class=\"system_msg\" style=\"color:#bbbbbb\">' +\n            'Bienvenido a Jam Quiz Show ' + username + '!</div>'\n        );\n    };\n\n    Sockets.prototype.webSocket.onmessage = function(ev) {\n        let response = JSON.parse(ev.data); // PHP sends Json data.\n        let resAction = response.action; // Message type.\n        switch (resAction) {\n            case 'newuser':\n                if (response.name !== undefined) {\n                    userlist.append(\n                        '<li data-userid=\"' + response.userid + '\">' +\n                        response.name + '</li>'\n                    );\n                    teacherMessages.append('<div>' + response.message + '</div>');\n                }\n                countusers.html(response.count);\n                break;\n            case 'countusers':\n                countusers.html(response.count);\n                break;\n            case 'teacherSend':\n                studentMessages.append('<div>' + response.message + '</div>');\n                break;\n            case 'studentSend':\n                teacherMessages.append('<div>' + response.message + '</div>');\n                break;\n            case 'userdisconnected':\n                $('[data-userid=\"' + response.id + '\"]').remove();\n                teacherMessages.append('<div>' + response.message + '</div>');\n                countusers.html(response.count);\n                break;\n            default:\n                break;\n        }\n        messageBox[0].scrollTop = messageBox[0].scrollHeight;\n    };\n\n    Sockets.prototype.webSocket.onerror = function(ev) {\n        messageBox.append('<div class=\"system_error\">Error Occurred - ' + ev.data + '</div>');\n    };\n\n    Sockets.prototype.webSocket.onclose = function() {\n        messageBox.append('<div class=\"system_msg\">Connection Closed</div>');\n    };\n\n    Sockets.prototype.sendMessageSocket = function(msg) {\n        this.webSocket.send(msg);\n    };\n\n    return {\n        /**\n         * @param {String} region\n         * @return {Sockets}\n         */\n        initSockets: function(region) {\n            return new Sockets(region);\n        },\n    };\n\n});\n"],"names":["define","$","REGION","ACTION","Sockets","region","this","root","initSockets","prototype","webSocket","WebSocket","M","cfg","wwwroot","replace","userid","username","messageBox","userlist","countusers","teacherMessages","studentMessages","isteacher","dataset","find","on","teacherSend","bind","studentSend","msg","id","name","action","sendMessageSocket","JSON","stringify","onopen","append","onmessage","ev","response","parse","data","undefined","message","html","count","remove","scrollTop","scrollHeight","onerror","onclose","send"],"mappings":"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"}