{"version":3,"file":"multichoice.min.js","sources":["../src/multichoice.js"],"sourcesContent":["\"use strict\";\r\n/* eslint-disable no-unused-vars */ // TODO remove.\r\n\r\nimport jQuery from 'jquery';\r\nimport Ajax from 'core/ajax';\r\nimport Notification from 'core/notification';\r\nimport Templates from 'core/templates';\r\n\r\nlet ACTION = {\r\n    REPLY: '[data-action=\"multichoice-answer\"]'\r\n};\r\n\r\nlet REGION = {\r\n    MULTICHOICE: '[data-region=\"multichoice\"]',\r\n    LOADING: '[data-region=\"overlay-icon-container\"]',\r\n    CONTENTFEEDBACKS: '[data-region=\"containt-feedbacks\"]',\r\n    FEEDBACK: '[data-region=\"statement-feedback\"]',\r\n    FEEDBACKANSWER: '[data-region=\"answer-feedback\"]',\r\n    FEEDBACKBACGROUND: '[data-region=\"feedback-background\"]',\r\n    STATEMENTTEXT: '[data-region=\"statement-text\"]',\r\n    TIMER: '[data-region=\"question-timer\"]',\r\n};\r\n\r\nlet SERVICES = {\r\n    REPLY: 'mod_jqshow_multichoice'\r\n};\r\n\r\nlet TEMPLATES = {\r\n    LOADING: 'core/overlay_loading'\r\n};\r\n\r\nlet cmId;\r\nlet sId;\r\nlet questionid;\r\nlet jqshowId;\r\n\r\n/**\r\n * @constructor\r\n * @param {String} selector\r\n */\r\nfunction MultiChoice(selector) {\r\n    this.node = jQuery(selector);\r\n    sId = this.node.attr('data-sid');\r\n    cmId = this.node.attr('data-cmid');\r\n    questionid = this.node.attr('data-questionid');\r\n    jqshowId = this.node.attr('data-jqshowid');\r\n    this.initMultichoice();\r\n}\r\n\r\n/** @type {jQuery} The jQuery node for the page region. */\r\nMultiChoice.prototype.node = null;\r\nMultiChoice.prototype.endTimer = new Event('endTimer');\r\nMultiChoice.prototype.questionEnd = new Event('questionEnd');\r\n\r\nMultiChoice.prototype.initMultichoice = function() {\r\n    this.node.find(ACTION.REPLY).on('click', this.reply.bind(this));\r\n    addEventListener('timeFinish', () => {\r\n        this.reply();\r\n    }, false);\r\n};\r\n\r\nMultiChoice.prototype.reply = function(e) {\r\n    let answerId = 0;\r\n    let that = this;\r\n    if (e !== undefined) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        answerId = jQuery(e.currentTarget).attr('data-answerid');\r\n    }\r\n    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\r\n        that.node.append(html);\r\n        dispatchEvent(that.endTimer);\r\n        let request = {\r\n            methodname: SERVICES.REPLY,\r\n            args: {\r\n                answerid: answerId,\r\n                sessionid: sId,\r\n                jqshowid: jqshowId,\r\n                cmid: cmId,\r\n                questionid: questionid,\r\n                preview: false\r\n            }\r\n        };\r\n        Ajax.call([request])[0].done(function(response) {\r\n            if (response.reply_status === true) {\r\n                if (response.hasfeedbacks) {\r\n                    jQuery(REGION.FEEDBACK).html(response.statment_feedback);\r\n                    jQuery(REGION.FEEDBACKANSWER).html(response.answer_feedback);\r\n                    jQuery(REGION.CONTENTFEEDBACKS).css({'display': 'block', 'z-index': 3});\r\n                }\r\n                jQuery(REGION.FEEDBACKBACGROUND).css('display', 'block');\r\n                jQuery(REGION.STATEMENTTEXT).css({'z-index': 3, 'padding': '15px'});\r\n                jQuery(REGION.TIMER).css('z-index', 3);\r\n                if (e !== undefined) {\r\n                    jQuery(e.currentTarget).css({'z-index': 3, 'pointer-events': 'none'});\r\n                }\r\n                if (response.correct_answers) {\r\n                    jQuery('.feedback-icon').css('display', 'flex');\r\n                    let correctAnswers = response.correct_answers.split(',');\r\n                    correctAnswers.forEach((answ) => {\r\n                        jQuery('[data-answerid=\"' + answ + '\"] .incorrect').css('display', 'none');\r\n                    });\r\n                }\r\n                setTimeout(function() {\r\n                    let contentHeight = jQuery(REGION.MULTICHOICE).outerHeight();\r\n                    jQuery(REGION.FEEDBACKBACGROUND).css('height', contentHeight + 'px');\r\n                }, 15);\r\n                dispatchEvent(that.questionEnd);\r\n            } else {\r\n                alert('error');\r\n            }\r\n            jQuery(REGION.LOADING).remove();\r\n        }).fail(Notification.exception);\r\n    });\r\n};\r\n\r\nexport const initMultiChoice = (selector) => {\r\n    return new MultiChoice(selector);\r\n};\r\n"],"names":["cmId","sId","questionid","jqshowId","ACTION","REGION","SERVICES","TEMPLATES","MultiChoice","selector","node","this","attr","initMultichoice","prototype","endTimer","Event","questionEnd","find","on","reply","bind","addEventListener","e","answerId","that","undefined","preventDefault","stopPropagation","currentTarget","render","visible","done","html","append","dispatchEvent","request","methodname","args","answerid","sessionid","jqshowid","cmid","preview","call","response","reply_status","hasfeedbacks","statment_feedback","answer_feedback","css","correct_answers","split","forEach","answ","setTimeout","contentHeight","outerHeight","alert","remove","fail","Notification","exception"],"mappings":"6fA+BIA,KACAC,IACAC,WACAC,SA1BAC,aACO,qCAGPC,mBACa,8BADbA,eAES,yCAFTA,wBAGkB,qCAHlBA,gBAIU,qCAJVA,sBAKgB,kCALhBA,yBAMmB,sCANnBA,qBAOe,iCAPfA,aAQO,iCAGPC,eACO,yBAGPC,kBACS,gCAYJC,YAAYC,eACZC,MAAO,mBAAOD,UACnBR,IAAMU,KAAKD,KAAKE,KAAK,YACrBZ,KAAOW,KAAKD,KAAKE,KAAK,aACtBV,WAAaS,KAAKD,KAAKE,KAAK,mBAC5BT,SAAWQ,KAAKD,KAAKE,KAAK,sBACrBC,kBAITL,YAAYM,UAAUJ,KAAO,KAC7BF,YAAYM,UAAUC,SAAW,IAAIC,MAAM,YAC3CR,YAAYM,UAAUG,YAAc,IAAID,MAAM,eAE9CR,YAAYM,UAAUD,gBAAkB,gBAC/BH,KAAKQ,KAAKd,cAAce,GAAG,QAASR,KAAKS,MAAMC,KAAKV,OACzDW,iBAAiB,cAAc,UACtBF,WACN,IAGPZ,YAAYM,UAAUM,MAAQ,SAASG,OAC/BC,SAAW,EACXC,KAAOd,UACDe,IAANH,IACAA,EAAEI,iBACFJ,EAAEK,kBACFJ,UAAW,mBAAOD,EAAEM,eAAejB,KAAK,qCAElCkB,OAAOvB,kBAAmB,CAACwB,SAAS,IAAOC,MAAK,SAASC,MAC/DR,KAAKf,KAAKwB,OAAOD,MACjBE,cAAcV,KAAKV,cACfqB,QAAU,CACVC,WAAY/B,eACZgC,KAAM,CACFC,SAAUf,SACVgB,UAAWvC,IACXwC,SAAUtC,SACVuC,KAAM1C,KACNE,WAAYA,WACZyC,SAAS,kBAGZC,KAAK,CAACR,UAAU,GAAGJ,MAAK,SAASa,cACJ,IAA1BA,SAASC,aAAuB,IAC5BD,SAASE,mCACF1C,iBAAiB4B,KAAKY,SAASG,uCAC/B3C,uBAAuB4B,KAAKY,SAASI,qCACrC5C,yBAAyB6C,IAAI,SAAY,kBAAoB,yBAEjE7C,0BAA0B6C,IAAI,UAAW,6BACzC7C,sBAAsB6C,IAAI,WAAY,UAAc,6BACpD7C,cAAc6C,IAAI,UAAW,QAC1BxB,IAANH,uBACOA,EAAEM,eAAeqB,IAAI,WAAY,mBAAqB,SAE7DL,SAASM,gBAAiB,qBACnB,kBAAkBD,IAAI,UAAW,QACnBL,SAASM,gBAAgBC,MAAM,KACrCC,SAASC,2BACb,mBAAqBA,KAAO,iBAAiBJ,IAAI,UAAW,WAG3EK,YAAW,eACHC,eAAgB,mBAAOnD,oBAAoBoD,kCACxCpD,0BAA0B6C,IAAI,SAAUM,cAAgB,QAChE,IACHrB,cAAcV,KAAKR,kBAEnByC,MAAM,6BAEHrD,gBAAgBsD,YACxBC,KAAKC,sBAAaC,wCAIGrD,UACrB,IAAID,YAAYC"}