define("mod_jqshow/sessionquestions",["exports","jquery","core/str","core/ajax","core/modal_factory","core/modal_events","core/templates","core/notification"],(function(_exports,_jquery,_str,_ajax,_modal_factory,_modal_events,_templates,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.initSessionQuestions=void 0,_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_templates=_interopRequireDefault(_templates),_notification=_interopRequireDefault(_notification);let cmId,sId,jqshowId,ACTION_COPYQUESTION='[data-action="copy_question"]',ACTION_DELETEQUESTION='[data-action="delete_question"]',SERVICES_COPYQUESTION="mod_jqshow_copyquestion",SERVICES_DELETEQUESTION="mod_jqshow_deletequestion",SERVICES_SESSIONQUESTIONS="mod_jqshow_sessionquestions",REGION_PANEL='[data-region="questions-panel"]',REGION_LOADING='[data-region="overlay-icon-container"]',REGION_SESSIONQUESTIONS='[data-region="session-questions"]',TEMPLATES_LOADING="core/overlay_loading",TEMPLATES_QUESTIONSSELECTED="mod_jqshow/createsession/sessionquestions";function SessionQuestions(selector){this.node=(0,_jquery.default)(selector),sId=this.node.attr("data-sid"),cmId=this.node.attr("data-cmid"),jqshowId=this.node.attr("data-jqshowid"),this.initPanel()}SessionQuestions.prototype.node=null,SessionQuestions.prototype.initPanel=function(){this.node.find(ACTION_COPYQUESTION).on("click",this.copyQuestion.bind(this)),this.node.find(ACTION_DELETEQUESTION).on("click",this.deleteQuestion.bind(this))},SessionQuestions.prototype.copyQuestion=function(e){e.preventDefault(),e.stopPropagation();let that=this,questionId=(0,_jquery.default)(e.currentTarget).attr("data-questionnid");(0,_str.get_strings)([{key:"copyquestion",component:"mod_jqshow"},{key:"copyquestion_desc",component:"mod_jqshow"},{key:"confirm",component:"mod_jqshow"}]).then((langStrings=>{const title=langStrings[0],message=langStrings[1],buttonText=langStrings[2];return _modal_factory.default.create({title:title,body:message,type:_modal_factory.default.types.SAVE_CANCEL}).then((modal=>(modal.setSaveButtonText(buttonText),modal.getRoot().on(_modal_events.default.save,(()=>{_templates.default.render(TEMPLATES_LOADING,{visible:!0}).done((function(html){(0,_jquery.default)(REGION_PANEL).append(html)}));let request={methodname:SERVICES_COPYQUESTION,args:{qid:questionId}};_ajax.default.call([request])[0].done((function(response){response.copied?that.reloadSessionQuestionsHtml():((0,_jquery.default)(REGION_LOADING).remove(),alert("no se ha podido borrar la pregunta. intentalo de nuevo mas tarde."))}))})),modal.getRoot().on(_modal_events.default.hidden,(()=>{modal.destroy()})),modal)))})).done((function(modal){modal.show()})).fail(_notification.default.exception)},SessionQuestions.prototype.reloadSessionQuestionsHtml=function(){let request={methodname:SERVICES_SESSIONQUESTIONS,args:{jqshowid:jqshowId,cmid:cmId,sid:sId}};_ajax.default.call([request])[0].done((function(response){_templates.default.render(TEMPLATES_QUESTIONSSELECTED,response).then((function(html,js){(0,_jquery.default)(REGION_SESSIONQUESTIONS).html(html),_templates.default.runTemplateJS(js),(0,_jquery.default)(REGION_LOADING).remove()})).fail(_notification.default.exception)})).fail(_notification.default.exception)},SessionQuestions.prototype.deleteQuestion=function(e){e.preventDefault(),e.stopPropagation();let that=this,questionId=(0,_jquery.default)(e.currentTarget).attr("data-questionnid");(0,_str.get_strings)([{key:"deletequestion",component:"mod_jqshow"},{key:"deletequestion_desc",component:"mod_jqshow"},{key:"confirm",component:"mod_jqshow"}]).then((langStrings=>{const title=langStrings[0],message=langStrings[1],buttonText=langStrings[2];return _modal_factory.default.create({title:title,body:message,type:_modal_factory.default.types.SAVE_CANCEL}).then((modal=>(modal.setSaveButtonText(buttonText),modal.getRoot().on(_modal_events.default.save,(()=>{_templates.default.render(TEMPLATES_LOADING,{visible:!0}).done((function(html){(0,_jquery.default)(REGION_PANEL).append(html)}));let request={methodname:SERVICES_DELETEQUESTION,args:{qid:questionId,sid:sId}};_ajax.default.call([request])[0].done((function(response){response.deleted?that.reloadSessionQuestionsHtml():((0,_jquery.default)(REGION_LOADING).remove(),alert("no se ha podido borrar la pregunta. intentalo de nuevo mas tarde."))}))})),modal.getRoot().on(_modal_events.default.hidden,(()=>{modal.destroy()})),modal)))})).done((function(modal){modal.show()})).fail(_notification.default.exception)};_exports.initSessionQuestions=selector=>new SessionQuestions(selector)}));

//# sourceMappingURL=sessionquestions.min.js.map