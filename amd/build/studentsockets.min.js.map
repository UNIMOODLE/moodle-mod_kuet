{"version":3,"file":"studentsockets.min.js","sources":["../src/studentsockets.js"],"sourcesContent":["\"use strict\";\n/* eslint-disable no-console*/ // TODO delete.\n/* eslint-disable no-unused-vars */\nimport jQuery from 'jquery';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\nimport Ajax from 'core/ajax';\nimport Encryptor from 'mod_jqshow/encryptor';\nimport mEvent from 'core/event';\n\nlet REGION = {\n    MESSAGEBOX: '#message-box',\n    USERLIST: '[data-region=\"active-users\"]',\n    COUNTUSERS: '#countusers',\n    ROOT: '[data-region=\"student-canvas\"]',\n    IMPROVISE: '[data-region=\"student-improvise\"]',\n    IMPROVISEREPLY: '.improvise-student-form #reply_student_improvise',\n    TAGSCONTENT: '[data-region=\"tags-content\"]',\n};\n\nlet ACTIONS = {\n    REPLYIMPROVISE: '.improvise-response-content [data-action=\"submit-improvise\"]'\n};\n\nlet SERVICES = {\n    SESSIONFIINISHED: 'mod_jqshow_sessionfinished',\n    USERQUESTIONRESPONSE: 'mod_jqshow_getuserquestionresponse'\n};\n\nlet TEMPLATES = {\n    LOADING: 'core/overlay_loading',\n    SUCCESS: 'core/notification_success',\n    ERROR: 'core/notification_error',\n    PARTICIPANT: 'mod_jqshow/session/manual/waitingroom/participant',\n    GROUPPARTICIPANT: 'mod_jqshow/session/manual/waitingroom/groupparticipant',\n    SESSIONFIINISHED: 'mod_jqshow/session/manual/closeconnection',\n    QUESTION: 'mod_jqshow/questions/encasement',\n    PROVISIONALRANKING: 'mod_jqshow/ranking/provisional',\n    IMPROVISESTUDENTRESPONSE: 'mod_jqshow/session/manual/improvise/studentresponse',\n};\n\nlet portUrl = '8080';\nlet socketUrl = '';\n\n/**\n * @constructor\n * @param {String} region\n * @param {String} socketurl\n * @param {String} port\n */\nfunction Sockets(region, socketurl, port) {\n    this.root = jQuery(region);\n    socketUrl = socketurl;\n    portUrl = port;\n    this.initSockets();\n    this.disableDevTools();\n    this.initListeners();\n}\n\nSockets.prototype.disableDevTools = function() {\n    document.addEventListener('contextmenu', (e) => e.preventDefault());\n    document.onkeydown = (e) => {\n        return !(event.keyCode === 123 ||\n            this.ctrlShiftKey(e, 'I') ||\n            this.ctrlShiftKey(e, 'J') ||\n            this.ctrlShiftKey(e, 'C') ||\n            (e.ctrlKey && e.keyCode === 'U'.charCodeAt(0)));\n    };\n};\n\nSockets.prototype.ctrlShiftKey = function(e, keyCode) {\n    return e.ctrlKey && e.shiftKey && e.keyCode === keyCode.charCodeAt(0);\n};\n\n/** @type {jQuery} The jQuery node for the page region. */\nSockets.prototype.root = null;\n\nlet userid = null;\nlet usersocketid = null;\nlet username = null;\nlet userimage = null;\nlet messageBox = null;\nlet countusers = null;\nlet cmid = null;\nlet sid = null;\nlet jqshowid = null;\nlet currentCuestionJqid = null;\nlet groupid = 0;\nlet groupmode = 0;\nlet groupimage = null;\nlet groupname = null;\nlet improviseReplied = false;\n\nSockets.prototype.initSockets = function() {\n    userid = this.root[0].dataset.userid;\n    username = this.root[0].dataset.username;\n    userimage = this.root[0].dataset.userimage;\n    jqshowid = this.root[0].dataset.jqshowid;\n    cmid = this.root[0].dataset.cmid;\n    sid = this.root[0].dataset.sid;\n    messageBox = this.root.find(REGION.MESSAGEBOX);\n    countusers = this.root.find(REGION.COUNTUSERS);\n    groupmode = this.root[0].dataset.groupmode;\n    if (groupmode != '0') {\n        groupimage = this.root[0].dataset.groupimage;\n        groupid = parseInt(this.root[0].dataset.groupid);\n        groupname = this.root[0].dataset.groupname;\n    }\n\n    Sockets.prototype.webSocket = new WebSocket(\n        'wss://' + socketUrl.replace(/^https?:\\/\\//, '') + ':' + portUrl + '/jqshow'\n    );\n\n    Sockets.prototype.webSocket.onopen = function() {\n\n    };\n\n    Sockets.prototype.webSocket.onmessage = function(ev) {\n        let msgDecrypt = Encryptor.decrypt(ev.data);\n        let response = JSON.parse(msgDecrypt); // PHP sends Json data.\n        let resAction = response.action; // Message type.\n        switch (resAction) {\n            case 'connect':\n                // The server has returned the connected status, it is time to identify yourself.\n                if (response.usersocketid !== undefined) {\n                    usersocketid = response.usersocketid;\n                    let msg = {\n                        'userid': userid,\n                        'name': username,\n                        'pic': userimage, // TODO encrypt.\n                        'cmid': cmid,\n                        'sid': sid,\n                        'usersocketid': usersocketid,\n                        'action': 'newuser',\n                    };\n                    if (groupmode) {\n                        msg.action = 'newgroup';\n                        msg.name = groupname;\n                        msg.pic = groupimage; // TODO encrypt.\n                        msg.groupid = groupid;\n                    }\n                    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n                }\n                break;\n            case 'newuser': {\n                let identifier = jQuery(REGION.USERLIST);\n                let data = response.students;\n                identifier.html('');\n                jQuery.each(data, function (i, student) {\n                    let templateContext = {\n                        'usersocketid': student.usersocketid,\n                        'userimage': student.picture,\n                        'userfullname': student.name,\n                    };\n                    Templates.render(TEMPLATES.PARTICIPANT, templateContext).then(function(html) {\n                        identifier.append(html);\n                    }).fail(Notification.exception);\n                });\n                countusers.html(response.count);\n                break;\n            }\n            case 'newgroup': {\n                let participantshtml = jQuery(REGION.USERLIST);\n                let grouplist = response.groups;\n                participantshtml.html('');\n                jQuery.each(grouplist, function (i, group) {\n                    let templateContext = {\n                        'usersocketid': group.usersocketid,\n                        'groupimage': group.picture,\n                        'groupid': group.groupid,\n                        'name': group.name,\n                        'numgroupusers': group.numgroupusers,\n                    };\n                    Templates.render(TEMPLATES.GROUPPARTICIPANT, templateContext).then(function(html) {\n                        participantshtml.append(html);\n                    }).fail(Notification.exception);\n                });\n                countusers.html(response.count);\n                break;\n            }\n            case 'countusers':\n                countusers.html(response.count);\n                break;\n            case 'question':\n                Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                    let identifier = jQuery(REGION.ROOT);\n                    identifier.append(html);\n                    currentCuestionJqid = response.context.jqid;\n                    let request = {\n                        methodname: SERVICES.USERQUESTIONRESPONSE,\n                        args: {\n                            jqid: response.context.jqid,\n                            cmid: cmid,\n                            sid: sid,\n                            uid: 0\n                        }\n                    };\n                    Ajax.call([request])[0].done(function(answer) {\n                        const questionData = {\n                            ...response.context.value,\n                            ...answer\n                        };\n                        Templates.render(TEMPLATES.QUESTION, questionData).then(function(html, js) {\n                            identifier.html(html);\n                            Templates.runTemplateJS(js);\n                            mEvent.notifyFilterContentUpdated(document.querySelector(REGION.ROOT));\n                            jQuery(REGION.LOADING).remove();\n                        }).fail(Notification.exception);\n                    });\n                });\n                break;\n            case 'ranking':\n                Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                    let identifier = jQuery(REGION.ROOT);\n                    identifier.append(html);\n                    Templates.render(TEMPLATES.PROVISIONALRANKING, response.context).then(function(html, js) {\n                        identifier.html(html);\n                        Templates.runTemplateJS(js);\n                        jQuery(REGION.LOADING).remove();\n                    }).fail(Notification.exception);\n                });\n                break;\n            case 'pauseQuestion':\n                dispatchEvent(new Event('pauseQuestion_' + response.jqid));\n                break;\n            case 'playQuestion':\n                dispatchEvent(new Event('playQuestion_' + response.jqid));\n                break;\n            case 'showAnswers':\n                dispatchEvent(new Event('showAnswers_' + response.jqid));\n                break;\n            case 'hideAnswers':\n                dispatchEvent(new Event('hideAnswers_' + response.jqid));\n                break;\n            case 'showStatistics':\n                dispatchEvent(new Event('showStatistics_' + response.jqid));\n                break;\n            case 'hideStatistics':\n                dispatchEvent(new Event('hideStatistics_' + response.jqid));\n                break;\n            case 'showFeedback':\n                dispatchEvent(new Event('showFeedback_' + response.jqid));\n                break;\n            case 'hideFeedback':\n                dispatchEvent(new Event('hideFeedback_' + response.jqid));\n                break;\n            case 'improvising':\n                jQuery(REGION.IMPROVISE).removeClass('d-none');\n                jQuery(REGION.ROOT).addClass('d-none');\n                break;\n            case 'closeImprovise':\n                jQuery(REGION.IMPROVISE).addClass('d-none');\n                jQuery(REGION.ROOT).removeClass('d-none');\n                break;\n            case 'improvised':\n                Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                    jQuery(REGION.IMPROVISE).addClass('d-none');\n                    jQuery(REGION.ROOT).removeClass('d-none');\n                    let identifier = jQuery(REGION.ROOT);\n                    identifier.append(html);\n                    Templates.render(TEMPLATES.IMPROVISESTUDENTRESPONSE, response).then(function(html, js) {\n                        identifier.html(html);\n                        jQuery(ACTIONS.REPLYIMPROVISE).on('click', Sockets.prototype.replyImprovise);\n                        jQuery(REGION.LOADING).remove();\n                    }).fail(Notification.exception);\n                });\n                break;\n            case 'printNewTag':\n                // eslint-disable-next-line no-case-declarations\n                let htmlTags = '';\n                response.tags.forEach(tag => {\n                    htmlTags += '<li><span class=\"tag\" data-count=\"' + tag.count + '\"  data-size=\"' + tag.size + '\">' +\n                        tag.name + '</span></li>';\n                });\n                jQuery(REGION.TAGSCONTENT).html(htmlTags);\n                break;\n            case 'endSession':\n                jQuery(REGION.IMPROVISE).addClass('d-none');\n                jQuery(REGION.ROOT).removeClass('d-none');\n                Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                    let identifier = jQuery(REGION.ROOT);\n                    identifier.append(html);\n                    currentCuestionJqid = response.context.jqid;\n                    Templates.render(TEMPLATES.QUESTION, response.context.value).then(function(html, js) {\n                        identifier.html(html);\n                        Templates.runTemplateJS(js);\n                        jQuery(REGION.LOADING).remove();\n                    }).fail(Notification.exception);\n                });\n                break;\n            case 'teacherQuestionEnd':\n                dispatchEvent(new CustomEvent('teacherQuestionEnd_' + response.jqid, {\n                    \"detail\": {\"statistics\": response.statistics}\n                }));\n                break;\n            case 'userdisconnected':\n                jQuery('[data-userid=\"' + response.usersocketid + '\"]').remove();\n                countusers.html(response.count);\n                break;\n            default:\n                break;\n        }\n        messageBox[0].scrollTop = messageBox[0].scrollHeight;\n    };\n\n    Sockets.prototype.webSocket.onerror = function(ev) {\n        messageBox.append('<div class=\"system_error\">Error Occurred - ' + ev.data + '</div>');\n    };\n\n    Sockets.prototype.webSocket.onclose = function() {\n        jQuery(REGION.IMPROVISE).addClass('d-none');\n        jQuery(REGION.ROOT).removeClass('d-none');\n        let request = {\n            methodname: SERVICES.SESSIONFIINISHED,\n            args: {\n                jqshowid: jqshowid,\n                cmid: cmid\n            }\n        };\n        Ajax.call([request])[0].done(function(response) {\n            Templates.render(TEMPLATES.SESSIONFIINISHED, response).then(function(html, js) {\n                jQuery(REGION.ROOT).html(html);\n                Templates.runTemplateJS(js);\n            }).fail(Notification.exception);\n        });\n    };\n};\n\nSockets.prototype.initListeners = function() {\n    addEventListener('studentQuestionEnd', () => {\n        // TODO get the result and score of the user's response and send it to the socket for the teacher to receive.\n        // TODO there is no way to get the note yet, it can be stored in dataSotarge with id->currentsid so that it can pick it up.\n        let msg = {\n            'userid': userid,\n            'sid': sid,\n            'usersocketid': usersocketid,\n            'jqid': currentCuestionJqid,\n            'answer': '', // TODO get pulsed response.\n            'points': '', // TODO obtain total score.\n            'oft': true, // IMPORTANT: Only for teacher.\n            'action': 'studentQuestionEnd',\n        };\n        Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n    }, false);\n};\n\nSockets.prototype.replyImprovise = function() {\n    let improviseReply = jQuery(REGION.IMPROVISEREPLY).val();\n    if (improviseReply === '') {\n        jQuery(REGION.IMPROVISEREPLY).focus(() => {\n            jQuery(REGION.IMPROVISEREPLY).css({'border-color': 'red'});\n        });\n    } else {\n        improviseReplied = true;\n        Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n            jQuery(REGION.IMPROVISE).addClass('d-none');\n            jQuery(REGION.ROOT).removeClass('d-none');\n            jQuery(REGION.IMPROVISEREPLY).val('');\n            let cloudtagsData = {\n                'sessionid': sid,\n                'cmid': cmid,\n                'question_index_string': 'improvised',\n                'sessionprogress': 0,\n                'cloudtags': true,\n                'isteacher': false,\n                'questiontext': jQuery('.improvise-statement').text(),\n                'programmedmode': false,\n                'preview': false,\n                'tags': [{name: improviseReply, count: 1, size: 9}]\n            };\n            Templates.render(TEMPLATES.QUESTION, cloudtagsData).then(function(html) {\n                jQuery(REGION.ROOT).html(html);\n                jQuery(REGION.LOADING).remove();\n                let msg = {\n                    'action': 'ImproviseStudentTag',\n                    'sid': sid,\n                    'oft': true, // IMPORTANT: Only for teacher.\n                    'improvisereply': improviseReply,\n                    'sessionid': sid,\n                    'cmid': cmid,\n                    'userid': userid,\n                };\n                Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n            }).fail(Notification.exception);\n        });\n    }\n};\n\nSockets.prototype.sendMessageSocket = function(msg) {\n    this.webSocket.send(msg);\n};\n\nexport const studentInitSockets = (region, socketurl, port) => {\n    return new Sockets(region, socketurl, port);\n};\n"],"names":["_interopRequireDefault","obj","__esModule","default","_typeof","Symbol","iterator","constructor","prototype","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","value","arg","input","hint","prim","toPrimitive","undefined","res","call","TypeError","String","Number","_toPrimitive","_toPropertyKey","configurable","writable","_exports","studentInitSockets","_jquery","_templates","_notification","_ajax","_encryptor","_event","REGION","MESSAGEBOX","USERLIST","COUNTUSERS","ROOT","IMPROVISE","IMPROVISEREPLY","TAGSCONTENT","ACTIONS","SERVICES","TEMPLATES","portUrl","socketUrl","Sockets","region","socketurl","port","this","root","jQuery","initSockets","disableDevTools","initListeners","_this","document","addEventListener","e","preventDefault","onkeydown","event","keyCode","ctrlShiftKey","ctrlKey","charCodeAt","shiftKey","userid","usersocketid","username","userimage","messageBox","countusers","cmid","sid","jqshowid","currentCuestionJqid","groupid","groupmode","groupimage","groupname","dataset","find","parseInt","webSocket","WebSocket","replace","onopen","onmessage","ev","msgDecrypt","Encryptor","decrypt","data","response","JSON","parse","action","msg","name","pic","sendMessageSocket","stringify","identifier","students","html","each","student","templateContext","picture","userfullname","Templates","render","then","append","fail","Notification","exception","count","participantshtml","grouplist","groups","group","numgroupusers","visible","done","context","jqid","request","methodname","args","uid","Ajax","answer","questionData","js","runTemplateJS","mEvent","notifyFilterContentUpdated","querySelector","LOADING","remove","dispatchEvent","Event","removeClass","addClass","on","replyImprovise","htmlTags","tags","tag","size","CustomEvent","detail","statistics","scrollTop","scrollHeight","onerror","onclose","points","oft","improviseReply","val","focus","css","cloudtagsData","sessionid","question_index_string","sessionprogress","cloudtags","isteacher","questiontext","text","programmedmode","preview","improvisereply","send"],"mappings":"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"}