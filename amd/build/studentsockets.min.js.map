{"version":3,"file":"studentsockets.min.js","sources":["../src/studentsockets.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n// Project implemented by the \"Recovery, Transformation and Resilience Plan.\n// Funded by the European Union - Next GenerationEU\".\n//\n// Produced by the UNIMOODLE University Group: Universities of\n// Valladolid, Complutense de Madrid, UPV/EHU, León, Salamanca,\n// Illes Balears, Valencia, Rey Juan Carlos, La Laguna, Zaragoza, Málaga,\n// Córdoba, Extremadura, Vigo, Las Palmas de Gran Canaria y Burgos..\n\n/**\n *\n * @module    mod_kuet/studentsockets\n * @copyright  2023 Proyecto UNIMOODLE {@link https://unimoodle.github.io}\n * @author     UNIMOODLE Group (Coordinator) <direccion.area.estrategia.digital@uva.es>\n * @author     3IPUNT <contacte@tresipunt.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n\"use strict\";\nimport jQuery from 'jquery';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\nimport Ajax from 'core/ajax';\nimport Encryptor from 'mod_kuet/encryptor';\nimport mEvent from 'core/event';\nimport {get_strings as getStrings} from 'core/str';\n\nlet REGION = {\n    MESSAGEBOX: '#message-box',\n    USERLIST: '[data-region=\"active-users\"]',\n    COUNTUSERS: '#countusers',\n    ROOT: '[data-region=\"student-canvas\"]',\n    IMPROVISE: '[data-region=\"student-improvise\"]',\n    IMPROVISEREPLY: '.improvise-student-form #reply_student_improvise',\n    TAGSCONTENT: '[data-region=\"tags-content\"]',\n    VOTETAG: '[data-action=\"vote-tag\"]',\n};\n\nlet ACTIONS = {\n    REPLYIMPROVISE: '.improvise-response-content [data-action=\"submit-improvise\"]'\n};\n\nlet SERVICES = {\n    SESSIONFIINISHED: 'mod_kuet_sessionfinished',\n    USERQUESTIONRESPONSE: 'mod_kuet_getuserquestionresponse'\n};\n\nlet TEMPLATES = {\n    LOADING: 'core/overlay_loading',\n    SUCCESS: 'core/notification_success',\n    ERROR: 'core/notification_error',\n    PARTICIPANT: 'mod_kuet/session/manual/waitingroom/participant',\n    GROUPPARTICIPANT: 'mod_kuet/session/manual/waitingroom/groupparticipant',\n    SESSIONFIINISHED: 'mod_kuet/session/manual/closeconnection',\n    QUESTION: 'mod_kuet/questions/encasement',\n    PROVISIONALRANKING: 'mod_kuet/ranking/provisional',\n    IMPROVISESTUDENTRESPONSE: 'mod_kuet/session/manual/improvise/studentresponse',\n};\n\nlet portUrl = '8080';\nlet socketUrl = '';\n\n/**\n * @constructor\n * @param {String} region\n * @param {String} socketurl\n * @param {String} port\n */\nfunction Sockets(region, socketurl, port) {\n    this.root = jQuery(region);\n    socketUrl = socketurl;\n    portUrl = port;\n    this.initSockets();\n    this.disableDevTools();\n    this.initListeners();\n}\n\nSockets.prototype.disableDevTools = function() {\n    document.addEventListener('contextmenu', (e) => e.preventDefault());\n    document.onkeydown = (e) => {\n        return !(event.keyCode === 123 ||\n            this.ctrlShiftKey(e, 'I') ||\n            this.ctrlShiftKey(e, 'J') ||\n            this.ctrlShiftKey(e, 'C') ||\n            (e.ctrlKey && e.keyCode === 'U'.charCodeAt(0)));\n    };\n};\n\nSockets.prototype.ctrlShiftKey = function(e, keyCode) {\n    return e.ctrlKey && e.shiftKey && e.keyCode === keyCode.charCodeAt(0);\n};\n\n/** @type {jQuery} The jQuery node for the page region. */\nSockets.prototype.root = null;\n\nlet userid = null;\nlet usersocketid = null;\nlet username = null;\nlet userimage = null;\nlet messageBox = null;\nlet countusers = null;\nlet cmid = null;\nlet sid = null;\nlet kuetid = null;\nlet currentCuestionKqid = null;\nlet groupid = 0;\nlet groupmode = '';\nlet groupimage = null;\nlet groupname = null;\n// Flags for improvised flow.\nlet userHasImprovised = false;\nlet userHasVoted = false;\nlet initVote = false;\nlet notImprovised = false;\n\nSockets.prototype.initSockets = function() {\n    userid = this.root[0].dataset.userid;\n    username = this.root[0].dataset.username;\n    userimage = this.root[0].dataset.userimage;\n    kuetid = this.root[0].dataset.kuetid;\n    cmid = this.root[0].dataset.cmid;\n    sid = this.root[0].dataset.sid;\n    messageBox = this.root.find(REGION.MESSAGEBOX);\n    countusers = this.root.find(REGION.COUNTUSERS);\n    groupmode = this.root[0].dataset.groupmode;\n    if (groupmode == '1') {\n        groupimage = this.root[0].dataset.groupimage;\n        groupid = parseInt(this.root[0].dataset.groupid);\n        groupname = this.root[0].dataset.groupname;\n    }\n\n    let normalizeSocketUrl = Sockets.prototype.normalizeSocketUrl(socketUrl, portUrl);\n    Sockets.prototype.webSocket = new WebSocket(normalizeSocketUrl);\n\n    Sockets.prototype.webSocket.onopen = function() {\n\n    };\n\n    Sockets.prototype.webSocket.onmessage = function(ev) {\n        let msgDecrypt = Encryptor.decrypt(ev.data);\n        let response = JSON.parse(msgDecrypt); // PHP sends Json data.\n        let resAction = response.action; // Message type.\n        switch (resAction) {\n            case 'alreadyAnswered':\n                if (groupmode == '1') {\n                    dispatchEvent(new CustomEvent('alreadyAnswered_' + response.kid, {detail: { userid : response.userid }}));\n                }\n                break;\n            case 'connect':\n                // The server has returned the connected status, it is time to identify yourself.\n                if (response.usersocketid !== undefined) {\n                    usersocketid = response.usersocketid;\n                    let msg = {\n                        'userid': userid,\n                        'name': username,\n                        'pic': userimage,\n                        'cmid': cmid,\n                        'sid': sid,\n                        'usersocketid': usersocketid,\n                        'action': 'newuser',\n                    };\n                    if (groupmode == '1') {\n                        msg.action = 'newgroup';\n                        msg.name = groupname;\n                        msg.pic = groupimage;\n                        msg.groupid = groupid;\n                    }\n                    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n                }\n                break;\n            case 'newuser': {\n                let identifier = jQuery(REGION.USERLIST);\n                let data = response.students;\n                identifier.html('');\n                jQuery.each(data, function (i, student) {\n                    let templateContext = {\n                        'usersocketid': student.usersocketid,\n                        'userimage': student.picture,\n                        'userfullname': student.name,\n                    };\n                    Templates.render(TEMPLATES.PARTICIPANT, templateContext).then(function(html) {\n                        identifier.append(html);\n                    }).fail(Notification.exception);\n                });\n                countusers.html(response.count);\n                break;\n            }\n            case 'newgroup': {\n                let participantshtml = jQuery(REGION.USERLIST);\n                let grouplist = response.groups;\n                participantshtml.html('');\n                jQuery.each(grouplist, function(i, group) {\n                    let templateContext = {\n                        'usersocketid': group.usersocketid,\n                        'groupimage': group.picture,\n                        'groupid': group.groupid,\n                        'name': group.name,\n                        'numgroupusers': group.numgroupusers,\n                    };\n                    Templates.render(TEMPLATES.GROUPPARTICIPANT, templateContext).then(function(html) {\n                        participantshtml.append(html);\n                    }).fail(Notification.exception);\n                });\n                countusers.html(response.count);\n                break;\n            }\n            case 'countusers':\n                countusers.html(response.count);\n                break;\n            case 'question':\n                Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                    let identifier = jQuery(REGION.ROOT);\n                    identifier.append(html);\n                    currentCuestionKqid = response.context.kid;\n                    let request = {\n                        methodname: SERVICES.USERQUESTIONRESPONSE,\n                        args: {\n                            kid: response.context.kid,\n                            cmid: cmid,\n                            sid: sid,\n                            uid: 0,\n                            preview: false\n                        }\n                    };\n                    let removeEvents = new CustomEvent('removeEvents');\n                    dispatchEvent(removeEvents);\n                    Ajax.call([request])[0].done(function(answer) {\n                        const questionData = {\n                            ...response.context.value,\n                            ...answer\n                        };\n                        Templates.render(TEMPLATES.QUESTION, questionData).then(function(html, js) {\n                            identifier.html(html);\n                            Templates.runTemplateJS(js);\n                            mEvent.notifyFilterContentUpdated(document.querySelector(REGION.ROOT));\n                            jQuery(REGION.LOADING).remove();\n                        }).fail(Notification.exception);\n                    });\n                });\n                break;\n            case 'ranking':\n                Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                    let identifier = jQuery(REGION.ROOT);\n                    identifier.append(html);\n                    let removeEvents = new CustomEvent('removeEvents');\n                    dispatchEvent(removeEvents);\n                    Templates.render(TEMPLATES.PROVISIONALRANKING, response.context).then(function(html, js) {\n                        identifier.html(html);\n                        Templates.runTemplateJS(js);\n                        jQuery(REGION.LOADING).remove();\n                    }).fail(Notification.exception);\n                });\n                break;\n            case 'pauseQuestion':\n                dispatchEvent(new Event('pauseQuestion_' + response.kid));\n                break;\n            case 'playQuestion':\n                dispatchEvent(new Event('playQuestion_' + response.kid));\n                break;\n            case 'showAnswers':\n                dispatchEvent(new Event('showAnswers_' + response.kid));\n                break;\n            case 'hideAnswers':\n                dispatchEvent(new Event('hideAnswers_' + response.kid));\n                break;\n            case 'showStatistics':\n                dispatchEvent(new Event('showStatistics_' + response.kid));\n                break;\n            case 'hideStatistics':\n                dispatchEvent(new Event('hideStatistics_' + response.kid));\n                break;\n            case 'showFeedback':\n                dispatchEvent(new Event('showFeedback_' + response.kid));\n                break;\n            case 'hideFeedback':\n                dispatchEvent(new Event('hideFeedback_' + response.kid));\n                break;\n            case 'improvising':\n                jQuery(REGION.IMPROVISE).removeClass('d-none');\n                jQuery(REGION.ROOT).addClass('d-none');\n                break;\n            case 'closeImprovise':\n                jQuery(REGION.IMPROVISE).addClass('d-none');\n                jQuery(REGION.ROOT).removeClass('d-none');\n                break;\n            case 'improvised': // Teacher sen question improvised.\n                userHasImprovised = false;\n                userHasVoted = false;\n                initVote = false;\n                notImprovised = false;\n                Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                    jQuery(REGION.IMPROVISE).addClass('d-none');\n                    jQuery(REGION.ROOT).removeClass('d-none');\n                    let identifier = jQuery(REGION.ROOT);\n                    identifier.append(html);\n                    Templates.render(TEMPLATES.IMPROVISESTUDENTRESPONSE, response).then(function(html) {\n                        identifier.html(html);\n                        jQuery(ACTIONS.REPLYIMPROVISE).on('click', Sockets.prototype.replyImprovise);\n                        jQuery(REGION.LOADING).remove();\n                    }).fail(Notification.exception);\n                });\n                break;\n            case 'printNewTag':\n                // eslint-disable-next-line no-case-declarations\n                let printTags = false;\n                if (initVote === true) {\n                    if (userHasVoted === true && notImprovised === false) {\n                        printTags = true;\n                    }\n                    if (notImprovised === true) {\n                        printTags = true;\n                        notImprovised = false;\n                    }\n                } else {\n                    printTags = true;\n                }\n                if (printTags === true) {\n                    // eslint-disable-next-line no-case-declarations\n                    let htmlTags = '';\n                    response.tags.forEach(tag => {\n                        // eslint-disable-next-line max-len\n                        htmlTags += '<li><span class=\"tag\" data-count=\"' + tag.count + '\" data-vote=\"' + tag.votenum + '\" data-size=\"' + tag.size + '\">' +\n                            '<div class=\"vote-tag d-none\" data-name=\"' + tag.name + '\" data-action=\"vote-tag\">' +\n                            '<svg id=\"vote-layer\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 122.88 115.29\">' +\n                            '<defs><style>.cls-1{fill:#212121;}.cls-2{fill:#33a867;fill-rule:evenodd;}</style></defs>' +\n                            // eslint-disable-next-line max-len\n                            '<path d=\"M45.22,30.83a5.78,5.78,0,0,1,2.9-3,6.83,6.83,0,0,1,4.66-.26,12.88,12.88,0,0,1,4.45,2.27,22,22,0,0,1,8.14,15.82,45.93,45.93,0,0,1-.1,7c-.13,1.64-.34,3.37-.63,5.16H81.57a18.21,18.21,0,0,1,7.64,1.94,12.43,12.43,0,0,1,4.69,4.12,10.55,10.55,0,0,1,1.71,6.31A14.93,14.93,0,0,1,94.08,76a18.42,18.42,0,0,1,.46,7,8.22,8.22,0,0,1-2.33,4.75A21.3,21.3,0,0,1,91,95.65a16.62,16.62,0,0,1-3.77,5.9,24,24,0,0,1-.75,4.21,14.4,14.4,0,0,1-2.1,4.52h0c-2.88,4.06-5.18,4-8.82,3.81-.51,0-1,0-1.89,0h-33a16,16,0,0,1-7.42-1.49,17.68,17.68,0,0,1-5.83-5.08L27,106.07V67.62l1.68-.45C32.9,66,36.24,62.39,38.85,58a64.87,64.87,0,0,0,5.83-13.95v-10a6.17,6.17,0,0,1,.54-3.25ZM3.38,63.6H19.73A3.39,3.39,0,0,1,23.11,67v44.93a3.39,3.39,0,0,1-3.38,3.38H3.38A3.39,3.39,0,0,1,0,111.91V67A3.39,3.39,0,0,1,3.38,63.6ZM50,31.87a1.82,1.82,0,0,0-.83,1.32V44.4l-.1.64a69.3,69.3,0,0,1-6.38,15.3C39.87,65,36.22,69.09,31.47,71v34.32a12.18,12.18,0,0,0,3.82,3.25,11.76,11.76,0,0,0,5.42,1h33c.59,0,1.35,0,2.07.06,2.16.08,3.52.14,5-1.92h0a9.93,9.93,0,0,0,1.43-3.14,20.11,20.11,0,0,0,.67-4.15l.69-1.48a12.6,12.6,0,0,0,3.27-4.83,17.75,17.75,0,0,0,.87-7.28l-.08-1.33,1.13-.7a3.44,3.44,0,0,0,1.38-2.51,14.87,14.87,0,0,0-.57-6l.18-1.63A11.34,11.34,0,0,0,91.13,70a6.15,6.15,0,0,0-1-3.68,8.06,8.06,0,0,0-3-2.61,13.58,13.58,0,0,0-5.63-1.43H59.26l.5-2.66c.48-2.58.83-5,1-7.37a42.55,42.55,0,0,0,.11-6.33,17.42,17.42,0,0,0-6.39-12.53,8.43,8.43,0,0,0-2.86-1.5,2.56,2.56,0,0,0-1.65,0Z\"/>' +\n                            '</svg>' +\n                            '</div>' +\n                            tag.name + '</span></li>';\n                    });\n                    jQuery(REGION.TAGSCONTENT).html(htmlTags);\n                    if (initVote === true && userHasVoted === false) {\n                        jQuery(REGION.VOTETAG).removeClass('d-none').on('click', Sockets.prototype.voteTags);\n                    }\n                }\n                break;\n            case 'initVote': // Teacher init vote.\n                initVote = true;\n                if (userHasImprovised === false) {\n                    Sockets.prototype.replyImprovise();\n                }\n                jQuery(REGION.VOTETAG).removeClass('d-none').on('click', Sockets.prototype.voteTags);\n                break;\n            case 'endSession':\n                jQuery(REGION.IMPROVISE).addClass('d-none');\n                jQuery(REGION.ROOT).removeClass('d-none');\n                Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                    let identifier = jQuery(REGION.ROOT);\n                    identifier.append(html);\n                    currentCuestionKqid = response.context.kid;\n                    Templates.render(TEMPLATES.QUESTION, response.context.value).then(function(html, js) {\n                        identifier.html(html);\n                        Templates.runTemplateJS(js);\n                        jQuery(REGION.LOADING).remove();\n                    }).fail(Notification.exception);\n                });\n                break;\n            case 'teacherQuestionEnd':\n                dispatchEvent(new CustomEvent('teacherQuestionEnd_' + response.kid, {\n                    \"detail\": {\"statistics\": response.statistics}\n                }));\n                break;\n            case 'userdisconnected':\n                if (groupmode != '1') {\n                    jQuery('[data-userid=\"' + response.usersocketid + '\"]').remove();\n                    countusers.html(response.count);\n                }\n                break;\n            case 'groupdisconnected':\n                jQuery('[data-groupid=\"' + response.groupid + '\"]').remove();\n                countusers.html(response.count);\n                messageBox.append('<div>' + response.message + '</div>');\n                break;\n            case 'groupmemberdisconnected':\n                jQuery('.participants').find('[data-groupid=\"' + response.groupid + '\"]')\n                    .find('.numgroupusers').html('(' + response.count + ')');\n                messageBox.append('<div>' + response.message + '</div>');\n                break;\n            default:\n                break;\n        }\n        messageBox[0].scrollTop = messageBox[0].scrollHeight;\n    };\n\n    Sockets.prototype.webSocket.onerror = function(ev) {\n        messageBox.append('<div class=\"system_error\">Error Occurred - ' + ev.data + '</div>');\n    };\n\n    Sockets.prototype.webSocket.onclose = function() {\n        jQuery(REGION.IMPROVISE).addClass('d-none');\n        jQuery(REGION.ROOT).removeClass('d-none');\n        let request = {\n            methodname: SERVICES.SESSIONFIINISHED,\n            args: {\n                kuetid: kuetid,\n                cmid: cmid\n            }\n        };\n        Ajax.call([request])[0].done(function(response) {\n            Templates.render(TEMPLATES.SESSIONFIINISHED, response).then(function(html, js) {\n                jQuery(REGION.ROOT).html(html);\n                Templates.runTemplateJS(js);\n            }).fail(Notification.exception);\n        });\n    };\n};\n\nSockets.prototype.normalizeSocketUrl = function(socketUrl, port) {\n    let jsUrl = new URL(socketUrl);\n    if (jsUrl.protocol === 'https:') {\n        jsUrl.port = port;\n        jsUrl.protocol = 'wss:';\n        if (jsUrl.pathname === '/') {\n            jsUrl.pathname = jsUrl.pathname + 'kuet';\n        } else {\n            jsUrl.pathname = jsUrl.pathname + '/kuet';\n        }\n        return jsUrl.toString();\n    }\n    getStrings([\n        {key: 'httpsrequired', component: 'mod_kuet'}\n    ]).done(function(strings) {\n        messageBox = this.root.find('#testresult');\n        messageBox.append('<div class=\"alert alert-danger\" role=\"alert\">' + strings[0] + '</div>');\n    }).fail(Notification.exception);\n    return '';\n};\n\nSockets.prototype.initListeners = function() {\n    addEventListener('studentQuestionEnd', () => {\n        let msg = {\n            'userid': userid,\n            'sid': sid,\n            'usersocketid': usersocketid,\n            'kid': currentCuestionKqid,\n            'oft': true,\n            'action': 'studentQuestionEnd',\n        };\n        Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n        if (groupmode == '1') {\n            let msg2 = {\n                'userid': userid,\n                'sid': sid,\n                'usersocketid': usersocketid,\n                'kid': currentCuestionKqid,\n                'ofg': true,\n                'action': 'alreadyAnswered',\n            };\n            setTimeout(function() {\n                Sockets.prototype.sendMessageSocket(JSON.stringify(msg2));\n            }, 300);\n        }\n    }, false);\n};\n\nSockets.prototype.replyImprovise = function() {\n    let improviseReply = '';\n    if (initVote === false) {\n        improviseReply = jQuery(REGION.IMPROVISEREPLY).val();\n        if (improviseReply === '') {\n            jQuery(REGION.IMPROVISEREPLY).focus(() => {\n                jQuery(REGION.IMPROVISEREPLY).css({'border-color': 'red'});\n            });\n        }\n    }\n    if ((initVote === false && improviseReply !== '') || initVote === true) {\n        Templates.render(TEMPLATES.LOADING, {visible: true}).done(function() {\n            jQuery(REGION.IMPROVISE).addClass('d-none');\n            jQuery(REGION.ROOT).removeClass('d-none');\n            jQuery(REGION.IMPROVISEREPLY).val('');\n            let cloudtagsData = {\n                'sessionid': sid,\n                'cmid': cmid,\n                'improvised': true,\n                'sessionprogress': 0,\n                'cloudtags': true,\n                'isteacher': false,\n                'questiontext': jQuery('.improvise-statement').text(),\n                'programmedmode': false,\n                'preview': false,\n                'tags': [{name: improviseReply, count: 1, size: 9}]\n            };\n            Templates.render(TEMPLATES.QUESTION, cloudtagsData).then(function(html) {\n                jQuery(REGION.ROOT).html(html);\n                jQuery(REGION.LOADING).remove();\n                let msg = {\n                    'action': 'ImproviseStudentTag',\n                    'sid': sid,\n                    'oft': true, // IMPORTANT: Only for teacher.\n                    'improvisereply': improviseReply,\n                    'sessionid': sid,\n                    'cmid': cmid,\n                    'userid': userid,\n                };\n                Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n                if (userHasImprovised === false) {\n                    jQuery(REGION.VOTETAG).removeClass('d-none').on('click', Sockets.prototype.voteTags);\n                    notImprovised = true;\n                }\n                userHasImprovised = true;\n            }).fail(Notification.exception);\n        });\n    }\n};\n\nSockets.prototype.voteTags = function(e) {\n    jQuery(REGION.VOTETAG).addClass('d-none');\n    jQuery(REGION.TAGSCONTENT).attr('data-show-votes', true);\n    jQuery(REGION.TAGSCONTENT).attr('data-show-value', false);\n    let votedTag = e.target.getAttribute('data-name');\n    if (votedTag) {\n        userHasVoted = true;\n        let msg = {\n            'action': 'StudentVotedTag',\n            'sid': sid,\n            'oft': true, // IMPORTANT: Only for teacher.\n            'votedtag': votedTag,\n            'sessionid': sid,\n            'cmid': cmid,\n            'userid': userid,\n        };\n        Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n    }\n};\n\nSockets.prototype.sendMessageSocket = function(msg) {\n    this.webSocket.send(msg);\n};\n\nexport const studentInitSockets = (region, socketurl, port) => {\n    return new Sockets(region, socketurl, port);\n};\n"],"names":["REGION","MESSAGEBOX","USERLIST","COUNTUSERS","ROOT","IMPROVISE","IMPROVISEREPLY","TAGSCONTENT","VOTETAG","ACTIONS","SERVICES","TEMPLATES","portUrl","socketUrl","Sockets","region","socketurl","port","root","initSockets","disableDevTools","initListeners","prototype","document","addEventListener","e","preventDefault","onkeydown","event","keyCode","this","ctrlShiftKey","ctrlKey","charCodeAt","shiftKey","userid","usersocketid","username","userimage","messageBox","countusers","cmid","sid","kuetid","currentCuestionKqid","groupid","groupmode","groupimage","groupname","userHasImprovised","userHasVoted","initVote","notImprovised","dataset","find","parseInt","normalizeSocketUrl","webSocket","WebSocket","onopen","onmessage","ev","msgDecrypt","Encryptor","decrypt","data","response","JSON","parse","action","dispatchEvent","CustomEvent","kid","detail","undefined","msg","name","pic","sendMessageSocket","stringify","identifier","students","html","each","i","student","templateContext","picture","render","then","append","fail","Notification","exception","count","participantshtml","grouplist","groups","group","numgroupusers","visible","done","context","request","methodname","args","uid","preview","removeEvents","call","answer","questionData","value","js","runTemplateJS","notifyFilterContentUpdated","querySelector","LOADING","remove","Event","removeClass","addClass","on","replyImprovise","printTags","htmlTags","tags","forEach","tag","votenum","size","voteTags","statistics","message","scrollTop","scrollHeight","onerror","onclose","jsUrl","URL","protocol","pathname","toString","key","component","strings","msg2","setTimeout","improviseReply","val","focus","css","cloudtagsData","text","attr","votedTag","target","getAttribute","send"],"mappings":"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"}