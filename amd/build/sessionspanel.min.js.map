{"version":3,"file":"sessionspanel.min.js","sources":["../src/sessionspanel.js"],"sourcesContent":["\"use strict\";\r\n\r\nimport jQuery from 'jquery';\r\nimport {get_strings as getStrings} from 'core/str';\r\nimport Ajax from 'core/ajax';\r\nimport ModalFactory from 'core/modal_factory';\r\nimport ModalEvents from 'core/modal_events';\r\nimport Templates from 'core/templates';\r\nimport Notification from 'core/notification';\r\n\r\nlet ACTION = {\r\n    COPYSESSION: '[data-action=\"copy_session\"]',\r\n    DELETESESSION: '[data-action=\"delete_session\"]',\r\n    INITSESSION: '[data-action=\"init_session\"]'\r\n};\r\n\r\nlet SERVICES = {\r\n    SESSIONSPANEL: 'mod_jqshow_sessionspanel',\r\n    COPYSESSION: 'mod_jqshow_copysession',\r\n    DELETESESSION: 'mod_jqshow_deletesession'\r\n};\r\n\r\nlet REGION = {\r\n    SESSIONSPANEL: '[data-region=\"sessions-panel-reload\"]',\r\n    PANEL: '[data-region=\"sessions-panel\"]'\r\n};\r\n\r\nlet TEMPLATES = {\r\n    LOADING: 'core/overlay_loading',\r\n    SUCCESS: 'core/notification_success',\r\n    ERROR: 'core/notification_error',\r\n    PANEL: 'mod_jqshow/sessions_panel'\r\n};\r\n\r\nlet cmId;\r\nlet courseId;\r\n\r\n/**\r\n * @constructor\r\n * @param {String} selector The selector for the page region containing the page.\r\n */\r\nfunction SessionsPanel(selector) {\r\n    this.node = jQuery(selector);\r\n    courseId = this.node.attr('data-courseid');\r\n    cmId = this.node.attr('data-cmid');\r\n    this.initPanel();\r\n}\r\n\r\n/** @type {jQuery} The jQuery node for the page region. */\r\nSessionsPanel.prototype.node = null;\r\n\r\nSessionsPanel.prototype.initPanel = function() {\r\n    this.node.find(ACTION.COPYSESSION).on('click', this.copySession);\r\n    this.node.find(ACTION.DELETESESSION).on('click', this.deleteSession);\r\n    this.node.find(ACTION.INITSESSION).on('click', this.initSession);\r\n};\r\n\r\nSessionsPanel.prototype.copySession = function(e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    let sessionId = jQuery(e.currentTarget).attr('data-sessionid');\r\n    const stringkeys = [\r\n        {key: 'copysession', component: 'mod_jqshow'},\r\n        {key: 'copysession_desc', component: 'mod_jqshow'},\r\n        {key: 'confirm', component: 'mod_jqshow'},\r\n        {key: 'copysessionerror', component: 'mod_jqshow'},\r\n    ];\r\n    getStrings(stringkeys).then((langStrings) => {\r\n        const title = langStrings[0];\r\n        const confirmMessage = langStrings[1];\r\n        const buttonText = langStrings[2];\r\n        const copysessionerror = langStrings[3];\r\n        return ModalFactory.create({\r\n            title: title,\r\n            body: confirmMessage,\r\n            type: ModalFactory.types.SAVE_CANCEL\r\n        }).then(modal => {\r\n            modal.setSaveButtonText(buttonText);\r\n            modal.getRoot().on(ModalEvents.save, () => {\r\n                Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\r\n                    let identifier = jQuery(REGION.PANEL);\r\n                    identifier.append(html);\r\n                    let request = {\r\n                        methodname: SERVICES.COPYSESSION,\r\n                        args: {\r\n                            courseid: courseId,\r\n                            sessionid: sessionId\r\n                        }\r\n                    };\r\n                    Ajax.call([request])[0].done(function(copied) {\r\n                        if (copied) {\r\n                            let requestPanel = {\r\n                                methodname: SERVICES.SESSIONSPANEL,\r\n                                args: {\r\n                                    cmid: cmId\r\n                                }\r\n                            };\r\n                            // eslint-disable-next-line max-nested-callbacks\r\n                            Ajax.call([requestPanel])[0].done(function(response) {\r\n                                let templatePanel = TEMPLATES.PANEL;\r\n                                // eslint-disable-next-line max-nested-callbacks\r\n                                Templates.render(templatePanel, response).then(function(html, js) {\r\n                                    identifier.html(html);\r\n                                    Templates.runTemplateJS(js);\r\n                                });\r\n                            }).fail(Notification.exception);\r\n                        } else {\r\n                            Notification.exception({message: copysessionerror});\r\n                        }\r\n                    });\r\n                });\r\n            });\r\n            modal.getRoot().on(ModalEvents.hidden, () => {\r\n                modal.destroy();\r\n            });\r\n            return modal;\r\n        });\r\n    }).done(function(modal) {\r\n        modal.show();\r\n        // eslint-disable-next-line no-restricted-globals\r\n    }).fail(Notification.exception);\r\n\r\n};\r\n\r\nSessionsPanel.prototype.deleteSession = function(e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    let sessionId = jQuery(e.currentTarget).attr('data-sessionid');\r\n    const stringkeys = [\r\n        {key: 'deletesession', component: 'mod_jqshow'},\r\n        {key: 'deletesession_desc', component: 'mod_jqshow'},\r\n        {key: 'confirm', component: 'mod_jqshow'},\r\n        {key: 'deletesessionrror', component: 'mod_jqshow'},\r\n    ];\r\n    getStrings(stringkeys).then((langStrings) => {\r\n        const title = langStrings[0];\r\n        const confirmMessage = langStrings[1];\r\n        const buttonText = langStrings[2];\r\n        const copysessionerror = langStrings[3];\r\n        return ModalFactory.create({\r\n            title: title,\r\n            body: confirmMessage,\r\n            type: ModalFactory.types.SAVE_CANCEL\r\n        }).then(modal => {\r\n            modal.setSaveButtonText(buttonText);\r\n            modal.getRoot().on(ModalEvents.save, () => {\r\n                Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\r\n                    let identifier = jQuery(REGION.PANEL);\r\n                    identifier.append(html);\r\n                    let request = {\r\n                        methodname: SERVICES.DELETESESSION,\r\n                        args: {\r\n                            courseid: courseId,\r\n                            sessionid: sessionId\r\n                        }\r\n                    };\r\n                    Ajax.call([request])[0].done(function(deleted) {\r\n                        if (deleted) {\r\n                            let requestPanel = {\r\n                                methodname: SERVICES.SESSIONSPANEL,\r\n                                args: {\r\n                                    cmid: cmId\r\n                                }\r\n                            };\r\n                            // eslint-disable-next-line max-nested-callbacks\r\n                            Ajax.call([requestPanel])[0].done(function(response) {\r\n                                let templatePanel = TEMPLATES.PANEL;\r\n                                // eslint-disable-next-line max-nested-callbacks\r\n                                Templates.render(templatePanel, response).done(function(html, js) {\r\n                                    identifier.html(html);\r\n                                    Templates.runTemplateJS(js);\r\n                                });\r\n                            }).fail(Notification.exception);\r\n                        } else {\r\n                            Notification.exception({message: copysessionerror});\r\n                        }\r\n                    }).fail(function() {\r\n                        alert(\"hola\");\r\n                    });\r\n                }).fail(function() {\r\n                    alert(\"hola templTE\");\r\n                });\r\n            });\r\n            modal.getRoot().on(ModalEvents.hidden, () => {\r\n                modal.destroy();\r\n            });\r\n            return modal;\r\n        });\r\n    }).done(function(modal) {\r\n        modal.show();\r\n        // eslint-disable-next-line no-restricted-globals\r\n    }).fail(Notification.exception);\r\n\r\n};\r\n\r\nSessionsPanel.prototype.initSession = function(e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    let sessionId = jQuery(e.currentTarget).attr('data-sessionid');\r\n    const stringkeys = [\r\n        {key: 'init_session', component: 'mod_jqshow'},\r\n        {key: 'init_session_desc', component: 'mod_jqshow'},\r\n        {key: 'confirm', component: 'mod_jqshow'}\r\n    ];\r\n    getStrings(stringkeys).then((langStrings) => {\r\n        const title = langStrings[0];\r\n        const confirmMessage = langStrings[1];\r\n        const buttonText = langStrings[2];\r\n        return ModalFactory.create({\r\n            title: title,\r\n            body: confirmMessage,\r\n            type: ModalFactory.types.SAVE_CANCEL\r\n        }).then(modal => {\r\n            modal.setSaveButtonText(buttonText);\r\n            modal.getRoot().on(ModalEvents.save, () => {\r\n                window.location.replace(M.cfg.wwwroot + '/mod/jqshow/session.php?cmid=' + cmId + '&sid=' + sessionId);\r\n            });\r\n            modal.getRoot().on(ModalEvents.hidden, () => {\r\n                modal.destroy();\r\n            });\r\n            return modal;\r\n        });\r\n    }).done(function(modal) {\r\n        modal.show();\r\n        // eslint-disable-next-line no-restricted-globals\r\n    }).fail(Notification.exception);\r\n};\r\n\r\nexport const initSessionsPanel = (selector) => {\r\n    return new SessionsPanel(selector);\r\n};\r\n"],"names":["cmId","courseId","ACTION","SERVICES","REGION","TEMPLATES","SessionsPanel","selector","node","this","attr","initPanel","prototype","find","on","copySession","deleteSession","initSession","e","preventDefault","stopPropagation","sessionId","currentTarget","key","component","then","langStrings","title","confirmMessage","buttonText","copysessionerror","ModalFactory","create","body","type","types","SAVE_CANCEL","modal","setSaveButtonText","getRoot","ModalEvents","save","render","visible","done","html","identifier","append","request","methodname","args","courseid","sessionid","call","copied","requestPanel","cmid","response","templatePanel","js","runTemplateJS","fail","Notification","exception","message","hidden","destroy","show","deleted","alert","window","location","replace","M","cfg","wwwroot"],"mappings":"isBAkCIA,KACAC,SAzBAC,mBACa,+BADbA,qBAEe,iCAFfA,mBAGa,+BAGbC,uBACe,2BADfA,qBAEa,yBAFbA,uBAGe,2BAGfC,aAEO,iCAGPC,kBACS,uBADTA,gBAIO,qCAUFC,cAAcC,eACdC,MAAO,mBAAOD,UACnBN,SAAWQ,KAAKD,KAAKE,KAAK,iBAC1BV,KAAOS,KAAKD,KAAKE,KAAK,kBACjBC,YAITL,cAAcM,UAAUJ,KAAO,KAE/BF,cAAcM,UAAUD,UAAY,gBAC3BH,KAAKK,KAAKX,oBAAoBY,GAAG,QAASL,KAAKM,kBAC/CP,KAAKK,KAAKX,sBAAsBY,GAAG,QAASL,KAAKO,oBACjDR,KAAKK,KAAKX,oBAAoBY,GAAG,QAASL,KAAKQ,cAGxDX,cAAcM,UAAUG,YAAc,SAASG,GAC3CA,EAAEC,iBACFD,EAAEE,sBACEC,WAAY,mBAAOH,EAAEI,eAAeZ,KAAK,uCAC1B,CACf,CAACa,IAAK,cAAeC,UAAW,cAChC,CAACD,IAAK,mBAAoBC,UAAW,cACrC,CAACD,IAAK,UAAWC,UAAW,cAC5B,CAACD,IAAK,mBAAoBC,UAAW,gBAElBC,MAAMC,oBACnBC,MAAQD,YAAY,GACpBE,eAAiBF,YAAY,GAC7BG,WAAaH,YAAY,GACzBI,iBAAmBJ,YAAY,UAC9BK,uBAAaC,OAAO,CACvBL,MAAOA,MACPM,KAAML,eACNM,KAAMH,uBAAaI,MAAMC,cAC1BX,MAAKY,QACJA,MAAMC,kBAAkBT,YACxBQ,MAAME,UAAUzB,GAAG0B,sBAAYC,MAAM,wBACvBC,OAAOrC,kBAAmB,CAACsC,SAAS,IAAOC,MAAK,SAASC,UAC3DC,YAAa,mBAAO1C,cACxB0C,WAAWC,OAAOF,UACdG,QAAU,CACVC,WAAY9C,qBACZ+C,KAAM,CACFC,SAAUlD,SACVmD,UAAW/B,0BAGdgC,KAAK,CAACL,UAAU,GAAGJ,MAAK,SAASU,WAC9BA,OAAQ,KACJC,aAAe,CACfN,WAAY9C,uBACZ+C,KAAM,CACFM,KAAMxD,qBAITqD,KAAK,CAACE,eAAe,GAAGX,MAAK,SAASa,cACnCC,cAAgBrD,mCAEVqC,OAAOgB,cAAeD,UAAUhC,MAAK,SAASoB,KAAMc,IAC1Db,WAAWD,KAAKA,yBACNe,cAAcD,UAE7BE,KAAKC,sBAAaC,sCAERA,UAAU,CAACC,QAASlC,4BAKjDO,MAAME,UAAUzB,GAAG0B,sBAAYyB,QAAQ,KACnC5B,MAAM6B,aAEH7B,QA3CX,IA6CDO,MAAK,SAASP,OACbA,MAAM8B,UAEPN,KAAKC,sBAAaC,YAIzBzD,cAAcM,UAAUI,cAAgB,SAASE,GAC7CA,EAAEC,iBACFD,EAAEE,sBACEC,WAAY,mBAAOH,EAAEI,eAAeZ,KAAK,uCAC1B,CACf,CAACa,IAAK,gBAAiBC,UAAW,cAClC,CAACD,IAAK,qBAAsBC,UAAW,cACvC,CAACD,IAAK,UAAWC,UAAW,cAC5B,CAACD,IAAK,oBAAqBC,UAAW,gBAEnBC,MAAMC,oBACnBC,MAAQD,YAAY,GACpBE,eAAiBF,YAAY,GAC7BG,WAAaH,YAAY,GACzBI,iBAAmBJ,YAAY,UAC9BK,uBAAaC,OAAO,CACvBL,MAAOA,MACPM,KAAML,eACNM,KAAMH,uBAAaI,MAAMC,cAC1BX,MAAKY,QACJA,MAAMC,kBAAkBT,YACxBQ,MAAME,UAAUzB,GAAG0B,sBAAYC,MAAM,wBACvBC,OAAOrC,kBAAmB,CAACsC,SAAS,IAAOC,MAAK,SAASC,UAC3DC,YAAa,mBAAO1C,cACxB0C,WAAWC,OAAOF,UACdG,QAAU,CACVC,WAAY9C,uBACZ+C,KAAM,CACFC,SAAUlD,SACVmD,UAAW/B,0BAGdgC,KAAK,CAACL,UAAU,GAAGJ,MAAK,SAASwB,YAC9BA,QAAS,KACLb,aAAe,CACfN,WAAY9C,uBACZ+C,KAAM,CACFM,KAAMxD,qBAITqD,KAAK,CAACE,eAAe,GAAGX,MAAK,SAASa,cACnCC,cAAgBrD,mCAEVqC,OAAOgB,cAAeD,UAAUb,MAAK,SAASC,KAAMc,IAC1Db,WAAWD,KAAKA,yBACNe,cAAcD,UAE7BE,KAAKC,sBAAaC,sCAERA,UAAU,CAACC,QAASlC,sBAEtC+B,MAAK,WACJQ,MAAM,cAEXR,MAAK,WACJQ,MAAM,sBAGdhC,MAAME,UAAUzB,GAAG0B,sBAAYyB,QAAQ,KACnC5B,MAAM6B,aAEH7B,QA/CX,IAiDDO,MAAK,SAASP,OACbA,MAAM8B,UAEPN,KAAKC,sBAAaC,YAIzBzD,cAAcM,UAAUK,YAAc,SAASC,GAC3CA,EAAEC,iBACFD,EAAEE,sBACEC,WAAY,mBAAOH,EAAEI,eAAeZ,KAAK,uCAC1B,CACf,CAACa,IAAK,eAAgBC,UAAW,cACjC,CAACD,IAAK,oBAAqBC,UAAW,cACtC,CAACD,IAAK,UAAWC,UAAW,gBAETC,MAAMC,oBACnBC,MAAQD,YAAY,GACpBE,eAAiBF,YAAY,GAC7BG,WAAaH,YAAY,UACxBK,uBAAaC,OAAO,CACvBL,MAAOA,MACPM,KAAML,eACNM,KAAMH,uBAAaI,MAAMC,cAC1BX,MAAKY,QACJA,MAAMC,kBAAkBT,YACxBQ,MAAME,UAAUzB,GAAG0B,sBAAYC,MAAM,KACjC6B,OAAOC,SAASC,QAAQC,EAAEC,IAAIC,QAAU,gCAAkC3E,KAAO,QAAUqB,cAE/FgB,MAAME,UAAUzB,GAAG0B,sBAAYyB,QAAQ,KACnC5B,MAAM6B,aAEH7B,QAZX,IAcDO,MAAK,SAASP,OACbA,MAAM8B,UAEPN,KAAKC,sBAAaC,uCAGSxD,UACvB,IAAID,cAAcC"}