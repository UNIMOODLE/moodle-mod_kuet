{"version":3,"file":"selectquestions.min.js","sources":["../src/selectquestions.js"],"sourcesContent":["\"use strict\";\r\n/* eslint-disable no-unused-vars */ // TODO remove.\r\n\r\nimport jQuery from 'jquery';\r\nimport {get_strings as getStrings} from 'core/str';\r\nimport Ajax from 'core/ajax';\r\nimport ModalFactory from 'core/modal_factory';\r\nimport ModalEvents from 'core/modal_events';\r\nimport Notification from 'core/notification';\r\nimport Templates from 'core/templates';\r\n\r\nlet ACTION = {\r\n    ADDQUESTIONS: '[data-action=\"add_questions\"]',\r\n    ADDQUESTION: '[data-action=\"add_question\"]',\r\n    SELECTALL: '#selectall',\r\n    SELECTVISIBLES: '#selectvisibles',\r\n};\r\n\r\nlet REGION = {\r\n    PANEL: '[data-region=\"questions-panel\"]',\r\n    NUMBERSELECT: '#number_select',\r\n    SELECTQUESTION: '.select_question',\r\n    CONTENTQUESTIONS: '#content_questions',\r\n    PAGENAVIGATION: '#page_navigation',\r\n    CURRENTPAGE: '#current_page',\r\n    SESSIONQUESTIONS: '[data-region=\"session-questions\"]',\r\n    LOADING: '[data-region=\"overlay-icon-container\"]'\r\n};\r\n\r\nlet SERVICES = {\r\n    ADDQUESTIONS: 'mod_jqshow_addquestions',\r\n    SESSIONQUESTIONS: 'mod_jqshow_sessionquestions'\r\n};\r\n\r\nlet TEMPLATES = {\r\n    LOADING: 'core/overlay_loading',\r\n    SUCCESS: 'core/notification_success',\r\n    ERROR: 'core/notification_error',\r\n    QUESTIONSSELECTED: 'mod_jqshow/createsession/sessionquestions'\r\n};\r\n\r\nlet cmId;\r\nlet sId;\r\nlet jqshowId;\r\nlet showPerPage = 20;\r\n\r\n/**\r\n * @constructor\r\n * @param {String} selector The selector for the page region containing the page.\r\n */\r\nfunction SelectQuestions(selector) {\r\n    this.node = jQuery(selector);\r\n    sId = this.node.attr('data-sid');\r\n    cmId = this.node.attr('data-cmid');\r\n    jqshowId = this.node.attr('data-jqshowid');\r\n    this.initPanel();\r\n}\r\n\r\n/** @type {jQuery} The jQuery node for the page region. */\r\nSelectQuestions.prototype.node = null;\r\n\r\nSelectQuestions.prototype.initPanel = function() {\r\n    this.node.find(ACTION.SELECTALL).on('change', this.selectAll.bind(this));\r\n    this.node.find(ACTION.SELECTVISIBLES).on('change', this.selectVisibles.bind(this));\r\n    this.node.find(ACTION.ADDQUESTIONS).on('click', this.addQuestions.bind(this));\r\n    this.node.find(ACTION.ADDQUESTION).on('click', this.addQuestion);\r\n    this.node.find(REGION.SELECTQUESTION).on('change', this.selectQuestion.bind(this));\r\n    this.countChecks();\r\n    this.pagination();\r\n};\r\n\r\nSelectQuestions.prototype.countChecks = function(e) {\r\n    jQuery(REGION.NUMBERSELECT).html(jQuery(REGION.SELECTQUESTION + ':checked').length);\r\n};\r\n\r\nSelectQuestions.prototype.selectAll = function(e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    this.node.find(REGION.SELECTQUESTION).prop('checked', jQuery(e.currentTarget).is(':checked'));\r\n    this.countChecks();\r\n};\r\n\r\nSelectQuestions.prototype.selectVisibles = function(e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    this.node.find('[style=\"display: flex;\"] ' + REGION.SELECTQUESTION).prop('checked', jQuery(e.currentTarget).is(':checked'));\r\n    this.countChecks();\r\n};\r\n\r\nSelectQuestions.prototype.addQuestions = function(e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    let that = this;\r\n    let questionschekced = jQuery(REGION.SELECTQUESTION + ':checked');\r\n    if (questionschekced.length < 1) {\r\n        const stringkeys = [\r\n            {key: 'selectone', component: 'mod_jqshow'},\r\n            {key: 'selectone_desc', component: 'mod_jqshow'}\r\n        ];\r\n        getStrings(stringkeys).then((langStrings) => {\r\n            const title = langStrings[0];\r\n            const message = langStrings[1];\r\n            return ModalFactory.create({\r\n                title: title,\r\n                body: message,\r\n                type: ModalFactory.types.CANCEL\r\n            }).then(modal => {\r\n                modal.getRoot().on(ModalEvents.hidden, () => {\r\n                    modal.destroy();\r\n                });\r\n                return modal;\r\n            });\r\n        }).done(function(modal) {\r\n            modal.show();\r\n            // eslint-disable-next-line no-restricted-globals\r\n        }).fail(Notification.exception);\r\n    } else {\r\n        let questions = [];\r\n        questionschekced.each(function callback(index, question) {\r\n            // eslint-disable-next-line no-console\r\n            console.log(jQuery(question).attr('data-questionnid'));\r\n            let questiondata = {\r\n                questionid: jQuery(question).attr('data-questionnid'),\r\n                sessionid: sId,\r\n                jqshowid: jqshowId,\r\n                qtype: jQuery(question).attr('data-type')\r\n            };\r\n            questions.push(questiondata);\r\n        });\r\n        const stringkeys = [\r\n            {key: 'addquestions', component: 'mod_jqshow'},\r\n            {key: 'addquestions_desc', component: 'mod_jqshow', param: questionschekced.length},\r\n            {key: 'confirm', component: 'mod_jqshow'}\r\n        ];\r\n        getStrings(stringkeys).then((langStrings) => {\r\n            const title = langStrings[0];\r\n            const message = langStrings[1];\r\n            const buttonText = langStrings[2];\r\n            return ModalFactory.create({\r\n                title: title,\r\n                body: message,\r\n                type: ModalFactory.types.SAVE_CANCEL\r\n            }).then(modal => {\r\n                modal.setSaveButtonText(buttonText);\r\n                modal.getRoot().on(ModalEvents.save, () => {\r\n                    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\r\n                        let identifier = jQuery(REGION.PANEL);\r\n                        identifier.append(html);\r\n                    });\r\n                    let request = {\r\n                        methodname: SERVICES.ADDQUESTIONS,\r\n                        args: {\r\n                            questions: questions\r\n                        }\r\n                    };\r\n                    Ajax.call([request])[0].done(function(response) {\r\n                        if (response) {\r\n                            jQuery(REGION.CONTENTQUESTIONS).find(REGION.SELECTQUESTION).prop('checked', false);\r\n                            jQuery(ACTION.SELECTALL).prop('checked', false);\r\n                            jQuery(ACTION.SELECTVISIBLES).prop('checked', false);\r\n                            let request = {\r\n                                methodname: SERVICES.SESSIONQUESTIONS,\r\n                                args: {\r\n                                    jqshowid: jqshowId,\r\n                                    cmid: cmId,\r\n                                    sid: sId\r\n                                }\r\n                            };\r\n                            Ajax.call([request])[0].done(function(response) {\r\n                                Templates.render(TEMPLATES.QUESTIONSSELECTED, response).then(function(html, js) {\r\n                                    jQuery(REGION.SESSIONQUESTIONS).html(html);\r\n                                    Templates.runTemplateJS(js);\r\n                                    that.countChecks();\r\n                                    jQuery(REGION.LOADING).remove();\r\n                                }).fail(Notification.exception);\r\n                            });\r\n                        } else {\r\n                            // TODO modal error.\r\n                            alert('error');\r\n                            jQuery(REGION.LOADING).remove();\r\n                        }\r\n                    });\r\n                });\r\n                modal.getRoot().on(ModalEvents.hidden, () => {\r\n                    modal.destroy();\r\n                });\r\n                return modal;\r\n            });\r\n        }).done(function(modal) {\r\n            modal.show();\r\n            // eslint-disable-next-line no-restricted-globals\r\n        }).fail(Notification.exception);\r\n        // eslint-disable-next-line no-console\r\n        console.log(questions);\r\n    }\r\n};\r\n\r\nSelectQuestions.prototype.addQuestion = function(e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    let questionId = jQuery(e.currentTarget).attr('data-questionnid');\r\n    alert('addQuestion ' + questionId);\r\n};\r\n\r\nSelectQuestions.prototype.selectQuestion = function(e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    this.countChecks();\r\n};\r\n\r\nSelectQuestions.prototype.pagination = function() {\r\n    let numberOfItems = jQuery(REGION.CONTENTQUESTIONS).children().length;\r\n    let numberOfPages = Math.ceil(numberOfItems / showPerPage);\r\n    jQuery(REGION.CURRENTPAGE).val(0);\r\n    let navigationHtml = '';\r\n    let currentLink = 0;\r\n    if (numberOfItems === 0) {\r\n        jQuery(ACTION.SELECTALL).remove();\r\n        jQuery('label[for=\"selectall\"]').remove();\r\n    }\r\n    if (numberOfPages > 1) {\r\n        while (numberOfPages > currentLink) {\r\n            navigationHtml +=\r\n                '<div class=\"page-item\" data-goto=\"' + currentLink + '\">' +\r\n                    '<span class=\"page-link\">' + (currentLink + 1) + '</span>' +\r\n                '</div>';\r\n            currentLink++;\r\n        }\r\n    } else {\r\n        jQuery(ACTION.SELECTVISIBLES).remove();\r\n        jQuery('label[for=\"selectvisibles\"]').remove();\r\n    }\r\n    jQuery(REGION.PAGENAVIGATION).html(navigationHtml);\r\n    this.node.find('.page-item').on('click', this.goToPage);\r\n    jQuery(REGION.PAGENAVIGATION + ' .page-item:first').addClass('active');\r\n    jQuery(REGION.CONTENTQUESTIONS).children().css('display', 'none');\r\n    jQuery(REGION.CONTENTQUESTIONS).children().slice(0, showPerPage).css('display', 'flex');\r\n};\r\n\r\nSelectQuestions.prototype.goToPage = function(e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    let gotTo = jQuery(e.currentTarget).attr('data-goto');\r\n    let startFrom = gotTo * showPerPage;\r\n    let endOn = startFrom + showPerPage;\r\n    jQuery(REGION.CONTENTQUESTIONS).children().css('display', 'none').slice(startFrom, endOn).css('display', 'flex');\r\n    jQuery('.page-item[data-goto=' + gotTo + ']').addClass('active').siblings('.active').removeClass('active');\r\n    jQuery(ACTION.SELECTVISIBLES).prop('checked', false);\r\n    jQuery(REGION.CURRENTPAGE).val(gotTo);\r\n};\r\n\r\nexport const initSelectQuestions = (selector) => {\r\n    return new SelectQuestions(selector);\r\n};\r\n"],"names":["cmId","sId","jqshowId","ACTION","REGION","SERVICES","TEMPLATES","SelectQuestions","selector","node","this","attr","initPanel","prototype","find","on","selectAll","bind","selectVisibles","addQuestions","addQuestion","selectQuestion","countChecks","pagination","e","html","length","preventDefault","stopPropagation","prop","currentTarget","is","that","questionschekced","stringkeys","key","component","then","langStrings","title","message","ModalFactory","create","body","type","types","CANCEL","modal","getRoot","ModalEvents","hidden","destroy","done","show","fail","Notification","exception","questions","each","index","question","console","log","questiondata","questionid","sessionid","jqshowid","qtype","push","param","buttonText","SAVE_CANCEL","setSaveButtonText","save","render","visible","append","request","methodname","args","call","response","cmid","sid","js","runTemplateJS","remove","alert","questionId","numberOfItems","children","numberOfPages","Math","ceil","val","navigationHtml","currentLink","goToPage","addClass","css","slice","gotTo","startFrom","endOn","siblings","removeClass"],"mappings":"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"}
