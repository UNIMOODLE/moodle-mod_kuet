{"version":3,"file":"selectquestions.min.js","sources":["../src/selectquestions.js"],"sourcesContent":["\"use strict\";\n/* eslint-disable no-unused-vars */ // TODO remove.\n\nimport jQuery from 'jquery';\nimport {get_strings as getStrings} from 'core/str';\nimport Ajax from 'core/ajax';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport Notification from 'core/notification';\nimport Templates from 'core/templates';\n\nlet ACTION = {\n    ADDQUESTIONS: '[data-action=\"add_questions\"]',\n    ADDQUESTION: '[data-action=\"add_question\"]',\n    SELECTALL: '#selectall',\n    SELECTVISIBLES: '#selectvisibles',\n};\n\nlet REGION = {\n    PANEL: '[data-region=\"questions-panel\"]',\n    NUMBERSELECT: '#number_select',\n    SELECTQUESTION: '.select_question',\n    CONTENTQUESTIONS: '#content_questions',\n    PAGENAVIGATION: '#page_navigation',\n    CURRENTPAGE: '#current_page',\n    SESSIONQUESTIONS: '[data-region=\"session-questions\"]',\n    LOADING: '[data-region=\"overlay-icon-container\"]'\n};\n\nlet SERVICES = {\n    ADDQUESTIONS: 'mod_jqshow_addquestions',\n    SESSIONQUESTIONS: 'mod_jqshow_sessionquestions'\n};\n\nlet TEMPLATES = {\n    LOADING: 'core/overlay_loading',\n    SUCCESS: 'core/notification_success',\n    ERROR: 'core/notification_error',\n    QUESTIONSSELECTED: 'mod_jqshow/createsession/sessionquestions'\n};\n\nlet cmId;\nlet sId;\nlet jqshowId;\nlet showPerPage = 20;\n\n/**\n * @constructor\n * @param {String} selector The selector for the page region containing the page.\n */\nfunction SelectQuestions(selector) {\n    this.node = jQuery(selector);\n    sId = this.node.attr('data-sid');\n    cmId = this.node.attr('data-cmid');\n    jqshowId = this.node.attr('data-jqshowid');\n    this.initPanel();\n}\n\n/** @type {jQuery} The jQuery node for the page region. */\nSelectQuestions.prototype.node = null;\n\nSelectQuestions.prototype.initPanel = function() {\n    this.node.find(ACTION.SELECTALL).on('change', this.selectAll.bind(this));\n    this.node.find(ACTION.SELECTVISIBLES).on('change', this.selectVisibles.bind(this));\n    this.node.find(ACTION.ADDQUESTIONS).on('click', this.addQuestions);\n    this.node.find(ACTION.ADDQUESTION).on('click', this.addQuestion);\n    this.node.find(REGION.SELECTQUESTION).on('change', this.selectQuestion.bind(this));\n    this.countChecks();\n    this.pagination();\n};\n\nSelectQuestions.prototype.selectAll = function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    this.node.find(REGION.SELECTQUESTION).prop('checked', jQuery(e.currentTarget).is(':checked'));\n    this.countChecks();\n};\n\nSelectQuestions.prototype.selectVisibles = function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    this.node.find('[style=\"display: flex;\"] ' + REGION.SELECTQUESTION).prop('checked', jQuery(e.currentTarget).is(':checked'));\n    this.countChecks();\n};\n\nSelectQuestions.prototype.addQuestions = function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    let questionschekced = jQuery(REGION.SELECTQUESTION + ':checked');\n    if (questionschekced.length < 1) {\n        const stringkeys = [\n            {key: 'selectone', component: 'mod_jqshow'},\n            {key: 'selectone_desc', component: 'mod_jqshow'}\n        ];\n        getStrings(stringkeys).then((langStrings) => {\n            const title = langStrings[0];\n            const message = langStrings[1];\n            return ModalFactory.create({\n                title: title,\n                body: message,\n                type: ModalFactory.types.CANCEL\n            }).then(modal => {\n                modal.getRoot().on(ModalEvents.hidden, () => {\n                    modal.destroy();\n                });\n                return modal;\n            });\n        }).done(function(modal) {\n            modal.show();\n            // eslint-disable-next-line no-restricted-globals\n        }).fail(Notification.exception);\n    } else {\n        let questions = [];\n        questionschekced.each(function callback(index, question) {\n            // eslint-disable-next-line no-console\n            console.log(jQuery(question).attr('data-questionnid'));\n            let questiondata = {\n                questionid: jQuery(question).attr('data-questionnid'),\n                sessionid: sId,\n                jqshowid: jqshowId,\n                qtype: jQuery(question).attr('data-type')\n            };\n            questions.push(questiondata);\n        });\n        const stringkeys = [\n            {key: 'addquestions', component: 'mod_jqshow'},\n            {key: 'addquestions_desc', component: 'mod_jqshow', param: questionschekced.length},\n            {key: 'confirm', component: 'mod_jqshow'}\n        ];\n        getStrings(stringkeys).then((langStrings) => {\n            const title = langStrings[0];\n            const message = langStrings[1];\n            const buttonText = langStrings[2];\n            return ModalFactory.create({\n                title: title,\n                body: message,\n                type: ModalFactory.types.SAVE_CANCEL\n            }).then(modal => {\n                modal.setSaveButtonText(buttonText);\n                modal.getRoot().on(ModalEvents.save, () => {\n                    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                        let identifier = jQuery(REGION.PANEL);\n                        identifier.append(html);\n                    });\n                    let request = {\n                        methodname: SERVICES.ADDQUESTIONS,\n                        args: {\n                            questions: questions\n                        }\n                    };\n                    Ajax.call([request])[0].done(function(response) {\n                        if (response) {\n                            jQuery(REGION.CONTENTQUESTIONS).find(REGION.SELECTQUESTION).prop('checked', false);\n                            jQuery(ACTION.SELECTALL).prop('checked', false);\n                            jQuery(ACTION.SELECTVISIBLES).prop('checked', false);\n                            let request = {\n                                methodname: SERVICES.SESSIONQUESTIONS,\n                                args: {\n                                    jqshowid: jqshowId,\n                                    cmid: cmId,\n                                    sid: sId\n                                }\n                            };\n                            Ajax.call([request])[0].done(function(response) {\n                                Templates.render(TEMPLATES.QUESTIONSSELECTED, response).then(function(html, js) {\n                                    jQuery(REGION.SESSIONQUESTIONS).html(html);\n                                    Templates.runTemplateJS(js);\n                                    jQuery(REGION.LOADING).remove();\n                                }).fail(Notification.exception);\n                            });\n                        } else {\n                            // TODO modal error.\n                            alert('error');\n                            jQuery(REGION.LOADING).remove();\n                        }\n                    });\n                });\n                modal.getRoot().on(ModalEvents.hidden, () => {\n                    modal.destroy();\n                });\n                return modal;\n            });\n        }).done(function(modal) {\n            modal.show();\n            // eslint-disable-next-line no-restricted-globals\n        }).fail(Notification.exception);\n        // eslint-disable-next-line no-console\n        console.log(questions);\n    }\n};\n\nSelectQuestions.prototype.addQuestion = function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    let questionId = jQuery(e.currentTarget).attr('data-questionnid');\n    alert('addQuestion ' + questionId);\n};\n\nSelectQuestions.prototype.selectQuestion = function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    this.countChecks();\n};\n\nSelectQuestions.prototype.countChecks = function(e) {\n    // TODO change for datastorage, para poder contabilizar todos los marcados tras la paginaciÃ³n.\n    jQuery(REGION.NUMBERSELECT).html(jQuery(REGION.SELECTQUESTION + ':checked').length);\n};\n\nSelectQuestions.prototype.pagination = function() {\n    let numberOfItems = jQuery(REGION.CONTENTQUESTIONS).children().length;\n    let numberOfPages = Math.ceil(numberOfItems / showPerPage);\n    jQuery(REGION.CURRENTPAGE).val(0);\n    let navigationHtml = '';\n    let currentLink = 0;\n    if (numberOfItems === 0) {\n        jQuery(ACTION.SELECTALL).remove();\n        jQuery('label[for=\"selectall\"]').remove();\n    }\n    if (numberOfPages > 1) {\n        while (numberOfPages > currentLink) {\n            navigationHtml +=\n                '<div class=\"page-item\" data-goto=\"' + currentLink + '\">' +\n                    '<span class=\"page-link\">' + (currentLink + 1) + '</span>' +\n                '</div>';\n            currentLink++;\n        }\n    } else {\n        jQuery(ACTION.SELECTVISIBLES).remove();\n        jQuery('label[for=\"selectvisibles\"]').remove();\n    }\n    jQuery(REGION.PAGENAVIGATION).html(navigationHtml);\n    this.node.find('.page-item').on('click', this.goToPage);\n    jQuery(REGION.PAGENAVIGATION + ' .page-item:first').addClass('active');\n    jQuery(REGION.CONTENTQUESTIONS).children().css('display', 'none');\n    jQuery(REGION.CONTENTQUESTIONS).children().slice(0, showPerPage).css('display', 'flex');\n};\n\nSelectQuestions.prototype.goToPage = function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    let gotTo = jQuery(e.currentTarget).attr('data-goto');\n    let startFrom = gotTo * showPerPage;\n    let endOn = startFrom + showPerPage;\n    jQuery(REGION.CONTENTQUESTIONS).children().css('display', 'none').slice(startFrom, endOn).css('display', 'flex');\n    jQuery('.page-item[data-goto=' + gotTo + ']').addClass('active').siblings('.active').removeClass('active');\n    jQuery(ACTION.SELECTVISIBLES).prop('checked', false);\n    jQuery(REGION.CURRENTPAGE).val(gotTo);\n};\n\nexport const initSelectQuestions = (selector) => {\n    return new SelectQuestions(selector);\n};\n"],"names":["_interopRequireDefault","obj","__esModule","default","Object","defineProperty","_exports","value","initSelectQuestions","_jquery","_ajax","_modal_factory","_modal_events","_notification","_templates","cmId","sId","jqshowId","ACTION","REGION","SERVICES","TEMPLATES","SelectQuestions","selector","this","node","jQuery","attr","initPanel","prototype","find","on","selectAll","bind","selectVisibles","addQuestions","addQuestion","selectQuestion","countChecks","pagination","e","preventDefault","stopPropagation","prop","currentTarget","is","questionschekced","length","getStrings","key","component","then","langStrings","title","message","ModalFactory","create","body","type","types","CANCEL","modal","getRoot","ModalEvents","hidden","destroy","done","show","fail","Notification","exception","questions","each","index","question","console","log","questiondata","questionid","sessionid","jqshowid","qtype","push","stringkeys","param","buttonText","SAVE_CANCEL","setSaveButtonText","save","Templates","render","visible","html","append","request","methodname","args","Ajax","call","response","cmid","sid","js","runTemplateJS","remove","alert","questionId","numberOfItems","children","numberOfPages","Math","ceil","val","navigationHtml","currentLink","goToPage","addClass","css","slice","gotTo","startFrom","endOn","siblings","removeClass"],"mappings":"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"}