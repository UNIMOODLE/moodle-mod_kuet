define("mod_jqshow/match",["exports","jquery","core/ajax","core/templates","core/event"],(function(_exports,_jquery,_ajax,_templates,_event){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.initMatch=void 0,_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax),_templates=_interopRequireDefault(_templates),_event=_interopRequireDefault(_event);let cmId,sId,questionid,jqshowId,jqid,startPoint,color,toucheX,toucheY,ACTION={SEND_RESPONSE:'[data-action="send-match"]',SELECTOPTION:'[data-action="mark-left-option-mobile"]'},REGION_ROOT='[data-region="question-content"]',REGION_LOADING='[data-region="overlay-icon-container"]',REGION_LEFT_OPTION="#dragOption",REGION_RIGHT_OPTION="#dropOption",REGION_CONTAINER_ANSWERS="#dragQuestion",REGION_CONTAINER_ANSWERS_MOBILE="#selectQuestion",REGION_CANVAS="#canvas",REGION_CANVASTEMP="#canvasTemp",REGION_LEFT_OPTION_SELECTOR="#dragOption .option",REGION_LEFT_OPTION_CLICKABLE="#dragOption .option.option-left .content-option",REGION_RIGHT_OPTION_CLICKABLE="#dropOption .option.option-right .content-option",REGION_OPTION=".option",REGION_CLEARPATH="#dropOption .drop-element",REGION_POINTER=".option-pointer",REGION_NEXT='[data-action="next-question"]',REGION_TIMER='[data-region="question-timer"]',REGION_SECONDS='[data-region="seconds"]',REGION_CONTENTFEEDBACKS='[data-region="containt-feedbacks"]',REGION_FEEDBACK='[data-region="statement-feedback"]',REGION_FEEDBACKANSWER='[data-region="answer-feedback"]',REGION_FEEDBACKBACGROUND='[data-region="feedback-background"]',SERVICES_REPLY="mod_jqshow_match",TEMPLATES_LOADING="core/overlay_loading",questionEnd=!1,showQuestionFeedback=!1,manualMode=!1,linkList=[],linkCorrection=[],showingAnswers=!1,showingFeedback=!1;function Match(selector){let showquestionfeedback=arguments.length>1&&void 0!==arguments[1]&&arguments[1],manualmode=arguments.length>2&&void 0!==arguments[2]&&arguments[2],jsonresponse=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.node=(0,_jquery.default)(selector),sId=this.node.attr("data-sid"),cmId=this.node.attr("data-cmid"),questionid=this.node.attr("data-questionid"),jqshowId=this.node.attr("data-jqshowid"),jqid=this.node.attr("data-jqid"),showQuestionFeedback=showquestionfeedback,manualMode=manualmode,questionEnd=!1,linkList=[],this.createLinkCorrection(),""!==jsonresponse&&(this.answered(JSON.parse(atob(jsonresponse))),(!1===manualMode||(0,_jquery.default)(".modal-body").length)&&(questionEnd=!0,!0===showQuestionFeedback&&this.showFeedback(),this.showAnswers())),setTimeout((()=>{this.initMatch()}),500)}Match.prototype.node=null,Match.prototype.endTimer=new Event("endTimer"),Match.prototype.studentQuestionEnd=new Event("studentQuestionEnd"),Match.prototype.answered=function(jsonresponse){Match.prototype.allDisabled(),linkList=jsonresponse,Match.prototype.drawResponse(),Match.prototype.drawSelects(),questionEnd=!0,(0,_jquery.default)(ACTION.SEND_RESPONSE).addClass("d-none"),(0,_jquery.default)(REGION_FEEDBACKBACGROUND).css("display","block"),(0,_jquery.default)(REGION_CONTAINER_ANSWERS).css("z-index",3),(0,_jquery.default)(REGION_CONTAINER_ANSWERS_MOBILE).css("z-index",3),!1===manualMode&&(0,_jquery.default)(REGION_NEXT).removeClass("d-none"),null!==document.querySelector(REGION_CONTENTFEEDBACKS)&&_event.default.notifyFilterContentUpdated(document.querySelector(REGION_CONTENTFEEDBACKS))},Match.prototype.initMatch=function(){Match.prototype.normalizeCanvas(),(0,_jquery.default)(REGION_CONTAINER_ANSWERS).bind("dragover",(function(){let top=window.event.pageY,left=window.event.pageX;Match.prototype.drawLinkTemp(startPoint,{top:top,left:left})})),(0,_jquery.default)(REGION_LEFT_OPTION).find(REGION_OPTION).toArray().forEach((dragEl=>this.addEventsDragAndDrop(dragEl))),(0,_jquery.default)(REGION_RIGHT_OPTION).find(REGION_OPTION).toArray().forEach((dropEl=>this.addTargetEvents(dropEl))),Match.prototype.drawLinks(),(0,_jquery.default)(REGION_CLEARPATH).on("click touchend",Match.prototype.clearPath.bind(this)),(0,_jquery.default)(REGION_LEFT_OPTION_CLICKABLE).on("click touchend",Match.prototype.leftOptionSelected.bind(this)),(0,_jquery.default)(ACTION.SEND_RESPONSE).off("click"),(0,_jquery.default)(ACTION.SEND_RESPONSE).on("click",Match.prototype.sendResponse),(0,_jquery.default)(ACTION.SELECTOPTION).on("change",Match.prototype.OptionSelected.bind(this)),(0,_jquery.default)(window).on("resize",(function(){Match.prototype.normalizeCanvas(),!1!==manualMode&&!(0,_jquery.default)(".modal-body").length||!0!==questionEnd?(Match.prototype.drawLinks(),Match.prototype.drawSelects()):Match.prototype.showAnswers()})),Match.prototype.initEvents()},Match.prototype.normalizeCanvas=function(){let heightLeft=(0,_jquery.default)(REGION_LEFT_OPTION).height(),heightRight=(0,_jquery.default)(REGION_RIGHT_OPTION).height(),canvasHeight=heightLeft>heightRight?heightLeft:heightRight;(0,_jquery.default)(REGION_CANVAS).attr("height",canvasHeight),(0,_jquery.default)(REGION_CANVAS).attr("width",(0,_jquery.default)(REGION_CANVAS).width()),(0,_jquery.default)(REGION_CANVASTEMP).attr("width",(0,_jquery.default)(REGION_CANVASTEMP).width()),(0,_jquery.default)(REGION_CANVASTEMP).attr("height",canvasHeight)},Match.prototype.initEvents=function(){addEventListener("timeFinish",Match.prototype.sendResponse,{once:!0}),!1!==manualMode&&(addEventListener("alreadyAnswered_"+jqid,(ev=>{(0,_jquery.default)('[data-region="student-canvas"]').data("userid")!=ev.detail.userid&&((0,_jquery.default)('[data-region="group-message"]').css({"z-index":3,padding:"15px"}),(0,_jquery.default)('[data-region="group-message"]').show()),!0!==questionEnd&&Match.prototype.sendResponse()}),{once:!0}),addEventListener("teacherQuestionEnd_"+jqid,(e=>{!0!==questionEnd&&Match.prototype.sendResponse(),e.detail.statistics.forEach((statistic=>{(0,_jquery.default)("#statistics .correct").attr("aria-valuenow",statistic.correct).width(statistic.correct+"%").html(statistic.correct+"%"),(0,_jquery.default)("#statistics .failure").attr("aria-valuenow",statistic.failure).width(statistic.failure+"%").html(statistic.failure+"%"),(0,_jquery.default)("#statistics .invalid").attr("aria-valuenow",statistic.invalid).width(statistic.invalid+"%").html(statistic.invalid+"%"),(0,_jquery.default)("#statistics .noresponse").attr("aria-valuenow",statistic.noresponse).width(statistic.noresponse+"%").html(statistic.noresponse+"%"),(0,_jquery.default)("#statistics .partially").attr("aria-valuenow",statistic.partially).width(statistic.partially+"%").html(statistic.partially+"%")}))}),{once:!0}),addEventListener("pauseQuestion_"+jqid,(()=>{Match.prototype.pauseQuestion()}),!1),addEventListener("playQuestion_"+jqid,(()=>{Match.prototype.playQuestion()}),!1),addEventListener("showAnswers_"+jqid,(()=>{Match.prototype.showAnswers()}),!1),addEventListener("hideAnswers_"+jqid,(()=>{Match.prototype.hideAnswers()}),!1),addEventListener("showStatistics_"+jqid,(()=>{Match.prototype.showStatistics()}),!1),addEventListener("hideStatistics_"+jqid,(()=>{Match.prototype.hideStatistics()}),!1),addEventListener("showFeedback_"+jqid,(()=>{Match.prototype.showFeedback()}),!1),addEventListener("hideFeedback_"+jqid,(()=>{Match.prototype.hideFeedback()}),!1),addEventListener("removeEvents",(()=>{Match.prototype.removeEvents()}),{once:!0})),window.onbeforeunload=function(){if((0,_jquery.default)(REGION_SECONDS).length>0&&!1===questionEnd)return Match.prototype.sendResponse(),"Because the question is overdue and an attempt has been made to reload the page, the question has remained unanswered."}},Match.prototype.removeEvents=function(){removeEventListener("timeFinish",(()=>Match.prototype.sendResponse),{once:!0}),!1!==manualMode&&(removeEventListener("alreadyAnswered_"+jqid,(ev=>{(0,_jquery.default)('[data-region="student-canvas"]').data("userid")!=ev.detail.userid&&((0,_jquery.default)('[data-region="group-message"]').css({"z-index":3,padding:"15px"}),(0,_jquery.default)('[data-region="group-message"]').show()),!0!==questionEnd&&Match.prototype.sendResponse()}),{once:!0}),removeEventListener("teacherQuestionEnd_"+jqid,(e=>{!0!==questionEnd&&Match.prototype.sendResponse(),e.detail.statistics.forEach((statistic=>{(0,_jquery.default)("#statistics .correct").attr("aria-valuenow",statistic.correct).width(statistic.correct+"%").html(statistic.correct+"%"),(0,_jquery.default)("#statistics .failure").attr("aria-valuenow",statistic.failure).width(statistic.failure+"%").html(statistic.failure+"%"),(0,_jquery.default)("#statistics .invalid").attr("aria-valuenow",statistic.invalid).width(statistic.invalid+"%").html(statistic.invalid+"%"),(0,_jquery.default)("#statistics .noresponse").attr("aria-valuenow",statistic.noresponse).width(statistic.noresponse+"%").html(statistic.noresponse+"%"),(0,_jquery.default)("#statistics .partially").attr("aria-valuenow",statistic.partially).width(statistic.partially+"%").html(statistic.partially+"%")}))}),{once:!0}),removeEventListener("pauseQuestion_"+jqid,(()=>{Match.prototype.pauseQuestion()}),!1),removeEventListener("playQuestion_"+jqid,(()=>{Match.prototype.playQuestion()}),!1),removeEventListener("showAnswers_"+jqid,(()=>{Match.prototype.showAnswers()}),!1),removeEventListener("hideAnswers_"+jqid,(()=>{Match.prototype.hideAnswers()}),!1),removeEventListener("showStatistics_"+jqid,(()=>{Match.prototype.showStatistics()}),!1),removeEventListener("hideStatistics_"+jqid,(()=>{Match.prototype.hideStatistics()}),!1),removeEventListener("showFeedback_"+jqid,(()=>{Match.prototype.showFeedback()}),!1),removeEventListener("hideFeedback_"+jqid,(()=>{Match.prototype.hideFeedback()}),!1),removeEventListener("removeEvents",(()=>{Match.prototype.removeEvents()}),{once:!0}))},Match.prototype.createLinkCorrection=function(){linkCorrection=[],_jquery.default.each((0,_jquery.default)(REGION_LEFT_OPTION_SELECTOR),(function(index,item){let dragId=(0,_jquery.default)(item).data("stems")+"-draggable",steam=Match.prototype.baseConvert((0,_jquery.default)(item).data("stems"),2,16),dropId=Match.prototype.baseConvert(steam,10,26)+"-dropzone",stemsLeft=(0,_jquery.default)("#"+dragId).data("forstems"),stemsRight=(0,_jquery.default)("#"+dropId).data("forstems");linkCorrection.push({dragId:dragId,dropId:dropId,stemsLeft:stemsLeft,stemsRight:stemsRight})}))},Match.prototype.getRandomColor=function(position){return["#FF6633","#E64D66","#FF33FF","#FF9999","#00B3E6","#E6B333","#3366E6","#999966","#99FF99","#B34D4D","#80B300","#809900","#E6B3B3","#6680B3","#66991A","#FF99E6","#CCFF1A","#FF1A66","#E6331A","#33FFCC","#66994D","#B366CC","#4D8000","#B33300","#CC80CC","#66664D","#991AFF","#E666FF","#4DB3FF","#1AB399","#E666B3","#33991A","#CC9999","#B3B31A","#00E680","#4D8066","#809980","#E6FF80","#1AFF33","#999933","#FF3380","#CCCC00","#66E64D","#4D80CC","#9900B3","#FFB399","#4DB380","#FF4D4D","#99E6E6","#6666FF"][position]},Match.prototype.drawResponse=function(){let fromTeacher=arguments.length>0&&void 0!==arguments[0]&&arguments[0],corrects=0,fails=0;return linkList.forEach((userR=>{let optionLeft=(0,_jquery.default)("#"+userR.dragId).parents(".option-left").first(),optionRight=(0,_jquery.default)("#"+userR.dropId).parents(".option-right").first();userR.stemDragId===userR.stemDropId?((!1===manualMode||(0,_jquery.default)(".modal-body").length||!0===fromTeacher)&&(userR.color="#0fd08c",optionLeft.find(".feedback-icon.correct").css({display:"flex"}),optionLeft.find(".content-option").removeClass("bg-primary").css({"background-color":"#0fd08c"}),optionRight.find(".content-option").removeClass("bg-primary").css({"background-color":"#0fd08c"})),corrects++):((!1===manualMode||(0,_jquery.default)(".modal-body").length||!0===fromTeacher)&&(userR.color="#f85455",optionLeft.find(".feedback-icon.incorrect").css({display:"flex"}),optionLeft.find(".content-option").removeClass("bg-primary").css({"background-color":"#f85455"}),optionRight.find(".content-option").removeClass("bg-primary").css({"background-color":"#f85455"})),fails++)})),Match.prototype.drawMobileResponse(fromTeacher),[corrects,fails]},Match.prototype.hideResponse=function(){return linkList.forEach((userR=>{let optionLeft=(0,_jquery.default)("#"+userR.dragId).parents(".option-left").first(),optionRight=(0,_jquery.default)("#"+userR.dropId).parents(".option-right").first();userR.color=Match.prototype.getRandomColor(linkList.indexOf(userR)),optionLeft.find(".feedback-icon").css({display:"none"}),optionLeft.find(".content-option").css({"background-color":"inherit"}).addClass("bg-primary"),optionRight.find(".content-option").css({"background-color":"inherit"}).addClass("bg-primary")})),Match.prototype.hideMobileResponse(),[0,0]},Match.prototype.showCorrects=function(){linkCorrection.forEach((userR=>{userR.color="#0fd08c"}))},Match.prototype.sendResponse=function(){Match.prototype.allDisabled(),_templates.default.render(TEMPLATES_LOADING,{visible:!0}).done((function(html){(0,_jquery.default)(REGION_ROOT).append(html),dispatchEvent(Match.prototype.endTimer),removeEventListener("timeFinish",(()=>Match.prototype.sendResponse),{once:!0}),Match.prototype.removeEvents();let timeLeft=parseInt((0,_jquery.default)(REGION_SECONDS).text()),result=0,[corrects,fails]=Match.prototype.drawResponse();0!==corrects&&(result=2),(0,_jquery.default)(REGION_LEFT_OPTION_SELECTOR).length===corrects&&(result=1),(0,_jquery.default)(REGION_LEFT_OPTION_SELECTOR).length===fails&&(result=0),0===(0,_jquery.default)(REGION_LEFT_OPTION_SELECTOR).length&&0===(0,_jquery.default)(REGION_LEFT_OPTION_SELECTOR).length&&(result=3),Match.prototype.drawLinks();let request={methodname:SERVICES_REPLY,args:{jsonresponse:JSON.stringify(linkList),result:result,sessionid:sId,jqshowid:jqshowId,cmid:cmId,questionid:questionid,jqid:jqid,timeleft:timeLeft||0,preview:!1}};_ajax.default.call([request])[0].done((function(response){!0===response.reply_status?(questionEnd=!0,(0,_jquery.default)(ACTION.SEND_RESPONSE).addClass("d-none"),(0,_jquery.default)(REGION_NEXT).removeClass("d-none"),dispatchEvent(Match.prototype.studentQuestionEnd),response.hasfeedbacks&&((0,_jquery.default)(REGION_FEEDBACK).html(response.statment_feedback),(0,_jquery.default)(REGION_FEEDBACKANSWER).html(response.answer_feedback)),((0,_jquery.default)(".modal-body").length||!1===manualMode)&&(Match.prototype.showAnswers(),!0===showQuestionFeedback&&Match.prototype.showFeedback()),(0,_jquery.default)(REGION_CONTAINER_ANSWERS).css("z-index",3),(0,_jquery.default)(REGION_CONTAINER_ANSWERS_MOBILE).css("z-index",3),(0,_jquery.default)(REGION_FEEDBACKBACGROUND).css("display","block")):alert("error"),(0,_jquery.default)(REGION_LOADING).remove()}))}))},Match.prototype.addEventsDragAndDrop=function(el){el.addEventListener("dragstart",Match.prototype.onDragStart,!1),el.addEventListener("dragend",Match.prototype.onDragEnd,!1),el.addEventListener("touchstart",Match.prototype.touchStart,!1),el.addEventListener("touchmove",Match.prototype.touchMove,!1),el.addEventListener("touchend",Match.prototype.touchEnd,!1)},Match.prototype.removeEventsDragAndDrop=function(el){el.removeEventListener("dragstart",Match.prototype.onDragStart,!1),el.removeEventListener("dragend",Match.prototype.onDragEnd,!1),el.removeEventListener("touchstart",Match.prototype.touchStart,!1),el.removeEventListener("touchmove",Match.prototype.touchMove,!1),el.removeEventListener("touchend",Match.prototype.touchEnd,!1)},Match.prototype.addTargetEvents=function(target){target.addEventListener("dragover",Match.prototype.onDragOver,!1),target.addEventListener("drop",Match.prototype.onDrop,!1)},Match.prototype.removeTargetEvents=function(target){target.removeEventListener("dragover",Match.prototype.onDragOver,!1),target.removeEventListener("drop",Match.prototype.onDrop,!1)},Match.prototype.onDragStart=function(event){event.dataTransfer.setData("text/plain",event.target.id),startPoint=event.target.id;let options=document.querySelectorAll(REGION_LEFT_OPTION_SELECTOR);color=Match.prototype.getRandomColor(Array.from(options).indexOf(event.currentTarget))},Match.prototype.onDragOver=function(event){Match.prototype.clearPathTemp(),event.preventDefault()},Match.prototype.onDragEnd=function(event){Match.prototype.clearPathTemp(),event.preventDefault()},Match.prototype.onDrop=function(event){const dragId=event.dataTransfer.getData("text"),dropId=(0,_jquery.default)(event.currentTarget).find(REGION_POINTER).attr("id");Match.prototype.Drop(dragId,dropId)},Match.prototype.Drop=function(dragId,dropId){let deselected=linkList.filter((obj=>obj.dragId===dragId||obj.dropId===dropId));deselected.length&&deselected.forEach((x=>{let selectroDropId=(0,_jquery.default)("#"+x.dropId);selectroDropId.find("i").css("font-weight","400"),selectroDropId.find("i").css("color","#5a57ff"),selectroDropId.find("i").removeClass("linked"),selectroDropId.find("i").css("font-weight","400"),selectroDropId.find("i").css("color","#5a57ff")})),linkList=linkList.filter((obj=>obj.dragId!==dragId)),linkList=linkList.filter((obj=>obj.dropId!==dropId));let stemsLeft=(0,_jquery.default)("#"+dragId).data("forstems"),stemsRight=(0,_jquery.default)("#"+dropId).data("forstems"),stemDragId=Match.prototype.baseConvert(stemsLeft,2,16),stemDropId=Match.prototype.baseConvert(stemsRight,26,10);linkList.push({dragId:dragId,dropId:dropId,color:color,stemDragId:stemDragId,stemDropId:stemDropId,stemsLeft:stemsLeft,stemsRight:stemsRight}),Match.prototype.drawLinks(),Match.prototype.drawSelects(),Match.prototype.clearPathTemp()},Match.prototype.baseConvert=function(number,frombase,tobase){return parseInt(number+"",0|frombase).toString(0|tobase)},Match.prototype.touchStart=function(e){void 0!==e.target.id&&""!==e.target.id||(startPoint=void 0!==(0,_jquery.default)(e.target).parent().attr("id")?(0,_jquery.default)(e.target).parent().attr("id"):(0,_jquery.default)(e.target).closest(".option-left").find(".drag-element").first().attr("id"));let options=document.querySelectorAll(REGION_LEFT_OPTION_SELECTOR);color=Match.prototype.getRandomColor(Array.from(options).indexOf(e.currentTarget))},Match.prototype.touchMove=function(e){e.preventDefault();let top=toucheY=e.touches[0].pageY,left=toucheX=e.touches[0].pageX;Match.prototype.drawLinkTemp(startPoint,{top:top,left:left})},Match.prototype.touchEnd=function(e){(0,_jquery.default)(REGION_RIGHT_OPTION).find(REGION_OPTION).toArray().forEach((target=>{let box2=target.getBoundingClientRect(),x=box2.left,y=box2.top,h=target.offsetHeight,w=target.offsetWidth;if(!(toucheX>x&&toucheX<x+w&&toucheY>y&&toucheY<y+h))return!1;{let dropId;dropId=void 0===target.id||""===target.id||"dropOption"===target.id?void 0!==(0,_jquery.default)(target).parent().attr("id")&&"dropOption"!==(0,_jquery.default)(target).parent().attr("id")?(0,_jquery.default)(target).parent().attr("id"):(0,_jquery.default)(target).closest(".option-right").find(".drop-element").first().attr("id"):target.id,Match.prototype.Drop(startPoint,dropId)}})),Match.prototype.clearPathTemp(),e.preventDefault()},Match.prototype.drawLinks=function(){let canvas=(0,_jquery.default)(REGION_CANVAS).get(0);canvas.getContext("2d").clearRect(0,0,canvas.width,canvas.height),linkList.forEach((link=>Match.prototype.drawLink(link.dragId,link.dropId,link.color)))},Match.prototype.drawCorrectLinks=function(){let canvas=(0,_jquery.default)(REGION_CANVAS).get(0);canvas.getContext("2d").clearRect(0,0,canvas.width,canvas.height),linkCorrection.forEach((link=>Match.prototype.drawLink(link.dragId,link.dropId,link.color))),linkCorrection.forEach((link=>Match.prototype.drawSelect(link.stemsLeft,link.stemsRight,link.color)))},Match.prototype.drawLink=function(obj1,obj2,pColor){let ctx=(0,_jquery.default)(REGION_CANVAS).get(0).getContext("2d"),$obj1=(0,_jquery.default)("#"+obj1),$obj2=(0,_jquery.default)("#"+obj2),parent=(0,_jquery.default)(REGION_CONTAINER_ANSWERS).offset(),p1=$obj1.offset(),h1=($obj1.width(),$obj1.height()),p2=$obj2.offset(),h2=($obj2.width(),$obj2.height()),wc=(0,_jquery.default)(REGION_CANVAS).width();ctx.beginPath(),ctx.strokeStyle=pColor||color,ctx.lineWidth=3,ctx.moveTo(0,p1.top-parent.top+h1/2-20-2),ctx.bezierCurveTo(wc/2,p1.top-parent.top+h1/2-20-2,wc/2,p2.top-parent.top+h2/2-20-2,wc-4,p2.top-parent.top+h2/2-20-2),ctx.stroke(),$obj1.children().css("color",pColor||color),$obj1.children().css("font-weight","900"),$obj2.children().css("color",pColor||color),$obj2.children().css("font-weight","900"),$obj2.children().addClass("linked")},Match.prototype.clearPath=function(event){let ident=event.currentTarget.id,oldStemsLeft="",oldStemsRight="";linkList=linkList.filter((obj=>(obj.dropId===ident&&(oldStemsLeft=obj.stemsLeft,oldStemsRight=obj.stemsRight),obj.dropId!==ident)));let dragQuestionObject=(0,_jquery.default)(REGION_CONTAINER_ANSWERS);dragQuestionObject.find("i").removeClass("linked"),dragQuestionObject.find("i").css("font-weight","400"),dragQuestionObject.find("i").css("color","#5a57ff"),Match.prototype.drawLinks(),""!==oldStemsLeft&&""!==oldStemsRight&&Match.prototype.optionDeselected(oldStemsLeft,oldStemsRight),Match.prototype.drawSelects()},Match.prototype.drawLinkTemp=function(obj1,coordPt){let ctx=(0,_jquery.default)(REGION_CANVASTEMP).get(0).getContext("2d"),$obj1=(0,_jquery.default)("#"+obj1),parent=(0,_jquery.default)(REGION_CONTAINER_ANSWERS).offset(),p1=$obj1.offset(),h1=($obj1.width(),$obj1.height()),p2=coordPt,c=(0,_jquery.default)(REGION_CANVASTEMP).offset();ctx.beginPath(),ctx.strokeStyle=color,ctx.lineWidth=3,ctx.moveTo(0,p1.top-parent.top+h1/2-20-2),ctx.bezierCurveTo((p2.left-c.left)/2,p1.top-parent.top-19-2,(p2.left-c.left)/2,p2.top-parent.top-19-2,p2.left-c.left,p2.top-parent.top-19-2),Match.prototype.clearPathTemp(),ctx.stroke()},Match.prototype.clearPathTemp=function(){let canvas=(0,_jquery.default)(REGION_CANVASTEMP).get(0);canvas.getContext("2d").clearRect(0,0,canvas.width,canvas.height)},Match.prototype.leftOptionSelected=function(e){e.preventDefault(),e.stopPropagation(),_jquery.default.each((0,_jquery.default)(REGION_LEFT_OPTION_CLICKABLE),(function(index,item){e.target!==item?(0,_jquery.default)(item).parent().addClass("disabled"):(0,_jquery.default)(item).parents(".option").first().find(".option-pointer").addClass("disabled")})),_jquery.default.each((0,_jquery.default)(REGION_CLEARPATH),(function(index,item){(0,_jquery.default)(item).addClass("disabled")})),_jquery.default.each((0,_jquery.default)(REGION_RIGHT_OPTION_CLICKABLE),(function(index,item){(0,_jquery.default)(item).css({"pointer-events":"inherit"})})),(0,_jquery.default)(REGION_RIGHT_OPTION_CLICKABLE).on("click touchend",Match.prototype.rightOptionSelected.bind(this));let options=document.querySelectorAll(REGION_LEFT_OPTION_SELECTOR);color=Match.prototype.getRandomColor(Array.from(options).indexOf((0,_jquery.default)(e.target).parents(".option").first().get(0)))},Match.prototype.rightOptionSelected=function(e){e.preventDefault(),e.stopPropagation();let dragId=(0,_jquery.default)(".option-left:not(.disabled)").find(".drag-element").attr("id");_jquery.default.each((0,_jquery.default)(REGION_RIGHT_OPTION_CLICKABLE),(function(index,item){if(e.target===item){let dropId=(0,_jquery.default)(item).parents(".option-right").first().find(".drop-element").attr("id");document.getElementById(dropId).click(),Match.prototype.Drop(dragId,dropId),(0,_jquery.default)(dragId).removeClass("disabled")}(0,_jquery.default)(".option-left").removeClass("disabled"),(0,_jquery.default)(".drag-element").removeClass("disabled"),(0,_jquery.default)(REGION_RIGHT_OPTION_CLICKABLE).off("click touchend"),_jquery.default.each((0,_jquery.default)(REGION_CLEARPATH),(function(index,item){(0,_jquery.default)(item).removeClass("disabled")})),_jquery.default.each((0,_jquery.default)(REGION_RIGHT_OPTION_CLICKABLE),(function(index,item){(0,_jquery.default)(item).css({"pointer-events":"none"})}))}))},Match.prototype.allDisabled=function(){_jquery.default.each((0,_jquery.default)(REGION_LEFT_OPTION_CLICKABLE),(function(index,item){(0,_jquery.default)(item).css({"pointer-events":"none"})})),_jquery.default.each((0,_jquery.default)(REGION_RIGHT_OPTION_CLICKABLE),(function(index,item){(0,_jquery.default)(item).css({"pointer-events":"none"})})),_jquery.default.each((0,_jquery.default)(REGION_POINTER),(function(index,item){(0,_jquery.default)(item).css({"pointer-events":"none"})})),(0,_jquery.default)(REGION_CONTAINER_ANSWERS).unbind("dragover"),(0,_jquery.default)(ACTION.SELECTOPTION).unbind("change").css({"pointer-events":"none"}),(0,_jquery.default)(REGION_LEFT_OPTION).find(REGION_OPTION).toArray().forEach((dragEl=>this.removeEventsDragAndDrop(dragEl))),(0,_jquery.default)(REGION_RIGHT_OPTION).find(REGION_OPTION).toArray().forEach((dropEl=>this.removeTargetEvents(dropEl))),(0,_jquery.default)(REGION_CLEARPATH).off("click touchend"),(0,_jquery.default)(REGION_LEFT_OPTION_CLICKABLE).off("click touchend"),(0,_jquery.default)(ACTION.SEND_RESPONSE).off("click")},Match.prototype.OptionSelected=function(e){e.preventDefault(),e.stopPropagation();let optionLeft=(0,_jquery.default)(e.target),optionRight=(0,_jquery.default)(e.target).find("option:selected"),stemsLeft=optionLeft.attr("data-stems"),stemsRight=optionRight.attr("data-stems");if("default"!==stemsRight)(0,_jquery.default)("#"+stemsLeft+"-left-clickable").trigger("click"),setTimeout((function(){(0,_jquery.default)("#"+stemsRight+"-right-clickable").trigger("click"),optionLeft.css({border:"1px solid "+color})}),200);else{let dragId=stemsLeft+"-draggable",oldDropId="",oldStemsRight="";linkList=linkList.filter((obj=>(obj.dragId===dragId&&(oldDropId=obj.dropId,oldStemsRight=obj.stemsRight),obj.dragId!==dragId))),Match.prototype.optionDeselected(stemsLeft,oldStemsRight),(0,_jquery.default)("#"+oldDropId).trigger("click")}},Match.prototype.optionSelected=function(stemsLeft,stemsRight,color){(0,_jquery.default)(ACTION.SELECTOPTION).each((function(){(0,_jquery.default)(this).find('option[data-stems="'+stemsRight+'"]').each((function(){(0,_jquery.default)(this).css("background-color",color)}))}))},Match.prototype.optionDeselected=function(stemsLeft,stemsRight){(0,_jquery.default)(ACTION.SELECTOPTION).each((function(){parseInt((0,_jquery.default)(this).attr("data-stems"))===parseInt(stemsLeft)&&(0,_jquery.default)(this).css({border:"1px solid #8f959e"}),(0,_jquery.default)(this).find('option[data-stems="'+stemsRight+'"]:selected').length&&(0,_jquery.default)(this).find('option[data-stems="default"]').prop("selected",!0),(0,_jquery.default)(this).find('option[data-stems="'+stemsRight+'"]').each((function(){(0,_jquery.default)(this).css("background-color","white")}))}))},Match.prototype.drawSelects=function(){(0,_jquery.default)(ACTION.SELECTOPTION).each((function(){(0,_jquery.default)(this).find("option").each((function(){(0,_jquery.default)(this).css("background-color","white")}))})),linkList.forEach((select=>Match.prototype.drawSelect(select.stemsLeft,select.stemsRight,select.color)))},Match.prototype.drawSelect=function(stemsLeft,stemsRight,color){(0,_jquery.default)('.content-options-right-mobile[data-stems="'+stemsLeft+'"]').css({border:"1px solid "+color}),(0,_jquery.default)('.content-options-right-mobile[data-stems="'+stemsLeft+'"] .option-right-mobile[data-stems="'+stemsRight+'"]').prop("selected",!0),Match.prototype.optionSelected(stemsLeft,stemsRight,color)},Match.prototype.drawMobileResponse=function(){let fromTeacher=arguments.length>0&&void 0!==arguments[0]&&arguments[0];linkList.forEach((userR=>{let feedbacks=(0,_jquery.default)('.feedback-icons[data-stems="'+userR.stemsLeft+'"]'),optionLeft=(0,_jquery.default)('.content-options-right-mobile[data-stems="'+userR.stemsLeft+'"]'),optionRight=(0,_jquery.default)('.content-options-right-mobile[data-stems="'+userR.stemsLeft+'"] .option-right-mobile[data-stems="'+userR.stemsRight+'"]');(!1===manualMode||(0,_jquery.default)(".modal-body").length||!0===fromTeacher)&&(userR.stemDragId===userR.stemDropId?(userR.color="#0fd08c",feedbacks.find(".feedback-icon.correct").css({display:"flex"}),optionLeft.css({border:"1px solid #0fd08c"}),optionRight.css({"background-color":"#0fd08c"}).prop("selected",!0)):(userR.color="#f85455",feedbacks.find(".feedback-icon.incorrect").css({display:"flex"}),optionLeft.css({border:"1px solid #f85455"}),optionRight.css({"background-color":"#f85455"}).prop("selected",!0)))}))},Match.prototype.hideMobileResponse=function(){linkList.forEach((userR=>{let feedbacks=(0,_jquery.default)('.feedback-icons[data-stems="'+userR.stemsLeft+'"]'),optionLeft=(0,_jquery.default)('.content-options-right-mobile[data-stems="'+userR.stemsLeft+'"]'),optionRight=(0,_jquery.default)('.content-options-right-mobile[data-stems="'+userR.stemsLeft+'"] .option-right-mobile[data-stems="'+userR.stemsRight+'"]');feedbacks.find(".feedback-icon").css({display:"none"}),optionLeft.css({border:"1px solid"+userR.color}),optionRight.css({"background-color":userR.color})}))},Match.prototype.pauseQuestion=function(){dispatchEvent(new Event("pauseQuestion")),(0,_jquery.default)(REGION_TIMER).css("z-index",3),(0,_jquery.default)(REGION_FEEDBACKBACGROUND).css("display","block"),(0,_jquery.default)(ACTION.REPLY).css("pointer-events","none"),_jquery.default.each((0,_jquery.default)(".drag-element"),(function(index,item){(0,_jquery.default)(item).css({"z-index":"0"})})),_jquery.default.each((0,_jquery.default)(REGION_LEFT_OPTION_CLICKABLE),(function(index,item){(0,_jquery.default)(item).css({"pointer-events":"none"})})),_jquery.default.each((0,_jquery.default)(REGION_RIGHT_OPTION_CLICKABLE),(function(index,item){(0,_jquery.default)(item).css({"pointer-events":"none"})}))},Match.prototype.playQuestion=function(){!0!==questionEnd&&(dispatchEvent(new Event("playQuestion")),(0,_jquery.default)(REGION_TIMER).css("z-index",1),(0,_jquery.default)(REGION_FEEDBACKBACGROUND).css("display","none"),(0,_jquery.default)(ACTION.REPLY).css("pointer-events","auto"),_jquery.default.each((0,_jquery.default)(".drag-element"),(function(index,item){(0,_jquery.default)(item).css({"z-index":"2"})})),_jquery.default.each((0,_jquery.default)(REGION_LEFT_OPTION_CLICKABLE),(function(index,item){(0,_jquery.default)(item).css({"pointer-events":"inherit"})})),_jquery.default.each((0,_jquery.default)(REGION_RIGHT_OPTION_CLICKABLE),(function(index,item){(0,_jquery.default)(item).css({"pointer-events":"inherit"})})))},Match.prototype.showAnswers=function(){showingAnswers=!0,Match.prototype.drawResponse(!0),Match.prototype.drawLinks()},Match.prototype.hideAnswers=function(){showingAnswers=!1,Match.prototype.hideResponse(),Match.prototype.drawLinks(),showingFeedback?Match.prototype.showFeedback():Match.prototype.hideFeedback()},Match.prototype.showStatistics=function(){!0===questionEnd&&(0,_jquery.default)("#statistics").css({display:"block","z-index":3})},Match.prototype.hideStatistics=function(){!0===questionEnd&&(0,_jquery.default)("#statistics").css({display:"none","z-index":0})},Match.prototype.showFeedback=function(){!0===questionEnd&&(showingFeedback=!0,0===(0,_jquery.default)(".modal-body").length&&!0===manualMode&&(Match.prototype.hideResponse(),Match.prototype.showCorrects(),Match.prototype.drawCorrectLinks()),(0,_jquery.default)(REGION_CONTENTFEEDBACKS).css({display:"block","z-index":3}))},Match.prototype.hideFeedback=function(){!0===questionEnd&&(showingFeedback=!1,(0,_jquery.default)(REGION_CONTENTFEEDBACKS).css({display:"none","z-index":0}),showingAnswers?(Match.prototype.drawResponse(!0),Match.prototype.drawLinks()):(Match.prototype.hideResponse(),Match.prototype.drawLinks()))};_exports.initMatch=(selector,showquestionfeedback,manualmode,jsonresponse)=>new Match(selector,showquestionfeedback,manualmode,jsonresponse)}));

//# sourceMappingURL=match.min.js.map