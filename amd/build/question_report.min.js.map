{"version":3,"file":"question_report.min.js","sources":["../src/question_report.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n// Project implemented by the \"Recovery, Transformation and Resilience Plan.\n// Funded by the European Union - Next GenerationEU\".\n//\n// Produced by the UNIMOODLE University Group: Universities of\n// Valladolid, Complutense de Madrid, UPV/EHU, León, Salamanca,\n// Illes Balears, Valencia, Rey Juan Carlos, La Laguna, Zaragoza, Málaga,\n// Córdoba, Extremadura, Vigo, Las Palmas de Gran Canaria y Burgos.\n\n/**\n *\n * @module    mod_jqshow/question_report\n * @copyright  2023 Proyecto UNIMOODLE\n * @author     UNIMOODLE Group (Coordinator) <direccion.area.estrategia.digital@uva.es>\n * @author     3IPUNT <contacte@tresipunt.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n\"use strict\";\n/* eslint-disable no-unused-vars */\n\nimport jQuery from 'jquery';\nimport Templates from 'core/templates';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport ModalJqshow from 'mod_jqshow/modal';\nimport Ajax from 'core/ajax';\nimport Notification from 'core/notification';\nimport {get_string as getString} from 'core/str';\n\nlet REGION = {\n    ROOT: '[data-region=\"question-report\"]', // This root.\n    LOADING: '[data-region=\"overlay-icon-container\"]',\n};\n\nlet ACTION = {\n    QUESTIONPREVIEW: '[data-action=\"question-preview\"]',\n    SEEANSWER: '[data-action=\"seeanswer\"]',\n};\n\nlet SERVICES = {\n    GETQUESTION: 'mod_jqshow_getquestion',\n    USERQUESTIONRESPONSE: 'mod_jqshow_getuserquestionresponse'\n};\n\nlet TEMPLATES = {\n    LOADING: 'core/overlay_loading',\n    QUESTION: 'mod_jqshow/questions/encasement'\n};\n\nQuestionReport.prototype.root = null;\n\n/**\n * @constructor\n * @param {String} region\n */\nfunction QuestionReport(region) {\n    this.root = jQuery(region);\n    this.root.find(ACTION.QUESTIONPREVIEW).on('click', this.questionPreview);\n    this.root.find(ACTION.SEEANSWER).on('click', this.seeAnswer);\n}\n\nQuestionReport.prototype.questionPreview = function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    let sessionId = jQuery(e.currentTarget).attr('data-sessionid');\n    let questionnId = jQuery(e.currentTarget).attr('data-questionnid');\n    let cmId = jQuery(e.currentTarget).attr('data-cmid');\n    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n        let identifier = jQuery(REGION.ROOT);\n        identifier.append(html);\n        let request = {\n            methodname: SERVICES.GETQUESTION,\n            args: {\n                cmid: cmId,\n                sid: sessionId,\n                jqid: questionnId\n            }\n        };\n        Ajax.call([request])[0].done(function(question) {\n            Templates.render(TEMPLATES.QUESTION, question).then(function(html, js) {\n                getString('preview', 'mod_jqshow').done((title) => {\n                    ModalFactory.create({\n                        classes: 'modal_jqshow',\n                        body: html,\n                        title: title,\n                        footer: '',\n                        type: ModalJqshow.TYPE\n                    }).then(modal => {\n                        modal.getRoot().on(ModalEvents.hidden, function() {\n                            modal.destroy();\n                        });\n                        jQuery(REGION.LOADING).remove();\n                        modal.show();\n                        Templates.runTemplateJS(js);\n                    }).fail(Notification.exception);\n                }).fail(Notification.exception);\n            });\n        });\n    });\n};\n\nQuestionReport.prototype.seeAnswer = function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    let userId = jQuery(e.currentTarget).attr('data-userid');\n    let sessionId = jQuery(e.currentTarget).attr('data-sessionid');\n    let questionnId = jQuery(e.currentTarget).attr('data-questionnid');\n    let cmId = jQuery(e.currentTarget).attr('data-cmid');\n    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n        let identifier = jQuery(REGION.ROOT);\n        identifier.append(html);\n        let request = {\n            methodname: SERVICES.GETQUESTION,\n            args: {\n                cmid: cmId,\n                sid: sessionId,\n                jqid: questionnId\n            }\n        };\n        Ajax.call([request])[0].done(function(question) {\n            let requestAnswer = {\n                methodname: SERVICES.USERQUESTIONRESPONSE,\n                args: {\n                    jqid: question.jqid,\n                    cmid: cmId,\n                    sid: sessionId,\n                    uid: userId,\n                    preview: true\n                }\n            };\n            Ajax.call([requestAnswer])[0].done(function(answer) {\n                const questionData = {\n                    ...question,\n                    ...answer\n                };\n                getString('viewquestion_user', 'mod_jqshow').done((title) => {\n                    Templates.render(TEMPLATES.QUESTION, questionData).then(function(html, js) {\n                        ModalFactory.create({\n                            classes: 'modal_jqshow',\n                            body: html,\n                            title: title,\n                            footer: '',\n                            type: ModalJqshow.TYPE\n                        }).then(modal => {\n                            modal.getRoot().on(ModalEvents.hidden, function() {\n                                modal.destroy();\n                            });\n                            jQuery(REGION.LOADING).remove();\n                            modal.show();\n                            Templates.runTemplateJS(js);\n                        }).fail(Notification.exception);\n                    }).fail(Notification.exception);\n                }).fail(Notification.exception);\n            });\n        });\n    });\n};\n\nexport const questionReport = (region) => {\n    return new QuestionReport(region);\n};\n"],"names":["REGION","ACTION","SERVICES","TEMPLATES","QuestionReport","region","root","find","on","this","questionPreview","seeAnswer","prototype","e","preventDefault","stopPropagation","sessionId","currentTarget","attr","questionnId","cmId","render","visible","done","html","append","request","methodname","args","cmid","sid","jqid","call","question","then","js","title","create","classes","body","footer","type","ModalJqshow","TYPE","modal","getRoot","ModalEvents","hidden","destroy","remove","show","runTemplateJS","fail","Notification","exception","userId","requestAnswer","uid","preview","answer","questionData"],"mappings":"gwBA4CIA,YACM,kCADNA,eAES,yCAGTC,uBACiB,mCADjBA,iBAEW,4BAGXC,qBACa,yBADbA,8BAEsB,qCAGtBC,kBACS,uBADTA,mBAEU,2CASLC,eAAeC,aACfC,MAAO,mBAAOD,aACdC,KAAKC,KAAKN,wBAAwBO,GAAG,QAASC,KAAKC,sBACnDJ,KAAKC,KAAKN,kBAAkBO,GAAG,QAASC,KAAKE,WATtDP,eAAeQ,UAAUN,KAAO,KAYhCF,eAAeQ,UAAUF,gBAAkB,SAASG,GAChDA,EAAEC,iBACFD,EAAEE,sBACEC,WAAY,mBAAOH,EAAEI,eAAeC,KAAK,kBACzCC,aAAc,mBAAON,EAAEI,eAAeC,KAAK,oBAC3CE,MAAO,mBAAOP,EAAEI,eAAeC,KAAK,gCAC9BG,OAAOlB,kBAAmB,CAACmB,SAAS,IAAOC,MAAK,SAASC,OAC9C,mBAAOxB,aACbyB,OAAOD,UACdE,QAAU,CACVC,WAAYzB,qBACZ0B,KAAM,CACFC,KAAMT,KACNU,IAAKd,UACLe,KAAMZ,4BAGTa,KAAK,CAACN,UAAU,GAAGH,MAAK,SAASU,6BACxBZ,OAAOlB,mBAAoB8B,UAAUC,MAAK,SAASV,KAAMW,wBACrD,UAAW,cAAcZ,MAAMa,+BACxBC,OAAO,CAChBC,QAAS,eACTC,KAAMf,KACNY,MAAOA,MACPI,OAAQ,GACRC,KAAMC,eAAYC,OACnBT,MAAKU,QACJA,MAAMC,UAAUrC,GAAGsC,sBAAYC,QAAQ,WACnCH,MAAMI,iCAEHhD,gBAAgBiD,SACvBL,MAAMM,0BACIC,cAAchB,OACzBiB,KAAKC,sBAAaC,cACtBF,KAAKC,sBAAaC,qBAMrClD,eAAeQ,UAAUD,UAAY,SAASE,GAC1CA,EAAEC,iBACFD,EAAEE,sBACEwC,QAAS,mBAAO1C,EAAEI,eAAeC,KAAK,eACtCF,WAAY,mBAAOH,EAAEI,eAAeC,KAAK,kBACzCC,aAAc,mBAAON,EAAEI,eAAeC,KAAK,oBAC3CE,MAAO,mBAAOP,EAAEI,eAAeC,KAAK,gCAC9BG,OAAOlB,kBAAmB,CAACmB,SAAS,IAAOC,MAAK,SAASC,OAC9C,mBAAOxB,aACbyB,OAAOD,UACdE,QAAU,CACVC,WAAYzB,qBACZ0B,KAAM,CACFC,KAAMT,KACNU,IAAKd,UACLe,KAAMZ,4BAGTa,KAAK,CAACN,UAAU,GAAGH,MAAK,SAASU,cAC9BuB,cAAgB,CAChB7B,WAAYzB,8BACZ0B,KAAM,CACFG,KAAME,SAASF,KACfF,KAAMT,KACNU,IAAKd,UACLyC,IAAKF,OACLG,SAAS,kBAGZ1B,KAAK,CAACwB,gBAAgB,GAAGjC,MAAK,SAASoC,cAClCC,aAAe,IACd3B,YACA0B,4BAEG,oBAAqB,cAAcpC,MAAMa,2BACrCf,OAAOlB,mBAAoByD,cAAc1B,MAAK,SAASV,KAAMW,2BACtDE,OAAO,CAChBC,QAAS,eACTC,KAAMf,KACNY,MAAOA,MACPI,OAAQ,GACRC,KAAMC,eAAYC,OACnBT,MAAKU,QACJA,MAAMC,UAAUrC,GAAGsC,sBAAYC,QAAQ,WACnCH,MAAMI,iCAEHhD,gBAAgBiD,SACvBL,MAAMM,0BACIC,cAAchB,OACzBiB,KAAKC,sBAAaC,cACtBF,KAAKC,sBAAaC,cACtBF,KAAKC,sBAAaC,6CAMNjD,QACpB,IAAID,eAAeC"}