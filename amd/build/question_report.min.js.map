{"version":3,"file":"question_report.min.js","sources":["../src/question_report.js"],"sourcesContent":["\"use strict\";\r\n/* eslint-disable no-unused-vars */\r\n\r\nimport jQuery from 'jquery';\r\nimport Templates from 'core/templates';\r\nimport ModalFactory from 'core/modal_factory';\r\nimport ModalEvents from 'core/modal_events';\r\nimport ModalJqshow from 'mod_jqshow/modal';\r\nimport Ajax from 'core/ajax';\r\nimport Notification from 'core/notification';\r\nimport {get_string as getString} from 'core/str';\r\n\r\nlet REGION = {\r\n    ROOT: '[data-region=\"question-report\"]', // This root.\r\n    LOADING: '[data-region=\"overlay-icon-container\"]',\r\n};\r\n\r\nlet ACTION = {\r\n    QUESTIONPREVIEW: '[data-action=\"question-preview\"]',\r\n    SEEANSWER: '[data-action=\"seeanswer\"]',\r\n};\r\n\r\nlet SERVICES = {\r\n    GETQUESTION: 'mod_jqshow_getquestion',\r\n    USERQUESTIONRESPONSE: 'mod_jqshow_getuserquestionresponse'\r\n};\r\n\r\nlet TEMPLATES = {\r\n    LOADING: 'core/overlay_loading',\r\n    QUESTION: 'mod_jqshow/questions/encasement'\r\n};\r\n\r\nQuestionReport.prototype.root = null;\r\n\r\n/**\r\n * @constructor\r\n * @param {String} region\r\n */\r\nfunction QuestionReport(region) {\r\n    this.root = jQuery(region);\r\n    this.root.find(ACTION.QUESTIONPREVIEW).on('click', this.questionPreview);\r\n    this.root.find(ACTION.SEEANSWER).on('click', this.seeAnswer);\r\n}\r\n\r\nQuestionReport.prototype.questionPreview = function(e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    let sessionId = jQuery(e.currentTarget).attr('data-sessionid');\r\n    let questionnId = jQuery(e.currentTarget).attr('data-questionnid');\r\n    let cmId = jQuery(e.currentTarget).attr('data-cmid');\r\n    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\r\n        let identifier = jQuery(REGION.ROOT);\r\n        identifier.append(html);\r\n        let request = {\r\n            methodname: SERVICES.GETQUESTION,\r\n            args: {\r\n                cmid: cmId,\r\n                sid: sessionId,\r\n                jqid: questionnId\r\n            }\r\n        };\r\n        Ajax.call([request])[0].done(function(question) {\r\n            Templates.render(TEMPLATES.QUESTION, question).then(function(html, js) {\r\n                getString('preview', 'mod_jqshow').done((title) => {\r\n                    ModalFactory.create({\r\n                        classes: 'modal_jqshow',\r\n                        body: html,\r\n                        title: title,\r\n                        footer: '',\r\n                        type: ModalJqshow.TYPE\r\n                    }).then(modal => {\r\n                        modal.getRoot().on(ModalEvents.hidden, function() {\r\n                            modal.destroy();\r\n                        });\r\n                        jQuery(REGION.LOADING).remove();\r\n                        modal.show();\r\n                        Templates.runTemplateJS(js);\r\n                    }).fail(Notification.exception);\r\n                }).fail(Notification.exception);\r\n            });\r\n        });\r\n    });\r\n};\r\n\r\nQuestionReport.prototype.seeAnswer = function(e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    let userId = jQuery(e.currentTarget).attr('data-userid');\r\n    let sessionId = jQuery(e.currentTarget).attr('data-sessionid');\r\n    let questionnId = jQuery(e.currentTarget).attr('data-questionnid');\r\n    let cmId = jQuery(e.currentTarget).attr('data-cmid');\r\n    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\r\n        let identifier = jQuery(REGION.ROOT);\r\n        identifier.append(html);\r\n        let request = {\r\n            methodname: SERVICES.GETQUESTION,\r\n            args: {\r\n                cmid: cmId,\r\n                sid: sessionId,\r\n                jqid: questionnId\r\n            }\r\n        };\r\n        Ajax.call([request])[0].done(function(question) {\r\n            let requestAnswer = {\r\n                methodname: SERVICES.USERQUESTIONRESPONSE,\r\n                args: {\r\n                    jqid: question.jqid,\r\n                    cmid: cmId,\r\n                    sid: sessionId,\r\n                    uid: userId\r\n                }\r\n            };\r\n            Ajax.call([requestAnswer])[0].done(function(answer) {\r\n                const questionData = {\r\n                    ...question,\r\n                    ...answer\r\n                };\r\n                getString('viewquestion_user', 'mod_jqshow').done((title) => {\r\n                    Templates.render(TEMPLATES.QUESTION, questionData).then(function(html, js) {\r\n                        ModalFactory.create({\r\n                            classes: 'modal_jqshow',\r\n                            body: html,\r\n                            title: title,\r\n                            footer: '',\r\n                            type: ModalJqshow.TYPE\r\n                        }).then(modal => {\r\n                            modal.getRoot().on(ModalEvents.hidden, function() {\r\n                                modal.destroy();\r\n                            });\r\n                            jQuery(REGION.LOADING).remove();\r\n                            modal.show();\r\n                            Templates.runTemplateJS(js);\r\n                        }).fail(Notification.exception);\r\n                    }).fail(Notification.exception);\r\n                }).fail(Notification.exception);\r\n            });\r\n        });\r\n    });\r\n};\r\n\r\nexport const questionReport = (region) => {\r\n    return new QuestionReport(region);\r\n};\r\n"],"names":["REGION","ACTION","SERVICES","TEMPLATES","QuestionReport","region","root","find","on","this","questionPreview","seeAnswer","prototype","e","preventDefault","stopPropagation","sessionId","currentTarget","attr","questionnId","cmId","render","visible","done","html","append","request","methodname","args","cmid","sid","jqid","call","question","then","js","title","create","classes","body","footer","type","ModalJqshow","TYPE","modal","getRoot","ModalEvents","hidden","destroy","remove","show","runTemplateJS","fail","Notification","exception","userId","requestAnswer","uid","answer","questionData"],"mappings":"gwBAYIA,YACM,kCADNA,eAES,yCAGTC,uBACiB,mCADjBA,iBAEW,4BAGXC,qBACa,yBADbA,8BAEsB,qCAGtBC,kBACS,uBADTA,mBAEU,2CASLC,eAAeC,aACfC,MAAO,mBAAOD,aACdC,KAAKC,KAAKN,wBAAwBO,GAAG,QAASC,KAAKC,sBACnDJ,KAAKC,KAAKN,kBAAkBO,GAAG,QAASC,KAAKE,WATtDP,eAAeQ,UAAUN,KAAO,KAYhCF,eAAeQ,UAAUF,gBAAkB,SAASG,GAChDA,EAAEC,iBACFD,EAAEE,sBACEC,WAAY,mBAAOH,EAAEI,eAAeC,KAAK,kBACzCC,aAAc,mBAAON,EAAEI,eAAeC,KAAK,oBAC3CE,MAAO,mBAAOP,EAAEI,eAAeC,KAAK,gCAC9BG,OAAOlB,kBAAmB,CAACmB,SAAS,IAAOC,MAAK,SAASC,OAC9C,mBAAOxB,aACbyB,OAAOD,UACdE,QAAU,CACVC,WAAYzB,qBACZ0B,KAAM,CACFC,KAAMT,KACNU,IAAKd,UACLe,KAAMZ,4BAGTa,KAAK,CAACN,UAAU,GAAGH,MAAK,SAASU,6BACxBZ,OAAOlB,mBAAoB8B,UAAUC,MAAK,SAASV,KAAMW,wBACrD,UAAW,cAAcZ,MAAMa,+BACxBC,OAAO,CAChBC,QAAS,eACTC,KAAMf,KACNY,MAAOA,MACPI,OAAQ,GACRC,KAAMC,eAAYC,OACnBT,MAAKU,QACJA,MAAMC,UAAUrC,GAAGsC,sBAAYC,QAAQ,WACnCH,MAAMI,iCAEHhD,gBAAgBiD,SACvBL,MAAMM,0BACIC,cAAchB,OACzBiB,KAAKC,sBAAaC,cACtBF,KAAKC,sBAAaC,qBAMrClD,eAAeQ,UAAUD,UAAY,SAASE,GAC1CA,EAAEC,iBACFD,EAAEE,sBACEwC,QAAS,mBAAO1C,EAAEI,eAAeC,KAAK,eACtCF,WAAY,mBAAOH,EAAEI,eAAeC,KAAK,kBACzCC,aAAc,mBAAON,EAAEI,eAAeC,KAAK,oBAC3CE,MAAO,mBAAOP,EAAEI,eAAeC,KAAK,gCAC9BG,OAAOlB,kBAAmB,CAACmB,SAAS,IAAOC,MAAK,SAASC,OAC9C,mBAAOxB,aACbyB,OAAOD,UACdE,QAAU,CACVC,WAAYzB,qBACZ0B,KAAM,CACFC,KAAMT,KACNU,IAAKd,UACLe,KAAMZ,4BAGTa,KAAK,CAACN,UAAU,GAAGH,MAAK,SAASU,cAC9BuB,cAAgB,CAChB7B,WAAYzB,8BACZ0B,KAAM,CACFG,KAAME,SAASF,KACfF,KAAMT,KACNU,IAAKd,UACLyC,IAAKF,uBAGRvB,KAAK,CAACwB,gBAAgB,GAAGjC,MAAK,SAASmC,cAClCC,aAAe,IACd1B,YACAyB,4BAEG,oBAAqB,cAAcnC,MAAMa,2BACrCf,OAAOlB,mBAAoBwD,cAAczB,MAAK,SAASV,KAAMW,2BACtDE,OAAO,CAChBC,QAAS,eACTC,KAAMf,KACNY,MAAOA,MACPI,OAAQ,GACRC,KAAMC,eAAYC,OACnBT,MAAKU,QACJA,MAAMC,UAAUrC,GAAGsC,sBAAYC,QAAQ,WACnCH,MAAMI,iCAEHhD,gBAAgBiD,SACvBL,MAAMM,0BACIC,cAAchB,OACzBiB,KAAKC,sBAAaC,cACtBF,KAAKC,sBAAaC,cACtBF,KAAKC,sBAAaC,6CAMNjD,QACpB,IAAID,eAAeC"}