define("mod_jqshow/sockets",["jquery"],(function($){var REGION_MESSAGEBOX="#message-box",REGION_USERLIST="#userlist",REGION_COUNTUSERS="#countusers",ACTION_TEACHERSEND="#teacher_send",ACTION_STUDENTSEND="#student_send",ACTION_TEACHERMESSAGES="#teacher_messages",ACTION_STUDENTMESSAGES="#student_messages",portUrl="8080";function Sockets(region,port){this.root=$(region),portUrl=port,this.initSockets()}Sockets.prototype.root=null;var userid=null,username=null,messageBox=null,userlist=null,countusers=null,teacherMessages=null,studentMessages=null,isteacher=null;return Sockets.prototype.initSockets=function(){userid=this.root[0].dataset.userid,username=this.root[0].dataset.username,isteacher=this.root[0].dataset.isteacher,messageBox=this.root.find(REGION_MESSAGEBOX),userlist=this.root.find(REGION_USERLIST),countusers=this.root.find(REGION_COUNTUSERS),teacherMessages=this.root.find(ACTION_TEACHERMESSAGES),studentMessages=this.root.find(ACTION_STUDENTMESSAGES),this.root.find(ACTION_TEACHERSEND).on("click",this.teacherSend.bind(this)),this.root.find(ACTION_STUDENTSEND).on("click",this.studentSend.bind(this)),Sockets.prototype.webSocket=new WebSocket("wss://"+M.cfg.wwwroot.replace(/^https?:\/\//,"")+":"+portUrl+"/jqshow"),Sockets.prototype.webSocket.onopen=function(){var msg={id:userid,name:username,isteacher:isteacher,action:"newuser"};Sockets.prototype.sendMessageSocket(JSON.stringify(msg)),messageBox.append('<div class="system_msg" style="color:#bbbbbb">Bienvenido a Jam Quiz Show '+username+"!</div>")},Sockets.prototype.webSocket.onmessage=function(ev){var response=JSON.parse(ev.data);switch(response.action){case"newuser":void 0!==response.name&&(userlist.append('<li data-userid="'+response.userid+'">'+response.name+"</li>"),teacherMessages.append("<div>"+response.message+"</div>")),countusers.html(response.count);break;case"countusers":countusers.html(response.count);break;case"teacherSend":studentMessages.append("<div>"+response.message+"</div>");break;case"studentSend":teacherMessages.append("<div>"+response.message+"</div>");break;case"userdisconnected":$('[data-userid="'+response.id+'"]').remove(),teacherMessages.append("<div>"+response.message+"</div>"),countusers.html(response.count)}messageBox[0].scrollTop=messageBox[0].scrollHeight},Sockets.prototype.webSocket.onerror=function(ev){messageBox.append('<div class="system_error">Error Occurred - '+ev.data+"</div>")},Sockets.prototype.webSocket.onclose=function(){messageBox.append('<div class="system_msg">Connection Closed</div>')}},Sockets.prototype.teacherSend=function(){var msg={id:userid,name:username,action:"teacherSend"};Sockets.prototype.sendMessageSocket(JSON.stringify(msg))},Sockets.prototype.studentSend=function(){var msg={id:userid,name:username,action:"studentSend"};Sockets.prototype.sendMessageSocket(JSON.stringify(msg))},Sockets.prototype.sendMessageSocket=function(msg){this.webSocket.send(msg)},{initSockets:function(region,port){return new Sockets(region,port)}}}));

//# sourceMappingURL=sockets.min.js.map